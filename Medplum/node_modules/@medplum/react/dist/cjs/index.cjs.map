{
  "version": 3,
  "sources": ["../../../../node_modules/rfc6902/pointer.js", "../../../../node_modules/rfc6902/util.js", "../../../../node_modules/rfc6902/diff.js", "../../../../node_modules/rfc6902/patch.js", "../../../../node_modules/rfc6902/index.js", "../../src/index.ts", "../../../react-hooks/src/MedplumProvider/MedplumProvider.tsx", "../../../react-hooks/src/MedplumProvider/MedplumProvider.context.ts", "../../../react-hooks/src/useCachedBinaryUrl/useCachedBinaryUrl.ts", "../../../react-hooks/src/useResource/useResource.ts", "../../../react-hooks/src/useSearch/useSearch.ts", "../../../react-hooks/src/useSubscription/useSubscription.ts", "../../src/AddressDisplay/AddressDisplay.tsx", "../../src/AddressInput/AddressInput.tsx", "../../src/AnnotationInput/AnnotationInput.tsx", "../../src/AppShell/AppShell.tsx", "../../src/ErrorBoundary/ErrorBoundary.tsx", "../../../../node_modules/@tabler/icons-react/src/defaultAttributes.js", "../../../../node_modules/@tabler/icons-react/src/createReactComponent.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconAdjustmentsHorizontal.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconAlertCircle.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconArrowDown.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconArrowUp.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconBleachOff.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconBleach.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconBoxMultiple.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconBracketsContain.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconBucketOff.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconBucket.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCalendar.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCheck.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCheckbox.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconChevronDown.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCircleMinus.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCirclePlus.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCloudUpload.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconColumns.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCopy.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconCurrencyDollar.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconDots.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconEdit.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconEqualNot.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconEqual.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconFileAlert.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconFilePlus.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconFilter.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconGenderFemale.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconListDetails.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconLogout.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconMathGreater.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconMathLower.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconMessage.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconPin.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconPinnedOff.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconPlus.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconRefresh.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconSearch.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconSettings.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconSortAscending.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconSortDescending.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconSquare.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconStethoscope.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconSwitchHorizontal.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconTableExport.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconTrash.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconUserSquare.js", "../../../../node_modules/@tabler/icons-react/src/icons/IconX.js", "../../src/Loading/Loading.tsx", "../../src/AppShell/AppShell.module.css", "../../src/AppShell/Header.tsx", "../../../../node_modules/clsx/dist/clsx.m.js", "../../src/ResourceAvatar/ResourceAvatar.tsx", "../../src/MedplumLink/MedplumLink.tsx", "../../src/utils/dom.ts", "../../src/ResourceAvatar/ResourceAvatar.utils.ts", "../../src/AppShell/Header.module.css", "../../src/AppShell/HeaderDropdown.tsx", "../../src/HumanNameDisplay/HumanNameDisplay.tsx", "../../src/AppShell/HeaderSearchInput.tsx", "../../src/AsyncAutocomplete/AsyncAutocomplete.tsx", "../../src/AppShell/HeaderSearchInput.module.css", "../../src/AppShell/Navbar.tsx", "../../src/BookmarkDialog/BookmarkDialog.tsx", "../../src/Form/FormUtils.ts", "../../src/Form/Form.tsx", "../../src/ResourceTypeInput/ResourceTypeInput.tsx", "../../src/CodeInput/CodeInput.tsx", "../../src/ValueSetAutocomplete/ValueSetAutocomplete.tsx", "../../src/AppShell/Navbar.module.css", "../../src/AttachmentDisplay/AttachmentDisplay.tsx", "../../src/DescriptionList/DescriptionList.module.css", "../../src/DescriptionList/DescriptionList.tsx", "../../src/AttachmentArrayDisplay/AttachmentArrayDisplay.tsx", "../../src/AttachmentArrayInput/AttachmentArrayInput.tsx", "../../src/AttachmentButton/AttachmentButton.tsx", "../../src/AttachmentInput/AttachmentInput.tsx", "../../src/BackboneElementDisplay/BackboneElementDisplay.tsx", "../../src/constants.ts", "../../src/ResourcePropertyDisplay/ResourcePropertyDisplay.tsx", "../../src/CodeableConceptDisplay/CodeableConceptDisplay.tsx", "../../src/CodingDisplay/CodingDisplay.tsx", "../../src/ContactPointDisplay/ContactPointDisplay.tsx", "../../src/ContactDetailDisplay/ContactDetailDisplay.tsx", "../../src/IdentifierDisplay/IdentifierDisplay.tsx", "../../src/MoneyDisplay/MoneyDisplay.tsx", "../../src/QuantityDisplay/QuantityDisplay.tsx", "../../src/RangeDisplay/RangeDisplay.tsx", "../../src/RatioDisplay/RatioDisplay.tsx", "../../src/ReferenceDisplay/ReferenceDisplay.tsx", "../../src/ResourceArrayDisplay/ResourceArrayDisplay.tsx", "../../src/ElementsInput/ElementsInput.utils.ts", "../../src/ResourceArrayInput/ResourceArrayInput.utils.ts", "../../src/SliceDisplay/SliceDisplay.tsx", "../../src/utils/maybeWrapWithContext.tsx", "../../src/ExtensionDisplay/ExtensionDisplay.tsx", "../../src/ResourcePropertyDisplay/ResourcePropertyDisplay.utils.ts", "../../src/BackboneElementInput/BackboneElementInput.tsx", "../../src/ElementsInput/ElementsInput.tsx", "../../src/CheckboxFormSection/CheckboxFormSection.tsx", "../../src/FormSection/FormSection.tsx", "../../src/utils/outcomes.ts", "../../src/ResourceForm/ResourceForm.utils.ts", "../../src/ResourcePropertyInput/ResourcePropertyInput.tsx", "../../src/CodeableConceptInput/CodeableConceptInput.tsx", "../../src/CodingInput/CodingInput.tsx", "../../src/ContactDetailInput/ContactDetailInput.tsx", "../../src/ContactPointInput/ContactPointInput.tsx", "../../src/DateTimeInput/DateTimeInput.tsx", "../../src/DateTimeInput/DateTimeInput.utils.ts", "../../src/ExtensionInput/ExtensionInput.tsx", "../../src/HumanNameInput/HumanNameInput.tsx", "../../src/IdentifierInput/IdentifierInput.tsx", "../../src/MoneyInput/MoneyInput.tsx", "../../src/PeriodInput/PeriodInput.tsx", "../../src/QuantityInput/QuantityInput.tsx", "../../src/RangeInput/RangeInput.tsx", "../../src/RatioInput/RatioInput.tsx", "../../src/ReferenceInput/ReferenceInput.tsx", "../../src/ResourceInput/ResourceInput.tsx", "../../src/ResourceArrayInput/ResourceArrayInput.tsx", "../../src/SliceInput/SliceInput.tsx", "../../src/buttons/ArrayAddButton.tsx", "../../src/buttons/ArrayRemoveButton.tsx", "../../src/ResourceArrayInput/ResourceArrayInput.module.css", "../../src/SensitiveTextarea/SensitiveTextarea.tsx", "../../src/TimingInput/TimingInput.tsx", "../../src/CalendarInput/CalendarInput.tsx", "../../src/CalendarInput/CalendarInput.module.css", "../../src/CalendarInput/CalendarInput.utils.ts", "../../src/Container/Container.tsx", "../../src/Container/Container.module.css", "../../src/ResourceTimeline/ResourceTimeline.tsx", "../../src/DiagnosticReportDisplay/DiagnosticReportDisplay.tsx", "../../src/NoteDisplay/NoteDisplay.tsx", "../../src/NoteDisplay/NoteDisplay.module.css", "../../src/ResourceBadge/ResourceBadge.tsx", "../../src/ResourceName/ResourceName.tsx", "../../src/StatusBadge/StatusBadge.tsx", "../../src/DiagnosticReportDisplay/DiagnosticReportDisplay.module.css", "../../src/Panel/Panel.tsx", "../../src/Panel/Panel.module.css", "../../src/ResourceDiffTable/ResourceDiffTable.tsx", "../../src/ResourceDiffTable/ResourceDiffTable.module.css", "../../src/ResourceTable/ResourceTable.tsx", "../../src/Timeline/Timeline.tsx", "../../src/utils/date.ts", "../../src/ResourceTimeline/ResourceTimeline.module.css", "../../src/DefaultResourceTimeline/DefaultResourceTimeline.tsx", "../../src/Document/Document.tsx", "../../src/EncounterTimeline/EncounterTimeline.tsx", "../../src/FhirPathTable/FhirPathTable.tsx", "../../src/FhirPathDisplay/FhirPathDisplay.tsx", "../../src/SearchControl/SearchControl.tsx", "../../src/SearchExportDialog/SearchExportDialog.tsx", "../../src/SearchFieldEditor/SearchFieldEditor.tsx", "../../src/SearchControl/SearchUtils.tsx", "../../src/SearchFilterEditor/SearchFilterEditor.tsx", "../../src/SearchFilterValueDisplay/SearchFilterValueDisplay.tsx", "../../src/SearchFilterValueInput/SearchFilterValueInput.tsx", "../../src/SearchFilterValueDialog/SearchFilterValueDialog.tsx", "../../src/SearchPopupMenu/SearchPopupMenu.tsx", "../../src/SearchControl/SearchControl.module.css", "../../src/SearchControl/SearchControlField.ts", "../../src/Logo/Logo.tsx", "../../src/MeasureReportDisplay/MeasureReportDisplay.tsx", "../../src/MeasureReportDisplay/MeasureReportGroupDisplay/MeasureReportGroupDisplay.tsx", "../../src/NotificationIcon/NotificationIcon.tsx", "../../src/OperationOutcomeAlert/OperationOutcomeAlert.tsx", "../../src/PatientSummary/PatientSummary.tsx", "../../src/PatientSummary/Allergies.tsx", "../../src/PatientSummary/Medications.tsx", "../../src/PatientSummary/ProblemList.tsx", "../../src/PatientSummary/SmokingStatus.tsx", "../../src/PatientSummary/Vitals.tsx", "../../src/PatientSummary/Vitals.utils.ts", "../../src/PatientTimeline/PatientTimeline.tsx", "../../src/PlanDefinitionBuilder/PlanDefinitionBuilder.tsx", "../../src/PlanDefinitionBuilder/PlanDefinitionBuilder.module.css", "../../src/QuestionnaireBuilder/QuestionnaireBuilder.tsx", "../../src/QuestionnaireForm/QuestionnaireFormItem/QuestionnaireFormItem.tsx", "../../src/utils/questionnaire.ts", "../../src/QuestionnaireForm/QuestionnaireForm.context.ts", "../../src/QuestionnaireBuilder/QuestionnaireBuilder.module.css", "../../src/QuestionnaireForm/QuestionnaireForm.tsx", "../../src/QuestionnaireForm/QuestionnaireFormComponents/QuestionnaireFormPageSequence.tsx", "../../src/QuestionnaireForm/QuestionnaireFormItem/QuestionnaireRepeatableItem.tsx", "../../src/QuestionnaireForm/QuestionnaireFormComponents/QuestionnaireFormGroup.tsx", "../../src/ReferenceRangeEditor/ReferenceRangeEditor.tsx", "../../src/ReferenceRangeEditor/ReferenceRangeEditor.module.css", "../../src/RequestGroupDisplay/RequestGroupDisplay.tsx", "../../src/ResourceBlame/ResourceBlame.tsx", "../../src/utils/blame.ts", "../../src/utils/diff.ts", "../../src/ResourceBlame/ResourceBlame.module.css", "../../src/ResourceBlame/ResourceBlame.utils.ts", "../../src/ResourceDiff/ResourceDiff.tsx", "../../src/ResourceDiff/ResourceDiff.module.css", "../../src/ResourceForm/ResourceForm.tsx", "../../src/ResourceHistoryTable/ResourceHistoryTable.tsx", "../../src/Scheduler/Scheduler.tsx", "../../src/Scheduler/Scheduler.module.css", "../../src/ServiceRequestTimeline/ServiceRequestTimeline.tsx", "../../src/SmartAppLaunchLink/SmartAppLaunchLink.tsx", "../../src/auth/RegisterForm.tsx", "../../src/auth/NewProjectForm.tsx", "../../src/auth/NewUserForm.tsx", "../../src/GoogleButton/GoogleButton.tsx", "../../src/utils/script.ts", "../../src/GoogleButton/GoogleButton.utils.ts", "../../src/utils/recaptcha.ts", "../../src/auth/SignInForm.tsx", "../../src/auth/AuthenticationForm.tsx", "../../src/auth/ChooseProfileForm.tsx", "../../src/auth/ChooseScopeForm.tsx", "../../src/auth/MfaForm.tsx"],
  "sourcesContent": ["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Pointer = void 0;\n/**\nUnescape token part of a JSON Pointer string\n\n`token` should *not* contain any '/' characters.\n\n> Evaluation of each reference token begins by decoding any escaped\n> character sequence.  This is performed by first transforming any\n> occurrence of the sequence '~1' to '/', and then transforming any\n> occurrence of the sequence '~0' to '~'.  By performing the\n> substitutions in this order, an implementation avoids the error of\n> turning '~01' first into '~1' and then into '/', which would be\n> incorrect (the string '~01' correctly becomes '~1' after\n> transformation).\n\nHere's my take:\n\n~1 is unescaped with higher priority than ~0 because it is a lower-order escape character.\nI say \"lower order\" because '/' needs escaping due to the JSON Pointer serialization technique.\nWhereas, '~' is escaped because escaping '/' uses the '~' character.\n*/\nfunction unescape(token) {\n    return token.replace(/~1/g, '/').replace(/~0/g, '~');\n}\n/** Escape token part of a JSON Pointer string\n\n> '~' needs to be encoded as '~0' and '/'\n> needs to be encoded as '~1' when these characters appear in a\n> reference token.\n\nThis is the exact inverse of `unescape()`, so the reverse replacements must take place in reverse order.\n*/\nfunction escape(token) {\n    return token.replace(/~/g, '~0').replace(/\\//g, '~1');\n}\n/**\nJSON Pointer representation\n*/\nvar Pointer = /** @class */ (function () {\n    function Pointer(tokens) {\n        if (tokens === void 0) { tokens = ['']; }\n        this.tokens = tokens;\n    }\n    /**\n    `path` *must* be a properly escaped string.\n    */\n    Pointer.fromJSON = function (path) {\n        var tokens = path.split('/').map(unescape);\n        if (tokens[0] !== '')\n            throw new Error(\"Invalid JSON Pointer: \".concat(path));\n        return new Pointer(tokens);\n    };\n    Pointer.prototype.toString = function () {\n        return this.tokens.map(escape).join('/');\n    };\n    /**\n    Returns an object with 'parent', 'key', and 'value' properties.\n    In the special case that this Pointer's path == \"\",\n    this object will be {parent: null, key: '', value: object}.\n    Otherwise, parent and key will have the property such that parent[key] == value.\n    */\n    Pointer.prototype.evaluate = function (object) {\n        var parent = null;\n        var key = '';\n        var value = object;\n        for (var i = 1, l = this.tokens.length; i < l; i++) {\n            parent = value;\n            key = this.tokens[i];\n            if (key == '__proto__' || key == 'constructor' || key == 'prototype') {\n                continue;\n            }\n            // not sure if this the best way to handle non-existant paths...\n            value = (parent || {})[key];\n        }\n        return { parent: parent, key: key, value: value };\n    };\n    Pointer.prototype.get = function (object) {\n        return this.evaluate(object).value;\n    };\n    Pointer.prototype.set = function (object, value) {\n        var endpoint = this.evaluate(object);\n        if (endpoint.parent) {\n            endpoint.parent[endpoint.key] = value;\n        }\n    };\n    Pointer.prototype.push = function (token) {\n        // mutable\n        this.tokens.push(token);\n    };\n    /**\n    `token` should be a String. It'll be coerced to one anyway.\n  \n    immutable (shallowly)\n    */\n    Pointer.prototype.add = function (token) {\n        var tokens = this.tokens.concat(String(token));\n        return new Pointer(tokens);\n    };\n    return Pointer;\n}());\nexports.Pointer = Pointer;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.clone = exports.objectType = exports.hasOwnProperty = void 0;\nexports.hasOwnProperty = Object.prototype.hasOwnProperty;\nfunction objectType(object) {\n    if (object === undefined) {\n        return 'undefined';\n    }\n    if (object === null) {\n        return 'null';\n    }\n    if (Array.isArray(object)) {\n        return 'array';\n    }\n    return typeof object;\n}\nexports.objectType = objectType;\nfunction isNonPrimitive(value) {\n    // loose-equality checking for null is faster than strict checking for each of null/undefined/true/false\n    // checking null first, then calling typeof, is faster than vice-versa\n    return value != null && typeof value == 'object';\n}\n/**\nRecursively copy a value.\n\n@param source - should be a JavaScript primitive, Array, Date, or (plain old) Object.\n@returns copy of source where every Array and Object have been recursively\n         reconstructed from their constituent elements\n*/\nfunction clone(source) {\n    if (!isNonPrimitive(source)) {\n        // short-circuiting is faster than a single return\n        return source;\n    }\n    // x.constructor == Array is the fastest way to check if x is an Array\n    if (source.constructor == Array) {\n        // construction via imperative for-loop is faster than source.map(arrayVsObject)\n        var length_1 = source.length;\n        // setting the Array length during construction is faster than just `[]` or `new Array()`\n        var arrayTarget = new Array(length_1);\n        for (var i = 0; i < length_1; i++) {\n            arrayTarget[i] = clone(source[i]);\n        }\n        return arrayTarget;\n    }\n    // Date\n    if (source.constructor == Date) {\n        var dateTarget = new Date(+source);\n        return dateTarget;\n    }\n    // Object\n    var objectTarget = {};\n    // declaring the variable (with const) inside the loop is faster\n    for (var key in source) {\n        // hasOwnProperty costs a bit of performance, but it's semantically necessary\n        // using a global helper is MUCH faster than calling source.hasOwnProperty(key)\n        if (exports.hasOwnProperty.call(source, key)) {\n            objectTarget[key] = clone(source[key]);\n        }\n    }\n    return objectTarget;\n}\nexports.clone = clone;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.diffAny = exports.diffObjects = exports.diffArrays = exports.intersection = exports.subtract = exports.isDestructive = void 0;\nvar util_1 = require(\"./util\");\nfunction isDestructive(_a) {\n    var op = _a.op;\n    return op === 'remove' || op === 'replace' || op === 'copy' || op === 'move';\n}\nexports.isDestructive = isDestructive;\n/**\nList the keys in `minuend` that are not in `subtrahend`.\n\nA key is only considered if it is both 1) an own-property (o.hasOwnProperty(k))\nof the object, and 2) has a value that is not undefined. This is to match JSON\nsemantics, where JSON object serialization drops keys with undefined values.\n\n@param minuend Object of interest\n@param subtrahend Object of comparison\n@returns Array of keys that are in `minuend` but not in `subtrahend`.\n*/\nfunction subtract(minuend, subtrahend) {\n    // initialize empty object; we only care about the keys, the values can be anything\n    var obj = {};\n    // build up obj with all the properties of minuend\n    for (var add_key in minuend) {\n        if (util_1.hasOwnProperty.call(minuend, add_key) && minuend[add_key] !== undefined) {\n            obj[add_key] = 1;\n        }\n    }\n    // now delete all the properties of subtrahend from obj\n    // (deleting a missing key has no effect)\n    for (var del_key in subtrahend) {\n        if (util_1.hasOwnProperty.call(subtrahend, del_key) && subtrahend[del_key] !== undefined) {\n            delete obj[del_key];\n        }\n    }\n    // finally, extract whatever keys remain in obj\n    return Object.keys(obj);\n}\nexports.subtract = subtract;\n/**\nList the keys that shared by all `objects`.\n\nThe semantics of what constitutes a \"key\" is described in {@link subtract}.\n\n@param objects Array of objects to compare\n@returns Array of keys that are in (\"own-properties\" of) every object in `objects`.\n*/\nfunction intersection(objects) {\n    var length = objects.length;\n    // prepare empty counter to keep track of how many objects each key occurred in\n    var counter = {};\n    // go through each object and increment the counter for each key in that object\n    for (var i = 0; i < length; i++) {\n        var object = objects[i];\n        for (var key in object) {\n            if (util_1.hasOwnProperty.call(object, key) && object[key] !== undefined) {\n                counter[key] = (counter[key] || 0) + 1;\n            }\n        }\n    }\n    // now delete all keys from the counter that were not seen in every object\n    for (var key in counter) {\n        if (counter[key] < length) {\n            delete counter[key];\n        }\n    }\n    // finally, extract whatever keys remain in the counter\n    return Object.keys(counter);\n}\nexports.intersection = intersection;\nfunction isArrayAdd(array_operation) {\n    return array_operation.op === 'add';\n}\nfunction isArrayRemove(array_operation) {\n    return array_operation.op === 'remove';\n}\nfunction appendArrayOperation(base, operation) {\n    return {\n        // the new operation must be pushed on the end\n        operations: base.operations.concat(operation),\n        cost: base.cost + 1,\n    };\n}\n/**\nCalculate the shortest sequence of operations to get from `input` to `output`,\nusing a dynamic programming implementation of the Levenshtein distance algorithm.\n\nTo get from the input ABC to the output AZ we could just delete all the input\nand say \"insert A, insert Z\" and be done with it. That's what we do if the\ninput is empty. But we can be smarter.\n\n          output\n               A   Z\n               -   -\n          [0]  1   2\ninput A |  1  [0]  1\n      B |  2  [1]  1\n      C |  3   2  [2]\n\n1) start at 0,0 (+0)\n2) keep A (+0)\n3) remove B (+1)\n4) replace C with Z (+1)\n\nIf the `input` (source) is empty, they'll all be in the top row, resulting in an\narray of 'add' operations.\nIf the `output` (target) is empty, everything will be in the left column,\nresulting in an array of 'remove' operations.\n\n@returns A list of add/remove/replace operations.\n*/\nfunction diffArrays(input, output, ptr, diff) {\n    if (diff === void 0) { diff = diffAny; }\n    // set up cost matrix (very simple initialization: just a map)\n    var memo = {\n        '0,0': { operations: [], cost: 0 },\n    };\n    /**\n    Calculate the cheapest sequence of operations required to get from\n    input.slice(0, i) to output.slice(0, j).\n    There may be other valid sequences with the same cost, but none cheaper.\n  \n    @param i The row in the layout above\n    @param j The column in the layout above\n    @returns An object containing a list of operations, along with the total cost\n             of applying them (+1 for each add/remove/replace operation)\n    */\n    function dist(i, j) {\n        // memoized\n        var memo_key = \"\".concat(i, \",\").concat(j);\n        var memoized = memo[memo_key];\n        if (memoized === undefined) {\n            // TODO: this !diff(...).length usage could/should be lazy\n            if (i > 0 && j > 0 && !diff(input[i - 1], output[j - 1], ptr.add(String(i - 1))).length) {\n                // equal (no operations => no cost)\n                memoized = dist(i - 1, j - 1);\n            }\n            else {\n                var alternatives = [];\n                if (i > 0) {\n                    // NOT topmost row\n                    var remove_base = dist(i - 1, j);\n                    var remove_operation = {\n                        op: 'remove',\n                        index: i - 1,\n                    };\n                    alternatives.push(appendArrayOperation(remove_base, remove_operation));\n                }\n                if (j > 0) {\n                    // NOT leftmost column\n                    var add_base = dist(i, j - 1);\n                    var add_operation = {\n                        op: 'add',\n                        index: i - 1,\n                        value: output[j - 1],\n                    };\n                    alternatives.push(appendArrayOperation(add_base, add_operation));\n                }\n                if (i > 0 && j > 0) {\n                    // TABLE MIDDLE\n                    // supposing we replaced it, compute the rest of the costs:\n                    var replace_base = dist(i - 1, j - 1);\n                    // okay, the general plan is to replace it, but we can be smarter,\n                    // recursing into the structure and replacing only part of it if\n                    // possible, but to do so we'll need the original value\n                    var replace_operation = {\n                        op: 'replace',\n                        index: i - 1,\n                        original: input[i - 1],\n                        value: output[j - 1],\n                    };\n                    alternatives.push(appendArrayOperation(replace_base, replace_operation));\n                }\n                // the only other case, i === 0 && j === 0, has already been memoized\n                // the meat of the algorithm:\n                // sort by cost to find the lowest one (might be several ties for lowest)\n                // [4, 6, 7, 1, 2].sort((a, b) => a - b) -> [ 1, 2, 4, 6, 7 ]\n                var best = alternatives.sort(function (a, b) { return a.cost - b.cost; })[0];\n                memoized = best;\n            }\n            memo[memo_key] = memoized;\n        }\n        return memoized;\n    }\n    // handle weird objects masquerading as Arrays that don't have proper length\n    // properties by using 0 for everything but positive numbers\n    var input_length = (isNaN(input.length) || input.length <= 0) ? 0 : input.length;\n    var output_length = (isNaN(output.length) || output.length <= 0) ? 0 : output.length;\n    var array_operations = dist(input_length, output_length).operations;\n    var padded_operations = array_operations.reduce(function (_a, array_operation) {\n        var operations = _a[0], padding = _a[1];\n        if (isArrayAdd(array_operation)) {\n            var padded_index = array_operation.index + 1 + padding;\n            var index_token = padded_index < (input_length + padding) ? String(padded_index) : '-';\n            var operation = {\n                op: array_operation.op,\n                path: ptr.add(index_token).toString(),\n                value: array_operation.value,\n            };\n            // padding++ // maybe only if array_operation.index > -1 ?\n            return [operations.concat(operation), padding + 1];\n        }\n        else if (isArrayRemove(array_operation)) {\n            var operation = {\n                op: array_operation.op,\n                path: ptr.add(String(array_operation.index + padding)).toString(),\n            };\n            // padding--\n            return [operations.concat(operation), padding - 1];\n        }\n        else { // replace\n            var replace_ptr = ptr.add(String(array_operation.index + padding));\n            var replace_operations = diff(array_operation.original, array_operation.value, replace_ptr);\n            return [operations.concat.apply(operations, replace_operations), padding];\n        }\n    }, [[], 0])[0];\n    return padded_operations;\n}\nexports.diffArrays = diffArrays;\nfunction diffObjects(input, output, ptr, diff) {\n    if (diff === void 0) { diff = diffAny; }\n    // if a key is in input but not output -> remove it\n    var operations = [];\n    subtract(input, output).forEach(function (key) {\n        operations.push({ op: 'remove', path: ptr.add(key).toString() });\n    });\n    // if a key is in output but not input -> add it\n    subtract(output, input).forEach(function (key) {\n        operations.push({ op: 'add', path: ptr.add(key).toString(), value: output[key] });\n    });\n    // if a key is in both, diff it recursively\n    intersection([input, output]).forEach(function (key) {\n        operations.push.apply(operations, diff(input[key], output[key], ptr.add(key)));\n    });\n    return operations;\n}\nexports.diffObjects = diffObjects;\n/**\n`diffAny()` returns an empty array if `input` and `output` are materially equal\n(i.e., would produce equivalent JSON); otherwise it produces an array of patches\nthat would transform `input` into `output`.\n\n> Here, \"equal\" means that the value at the target location and the\n> value conveyed by \"value\" are of the same JSON type, and that they\n> are considered equal by the following rules for that type:\n> o  strings: are considered equal if they contain the same number of\n>    Unicode characters and their code points are byte-by-byte equal.\n> o  numbers: are considered equal if their values are numerically\n>    equal.\n> o  arrays: are considered equal if they contain the same number of\n>    values, and if each value can be considered equal to the value at\n>    the corresponding position in the other array, using this list of\n>    type-specific rules.\n> o  objects: are considered equal if they contain the same number of\n>    members, and if each member can be considered equal to a member in\n>    the other object, by comparing their keys (as strings) and their\n>    values (using this list of type-specific rules).\n> o  literals (false, true, and null): are considered equal if they are\n>    the same.\n*/\nfunction diffAny(input, output, ptr, diff) {\n    if (diff === void 0) { diff = diffAny; }\n    // strict equality handles literals, numbers, and strings (a sufficient but not necessary cause)\n    if (input === output) {\n        return [];\n    }\n    var input_type = (0, util_1.objectType)(input);\n    var output_type = (0, util_1.objectType)(output);\n    if (input_type == 'array' && output_type == 'array') {\n        return diffArrays(input, output, ptr, diff);\n    }\n    if (input_type == 'object' && output_type == 'object') {\n        return diffObjects(input, output, ptr, diff);\n    }\n    // at this point we know that input and output are materially different;\n    // could be array -> object, object -> array, boolean -> undefined,\n    // number -> string, or some other combination, but nothing that can be split\n    // up into multiple patches: so `output` must replace `input` wholesale.\n    return [{ op: 'replace', path: ptr.toString(), value: output }];\n}\nexports.diffAny = diffAny;\n", "\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.apply = exports.InvalidOperationError = exports.test = exports.copy = exports.move = exports.replace = exports.remove = exports.add = exports.TestError = exports.MissingError = void 0;\nvar pointer_1 = require(\"./pointer\");\nvar util_1 = require(\"./util\");\nvar diff_1 = require(\"./diff\");\nvar MissingError = /** @class */ (function (_super) {\n    __extends(MissingError, _super);\n    function MissingError(path) {\n        var _this = _super.call(this, \"Value required at path: \".concat(path)) || this;\n        _this.path = path;\n        _this.name = 'MissingError';\n        return _this;\n    }\n    return MissingError;\n}(Error));\nexports.MissingError = MissingError;\nvar TestError = /** @class */ (function (_super) {\n    __extends(TestError, _super);\n    function TestError(actual, expected) {\n        var _this = _super.call(this, \"Test failed: \".concat(actual, \" != \").concat(expected)) || this;\n        _this.actual = actual;\n        _this.expected = expected;\n        _this.name = 'TestError';\n        return _this;\n    }\n    return TestError;\n}(Error));\nexports.TestError = TestError;\nfunction _add(object, key, value) {\n    if (Array.isArray(object)) {\n        // `key` must be an index\n        if (key == '-') {\n            object.push(value);\n        }\n        else {\n            var index = parseInt(key, 10);\n            object.splice(index, 0, value);\n        }\n    }\n    else {\n        object[key] = value;\n    }\n}\nfunction _remove(object, key) {\n    if (Array.isArray(object)) {\n        // '-' syntax doesn't make sense when removing\n        var index = parseInt(key, 10);\n        object.splice(index, 1);\n    }\n    else {\n        // not sure what the proper behavior is when path = ''\n        delete object[key];\n    }\n}\n/**\n>  o  If the target location specifies an array index, a new value is\n>     inserted into the array at the specified index.\n>  o  If the target location specifies an object member that does not\n>     already exist, a new member is added to the object.\n>  o  If the target location specifies an object member that does exist,\n>     that member's value is replaced.\n*/\nfunction add(object, operation) {\n    var endpoint = pointer_1.Pointer.fromJSON(operation.path).evaluate(object);\n    // it's not exactly a \"MissingError\" in the same way that `remove` is -- more like a MissingParent, or something\n    if (endpoint.parent === undefined) {\n        return new MissingError(operation.path);\n    }\n    _add(endpoint.parent, endpoint.key, (0, util_1.clone)(operation.value));\n    return null;\n}\nexports.add = add;\n/**\n> The \"remove\" operation removes the value at the target location.\n> The target location MUST exist for the operation to be successful.\n*/\nfunction remove(object, operation) {\n    // endpoint has parent, key, and value properties\n    var endpoint = pointer_1.Pointer.fromJSON(operation.path).evaluate(object);\n    if (endpoint.value === undefined) {\n        return new MissingError(operation.path);\n    }\n    // not sure what the proper behavior is when path = ''\n    _remove(endpoint.parent, endpoint.key);\n    return null;\n}\nexports.remove = remove;\n/**\n> The \"replace\" operation replaces the value at the target location\n> with a new value.  The operation object MUST contain a \"value\" member\n> whose content specifies the replacement value.\n> The target location MUST exist for the operation to be successful.\n\n> This operation is functionally identical to a \"remove\" operation for\n> a value, followed immediately by an \"add\" operation at the same\n> location with the replacement value.\n\nEven more simply, it's like the add operation with an existence check.\n*/\nfunction replace(object, operation) {\n    var endpoint = pointer_1.Pointer.fromJSON(operation.path).evaluate(object);\n    if (endpoint.parent === null) {\n        return new MissingError(operation.path);\n    }\n    // this existence check treats arrays as a special case\n    if (Array.isArray(endpoint.parent)) {\n        if (parseInt(endpoint.key, 10) >= endpoint.parent.length) {\n            return new MissingError(operation.path);\n        }\n    }\n    else if (endpoint.value === undefined) {\n        return new MissingError(operation.path);\n    }\n    endpoint.parent[endpoint.key] = (0, util_1.clone)(operation.value);\n    return null;\n}\nexports.replace = replace;\n/**\n> The \"move\" operation removes the value at a specified location and\n> adds it to the target location.\n> The operation object MUST contain a \"from\" member, which is a string\n> containing a JSON Pointer value that references the location in the\n> target document to move the value from.\n> This operation is functionally identical to a \"remove\" operation on\n> the \"from\" location, followed immediately by an \"add\" operation at\n> the target location with the value that was just removed.\n\n> The \"from\" location MUST NOT be a proper prefix of the \"path\"\n> location; i.e., a location cannot be moved into one of its children.\n\nTODO: throw if the check described in the previous paragraph fails.\n*/\nfunction move(object, operation) {\n    var from_endpoint = pointer_1.Pointer.fromJSON(operation.from).evaluate(object);\n    if (from_endpoint.value === undefined) {\n        return new MissingError(operation.from);\n    }\n    var endpoint = pointer_1.Pointer.fromJSON(operation.path).evaluate(object);\n    if (endpoint.parent === undefined) {\n        return new MissingError(operation.path);\n    }\n    _remove(from_endpoint.parent, from_endpoint.key);\n    _add(endpoint.parent, endpoint.key, from_endpoint.value);\n    return null;\n}\nexports.move = move;\n/**\n> The \"copy\" operation copies the value at a specified location to the\n> target location.\n> The operation object MUST contain a \"from\" member, which is a string\n> containing a JSON Pointer value that references the location in the\n> target document to copy the value from.\n> The \"from\" location MUST exist for the operation to be successful.\n\n> This operation is functionally identical to an \"add\" operation at the\n> target location using the value specified in the \"from\" member.\n\nAlternatively, it's like 'move' without the 'remove'.\n*/\nfunction copy(object, operation) {\n    var from_endpoint = pointer_1.Pointer.fromJSON(operation.from).evaluate(object);\n    if (from_endpoint.value === undefined) {\n        return new MissingError(operation.from);\n    }\n    var endpoint = pointer_1.Pointer.fromJSON(operation.path).evaluate(object);\n    if (endpoint.parent === undefined) {\n        return new MissingError(operation.path);\n    }\n    _add(endpoint.parent, endpoint.key, (0, util_1.clone)(from_endpoint.value));\n    return null;\n}\nexports.copy = copy;\n/**\n> The \"test\" operation tests that a value at the target location is\n> equal to a specified value.\n> The operation object MUST contain a \"value\" member that conveys the\n> value to be compared to the target location's value.\n> The target location MUST be equal to the \"value\" value for the\n> operation to be considered successful.\n*/\nfunction test(object, operation) {\n    var endpoint = pointer_1.Pointer.fromJSON(operation.path).evaluate(object);\n    // TODO: this diffAny(...).length usage could/should be lazy\n    if ((0, diff_1.diffAny)(endpoint.value, operation.value, new pointer_1.Pointer()).length) {\n        return new TestError(endpoint.value, operation.value);\n    }\n    return null;\n}\nexports.test = test;\nvar InvalidOperationError = /** @class */ (function (_super) {\n    __extends(InvalidOperationError, _super);\n    function InvalidOperationError(operation) {\n        var _this = _super.call(this, \"Invalid operation: \".concat(operation.op)) || this;\n        _this.operation = operation;\n        _this.name = 'InvalidOperationError';\n        return _this;\n    }\n    return InvalidOperationError;\n}(Error));\nexports.InvalidOperationError = InvalidOperationError;\n/**\nSwitch on `operation.op`, applying the corresponding patch function for each\ncase to `object`.\n*/\nfunction apply(object, operation) {\n    // not sure why TypeScript can't infer typesafety of:\n    //   {add, remove, replace, move, copy, test}[operation.op](object, operation)\n    // (seems like a bug)\n    switch (operation.op) {\n        case 'add': return add(object, operation);\n        case 'remove': return remove(object, operation);\n        case 'replace': return replace(object, operation);\n        case 'move': return move(object, operation);\n        case 'copy': return copy(object, operation);\n        case 'test': return test(object, operation);\n    }\n    return new InvalidOperationError(operation);\n}\nexports.apply = apply;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createTests = exports.createPatch = exports.applyPatch = exports.Pointer = void 0;\nvar pointer_1 = require(\"./pointer\");\nObject.defineProperty(exports, \"Pointer\", { enumerable: true, get: function () { return pointer_1.Pointer; } });\nvar patch_1 = require(\"./patch\");\nvar diff_1 = require(\"./diff\");\n/**\nApply a 'application/json-patch+json'-type patch to an object.\n\n`patch` *must* be an array of operations.\n\n> Operation objects MUST have exactly one \"op\" member, whose value\n> indicates the operation to perform.  Its value MUST be one of \"add\",\n> \"remove\", \"replace\", \"move\", \"copy\", or \"test\"; other values are\n> errors.\n\nThis method mutates the target object in-place.\n\n@returns list of results, one for each operation: `null` indicated success,\n         otherwise, the result will be an instance of one of the Error classes:\n         MissingError, InvalidOperationError, or TestError.\n*/\nfunction applyPatch(object, patch) {\n    return patch.map(function (operation) { return (0, patch_1.apply)(object, operation); });\n}\nexports.applyPatch = applyPatch;\nfunction wrapVoidableDiff(diff) {\n    function wrappedDiff(input, output, ptr) {\n        var custom_patch = diff(input, output, ptr);\n        // ensure an array is always returned\n        return Array.isArray(custom_patch) ? custom_patch : (0, diff_1.diffAny)(input, output, ptr, wrappedDiff);\n    }\n    return wrappedDiff;\n}\n/**\nProduce a 'application/json-patch+json'-type patch to get from one object to\nanother.\n\nThis does not alter `input` or `output` unless they have a property getter with\nside-effects (which is not a good idea anyway).\n\n`diff` is called on each pair of comparable non-primitive nodes in the\n`input`/`output` object trees, producing nested patches. Return `undefined`\nto fall back to default behaviour.\n\nReturns list of operations to perform on `input` to produce `output`.\n*/\nfunction createPatch(input, output, diff) {\n    var ptr = new pointer_1.Pointer();\n    // a new Pointer gets a default path of [''] if not specified\n    return (diff ? wrapVoidableDiff(diff) : diff_1.diffAny)(input, output, ptr);\n}\nexports.createPatch = createPatch;\n/**\nCreate a test operation based on `input`'s current evaluation of the JSON\nPointer `path`; if such a pointer cannot be resolved, returns undefined.\n*/\nfunction createTest(input, path) {\n    var endpoint = pointer_1.Pointer.fromJSON(path).evaluate(input);\n    if (endpoint !== undefined) {\n        return { op: 'test', path: path, value: endpoint.value };\n    }\n}\n/**\nProduce an 'application/json-patch+json'-type list of tests, to verify that\nexisting values in an object are identical to the those captured at some\ncheckpoint (whenever this function is called).\n\nThis does not alter `input` or `output` unless they have a property getter with\nside-effects (which is not a good idea anyway).\n\nReturns list of test operations.\n*/\nfunction createTests(input, patch) {\n    var tests = new Array();\n    patch.filter(diff_1.isDestructive).forEach(function (operation) {\n        var pathTest = createTest(input, operation.path);\n        if (pathTest)\n            tests.push(pathTest);\n        if ('from' in operation) {\n            var fromTest = createTest(input, operation.from);\n            if (fromTest)\n                tests.push(fromTest);\n        }\n    });\n    return tests;\n}\nexports.createTests = createTests;\n", "// Re-export all hooks from @medplum/react-hooks\nexport * from '@medplum/react-hooks';\n\n// Export all components\nexport * from './AddressDisplay/AddressDisplay';\nexport * from './AddressInput/AddressInput';\nexport * from './AnnotationInput/AnnotationInput';\nexport * from './AppShell/AppShell';\nexport * from './AppShell/Header';\nexport * from './AppShell/Navbar';\nexport * from './AsyncAutocomplete/AsyncAutocomplete';\nexport * from './AttachmentArrayDisplay/AttachmentArrayDisplay';\nexport * from './AttachmentArrayInput/AttachmentArrayInput';\nexport * from './AttachmentButton/AttachmentButton';\nexport * from './AttachmentDisplay/AttachmentDisplay';\nexport * from './AttachmentInput/AttachmentInput';\nexport * from './BackboneElementDisplay/BackboneElementDisplay';\nexport * from './BackboneElementInput/BackboneElementInput';\nexport * from './CalendarInput/CalendarInput';\nexport * from './CheckboxFormSection/CheckboxFormSection';\nexport * from './CodeInput/CodeInput';\nexport * from './CodeableConceptDisplay/CodeableConceptDisplay';\nexport * from './CodeableConceptInput/CodeableConceptInput';\nexport * from './CodingDisplay/CodingDisplay';\nexport * from './CodingInput/CodingInput';\nexport * from './ContactDetailDisplay/ContactDetailDisplay';\nexport * from './ContactDetailInput/ContactDetailInput';\nexport * from './ContactPointDisplay/ContactPointDisplay';\nexport * from './ContactPointInput/ContactPointInput';\nexport * from './Container/Container';\nexport * from './DateTimeInput/DateTimeInput';\nexport * from './DateTimeInput/DateTimeInput.utils';\nexport * from './DefaultResourceTimeline/DefaultResourceTimeline';\nexport * from './DescriptionList/DescriptionList';\nexport * from './DiagnosticReportDisplay/DiagnosticReportDisplay';\nexport * from './Document/Document';\nexport * from './EncounterTimeline/EncounterTimeline';\nexport * from './ErrorBoundary/ErrorBoundary';\nexport * from './FhirPathTable/FhirPathTable';\nexport * from './Form/Form';\nexport * from './Form/FormUtils';\nexport * from './FormSection/FormSection';\nexport * from './HumanNameDisplay/HumanNameDisplay';\nexport * from './HumanNameInput/HumanNameInput';\nexport * from './IdentifierDisplay/IdentifierDisplay';\nexport * from './IdentifierInput/IdentifierInput';\nexport * from './Loading/Loading';\nexport * from './Logo/Logo';\nexport * from './MeasureReportDisplay/MeasureReportDisplay';\nexport * from './MedplumLink/MedplumLink';\nexport * from './MoneyDisplay/MoneyDisplay';\nexport * from './MoneyInput/MoneyInput';\nexport * from './NoteDisplay/NoteDisplay';\nexport * from './NotificationIcon/NotificationIcon';\nexport * from './OperationOutcomeAlert/OperationOutcomeAlert';\nexport * from './Panel/Panel';\nexport * from './PatientSummary/PatientSummary';\nexport * from './PatientTimeline/PatientTimeline';\nexport * from './PlanDefinitionBuilder/PlanDefinitionBuilder';\nexport * from './QuantityDisplay/QuantityDisplay';\nexport * from './QuantityInput/QuantityInput';\nexport * from './QuestionnaireBuilder/QuestionnaireBuilder';\nexport * from './QuestionnaireForm/QuestionnaireForm';\nexport * from './RangeDisplay/RangeDisplay';\nexport * from './RangeInput/RangeInput';\nexport * from './ReferenceDisplay/ReferenceDisplay';\nexport * from './ReferenceInput/ReferenceInput';\nexport * from './ReferenceRangeEditor/ReferenceRangeEditor';\nexport * from './RequestGroupDisplay/RequestGroupDisplay';\nexport * from './ResourceArrayDisplay/ResourceArrayDisplay';\nexport * from './ResourceArrayInput/ResourceArrayInput';\nexport * from './ResourceAvatar/ResourceAvatar';\nexport * from './ResourceBadge/ResourceBadge';\nexport * from './ResourceBlame/ResourceBlame';\nexport * from './ResourceDiff/ResourceDiff';\nexport * from './ResourceForm/ResourceForm';\nexport * from './ResourceForm/ResourceForm.utils';\nexport * from './ResourceHistoryTable/ResourceHistoryTable';\nexport * from './ResourceInput/ResourceInput';\nexport * from './ResourceName/ResourceName';\nexport * from './ResourcePropertyDisplay/ResourcePropertyDisplay';\nexport * from './ResourcePropertyInput/ResourcePropertyInput';\nexport * from './ResourcePropertyInput/ResourcePropertyInput.utils';\nexport * from './ResourceTable/ResourceTable';\nexport * from './ResourceTimeline/ResourceTimeline';\nexport * from './Scheduler/Scheduler';\nexport * from './SearchControl/SearchControl';\nexport * from './SearchControl/SearchControlField';\nexport * from './SearchControl/SearchUtils';\nexport * from './SearchFieldEditor/SearchFieldEditor';\nexport * from './SearchFilterEditor/SearchFilterEditor';\nexport * from './ServiceRequestTimeline/ServiceRequestTimeline';\nexport * from './SmartAppLaunchLink/SmartAppLaunchLink';\nexport * from './StatusBadge/StatusBadge';\nexport * from './Timeline/Timeline';\nexport * from './TimingInput/TimingInput';\nexport * from './ValueSetAutocomplete/ValueSetAutocomplete';\nexport * from './auth/RegisterForm';\nexport * from './auth/SignInForm';\nexport * from './utils/date';\nexport * from './utils/outcomes';\nexport * from './utils/questionnaire';\nexport * from './utils/recaptcha';\nexport * from './utils/script';\n", "import { MedplumClient } from '@medplum/core';\nimport { ReactNode, useEffect, useMemo, useState } from 'react';\nimport { MedplumNavigateFunction, reactContext } from './MedplumProvider.context';\n\nexport interface MedplumProviderProps {\n  readonly medplum: MedplumClient;\n  readonly navigate?: MedplumNavigateFunction;\n  readonly children: ReactNode;\n}\n\n/**\n * The MedplumProvider component provides Medplum context state.\n *\n * Medplum context includes:\n *   1) medplum - Medplum client library\n *   2) profile - The current user profile (if signed in)\n * @param props - The MedplumProvider React props.\n * @returns The MedplumProvider React node.\n */\nexport function MedplumProvider(props: MedplumProviderProps): JSX.Element {\n  const medplum = props.medplum;\n  const navigate = props.navigate ?? defaultNavigate;\n\n  const [state, setState] = useState({\n    profile: medplum.getProfile(),\n    loading: !medplum.isInitialized,\n  });\n\n  useEffect(() => {\n    if (!medplum) {\n      return;\n    }\n    if (!medplum.isInitialized) {\n      setState((s) => ({ ...s, loading: true }));\n      medplum\n        .getInitPromise()\n        .then(() => setState((s) => ({ ...s, loading: false })))\n        .catch(console.error);\n    }\n  }, [medplum, medplum.isInitialized]);\n\n  useEffect(() => {\n    function eventListener(): void {\n      setState({\n        ...state,\n        profile: medplum.getProfile(),\n      });\n    }\n\n    medplum.addEventListener('change', eventListener);\n    return () => medplum.removeEventListener('change', eventListener);\n  }, [medplum, state]);\n\n  const medplumContext = useMemo(\n    () => ({\n      ...state,\n      medplum,\n      navigate,\n    }),\n    [state, medplum, navigate]\n  );\n\n  return <reactContext.Provider value={medplumContext}>{props.children}</reactContext.Provider>;\n}\n\n/**\n * The default \"navigate\" function which simply uses window.location.href.\n * @param path - The path to navigate to.\n */\nfunction defaultNavigate(path: string): void {\n  window.location.assign(path);\n}\n", "import { MedplumClient, ProfileResource } from '@medplum/core';\nimport { createContext, useContext } from 'react';\n\nexport const reactContext = createContext(undefined as MedplumContext | undefined);\n\nexport type MedplumNavigateFunction = (path: string) => void;\n\nexport interface MedplumContext {\n  medplum: MedplumClient;\n  navigate: MedplumNavigateFunction;\n  profile?: ProfileResource;\n  loading: boolean;\n}\n\n/**\n * Returns the MedplumContext instance.\n * @returns The MedplumContext instance.\n */\nexport function useMedplumContext(): MedplumContext {\n  return useContext(reactContext) as MedplumContext;\n}\n\n/**\n * Returns the MedplumClient instance.\n * This is a shortcut for useMedplumContext().medplum.\n * @returns The MedplumClient instance.\n */\nexport function useMedplum(): MedplumClient {\n  return useMedplumContext().medplum;\n}\n\n/**\n * Returns the Medplum navigate function.\n * @returns The Medplum navigate function.\n */\nexport function useMedplumNavigate(): MedplumNavigateFunction {\n  return useMedplumContext().navigate;\n}\n\n/**\n * Returns the current Medplum user profile (if signed in).\n * This is a shortcut for useMedplumContext().profile.\n * @returns The current user profile.\n */\nexport function useMedplumProfile(): ProfileResource | undefined {\n  return useMedplumContext().profile;\n}\n", "import { useMemo } from 'react';\n\n// Maintain a cache of urls to avoid unnecessary re-download of attachments\n// The following is a workaround for the fact that each request to a resource containing a Binary data reference\n// returns a NEW signed S3 URL for each bypassing the native browser caching mechanism\n// resulting in unnecessary bandwidth consumption.\n// https://www.medplum.com/docs/fhir-datastore/binary-data#consuming-a-fhir-binary-in-an-application\n// https://github.com/medplum/medplum/issues/3815\n\n// TODO: possibly retain this cache in and restore from local storage to persist across page refreshes?\n// The S3 presigned URLs expire after 1 hour with the default configuration and hard refreshes are not uncommon even in SPAs so this\n// could be a good way to get additional cache hits\n// This would require additional logic for initialization, saving, and purging of expired keys\nconst urls = new Map<string, string>();\n\nexport const useCachedBinaryUrl = (binaryUrl: string | undefined): string | undefined => {\n  return useMemo(() => {\n    if (!binaryUrl) {\n      return undefined;\n    }\n\n    const binaryResourceUrl = binaryUrl.split('?')[0];\n    if (!binaryResourceUrl) {\n      return binaryUrl;\n    }\n\n    // Check if the binaryUrl is a presigned S3 URL\n    let binaryUrlSearchParams: URLSearchParams;\n    try {\n      binaryUrlSearchParams = new URLSearchParams(new URL(binaryUrl).search);\n    } catch (e) {\n      return binaryUrl;\n    }\n\n    if (!binaryUrlSearchParams.has('Key-Pair-Id') || !binaryUrlSearchParams.has('Signature')) {\n      return binaryUrl;\n    }\n\n    // https://stackoverflow.com/questions/23929145/how-to-test-if-a-given-time-stamp-is-in-seconds-or-milliseconds\n    const binaryUrlExpires = binaryUrlSearchParams.get('Expires');\n    if (!binaryUrlExpires || binaryUrlExpires.length > 13) {\n      // Expires is expected to be in seconds, not milliseconds\n      return binaryUrl;\n    }\n\n    const cachedUrl = urls.get(binaryResourceUrl);\n    if (cachedUrl) {\n      const searchParams = new URLSearchParams(new URL(cachedUrl).search);\n\n      // This is fairly brittle as it relies on the current structure of the Medplum returned URL\n      const expires = searchParams.get('Expires');\n\n      // `expires` is in seconds, Date.now() is in ms\n      // Add padding to mitigate expiration between time of check and time of use\n      if (expires && parseInt(expires, 10) * 1000 - 5_000 > Date.now()) {\n        return cachedUrl;\n      }\n    }\n\n    urls.set(binaryResourceUrl, binaryUrl);\n    return binaryUrl;\n  }, [binaryUrl]);\n};\n", "import { deepEquals, isReference, isResource, MedplumClient, normalizeOperationOutcome } from '@medplum/core';\nimport { OperationOutcome, Reference, Resource } from '@medplum/fhirtypes';\nimport { useCallback, useEffect, useState } from 'react';\nimport { useMedplum } from '../MedplumProvider/MedplumProvider.context';\n\n/**\n * React Hook to use a FHIR reference.\n * Handles the complexity of resolving references and caching resources.\n * @param value - The resource or reference to resource.\n * @param setOutcome - Optional callback to set the OperationOutcome.\n * @returns The resolved resource.\n */\nexport function useResource<T extends Resource>(\n  value: Reference<T> | Partial<T> | undefined,\n  setOutcome?: (outcome: OperationOutcome) => void\n): T | undefined {\n  const medplum = useMedplum();\n  const [resource, setResource] = useState<T | undefined>(getInitialResource(medplum, value));\n\n  const setResourceIfChanged = useCallback(\n    (r: T | undefined) => {\n      if (!deepEquals(r, resource)) {\n        setResource(r);\n      }\n    },\n    [resource, setResource]\n  );\n\n  useEffect(() => {\n    setResourceIfChanged(getInitialResource(medplum, value));\n  }, [medplum, value, setResourceIfChanged]);\n\n  useEffect(() => {\n    let subscribed = true;\n\n    if (isReference(value)) {\n      medplum\n        .readReference(value as Reference<T>)\n        .then((r) => {\n          if (subscribed) {\n            setResourceIfChanged(r);\n          }\n        })\n        .catch((err) => {\n          if (subscribed) {\n            setResourceIfChanged(undefined);\n            if (setOutcome) {\n              setOutcome(normalizeOperationOutcome(err));\n            }\n          }\n        });\n    }\n\n    return (() => (subscribed = false)) as () => void;\n  }, [medplum, resource, value, setResourceIfChanged, setOutcome]);\n\n  return resource;\n}\n\n/**\n * Returns the initial resource value based on the input value.\n * If the input value is a resource, returns the resource.\n * If the input value is a reference to a resource available in the cache, returns the resource.\n * Otherwise, returns undefined.\n * @param medplum - The medplum client.\n * @param value - The resource or reference to resource.\n * @returns An initial resource if available; undefined otherwise.\n */\nfunction getInitialResource<T extends Resource>(\n  medplum: MedplumClient,\n  value: Reference<T> | Partial<T> | undefined\n): T | undefined {\n  if (value) {\n    if (isResource(value)) {\n      return value as T;\n    }\n\n    if (isReference(value)) {\n      return medplum.getCachedReference(value as Reference<T>);\n    }\n  }\n\n  return undefined;\n}\n", "import { allOk, normalizeOperationOutcome, QueryTypes, ResourceArray } from '@medplum/core';\nimport { Bundle, ExtractResource, OperationOutcome, ResourceType } from '@medplum/fhirtypes';\nimport { useEffect, useState } from 'react';\nimport { useMedplum } from '../MedplumProvider/MedplumProvider.context';\n\ntype SearchFn = 'search' | 'searchOne' | 'searchResources';\n\n/**\n * React hook for searching FHIR resources.\n *\n * This is a convenience hook for calling the MedplumClient.search() method.\n *\n * @param resourceType - The FHIR resource type to search.\n * @param query - Optional search parameters.\n * @returns A 3-element tuple containing the search result, loading flag, and operation outcome.\n */\nexport function useSearch<K extends ResourceType>(\n  resourceType: K,\n  query?: QueryTypes\n): [Bundle<ExtractResource<K>> | undefined, boolean, OperationOutcome | undefined] {\n  return useSearchImpl<K, Bundle<ExtractResource<K>>>('search', resourceType, query);\n}\n\n/**\n * React hook for searching for a single FHIR resource.\n *\n * This is a convenience hook for calling the MedplumClient.searchOne() method.\n *\n * @param resourceType - The FHIR resource type to search.\n * @param query - Optional search parameters.\n * @returns A 3-element tuple containing the search result, loading flag, and operation outcome.\n */\nexport function useSearchOne<K extends ResourceType>(\n  resourceType: K,\n  query?: QueryTypes\n): [ExtractResource<K> | undefined, boolean, OperationOutcome | undefined] {\n  return useSearchImpl<K, ExtractResource<K>>('searchOne', resourceType, query);\n}\n\n/**\n * React hook for searching for an array of FHIR resources.\n *\n * This is a convenience hook for calling the MedplumClient.searchResources() method.\n *\n * @param resourceType - The FHIR resource type to search.\n * @param query - Optional search parameters.\n * @returns A 3-element tuple containing the search result, loading flag, and operation outcome.\n */\nexport function useSearchResources<K extends ResourceType>(\n  resourceType: K,\n  query?: QueryTypes\n): [ResourceArray<ExtractResource<K>> | undefined, boolean, OperationOutcome | undefined] {\n  return useSearchImpl<K, ResourceArray<ExtractResource<K>>>('searchResources', resourceType, query);\n}\n\nfunction useSearchImpl<K extends ResourceType, ReturnType>(\n  searchFn: SearchFn,\n  resourceType: K,\n  query: QueryTypes | undefined\n): [ReturnType | undefined, boolean, OperationOutcome | undefined] {\n  const medplum = useMedplum();\n  const [searchKey, setSearchKey] = useState<string>();\n  const [loading, setLoading] = useState<boolean>(false);\n  const [result, setResult] = useState<ReturnType>();\n  const [outcome, setOutcome] = useState<OperationOutcome>();\n\n  useEffect(() => {\n    const key = medplum.fhirSearchUrl(resourceType, query).toString();\n    if (key !== searchKey) {\n      setSearchKey(key);\n      medplum[searchFn](resourceType, query)\n        .then((res) => {\n          setLoading(false);\n          setResult(res as ReturnType);\n          setOutcome(allOk);\n        })\n        .catch((err) => {\n          setLoading(false);\n          setResult(undefined);\n          setOutcome(normalizeOperationOutcome(err));\n        });\n    }\n  }, [medplum, searchFn, resourceType, query, searchKey]);\n\n  return [result, loading, outcome];\n}\n", "import { SubscriptionEmitter, SubscriptionEventMap } from '@medplum/core';\nimport { Bundle } from '@medplum/fhirtypes';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { useMedplum } from '../MedplumProvider/MedplumProvider.context';\n\nconst SUBSCRIPTION_DEBOUNCE_MS = 3000;\n\nexport function useSubscription(criteria: string, callback: (bundle: Bundle) => void): void {\n  const medplum = useMedplum();\n  const [emitter, setEmitter] = useState<SubscriptionEmitter>();\n\n  const listeningRef = useRef(false);\n  const unsubTimerRef = useRef<ReturnType<typeof setTimeout>>();\n  const prevCriteriaRef = useRef<string>();\n\n  const callbackRef = useRef<typeof callback>();\n  callbackRef.current = callback;\n\n  useEffect(() => {\n    if (unsubTimerRef.current) {\n      clearTimeout(unsubTimerRef.current);\n      unsubTimerRef.current = undefined;\n    }\n    if (prevCriteriaRef.current !== criteria) {\n      setEmitter(medplum.subscribeToCriteria(criteria));\n    }\n\n    // Set prev criteria to latest\n    prevCriteriaRef.current = criteria;\n\n    return () => {\n      unsubTimerRef.current = setTimeout(() => {\n        setEmitter(undefined);\n        medplum.unsubscribeFromCriteria(criteria);\n      }, SUBSCRIPTION_DEBOUNCE_MS);\n    };\n  }, [medplum, criteria]);\n\n  const emitterCallback = useCallback((event: SubscriptionEventMap['message']) => {\n    callbackRef.current?.(event.payload);\n  }, []);\n\n  useEffect(() => {\n    if (!emitter) {\n      return () => undefined;\n    }\n    if (!listeningRef.current) {\n      emitter.addEventListener('message', emitterCallback);\n      listeningRef.current = true;\n    }\n    return () => {\n      listeningRef.current = false;\n      emitter.removeEventListener('message', emitterCallback);\n    };\n  }, [emitter, emitterCallback]);\n}\n", "import { formatAddress } from '@medplum/core';\nimport { Address } from '@medplum/fhirtypes';\n\nexport interface AddressDisplayProps {\n  readonly value?: Address;\n}\n\nexport function AddressDisplay(props: AddressDisplayProps): JSX.Element | null {\n  const address = props.value;\n  if (!address) {\n    return null;\n  }\n\n  return <>{formatAddress(address)}</>;\n}\n", "import { Group, NativeSelect, TextInput } from '@mantine/core';\nimport { Address } from '@medplum/fhirtypes';\nimport { useRef, useState } from 'react';\nimport { ComplexTypeInputProps } from '../ResourcePropertyInput/ResourcePropertyInput.utils';\n\nfunction getLine(address: Address, index: number): string {\n  return address.line && address.line.length > index ? address.line[index] : '';\n}\n\nfunction setLine(address: Address, index: number, str: string): Address {\n  const line: string[] = address.line || [];\n  while (line.length <= index) {\n    line.push('');\n  }\n  line[index] = str;\n  return { ...address, line };\n}\n\nexport type AddressInputProps = ComplexTypeInputProps<Address>;\n\nexport function AddressInput(props: AddressInputProps): JSX.Element {\n  const [value, setValue] = useState<Address>(props.defaultValue || {});\n\n  const valueRef = useRef<Address>();\n  valueRef.current = value;\n\n  // TODO{profiles} is it worth the complexity of subbing in an autocomplete input when\n  // a binding is defined in a profile? If so, it should go in a new wrapper around TextInput\n  // e.g. US Core Patient Profile\n\n  function setValueWrapper(newValue: Address): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  function setUse(use: 'home' | 'work' | 'temp' | 'old' | 'billing'): void {\n    setValueWrapper({ ...valueRef.current, use });\n  }\n\n  function setType(type: 'postal' | 'physical' | 'both'): void {\n    setValueWrapper({ ...valueRef.current, type });\n  }\n\n  function setLine1(line1: string): void {\n    setValueWrapper(setLine(valueRef.current || {}, 0, line1));\n  }\n\n  function setLine2(line2: string): void {\n    setValueWrapper(setLine(valueRef.current || {}, 1, line2));\n  }\n\n  function setCity(city: string): void {\n    setValueWrapper({ ...valueRef.current, city });\n  }\n\n  function setState(state: string): void {\n    setValueWrapper({ ...valueRef.current, state });\n  }\n\n  function setPostalCode(postalCode: string): void {\n    setValueWrapper({ ...valueRef.current, postalCode });\n  }\n\n  return (\n    <Group gap=\"xs\" wrap=\"nowrap\" grow>\n      <NativeSelect\n        data-testid=\"address-use\"\n        defaultValue={value.use}\n        onChange={(e) => setUse(e.currentTarget.value as 'home' | 'work' | 'temp' | 'old' | 'billing')}\n        data={['', 'home', 'work', 'temp', 'old', 'billing']}\n      />\n      <NativeSelect\n        data-testid=\"address-type\"\n        defaultValue={value.type}\n        onChange={(e) => setType(e.currentTarget.value as 'postal' | 'physical' | 'both')}\n        data={['', 'postal', 'physical', 'both']}\n      />\n      <TextInput\n        placeholder=\"Line 1\"\n        defaultValue={getLine(value, 0)}\n        onChange={(e) => setLine1(e.currentTarget.value)}\n      />\n      <TextInput\n        placeholder=\"Line 2\"\n        defaultValue={getLine(value, 1)}\n        onChange={(e) => setLine2(e.currentTarget.value)}\n      />\n      <TextInput placeholder=\"City\" defaultValue={value.city} onChange={(e) => setCity(e.currentTarget.value)} />\n      <TextInput placeholder=\"State\" defaultValue={value.state} onChange={(e) => setState(e.currentTarget.value)} />\n      <TextInput\n        placeholder=\"Postal Code\"\n        defaultValue={value.postalCode}\n        onChange={(e) => setPostalCode(e.currentTarget.value)}\n      />\n    </Group>\n  );\n}\n", "import { TextInput } from '@mantine/core';\nimport { createReference } from '@medplum/core';\nimport { Annotation } from '@medplum/fhirtypes';\nimport { useMedplumProfile } from '@medplum/react-hooks';\nimport { useState } from 'react';\n\nexport interface AnnotationInputProps {\n  readonly name: string;\n  readonly defaultValue?: Annotation;\n  readonly onChange?: (value: Annotation) => void;\n}\n\nexport function AnnotationInput(props: AnnotationInputProps): JSX.Element {\n  const author = useMedplumProfile();\n  const [value, setValue] = useState<Annotation>(props.defaultValue || ({} as Annotation));\n\n  function setText(text: string): void {\n    const newValue: Annotation = text\n      ? {\n          text,\n          authorReference: author && createReference(author),\n          time: new Date().toISOString(),\n        }\n      : ({} as Annotation);\n\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  return (\n    <TextInput\n      name={props.name}\n      placeholder=\"Annotation text\"\n      defaultValue={value.text}\n      onChange={(e) => setText(e.currentTarget.value)}\n    />\n  );\n}\n", "import { AppShell as MantineAppShell } from '@mantine/core';\nimport { showNotification } from '@mantine/notifications';\nimport { useMedplum, useMedplumProfile } from '@medplum/react-hooks';\nimport { ReactNode, Suspense, useEffect, useState } from 'react';\nimport { ErrorBoundary } from '../ErrorBoundary/ErrorBoundary';\nimport { Loading } from '../Loading/Loading';\nimport classes from './AppShell.module.css';\nimport { Header } from './Header';\nimport { Navbar, NavbarMenu } from './Navbar';\n\nexport interface AppShellProps {\n  readonly logo: ReactNode;\n  readonly pathname?: string;\n  readonly searchParams?: URLSearchParams;\n  readonly headerSearchDisabled?: boolean;\n  readonly version?: string;\n  readonly menus?: NavbarMenu[];\n  readonly children: ReactNode;\n  readonly displayAddBookmark?: boolean;\n  readonly resourceTypeSearchDisabled?: boolean;\n  readonly notifications?: ReactNode;\n}\n\nexport function AppShell(props: AppShellProps): JSX.Element {\n  const [navbarOpen, setNavbarOpen] = useState(localStorage['navbarOpen'] === 'true');\n  const medplum = useMedplum();\n  const profile = useMedplumProfile();\n\n  useEffect(() => {\n    function eventListener(): void {\n      showNotification({ color: 'red', message: 'No connection to server', autoClose: false });\n    }\n    medplum.addEventListener('offline', eventListener);\n    return () => medplum.removeEventListener('offline', eventListener);\n  }, [medplum]);\n\n  function setNavbarOpenWrapper(open: boolean): void {\n    localStorage['navbarOpen'] = open.toString();\n    setNavbarOpen(open);\n  }\n\n  function closeNavbar(): void {\n    setNavbarOpenWrapper(false);\n  }\n\n  function toggleNavbar(): void {\n    setNavbarOpenWrapper(!navbarOpen);\n  }\n\n  if (medplum.isLoading()) {\n    return <Loading />;\n  }\n\n  return (\n    <MantineAppShell\n      header={{ height: 60 }}\n      navbar={{\n        width: 250,\n        breakpoint: 'sm',\n        collapsed: {\n          desktop: !profile || !navbarOpen,\n          mobile: !profile || !navbarOpen,\n        },\n      }}\n      padding={0}\n    >\n      {profile && (\n        <Header\n          pathname={props.pathname}\n          searchParams={props.searchParams}\n          headerSearchDisabled={props.headerSearchDisabled}\n          logo={props.logo}\n          version={props.version}\n          navbarToggle={toggleNavbar}\n          notifications={props.notifications}\n        />\n      )}\n      {profile && navbarOpen ? (\n        <Navbar\n          pathname={props.pathname}\n          searchParams={props.searchParams}\n          menus={props.menus}\n          closeNavbar={closeNavbar}\n          displayAddBookmark={props.displayAddBookmark}\n          resourceTypeSearchDisabled={props.resourceTypeSearchDisabled}\n        />\n      ) : undefined}\n      <MantineAppShell.Main className={classes.main}>\n        <ErrorBoundary>\n          <Suspense fallback={<Loading />}>{props.children}</Suspense>\n        </ErrorBoundary>\n      </MantineAppShell.Main>\n    </MantineAppShell>\n  );\n}\n", "import { Alert } from '@mantine/core';\nimport { normalizeErrorString } from '@medplum/core';\nimport { IconAlertCircle } from '@tabler/icons-react';\nimport { Component, ErrorInfo, ReactNode } from 'react';\n\nexport interface ErrorBoundaryProps {\n  readonly children: ReactNode;\n}\n\nexport interface ErrorBoundaryState {\n  readonly error?: Error;\n  readonly lastLocation: string;\n}\n\n/**\n * ErrorBoundary is a React component that handles errors in its child components.\n * See: https://reactjs.org/docs/error-boundaries.html\n */\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  readonly state: ErrorBoundaryState;\n\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { lastLocation: window.location.toString() };\n  }\n\n  static getDerivedStateFromError(error: Error): ErrorBoundaryState {\n    return { error, lastLocation: window.location.toString() };\n  }\n\n  componentDidUpdate(_prevProps: ErrorBoundaryProps, _prevState: ErrorBoundaryState): void {\n    if (window.location.toString() !== this.state.lastLocation) {\n      this.setState({\n        lastLocation: window.location.toString(),\n        error: undefined,\n      });\n    }\n  }\n\n  shouldComponentUpdate(nextProps: ErrorBoundaryProps, nextState: ErrorBoundaryState): boolean {\n    if (this.props.children !== nextProps.children) {\n      return true;\n    }\n    if (nextState.error && !this.state.error) {\n      return true;\n    }\n    if (this.state.lastLocation !== window.location.toString()) {\n      return true;\n    }\n    return false;\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    console.error('Uncaught error:', error, errorInfo);\n  }\n\n  render(): ReactNode {\n    if (this.state.error) {\n      return (\n        <Alert icon={<IconAlertCircle size={16} />} title=\"Something went wrong\" color=\"red\">\n          {normalizeErrorString(this.state.error)}\n        </Alert>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n", "export default {\n  xmlns: 'http://www.w3.org/2000/svg',\n  width: 24,\n  height: 24,\n  viewBox: '0 0 24 24',\n  fill: 'none',\n  stroke: 'currentColor',\n  strokeWidth: 2,\n  strokeLinecap: 'round',\n  strokeLinejoin: 'round',\n};\n", "import { forwardRef, createElement } from 'react';\nimport PropTypes from 'prop-types';\nimport defaultAttributes from './defaultAttributes';\n\nexport default (iconName, iconNamePascal, iconNode) => {\n  const Component = forwardRef(\n      ({ color = 'currentColor', size = 24, stroke = 2, children, ...rest }, ref) =>\n          createElement(\n              'svg',\n              {\n                ref,\n                ...defaultAttributes,\n                width: size,\n                height: size,\n                stroke: color,\n                strokeWidth: stroke,\n                className: `tabler-icon tabler-icon-${iconName}`,\n                ...rest,\n              },\n              [...iconNode.map(([tag, attrs]) => createElement(tag, attrs)), ...(children || [])],\n          ),\n  );\n\n  Component.propTypes = {\n    color: PropTypes.string,\n    size: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    stroke: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  };\n\n  Component.displayName = `${iconNamePascal}`;\n\n  return Component;\n};\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent(\n  'adjustments-horizontal',\n  'IconAdjustmentsHorizontal',\n  [\n    ['path', { d: 'M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0', key: 'svg-0' }],\n    ['path', { d: 'M4 6l8 0', key: 'svg-1' }],\n    ['path', { d: 'M16 6l4 0', key: 'svg-2' }],\n    ['path', { d: 'M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0', key: 'svg-3' }],\n    ['path', { d: 'M4 12l2 0', key: 'svg-4' }],\n    ['path', { d: 'M10 12l10 0', key: 'svg-5' }],\n    ['path', { d: 'M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0', key: 'svg-6' }],\n    ['path', { d: 'M4 18l11 0', key: 'svg-7' }],\n    ['path', { d: 'M19 18l1 0', key: 'svg-8' }],\n  ],\n);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('alert-circle', 'IconAlertCircle', [\n  ['path', { d: 'M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0', key: 'svg-0' }],\n  ['path', { d: 'M12 8v4', key: 'svg-1' }],\n  ['path', { d: 'M12 16h.01', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('arrow-down', 'IconArrowDown', [\n  ['path', { d: 'M12 5l0 14', key: 'svg-0' }],\n  ['path', { d: 'M18 13l-6 6', key: 'svg-1' }],\n  ['path', { d: 'M6 13l6 6', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('arrow-up', 'IconArrowUp', [\n  ['path', { d: 'M12 5l0 14', key: 'svg-0' }],\n  ['path', { d: 'M18 11l-6 -6', key: 'svg-1' }],\n  ['path', { d: 'M6 11l6 -6', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('bleach-off', 'IconBleachOff', [\n  [\n    'path',\n    {\n      d: 'M5 19h14m1.986 -1.977a2 2 0 0 0 -.146 -.773l-7.1 -12.25a2 2 0 0 0 -3.5 0l-.815 1.405m-1.488 2.568l-4.797 8.277a2 2 0 0 0 1.75 2.75',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M3 3l18 18', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('bleach', 'IconBleach', [\n  [\n    'path',\n    {\n      d: 'M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75',\n      key: 'svg-0',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('box-multiple', 'IconBoxMultiple', [\n  [\n    'path',\n    {\n      d: 'M7 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z',\n      key: 'svg-0',\n    },\n  ],\n  [\n    'path',\n    {\n      d: 'M17 17v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h2',\n      key: 'svg-1',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('brackets-contain', 'IconBracketsContain', [\n  ['path', { d: 'M7 4h-4v16h4', key: 'svg-0' }],\n  ['path', { d: 'M17 4h4v16h-4', key: 'svg-1' }],\n  ['path', { d: 'M8 16h.01', key: 'svg-2' }],\n  ['path', { d: 'M12 16h.01', key: 'svg-3' }],\n  ['path', { d: 'M16 16h.01', key: 'svg-4' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('bucket-off', 'IconBucketOff', [\n  [\n    'path',\n    {\n      d: 'M5.029 5.036c-.655 .58 -1.029 1.25 -1.029 1.964c0 2.033 3.033 3.712 6.96 3.967m3.788 -.21c3.064 -.559 5.252 -2.029 5.252 -3.757c0 -2.21 -3.582 -4 -8 -4c-1.605 0 -3.1 .236 -4.352 .643',\n      key: 'svg-0',\n    },\n  ],\n  [\n    'path',\n    {\n      d: 'M4 7c0 .664 .088 1.324 .263 1.965l2.737 10.035c.5 1.5 2.239 2 5 2s4.5 -.5 5 -2c.1 -.3 .252 -.812 .457 -1.535m.862 -3.146c.262 -.975 .735 -2.76 1.418 -5.354a7.45 7.45 0 0 0 .263 -1.965',\n      key: 'svg-1',\n    },\n  ],\n  ['path', { d: 'M3 3l18 18', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('bucket', 'IconBucket', [\n  ['path', { d: 'M12 7m-8 0a8 4 0 1 0 16 0a8 4 0 1 0 -16 0', key: 'svg-0' }],\n  [\n    'path',\n    {\n      d: 'M4 7c0 .664 .088 1.324 .263 1.965l2.737 10.035c.5 1.5 2.239 2 5 2s4.5 -.5 5 -2c.333 -1 1.246 -4.345 2.737 -10.035a7.45 7.45 0 0 0 .263 -1.965',\n      key: 'svg-1',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('calendar', 'IconCalendar', [\n  [\n    'path',\n    {\n      d: 'M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M16 3v4', key: 'svg-1' }],\n  ['path', { d: 'M8 3v4', key: 'svg-2' }],\n  ['path', { d: 'M4 11h16', key: 'svg-3' }],\n  ['path', { d: 'M11 15h1', key: 'svg-4' }],\n  ['path', { d: 'M12 15v3', key: 'svg-5' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('check', 'IconCheck', [\n  ['path', { d: 'M5 12l5 5l10 -10', key: 'svg-0' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('checkbox', 'IconCheckbox', [\n  ['path', { d: 'M9 11l3 3l8 -8', key: 'svg-0' }],\n  [\n    'path',\n    {\n      d: 'M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9',\n      key: 'svg-1',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('chevron-down', 'IconChevronDown', [\n  ['path', { d: 'M6 9l6 6l6 -6', key: 'svg-0' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('circle-minus', 'IconCircleMinus', [\n  ['path', { d: 'M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0', key: 'svg-0' }],\n  ['path', { d: 'M9 12l6 0', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('circle-plus', 'IconCirclePlus', [\n  ['path', { d: 'M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0', key: 'svg-0' }],\n  ['path', { d: 'M9 12h6', key: 'svg-1' }],\n  ['path', { d: 'M12 9v6', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('cloud-upload', 'IconCloudUpload', [\n  [\n    'path',\n    {\n      d: 'M7 18a4.6 4.4 0 0 1 0 -9a5 4.5 0 0 1 11 2h1a3.5 3.5 0 0 1 0 7h-1',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M9 15l3 -3l3 3', key: 'svg-1' }],\n  ['path', { d: 'M12 12l0 9', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('columns', 'IconColumns', [\n  ['path', { d: 'M4 6l5.5 0', key: 'svg-0' }],\n  ['path', { d: 'M4 10l5.5 0', key: 'svg-1' }],\n  ['path', { d: 'M4 14l5.5 0', key: 'svg-2' }],\n  ['path', { d: 'M4 18l5.5 0', key: 'svg-3' }],\n  ['path', { d: 'M14.5 6l5.5 0', key: 'svg-4' }],\n  ['path', { d: 'M14.5 10l5.5 0', key: 'svg-5' }],\n  ['path', { d: 'M14.5 14l5.5 0', key: 'svg-6' }],\n  ['path', { d: 'M14.5 18l5.5 0', key: 'svg-7' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('copy', 'IconCopy', [\n  [\n    'path',\n    {\n      d: 'M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z',\n      key: 'svg-0',\n    },\n  ],\n  [\n    'path',\n    {\n      d: 'M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1',\n      key: 'svg-1',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('currency-dollar', 'IconCurrencyDollar', [\n  [\n    'path',\n    {\n      d: 'M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M12 3v3m0 12v3', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('dots', 'IconDots', [\n  ['path', { d: 'M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0', key: 'svg-0' }],\n  ['path', { d: 'M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0', key: 'svg-1' }],\n  ['path', { d: 'M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('edit', 'IconEdit', [\n  [\n    'path',\n    {\n      d: 'M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1',\n      key: 'svg-0',\n    },\n  ],\n  [\n    'path',\n    {\n      d: 'M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z',\n      key: 'svg-1',\n    },\n  ],\n  ['path', { d: 'M16 5l3 3', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('equal-not', 'IconEqualNot', [\n  ['path', { d: 'M5 10h14', key: 'svg-0' }],\n  ['path', { d: 'M5 14h14', key: 'svg-1' }],\n  ['path', { d: 'M5 19l14 -14', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('equal', 'IconEqual', [\n  ['path', { d: 'M5 10h14', key: 'svg-0' }],\n  ['path', { d: 'M5 14h14', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('file-alert', 'IconFileAlert', [\n  ['path', { d: 'M14 3v4a1 1 0 0 0 1 1h4', key: 'svg-0' }],\n  [\n    'path',\n    {\n      d: 'M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z',\n      key: 'svg-1',\n    },\n  ],\n  ['path', { d: 'M12 17l.01 0', key: 'svg-2' }],\n  ['path', { d: 'M12 11l0 3', key: 'svg-3' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('file-plus', 'IconFilePlus', [\n  ['path', { d: 'M14 3v4a1 1 0 0 0 1 1h4', key: 'svg-0' }],\n  [\n    'path',\n    {\n      d: 'M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z',\n      key: 'svg-1',\n    },\n  ],\n  ['path', { d: 'M12 11l0 6', key: 'svg-2' }],\n  ['path', { d: 'M9 14l6 0', key: 'svg-3' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('filter', 'IconFilter', [\n  [\n    'path',\n    {\n      d: 'M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z',\n      key: 'svg-0',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('gender-female', 'IconGenderFemale', [\n  ['path', { d: 'M12 9m-5 0a5 5 0 1 0 10 0a5 5 0 1 0 -10 0', key: 'svg-0' }],\n  ['path', { d: 'M12 14v7', key: 'svg-1' }],\n  ['path', { d: 'M9 18h6', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('list-details', 'IconListDetails', [\n  ['path', { d: 'M13 5h8', key: 'svg-0' }],\n  ['path', { d: 'M13 9h5', key: 'svg-1' }],\n  ['path', { d: 'M13 15h8', key: 'svg-2' }],\n  ['path', { d: 'M13 19h5', key: 'svg-3' }],\n  [\n    'path',\n    {\n      d: 'M3 4m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z',\n      key: 'svg-4',\n    },\n  ],\n  [\n    'path',\n    {\n      d: 'M3 14m0 1a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v4a1 1 0 0 1 -1 1h-4a1 1 0 0 1 -1 -1z',\n      key: 'svg-5',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('logout', 'IconLogout', [\n  [\n    'path',\n    {\n      d: 'M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M9 12h12l-3 -3', key: 'svg-1' }],\n  ['path', { d: 'M18 15l3 -3', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('math-greater', 'IconMathGreater', [\n  ['path', { d: 'M5 18l14 -6l-14 -6', key: 'svg-0' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('math-lower', 'IconMathLower', [\n  ['path', { d: 'M19 18l-14 -6l14 -6', key: 'svg-0' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('message', 'IconMessage', [\n  ['path', { d: 'M8 9h8', key: 'svg-0' }],\n  ['path', { d: 'M8 13h6', key: 'svg-1' }],\n  [\n    'path',\n    {\n      d: 'M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z',\n      key: 'svg-2',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('pin', 'IconPin', [\n  [\n    'path',\n    {\n      d: 'M15 4.5l-4 4l-4 1.5l-1.5 1.5l7 7l1.5 -1.5l1.5 -4l4 -4',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M9 15l-4.5 4.5', key: 'svg-1' }],\n  ['path', { d: 'M14.5 4l5.5 5.5', key: 'svg-2' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('pinned-off', 'IconPinnedOff', [\n  ['path', { d: 'M3 3l18 18', key: 'svg-0' }],\n  [\n    'path',\n    {\n      d: 'M15 4.5l-3.249 3.249m-2.57 1.433l-2.181 .818l-1.5 1.5l7 7l1.5 -1.5l.82 -2.186m1.43 -2.563l3.25 -3.251',\n      key: 'svg-1',\n    },\n  ],\n  ['path', { d: 'M9 15l-4.5 4.5', key: 'svg-2' }],\n  ['path', { d: 'M14.5 4l5.5 5.5', key: 'svg-3' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('plus', 'IconPlus', [\n  ['path', { d: 'M12 5l0 14', key: 'svg-0' }],\n  ['path', { d: 'M5 12l14 0', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('refresh', 'IconRefresh', [\n  ['path', { d: 'M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4', key: 'svg-0' }],\n  ['path', { d: 'M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('search', 'IconSearch', [\n  ['path', { d: 'M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0', key: 'svg-0' }],\n  ['path', { d: 'M21 21l-6 -6', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('settings', 'IconSettings', [\n  [\n    'path',\n    {\n      d: 'M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0', key: 'svg-1' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('sort-ascending', 'IconSortAscending', [\n  ['path', { d: 'M4 6l7 0', key: 'svg-0' }],\n  ['path', { d: 'M4 12l7 0', key: 'svg-1' }],\n  ['path', { d: 'M4 18l9 0', key: 'svg-2' }],\n  ['path', { d: 'M15 9l3 -3l3 3', key: 'svg-3' }],\n  ['path', { d: 'M18 6l0 12', key: 'svg-4' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('sort-descending', 'IconSortDescending', [\n  ['path', { d: 'M4 6l9 0', key: 'svg-0' }],\n  ['path', { d: 'M4 12l7 0', key: 'svg-1' }],\n  ['path', { d: 'M4 18l7 0', key: 'svg-2' }],\n  ['path', { d: 'M15 15l3 3l3 -3', key: 'svg-3' }],\n  ['path', { d: 'M18 6l0 12', key: 'svg-4' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('square', 'IconSquare', [\n  [\n    'path',\n    {\n      d: 'M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z',\n      key: 'svg-0',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('stethoscope', 'IconStethoscope', [\n  [\n    'path',\n    {\n      d: 'M6 4h-1a2 2 0 0 0 -2 2v3.5h0a5.5 5.5 0 0 0 11 0v-3.5a2 2 0 0 0 -2 -2h-1',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M8 15a6 6 0 1 0 12 0v-3', key: 'svg-1' }],\n  ['path', { d: 'M11 3v2', key: 'svg-2' }],\n  ['path', { d: 'M6 3v2', key: 'svg-3' }],\n  ['path', { d: 'M20 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0', key: 'svg-4' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent(\n  'switch-horizontal',\n  'IconSwitchHorizontal',\n  [\n    ['path', { d: 'M16 3l4 4l-4 4', key: 'svg-0' }],\n    ['path', { d: 'M10 7l10 0', key: 'svg-1' }],\n    ['path', { d: 'M8 13l-4 4l4 4', key: 'svg-2' }],\n    ['path', { d: 'M4 17l9 0', key: 'svg-3' }],\n  ],\n);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('table-export', 'IconTableExport', [\n  [\n    'path',\n    {\n      d: 'M12.5 21h-7.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v7.5',\n      key: 'svg-0',\n    },\n  ],\n  ['path', { d: 'M3 10h18', key: 'svg-1' }],\n  ['path', { d: 'M10 3v18', key: 'svg-2' }],\n  ['path', { d: 'M16 19h6', key: 'svg-3' }],\n  ['path', { d: 'M19 16l3 3l-3 3', key: 'svg-4' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('trash', 'IconTrash', [\n  ['path', { d: 'M4 7l16 0', key: 'svg-0' }],\n  ['path', { d: 'M10 11l0 6', key: 'svg-1' }],\n  ['path', { d: 'M14 11l0 6', key: 'svg-2' }],\n  [\n    'path',\n    { d: 'M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12', key: 'svg-3' },\n  ],\n  ['path', { d: 'M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3', key: 'svg-4' }],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('user-square', 'IconUserSquare', [\n  ['path', { d: 'M9 10a3 3 0 1 0 6 0a3 3 0 0 0 -6 0', key: 'svg-0' }],\n  ['path', { d: 'M6 21v-1a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v1', key: 'svg-1' }],\n  [\n    'path',\n    {\n      d: 'M3 5a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-14z',\n      key: 'svg-2',\n    },\n  ],\n]);\n", "import createReactComponent from '../createReactComponent';\nexport default createReactComponent('x', 'IconX', [\n  ['path', { d: 'M18 6l-12 12', key: 'svg-0' }],\n  ['path', { d: 'M6 6l12 12', key: 'svg-1' }],\n]);\n", "import { Center, Loader } from '@mantine/core';\n\nexport function Loading(): JSX.Element {\n  return (\n    <Center style={{ width: '100%', height: '100vh' }}>\n      <Loader />\n    </Center>\n  );\n}\n", ".main {\n  flex: 1;\n  background-color: light-dark(var(--mantine-color-gray-0), var(--mantine-color-dark-6));\n  padding-bottom: var(--mantine-spacing-lg);\n}\n", "import { Group, AppShell as MantineAppShell, Menu, Text, UnstyledButton } from '@mantine/core';\nimport { formatHumanName } from '@medplum/core';\nimport { HumanName } from '@medplum/fhirtypes';\nimport { useMedplumProfile } from '@medplum/react-hooks';\nimport { IconChevronDown } from '@tabler/icons-react';\nimport cx from 'clsx';\nimport { ReactNode, useState } from 'react';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\nimport classes from './Header.module.css';\nimport { HeaderDropdown } from './HeaderDropdown';\nimport { HeaderSearchInput } from './HeaderSearchInput';\n\nexport interface HeaderProps {\n  readonly pathname?: string;\n  readonly searchParams?: URLSearchParams;\n  readonly headerSearchDisabled?: boolean;\n  readonly logo: ReactNode;\n  readonly version?: string;\n  readonly navbarToggle: () => void;\n  readonly notifications?: ReactNode;\n}\n\nexport function Header(props: HeaderProps): JSX.Element {\n  const profile = useMedplumProfile();\n  const [userMenuOpened, setUserMenuOpened] = useState(false);\n\n  return (\n    <MantineAppShell.Header p={8} style={{ zIndex: 101 }}>\n      <Group justify=\"space-between\">\n        <Group gap=\"xs\">\n          <UnstyledButton className={classes.logoButton} onClick={props.navbarToggle}>\n            {props.logo}\n          </UnstyledButton>\n          {!props.headerSearchDisabled && (\n            <HeaderSearchInput pathname={props.pathname} searchParams={props.searchParams} />\n          )}\n        </Group>\n        <Group gap=\"lg\" pr=\"sm\">\n          {props.notifications}\n          <Menu\n            width={260}\n            shadow=\"xl\"\n            position=\"bottom-end\"\n            transitionProps={{ transition: 'pop-top-right' }}\n            opened={userMenuOpened}\n            onClose={() => setUserMenuOpened(false)}\n          >\n            <Menu.Target>\n              <UnstyledButton\n                className={cx(classes.user, { [classes.userActive]: userMenuOpened })}\n                onClick={() => setUserMenuOpened((o) => !o)}\n              >\n                <Group gap={7}>\n                  <ResourceAvatar value={profile} radius=\"xl\" size={24} />\n                  <Text size=\"sm\" className={classes.userName}>\n                    {formatHumanName(profile?.name?.[0] as HumanName)}\n                  </Text>\n                  <IconChevronDown size={12} stroke={1.5} />\n                </Group>\n              </UnstyledButton>\n            </Menu.Target>\n            <Menu.Dropdown>\n              <HeaderDropdown version={props.version} />\n            </Menu.Dropdown>\n          </Menu>\n        </Group>\n      </Group>\n    </MantineAppShell.Header>\n  );\n}\n", "function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f);else for(t in e)e[t]&&(n&&(n+=\" \"),n+=t);return n}export function clsx(){for(var e,t,f=0,n=\"\";f<arguments.length;)(e=arguments[f++])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;", "import { Avatar, AvatarProps } from '@mantine/core';\nimport { getDisplayString, getImageSrc } from '@medplum/core';\nimport { Reference, Resource } from '@medplum/fhirtypes';\nimport { useCachedBinaryUrl, useResource } from '@medplum/react-hooks';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\nimport { getInitials } from './ResourceAvatar.utils';\n\nexport interface ResourceAvatarProps extends AvatarProps {\n  readonly value?: Reference | Resource;\n  readonly link?: boolean;\n}\n\nexport function ResourceAvatar(props: ResourceAvatarProps): JSX.Element {\n  const resource = useResource(props.value);\n  const text = resource ? getDisplayString(resource) : props.alt ?? '';\n  const initials = getInitials(text);\n  const uncachedImageUrl = (resource && getImageSrc(resource)) ?? props.src;\n  const imageUrl = useCachedBinaryUrl(uncachedImageUrl ?? undefined);\n  const radius = props.radius ?? 'xl';\n\n  const avatarProps = { ...props };\n  delete avatarProps.value;\n  delete avatarProps.link;\n\n  if (props.link) {\n    return (\n      <MedplumLink to={resource}>\n        <Avatar src={imageUrl} alt={text} radius={radius} {...avatarProps}>\n          {initials}\n        </Avatar>\n      </MedplumLink>\n    );\n  }\n\n  return (\n    <Avatar src={imageUrl} alt={text} radius={radius} {...avatarProps}>\n      {initials}\n    </Avatar>\n  );\n}\n", "import { Anchor, TextProps } from '@mantine/core';\nimport { isReference, isResource } from '@medplum/core';\nimport { Reference, Resource } from '@medplum/fhirtypes';\nimport { useMedplumNavigate } from '@medplum/react-hooks';\nimport { MouseEvent, MouseEventHandler, ReactNode } from 'react';\nimport { killEvent } from '../utils/dom';\n\nexport interface MedplumLinkProps extends TextProps {\n  readonly to?: Resource | Reference | string;\n  readonly suffix?: string;\n  readonly label?: string;\n  readonly onClick?: MouseEventHandler;\n  readonly children: ReactNode;\n}\n\nexport function MedplumLink(props: MedplumLinkProps): JSX.Element {\n  const navigate = useMedplumNavigate();\n  const { to, suffix, label, onClick, children, ...rest } = props;\n\n  let href = getHref(to);\n  if (suffix) {\n    href += '/' + suffix;\n  }\n\n  return (\n    <Anchor\n      href={href}\n      aria-label={label}\n      onClick={(e: MouseEvent) => {\n        killEvent(e);\n        if (onClick) {\n          onClick(e);\n        } else if (to) {\n          navigate(href);\n        }\n      }}\n      {...rest}\n    >\n      {children}\n    </Anchor>\n  );\n}\n\nfunction getHref(to: Resource | Reference | string | undefined): string {\n  if (to) {\n    if (typeof to === 'string') {\n      return getStringHref(to);\n    } else if (isResource(to)) {\n      return getResourceHref(to);\n    } else if (isReference(to)) {\n      return getReferenceHref(to);\n    }\n  }\n  return '#';\n}\n\nfunction getStringHref(to: string): string {\n  if (to.startsWith('http://') || to.startsWith('https://') || to.startsWith('/')) {\n    return to;\n  }\n  return '/' + to;\n}\n\nfunction getResourceHref(to: Resource): string {\n  return `/${to.resourceType}/${to.id}`;\n}\n\nfunction getReferenceHref(to: Reference): string {\n  return `/${to.reference}`;\n}\n", "/**\n * Kills a browser event.\n * Prevents default behavior.\n * Stops event propagation.\n * @param e - The event.\n */\nexport function killEvent(e: Event | React.SyntheticEvent): void {\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n/**\n * Returns true if the element is a checkbox or a table cell containing a checkbox.\n * Table cells containing checkboxes are commonly accidentally clicked.\n * @param el - The HTML DOM element.\n * @returns True if the element is a checkbox or a table cell containing a checkbox.\n */\nexport function isCheckboxCell(el: Element): boolean {\n  if (isCheckboxElement(el)) {\n    return true;\n  }\n\n  if (el instanceof HTMLTableCellElement) {\n    const children = el.children;\n    if (children.length === 1 && isCheckboxElement(children[0])) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction isCheckboxElement(el: Element): boolean {\n  return el instanceof HTMLInputElement && el.type === 'checkbox';\n}\n", "export function getInitials(input: string): string {\n  const words = input.split(' ').filter(Boolean);\n  if (words.length > 1) {\n    return words[0][0] + words[words.length - 1][0];\n  }\n  if (words.length === 1) {\n    return words[0][0];\n  }\n  return '';\n}\n", ".logoButton {\n  padding: var(--mantine-spacing-xs) var(--mantine-spacing-sm);\n  border-radius: var(--mantine-radius-sm);\n  transition: background-color 100ms ease;\n\n  &:hover {\n    background-color: var(--mantine-primary-color-light-hover);\n  }\n}\n\n.user {\n  padding: var(--mantine-spacing-xs) var(--mantine-spacing-sm);\n  border-radius: var(--mantine-radius-sm);\n  transition: background-color 100ms ease;\n\n  &:hover {\n    background-color: var(--mantine-primary-color-light-hover);\n  }\n}\n\n.userName {\n  font-weight: 500;\n  line-height: 1px;\n  margin-right: 3px;\n\n  @media (max-width: $mantine-breakpoint-xs) {\n    display: none;\n  }\n}\n\n.userActive {\n  background-color: var(--mantine-primary-color-light-hover);\n}\n", "import {\n  Avatar,\n  Group,\n  MantineColorScheme,\n  Menu,\n  SegmentedControl,\n  Stack,\n  Text,\n  useMantineColorScheme,\n} from '@mantine/core';\nimport { ProfileResource, getReferenceString } from '@medplum/core';\nimport { HumanName } from '@medplum/fhirtypes';\nimport { useMedplumContext } from '@medplum/react-hooks';\nimport { IconLogout, IconSettings, IconSwitchHorizontal } from '@tabler/icons-react';\nimport { HumanNameDisplay } from '../HumanNameDisplay/HumanNameDisplay';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\n\nexport interface HeaderDropdownProps {\n  readonly version?: string;\n}\n\nexport function HeaderDropdown(props: HeaderDropdownProps): JSX.Element {\n  const context = useMedplumContext();\n  const { medplum, profile, navigate } = context;\n  const logins = medplum.getLogins();\n  const { colorScheme, setColorScheme } = useMantineColorScheme();\n\n  return (\n    <>\n      <Stack align=\"center\" p=\"xl\">\n        <ResourceAvatar size=\"xl\" radius={100} value={context.profile} />\n        <HumanNameDisplay value={context.profile?.name?.[0] as HumanName} />\n        <Text c=\"dimmed\" size=\"xs\">\n          {medplum.getActiveLogin()?.project.display}\n        </Text>\n      </Stack>\n      {logins.length > 1 && <Menu.Divider />}\n      {logins.map(\n        (login) =>\n          login.profile.reference !== getReferenceString(context.profile as ProfileResource) && (\n            <Menu.Item\n              key={login.profile.reference}\n              onClick={() => {\n                medplum\n                  .setActiveLogin(login)\n                  .then(() => window.location.reload())\n                  .catch(console.log);\n              }}\n            >\n              <Group>\n                <Avatar radius=\"xl\" />\n                <div style={{ flex: 1 }}>\n                  <Text size=\"sm\" fw={500}>\n                    {login.profile.display}\n                  </Text>\n                  <Text c=\"dimmed\" size=\"xs\">\n                    {login.project.display}\n                  </Text>\n                </div>\n              </Group>\n            </Menu.Item>\n          )\n      )}\n      <Menu.Divider />\n      <Group justify=\"center\">\n        <SegmentedControl\n          size=\"xs\"\n          value={colorScheme}\n          onChange={(newValue) => setColorScheme(newValue as MantineColorScheme)}\n          data={[\n            { label: 'Light', value: 'light' },\n            { label: 'Dark', value: 'dark' },\n            { label: 'Auto', value: 'auto' },\n          ]}\n        />\n      </Group>\n      <Menu.Divider />\n      <Menu.Item leftSection={<IconSwitchHorizontal size={14} stroke={1.5} />} onClick={() => navigate('/signin')}>\n        Add another account\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconSettings size={14} stroke={1.5} />}\n        onClick={() => navigate(`/${getReferenceString(profile as ProfileResource)}`)}\n      >\n        Account settings\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconLogout size={14} stroke={1.5} />}\n        onClick={async () => {\n          await medplum.signOut();\n          navigate('/signin');\n        }}\n      >\n        Sign out\n      </Menu.Item>\n      <Text size=\"xs\" c=\"dimmed\" ta=\"center\">\n        {props.version}\n      </Text>\n    </>\n  );\n}\n", "import { formatHumanName, HumanNameFormatOptions } from '@medplum/core';\nimport { HumanName } from '@medplum/fhirtypes';\n\nexport interface HumanNameDisplayProps {\n  readonly value?: HumanName;\n  readonly options?: HumanNameFormatOptions;\n}\n\nexport function HumanNameDisplay(props: HumanNameDisplayProps): JSX.Element | null {\n  const name = props.value;\n  if (!name) {\n    return null;\n  }\n\n  return <>{formatHumanName(name, props.options)}</>;\n}\n", "import { formatHumanName, getDisplayString, getReferenceString, isUUID } from '@medplum/core';\nimport { Patient, ServiceRequest } from '@medplum/fhirtypes';\nimport { useMedplum, useMedplumNavigate } from '@medplum/react-hooks';\nimport { IconSearch } from '@tabler/icons-react';\nimport { forwardRef, useCallback } from 'react';\nimport { AsyncAutocomplete, AsyncAutocompleteOption } from '../AsyncAutocomplete/AsyncAutocomplete';\nimport classes from './HeaderSearchInput.module.css';\nimport { Group, Text } from '@mantine/core';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\n\nexport type HeaderSearchTypes = Patient | ServiceRequest;\n\ninterface SearchGraphQLResponse {\n  readonly data: {\n    readonly Patients1: Patient[] | undefined;\n    readonly Patients2: Patient[] | undefined;\n    readonly ServiceRequestList: ServiceRequest[] | undefined;\n  };\n}\n\nfunction toOption(resource: HeaderSearchTypes): AsyncAutocompleteOption<HeaderSearchTypes> {\n  return {\n    value: resource.id as string,\n    label: getDisplayString(resource),\n    resource,\n  };\n}\n\nexport interface HeaderSearchInputProps {\n  readonly pathname?: string;\n  readonly searchParams?: URLSearchParams;\n}\n\nexport function HeaderSearchInput(props: HeaderSearchInputProps): JSX.Element {\n  const navigate = useMedplumNavigate();\n  const medplum = useMedplum();\n\n  const loadData = useCallback(\n    async (input: string, signal: AbortSignal): Promise<HeaderSearchTypes[]> => {\n      const query = buildGraphQLQuery(input);\n      const options = { signal };\n      const response = (await medplum.graphql(query, undefined, undefined, options)) as SearchGraphQLResponse;\n      return getResourcesFromResponse(response, input);\n    },\n    [medplum]\n  );\n\n  const handleSelect = useCallback(\n    (item: HeaderSearchTypes[]): void => {\n      if (item.length > 0) {\n        navigate(`/${getReferenceString(item[0])}`);\n      }\n    },\n    [navigate]\n  );\n\n  return (\n    <AsyncAutocomplete\n      key={`${props.pathname}?${props.searchParams}`}\n      size=\"sm\"\n      radius=\"md\"\n      className={classes.searchInput}\n      leftSection={<IconSearch size={16} />}\n      placeholder=\"Search\"\n      itemComponent={ItemComponent}\n      toOption={toOption}\n      onChange={handleSelect}\n      loadOptions={loadData}\n      maxValues={0}\n      clearable={false}\n    />\n  );\n}\n\nconst ItemComponent = forwardRef<HTMLDivElement, any>(\n  ({ resource, ...others }: AsyncAutocompleteOption<HeaderSearchTypes>, ref) => {\n    let helpText: string | undefined = undefined;\n\n    if (resource.resourceType === 'Patient') {\n      helpText = resource.birthDate;\n    } else if (resource.resourceType === 'ServiceRequest') {\n      helpText = resource.subject?.display;\n    }\n\n    return (\n      <div ref={ref} {...others}>\n        <Group wrap=\"nowrap\">\n          <ResourceAvatar value={resource} />\n          <div>\n            <Text>{getDisplayString(resource)}</Text>\n            <Text size=\"xs\" c=\"dimmed\">\n              {helpText}\n            </Text>\n          </div>\n        </Group>\n      </div>\n    );\n  }\n);\n\nfunction buildGraphQLQuery(input: string): string {\n  const escaped = JSON.stringify(input);\n  if (isUUID(input)) {\n    return `{\n      Patients1: PatientList(_id: ${escaped}, _count: 1) {\n        resourceType\n        id\n        identifier {\n          system\n          value\n        }\n        name {\n          given\n          family\n        }\n        birthDate\n      }\n      ServiceRequestList(_id: ${escaped}, _count: 1) {\n        resourceType\n        id\n        identifier {\n          system\n          value\n        }\n        subject {\n          display\n        }\n      }\n    }`.replace(/\\s+/g, ' ');\n  }\n  return `{\n    Patients1: PatientList(name: ${escaped}, _count: 5) {\n      resourceType\n      id\n      identifier {\n        system\n        value\n      }\n      name {\n        given\n        family\n      }\n      birthDate\n    }\n    Patients2: PatientList(identifier: ${escaped}, _count: 5) {\n      resourceType\n      id\n      identifier {\n        system\n        value\n      }\n      name {\n        given\n        family\n      }\n      birthDate\n    }\n    ServiceRequestList(identifier: ${escaped}, _count: 5) {\n      resourceType\n      id\n      identifier {\n        system\n        value\n      }\n      subject {\n        display\n      }\n    }\n  }`.replace(/\\s+/g, ' ');\n}\n\n/**\n * Returns a de-duped and sorted list of resources from the search response.\n * The search request is actually 3+ separate searches, which can include duplicates.\n * This function combines the results, de-dupes, and sorts by relevance.\n * @param response - The response from a search query.\n * @param query - The user entered search query.\n * @returns The resources to display in the autocomplete.\n */\nfunction getResourcesFromResponse(response: SearchGraphQLResponse, query: string): HeaderSearchTypes[] {\n  const resources = [];\n  if (response.data.Patients1) {\n    resources.push(...response.data.Patients1);\n  }\n  if (response.data.Patients2) {\n    resources.push(...response.data.Patients2);\n  }\n  if (response.data.ServiceRequestList) {\n    resources.push(...response.data.ServiceRequestList);\n  }\n  return sortByRelevance(dedupeResources(resources), query).slice(0, 5);\n}\n\n/**\n * Removes duplicate resources from an array by ID.\n * @param resources - The array of resources with possible duplicates.\n * @returns The array of resources with no duplicates.\n */\nfunction dedupeResources(resources: HeaderSearchTypes[]): HeaderSearchTypes[] {\n  const ids = new Set<string>();\n  const result = [];\n\n  for (const resource of resources) {\n    if (!ids.has(resource.id as string)) {\n      ids.add(resource.id as string);\n      result.push(resource);\n    }\n  }\n\n  return result;\n}\n\n/**\n * Sorts an array of resources by relevance.\n * @param resources - The candidate resources.\n * @param query - The user entered search string.\n * @returns The sorted array of resources.\n */\nfunction sortByRelevance(resources: HeaderSearchTypes[], query: string): HeaderSearchTypes[] {\n  return resources.sort((a: HeaderSearchTypes, b: HeaderSearchTypes) => {\n    return getResourceScore(b, query) - getResourceScore(a, query);\n  });\n}\n\n/**\n * Calculates a relevance score of a candidate resource.\n * Higher scores are better.\n * @param resource - The candidate resource.\n * @param query - The user entered search string.\n * @returns The relevance score of the candidate resource.\n */\nfunction getResourceScore(resource: HeaderSearchTypes, query: string): number {\n  let bestScore = 0;\n\n  if (resource.identifier) {\n    for (const identifier of resource.identifier) {\n      bestScore = Math.max(bestScore, getStringScore(identifier.value, query));\n    }\n  }\n\n  if (resource.resourceType === 'Patient' && resource.name) {\n    for (const name of resource.name) {\n      bestScore = Math.max(bestScore, getStringScore(formatHumanName(name), query));\n    }\n  }\n\n  return bestScore;\n}\n\n/**\n * Calculates a relevance score of a candidate display string.\n * Higher scores are better.\n * @param str - The candidate display string.\n * @param query - The user entered search string.\n * @returns The relevance score of the candidate string.\n */\nfunction getStringScore(str: string | undefined, query: string): number {\n  if (!str) {\n    return 0;\n  }\n  const index = str.toLowerCase().indexOf(query.toLowerCase());\n  if (index < 0) {\n    return 0;\n  }\n  return 100 - index;\n}\n", "import { Combobox, ComboboxItem, ComboboxProps, Group, Loader, Pill, PillsInput, useCombobox } from '@mantine/core';\nimport { showNotification } from '@mantine/notifications';\nimport { normalizeErrorString } from '@medplum/core';\nimport { KeyboardEvent, ReactNode, useCallback, useEffect, useRef, useState } from 'react';\nimport { killEvent } from '../utils/dom';\n\nexport interface AsyncAutocompleteOption<T> extends ComboboxItem {\n  readonly resource: T;\n}\n\nexport interface AsyncAutocompleteProps<T>\n  extends Omit<ComboboxProps, 'data' | 'defaultValue' | 'loadOptions' | 'onChange' | 'onCreate' | 'searchable'> {\n  readonly name?: string;\n  readonly label?: ReactNode;\n  readonly description?: ReactNode;\n  readonly error?: ReactNode;\n  readonly defaultValue?: T | T[];\n  readonly toOption: (item: T) => AsyncAutocompleteOption<T>;\n  readonly loadOptions: (input: string, signal: AbortSignal) => Promise<T[]>;\n  readonly itemComponent?: (props: AsyncAutocompleteOption<T>) => JSX.Element | ReactNode;\n  readonly onChange: (item: T[]) => void;\n  readonly onCreate?: (input: string) => T;\n  readonly creatable?: boolean;\n  readonly clearable?: boolean;\n  readonly required?: boolean;\n  readonly className?: string;\n  readonly placeholder?: string;\n  readonly leftSection?: ReactNode;\n  readonly maxValues?: number;\n}\n\nexport function AsyncAutocomplete<T>(props: AsyncAutocompleteProps<T>): JSX.Element {\n  const combobox = useCombobox({\n    onDropdownClose: () => combobox.resetSelectedOption(),\n    onDropdownOpen: () => combobox.updateSelectedOptionIndex('active'),\n  });\n  const {\n    name,\n    label,\n    description,\n    error,\n    defaultValue,\n    toOption,\n    loadOptions,\n    itemComponent,\n    onChange,\n    onCreate,\n    creatable,\n    clearable,\n    required,\n    placeholder,\n    leftSection,\n    maxValues,\n    ...rest\n  } = props;\n  const defaultItems = toDefaultItems(defaultValue);\n  const [search, setSearch] = useState('');\n  const [timer, setTimer] = useState<number>();\n  const [abortController, setAbortController] = useState<AbortController>();\n  const [autoSubmit, setAutoSubmit] = useState<boolean>();\n  const [selected, setSelected] = useState<AsyncAutocompleteOption<T>[]>(defaultItems.map(toOption));\n  const [options, setOptions] = useState<AsyncAutocompleteOption<T>[]>([]);\n  const ItemComponent = itemComponent ?? DefaultItemComponent;\n\n  const searchRef = useRef<string>();\n  searchRef.current = search;\n\n  const lastLoadOptionsRef = useRef<AsyncAutocompleteProps<T>['loadOptions']>();\n  const lastValueRef = useRef<string>();\n\n  const timerRef = useRef<number>();\n  timerRef.current = timer;\n\n  const abortControllerRef = useRef<AbortController>();\n  abortControllerRef.current = abortController;\n\n  const autoSubmitRef = useRef<boolean>();\n  autoSubmitRef.current = autoSubmit;\n\n  const optionsRef = useRef<AsyncAutocompleteOption<T>[]>();\n  optionsRef.current = options;\n\n  const handleTimer = useCallback((): void => {\n    setTimer(undefined);\n\n    if (searchRef.current === lastValueRef.current && loadOptions === lastLoadOptionsRef.current) {\n      // Same search input and loadOptions function, move on\n      return;\n    }\n\n    lastValueRef.current = searchRef.current;\n    lastLoadOptionsRef.current = loadOptions;\n\n    const newAbortController = new AbortController();\n    setAbortController(newAbortController);\n\n    loadOptions(searchRef.current ?? '', newAbortController.signal)\n      .then((newValues: T[]) => {\n        if (!newAbortController.signal.aborted) {\n          setOptions(newValues.map(toOption));\n          setAbortController(undefined);\n          if (autoSubmitRef.current) {\n            if (newValues.length > 0) {\n              onChange(newValues.slice(0, 1));\n            }\n            setAutoSubmit(false);\n          } else if (newValues.length > 0) {\n            combobox.openDropdown();\n          }\n        }\n      })\n      .catch((err) => {\n        if (!(newAbortController.signal.aborted || err.message.includes('aborted'))) {\n          showNotification({ color: 'red', message: normalizeErrorString(err) });\n        }\n      });\n  }, [combobox, loadOptions, onChange, toOption]);\n\n  const handleSearchChange = useCallback(\n    (e: React.SyntheticEvent): void => {\n      if (options && options.length > 0) {\n        combobox.openDropdown();\n      }\n\n      combobox.updateSelectedOptionIndex();\n      setSearch((e.currentTarget as HTMLInputElement).value);\n\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n        setAbortController(undefined);\n      }\n\n      if (timerRef.current !== undefined) {\n        window.clearTimeout(timerRef.current);\n      }\n\n      const newTimer = window.setTimeout(() => handleTimer(), 100);\n      setTimer(newTimer);\n    },\n    [combobox, options, handleTimer]\n  );\n\n  const addSelected = useCallback(\n    (newValue: string): void => {\n      const result: T[] = [];\n      const newSelected: AsyncAutocompleteOption<T>[] = [...selected];\n\n      let option = options?.find((option) => option.value === newValue);\n      let item = option?.resource;\n      if (!item && creatable !== false && onCreate) {\n        item = onCreate(newValue);\n        option = toOption(item);\n      }\n\n      if (item) {\n        result.push(item);\n      }\n\n      if (option) {\n        newSelected.push(option);\n      }\n\n      if (maxValues !== undefined) {\n        while (newSelected.length > maxValues) {\n          // Remove from the front\n          newSelected.shift();\n        }\n      }\n\n      onChange(result);\n      setSelected(newSelected);\n    },\n    [creatable, options, selected, maxValues, onChange, onCreate, toOption]\n  );\n\n  const handleValueSelect = (val: string): void => {\n    setSearch('');\n    setOptions([]);\n    combobox.closeDropdown();\n    lastValueRef.current = undefined;\n    if (val === '$create') {\n      addSelected(search);\n    } else {\n      addSelected(val);\n    }\n  };\n\n  const handleValueRemove = useCallback(\n    (item: AsyncAutocompleteOption<T>): void => {\n      const newSelected = selected.filter((v) => v.value !== item.value);\n      onChange(newSelected.map((v) => v.resource));\n      setSelected(newSelected);\n    },\n    [selected, onChange]\n  );\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent): void => {\n      if (e.key === 'Enter') {\n        if (!timer && !abortController) {\n          killEvent(e);\n          if (options && options.length > 0) {\n            setOptions(options.slice(0, 1));\n            addSelected(options[0].value);\n          }\n        } else {\n          // The user pressed enter, but we don't have results yet.\n          // We need to wait for the results to come in.\n          setAutoSubmit(true);\n        }\n      } else if (e.key === 'Backspace' && search.length === 0) {\n        killEvent(e);\n        handleValueRemove(selected[selected.length - 1]);\n      }\n    },\n    [search, selected, options, timer, abortController, addSelected, handleValueRemove]\n  );\n\n  useEffect(() => {\n    return () => {\n      if (abortControllerRef.current) {\n        abortControllerRef.current.abort();\n      }\n    };\n  }, []);\n\n  // Based on Mantine MultiSelect:\n  // https://github.com/mantinedev/mantine/blob/master/packages/%40mantine/core/src/components/MultiSelect/MultiSelect.tsx\n  const clearButton = clearable && selected.length > 0 && (\n    <Combobox.ClearButton\n      title=\"Clear all\"\n      size={16}\n      onClear={() => {\n        setSearch('');\n        setSelected([]);\n        onChange([]);\n        combobox.closeDropdown();\n      }}\n    />\n  );\n\n  return (\n    <Combobox store={combobox} onOptionSubmit={handleValueSelect} withinPortal={true} shadow=\"xl\" {...rest}>\n      <Combobox.DropdownTarget>\n        <PillsInput\n          label={label}\n          description={description}\n          error={error}\n          className={props.className}\n          leftSection={leftSection}\n          rightSection={abortController ? <Loader size={16} /> : clearButton}\n          required={required}\n        >\n          <Pill.Group>\n            {selected.map((item) => (\n              <Pill key={item.value} withRemoveButton onRemove={() => handleValueRemove(item)}>\n                {item.label}\n              </Pill>\n            ))}\n\n            {(maxValues === undefined || maxValues === 0 || selected.length < maxValues) && (\n              <Combobox.EventsTarget>\n                <PillsInput.Field\n                  role=\"searchbox\"\n                  name={name}\n                  value={search}\n                  placeholder={placeholder}\n                  onFocus={handleSearchChange}\n                  onBlur={() => combobox.closeDropdown()}\n                  onKeyDown={handleKeyDown}\n                  onChange={handleSearchChange}\n                />\n              </Combobox.EventsTarget>\n            )}\n          </Pill.Group>\n        </PillsInput>\n      </Combobox.DropdownTarget>\n\n      <Combobox.Dropdown>\n        <Combobox.Options>\n          {options.map((item) => (\n            <Combobox.Option value={item.value} key={item.value} active={selected.includes(item)}>\n              <ItemComponent {...item} />\n            </Combobox.Option>\n          ))}\n\n          {creatable && search.trim().length > 0 && (\n            <Combobox.Option value=\"$create\">+ Create {search}</Combobox.Option>\n          )}\n\n          {!creatable && search.trim().length > 0 && options.length === 0 && (\n            <Combobox.Empty>Nothing found</Combobox.Empty>\n          )}\n        </Combobox.Options>\n      </Combobox.Dropdown>\n    </Combobox>\n  );\n}\n\nfunction toDefaultItems<T>(defaultValue: T | T[] | undefined): T[] {\n  if (!defaultValue) {\n    return [];\n  }\n  if (Array.isArray(defaultValue)) {\n    return defaultValue;\n  }\n  return [defaultValue];\n}\n\nfunction DefaultItemComponent(props: ComboboxItem): JSX.Element {\n  return (\n    <Group gap=\"sm\">\n      <span>{props.label}</span>\n    </Group>\n  );\n}\n", ".searchInput {\n  input {\n    width: 220px;\n    transition: width 0.1s ease-in-out;\n  }\n\n  input:focus {\n    width: 400px;\n  }\n\n  @media (max-width: 800px) {\n    input {\n      width: 150px;\n    }\n    input:focus {\n      width: 150px;\n    }\n  }\n}\n", "import { Button, AppShell as MantineAppShell, ScrollArea, Space, Text } from '@mantine/core';\nimport { useMedplumNavigate } from '@medplum/react-hooks';\nimport { IconPlus } from '@tabler/icons-react';\nimport cx from 'clsx';\nimport { Fragment, MouseEventHandler, ReactNode, SyntheticEvent, useState } from 'react';\nimport { BookmarkDialog } from '../BookmarkDialog/BookmarkDialog';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\nimport { ResourceTypeInput } from '../ResourceTypeInput/ResourceTypeInput';\nimport classes from './Navbar.module.css';\n\nexport interface NavbarLink {\n  readonly icon?: JSX.Element;\n  readonly label?: string;\n  readonly href: string;\n}\n\nexport interface NavbarMenu {\n  readonly title?: string;\n  readonly links?: NavbarLink[];\n}\n\nexport interface NavbarProps {\n  readonly pathname?: string;\n  readonly searchParams?: URLSearchParams;\n  readonly menus?: NavbarMenu[];\n  readonly closeNavbar: () => void;\n  readonly displayAddBookmark?: boolean;\n  readonly resourceTypeSearchDisabled?: boolean;\n}\n\nexport function Navbar(props: NavbarProps): JSX.Element {\n  const navigate = useMedplumNavigate();\n  const activeLink = getActiveLink(props.pathname, props.searchParams, props.menus);\n  const [bookmarkDialogVisible, setBookmarkDialogVisible] = useState(false);\n\n  function onLinkClick(e: SyntheticEvent, to: string): void {\n    e.stopPropagation();\n    e.preventDefault();\n    navigate(to);\n    if (window.innerWidth < 768) {\n      props.closeNavbar();\n    }\n  }\n\n  function navigateResourceType(resourceType: string | undefined): void {\n    if (resourceType) {\n      navigate(`/${resourceType}`);\n    }\n  }\n\n  return (\n    <>\n      <MantineAppShell.Navbar>\n        <ScrollArea p=\"xs\">\n          {!props.resourceTypeSearchDisabled && (\n            <MantineAppShell.Section mb=\"sm\">\n              <ResourceTypeInput\n                key={window.location.pathname}\n                name=\"resourceType\"\n                placeholder=\"Resource Type\"\n                maxValues={0}\n                onChange={(newValue) => navigateResourceType(newValue)}\n              />\n            </MantineAppShell.Section>\n          )}\n          <MantineAppShell.Section grow>\n            {props.menus?.map((menu) => (\n              <Fragment key={`menu-${menu.title}`}>\n                <Text className={classes.menuTitle}>{menu.title}</Text>\n                {menu.links?.map((link) => (\n                  <NavbarLink\n                    key={link.href}\n                    to={link.href}\n                    active={link.href === activeLink?.href}\n                    onClick={(e) => onLinkClick(e, link.href)}\n                  >\n                    <NavLinkIcon to={link.href} icon={link.icon} />\n                    <span>{link.label}</span>\n                  </NavbarLink>\n                ))}\n              </Fragment>\n            ))}\n            {props.displayAddBookmark && (\n              <Button\n                variant=\"subtle\"\n                size=\"xs\"\n                mt=\"xl\"\n                leftSection={<IconPlus size=\"0.75rem\" />}\n                onClick={() => setBookmarkDialogVisible(true)}\n              >\n                Add Bookmark\n              </Button>\n            )}\n          </MantineAppShell.Section>\n        </ScrollArea>\n      </MantineAppShell.Navbar>\n      {props.pathname && props.searchParams && (\n        <BookmarkDialog\n          pathname={props.pathname}\n          searchParams={props.searchParams}\n          visible={bookmarkDialogVisible}\n          onOk={() => setBookmarkDialogVisible(false)}\n          onCancel={() => setBookmarkDialogVisible(false)}\n        />\n      )}\n    </>\n  );\n}\n\ninterface NavbarLinkProps {\n  readonly to: string;\n  readonly active: boolean;\n  readonly onClick: MouseEventHandler;\n  readonly children: ReactNode;\n}\n\nfunction NavbarLink(props: NavbarLinkProps): JSX.Element {\n  return (\n    <MedplumLink\n      onClick={props.onClick}\n      to={props.to}\n      className={cx(classes.link, { [classes.linkActive]: props.active })}\n    >\n      {props.children}\n    </MedplumLink>\n  );\n}\n\ninterface NavLinkIconProps {\n  readonly to: string;\n  readonly icon?: JSX.Element;\n}\n\nfunction NavLinkIcon(props: NavLinkIconProps): JSX.Element {\n  if (props.icon) {\n    return props.icon;\n  }\n  return <Space w={30} />;\n}\n\n/**\n * Returns the best \"active\" link for the menu.\n * In most cases, the navbar links are simple, and an exact match can determine which link is active.\n * However, we ignore some search parameters to support pagination.\n * But we cannot ignore all search parameters, to support separate links based on search filters.\n * So in the end, we use a simple scoring system based on the number of matching query search params.\n * @param currentPathname - The web browser current pathname.\n * @param currentSearchParams - The web browser current search parameters.\n * @param menus - Collection of navbar menus and links.\n * @returns The active link if one is found.\n */\nfunction getActiveLink(\n  currentPathname: string | undefined,\n  currentSearchParams: URLSearchParams | undefined,\n  menus: NavbarMenu[] | undefined\n): NavbarLink | undefined {\n  if (!currentPathname || !currentSearchParams || !menus) {\n    return undefined;\n  }\n\n  let bestLink = undefined;\n  let bestScore = 0;\n\n  for (const menu of menus) {\n    if (menu.links) {\n      for (const link of menu.links) {\n        const score = getLinkScore(currentPathname, currentSearchParams, link.href);\n        if (score > bestScore) {\n          bestScore = score;\n          bestLink = link;\n        }\n      }\n    }\n  }\n\n  return bestLink;\n}\n\n/**\n * Calculates a score for a link.\n * Zero means \"does not match at all\".\n * One means \"matches the pathname only\".\n * Additional increases for each matching search parameter.\n * Ignores pagination parameters \"_count\" and \"_offset\".\n * @param currentPathname - The web browser current pathname.\n * @param currentSearchParams - The web browser current search parameters.\n * @param linkHref - A candidate link href.\n * @returns The link score.\n */\nfunction getLinkScore(currentPathname: string, currentSearchParams: URLSearchParams, linkHref: string): number {\n  const linkUrl = new URL(linkHref, 'https://example.com');\n  if (currentPathname !== linkUrl.pathname) {\n    return 0;\n  }\n  const ignoredParams = ['_count', '_offset'];\n  for (const [key, value] of linkUrl.searchParams.entries()) {\n    if (ignoredParams.includes(key)) {\n      continue;\n    }\n    if (currentSearchParams.get(key) !== value) {\n      return 0;\n    }\n  }\n  let count = 1;\n  for (const [key, value] of currentSearchParams.entries()) {\n    if (ignoredParams.includes(key)) {\n      continue;\n    }\n    if (linkUrl.searchParams.get(key) === value) {\n      count++;\n    }\n  }\n  return count;\n}\n", "import { Button, Group, Modal, NativeSelect, Stack, TextInput } from '@mantine/core';\nimport { showNotification } from '@mantine/notifications';\nimport { deepClone, normalizeErrorString } from '@medplum/core';\nimport { UserConfiguration } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { Form } from '../Form/Form';\n\ninterface BookmarkDialogProps {\n  readonly pathname: string;\n  readonly searchParams: URLSearchParams;\n  readonly visible: boolean;\n  readonly onOk: () => void;\n  readonly onCancel: () => void;\n  readonly defaultValue?: string;\n}\nexport function BookmarkDialog(props: BookmarkDialogProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const config = medplum.getUserConfiguration() as UserConfiguration;\n\n  function submitHandler(formData: Record<string, string>): void {\n    const { menuname, bookmarkname: name } = formData;\n    const target = `${props.pathname}?${props.searchParams.toString()}`;\n    const newConfig = deepClone(config) as UserConfiguration;\n    const menu = newConfig.menu?.find(({ title }) => title === menuname);\n\n    menu?.link?.push({ name, target });\n    medplum\n      .updateResource(newConfig)\n      .then((res) => {\n        // refresh current config menu\n        config.menu = res.menu;\n        medplum.dispatchEvent({ type: 'change' });\n        showNotification({ color: 'green', message: 'Success' });\n        props.onOk();\n      })\n      .catch((err: any) => {\n        showNotification({ color: 'red', message: normalizeErrorString(err) });\n      });\n  }\n\n  return (\n    <Modal\n      title=\"Add Bookmark\"\n      closeButtonProps={{ 'aria-label': 'Close' }}\n      opened={props.visible}\n      onClose={props.onCancel}\n    >\n      <Form onSubmit={submitHandler}>\n        <Stack>\n          <SelectMenu config={config}></SelectMenu>\n          <TextInput label=\"Bookmark Name\" type=\"text\" name=\"bookmarkname\" placeholder=\"Bookmark Name\" withAsterisk />\n          <Group justify=\"flex-end\">\n            <Button mt=\"sm\" type=\"submit\">\n              OK\n            </Button>\n          </Group>\n        </Stack>\n      </Form>\n    </Modal>\n  );\n}\n\ninterface SelectMenuProps {\n  readonly config: UserConfiguration | undefined;\n}\n\nfunction SelectMenu(props: SelectMenuProps): JSX.Element {\n  function userConfigToMenu(config: UserConfiguration | undefined): string[] {\n    return config?.menu?.map((menu) => menu.title) as [];\n  }\n  const menus = userConfigToMenu(props.config);\n\n  return <NativeSelect name=\"menuname\" defaultValue={menus[0]} label=\"Select Menu Option\" data={menus} withAsterisk />;\n}\n", "/**\n * Parses an HTML form and returns the result as a JavaScript object.\n * @param form - The HTML form element.\n * @returns Form values in key value pairs.\n */\nexport function parseForm(form: HTMLFormElement): Record<string, string> {\n  const result: Record<string, string> = {};\n\n  for (const element of Array.from(form.elements)) {\n    if (element instanceof HTMLInputElement) {\n      parseInputElement(result, element);\n    } else if (element instanceof HTMLTextAreaElement) {\n      result[element.name] = element.value;\n    } else if (element instanceof HTMLSelectElement) {\n      parseSelectElement(result, element);\n    }\n  }\n\n  return result;\n}\n\n/**\n * Parses an HTML input element.\n * Sets the name/value pair in the result,\n * but only if the element is enabled and checked.\n * @param result - The result builder.\n * @param el - The input element.\n */\nfunction parseInputElement(result: Record<string, string>, el: HTMLInputElement): void {\n  if (el.disabled) {\n    // Ignore disabled elements\n    return;\n  }\n\n  if ((el.type === 'checkbox' || el.type === 'radio') && !el.checked) {\n    // Ignore unchecked radio or checkbox elements\n    return;\n  }\n\n  result[el.name] = el.value;\n}\n\n/**\n * Parses an HTML select element.\n * Sets the name/value pair if one is selected.\n * @param result - The result builder.\n * @param el - The select element.\n */\nfunction parseSelectElement(result: Record<string, string>, el: HTMLSelectElement): void {\n  result[el.name] = el.value;\n}\n", "import { CSSProperties, ReactNode, SyntheticEvent } from 'react';\nimport { parseForm } from './FormUtils';\n\nexport interface FormProps {\n  readonly onSubmit?: (formData: Record<string, string>) => void;\n  readonly style?: CSSProperties;\n  readonly children?: ReactNode;\n  readonly testid?: string;\n}\n\nexport function Form(props: FormProps): JSX.Element {\n  return (\n    <form\n      style={props.style}\n      data-testid={props.testid}\n      onSubmit={(e: SyntheticEvent) => {\n        e.preventDefault();\n        const formData = parseForm(e.target as HTMLFormElement);\n        if (props.onSubmit) {\n          props.onSubmit(formData);\n        }\n      }}\n    >\n      {props.children}\n    </form>\n  );\n}\n", "import { ResourceType } from '@medplum/fhirtypes';\nimport { useCallback, useState } from 'react';\nimport { CodeInput } from '../CodeInput/CodeInput';\n\nexport interface ResourceTypeInputProps {\n  readonly name: string;\n  readonly placeholder?: string;\n  readonly defaultValue?: ResourceType;\n  readonly autoFocus?: boolean;\n  readonly testId?: string;\n  readonly maxValues?: number;\n  readonly onChange?: (value: ResourceType | undefined) => void;\n}\n\nexport function ResourceTypeInput(props: ResourceTypeInputProps): JSX.Element {\n  const [resourceType, setResourceType] = useState<string | undefined>(props.defaultValue);\n  const onChange = props.onChange;\n\n  const setResourceTypeWrapper = useCallback(\n    (newResourceType: string | undefined) => {\n      setResourceType(newResourceType);\n      if (onChange) {\n        onChange(newResourceType as ResourceType);\n      }\n    },\n    [onChange]\n  );\n\n  return (\n    <CodeInput\n      data-autofocus={props.autoFocus}\n      data-testid={props.testId}\n      defaultValue={resourceType}\n      onChange={setResourceTypeWrapper}\n      name={props.name}\n      placeholder={props.placeholder}\n      binding=\"https://medplum.com/fhir/ValueSet/resource-types\"\n      creatable={false}\n      maxValues={props.maxValues ?? 1}\n      clearable={false}\n      withHelpText={false}\n    />\n  );\n}\n", "import { ValueSetExpansionContains } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { ValueSetAutocomplete, ValueSetAutocompleteProps } from '../ValueSetAutocomplete/ValueSetAutocomplete';\n\nexport interface CodeInputProps extends Omit<ValueSetAutocompleteProps, 'defaultValue' | 'onChange'> {\n  readonly defaultValue?: string;\n  readonly onChange?: (value: string | undefined) => void;\n}\n\nexport function CodeInput(props: CodeInputProps): JSX.Element {\n  const { defaultValue, onChange, withHelpText, ...rest } = props;\n  const [value, setValue] = useState<string | undefined>(defaultValue);\n\n  function handleChange(newValues: ValueSetExpansionContains[]): void {\n    const newValue = newValues[0];\n    const newCode = valueSetElementToCode(newValue);\n    setValue(newCode);\n    if (onChange) {\n      onChange(newCode);\n    }\n  }\n\n  return (\n    <ValueSetAutocomplete\n      defaultValue={codeToValueSetElement(value)}\n      onChange={handleChange}\n      withHelpText={withHelpText ?? true}\n      {...rest}\n    />\n  );\n}\n\nfunction codeToValueSetElement(code: string | undefined): ValueSetExpansionContains | undefined {\n  return code ? { code } : undefined;\n}\n\nfunction valueSetElementToCode(element: ValueSetExpansionContains | undefined): string | undefined {\n  return element?.code;\n}\n", "import { Group, Text } from '@mantine/core';\nimport { ValueSetExpandParams } from '@medplum/core';\nimport { ValueSetExpansionContains } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { forwardRef, useCallback } from 'react';\nimport {\n  AsyncAutocomplete,\n  AsyncAutocompleteOption,\n  AsyncAutocompleteProps,\n} from '../AsyncAutocomplete/AsyncAutocomplete';\n\nexport interface ValueSetAutocompleteProps\n  extends Omit<AsyncAutocompleteProps<ValueSetExpansionContains>, 'loadOptions' | 'toKey' | 'toOption'> {\n  readonly binding: string | undefined;\n  readonly creatable?: boolean;\n  readonly clearable?: boolean;\n  readonly expandParams?: Partial<ValueSetExpandParams>;\n  readonly withHelpText?: boolean;\n}\n\nfunction toKey(element: ValueSetExpansionContains): string {\n  if (typeof element.code === 'string') {\n    return element.code;\n  }\n  return JSON.stringify(element);\n}\n\nfunction getDisplay(item: ValueSetExpansionContains): string {\n  if (typeof item.display === 'string') {\n    return item.display;\n  }\n  return toKey(item);\n}\n\nfunction toOption(element: ValueSetExpansionContains): AsyncAutocompleteOption<ValueSetExpansionContains> {\n  return {\n    value: toKey(element),\n    label: getDisplay(element),\n    resource: element,\n  };\n}\n\nfunction createValue(input: string): ValueSetExpansionContains {\n  return {\n    code: input,\n    display: input,\n  };\n}\n\n/**\n * A low-level component to autocomplete based on a FHIR Valueset.\n * This is the base component for CodeableConceptInput, CodingInput, and CodeInput.\n * @param props - The ValueSetAutocomplete React props.\n * @returns The ValueSetAutocomplete React node.\n */\nexport function ValueSetAutocomplete(props: ValueSetAutocompleteProps): JSX.Element {\n  const medplum = useMedplum();\n  const { binding, creatable, clearable, expandParams, withHelpText, ...rest } = props;\n\n  const loadValues = useCallback(\n    async (input: string, signal: AbortSignal): Promise<ValueSetExpansionContains[]> => {\n      if (!binding) {\n        return [];\n      }\n      const valueSet = await medplum.valueSetExpand(\n        {\n          ...expandParams,\n          url: binding,\n          filter: input,\n        },\n        { signal }\n      );\n      const valueSetElements = valueSet.expansion?.contains as ValueSetExpansionContains[];\n      const newData: ValueSetExpansionContains[] = [];\n      for (const valueSetElement of valueSetElements) {\n        if (valueSetElement.code && !newData.some((item) => item.code === valueSetElement.code)) {\n          newData.push(valueSetElement);\n        }\n      }\n\n      return newData;\n    },\n    [medplum, expandParams, binding]\n  );\n\n  return (\n    <AsyncAutocomplete\n      {...rest}\n      creatable={creatable ?? true}\n      clearable={clearable ?? true}\n      toOption={toOption}\n      loadOptions={loadValues}\n      onCreate={createValue}\n      itemComponent={withHelpText ? ItemComponent : undefined}\n    />\n  );\n}\n\nconst ItemComponent = forwardRef<HTMLDivElement, AsyncAutocompleteOption<ValueSetExpansionContains>>(\n  ({ label, resource, ...others }: AsyncAutocompleteOption<ValueSetExpansionContains>, ref) => {\n    return (\n      <div ref={ref} {...others}>\n        <Group wrap=\"nowrap\">\n          <div>\n            <Text>{label}</Text>\n            <Text size=\"xs\" c=\"dimmed\">\n              {`${resource.system}#${resource.code}`}\n            </Text>\n          </div>\n        </Group>\n      </div>\n    );\n  }\n);\n", ".menuTitle {\n  margin: 20px 0 4px 6px;\n  font-size: 9px;\n  font-weight: normal;\n  text-transform: uppercase;\n  letter-spacing: 2px;\n}\n\n.link {\n  display: flex;\n  align-items: center;\n  text-decoration: none;\n  font-size: var(--mantine-font-size-sm);\n  color: light-dark(var(--mantine-color-gray-7), var(--mantine-color-dark-1));\n  padding: 8px 12px;\n  border-radius: var(--mantine-radius-sm);\n  font-weight: 500;\n\n  &:hover {\n    background-color: light-dark(var(--mantine-color-gray-0), var(--mantine-color-dark-6));\n    color: light-dark(var(--mantine-color-black), var(--mantine-color-white));\n    text-decoration: none;\n\n    & svg {\n      color: light-dark(var(--mantine-color-black), var(--mantine-color-white));\n    }\n  }\n\n  & svg {\n    color: light-dark(var(--mantine-color-gray-6), var(--mantine-color-dark-2));\n    margin-right: var(--mantine-spacing-sm);\n    stroke-width: 1.5;\n    width: 18px;\n    height: 18px;\n  }\n}\n\n.linkActive {\n  color: var(--mantine-primary-color-filled);\n  background-color: light-dark(var(--mantine-primary-color-light), var(--mantine-primary-color-dark));\n\n  &:hover {\n    color: var(--mantine-primary-color-filled-hover);\n    background-color: light-dark(var(--mantine-primary-color-light-hover), var(--mantine-primary-color-dark-hover));\n\n    & svg {\n      color: var(--mantine-color-blue-light-color);\n    }\n  }\n\n  & svg {\n    color: var(--mantine-color-blue-light-color);\n  }\n}\n", "import { Anchor } from '@mantine/core';\nimport { Attachment } from '@medplum/fhirtypes';\nimport { useCachedBinaryUrl } from '@medplum/react-hooks';\n\nexport interface AttachmentDisplayProps {\n  readonly value?: Attachment;\n  readonly maxWidth?: number;\n}\n\nexport function AttachmentDisplay(props: AttachmentDisplayProps): JSX.Element | null {\n  const { contentType, url: uncachedUrl, title } = props.value ?? {};\n  const url = useCachedBinaryUrl(uncachedUrl);\n\n  if (!url) {\n    return null;\n  }\n\n  return (\n    <div data-testid=\"attachment-display\">\n      {contentType?.startsWith('image/') && (\n        <img data-testid=\"attachment-image\" style={{ maxWidth: props.maxWidth }} src={url} alt={title} />\n      )}\n      {contentType?.startsWith('video/') && (\n        <video data-testid=\"attachment-video\" style={{ maxWidth: props.maxWidth }} controls={true}>\n          <source type={contentType} src={url} />\n        </video>\n      )}\n      {contentType === 'application/pdf' && (\n        <div data-testid=\"attachment-pdf\" style={{ maxWidth: props.maxWidth, minHeight: 400 }}>\n          <iframe\n            width=\"100%\"\n            height=\"400\"\n            src={url + '#navpanes=0'}\n            allowFullScreen={true}\n            frameBorder={0}\n            seamless={true}\n          />\n        </div>\n      )}\n      <div data-testid=\"download-link\" style={{ padding: '2px 16px 16px 16px' }}>\n        <Anchor\n          href={url}\n          data-testid=\"attachment-details\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          download={getDownloadName(title)}\n        >\n          {title || 'Download'}\n        </Anchor>\n      </div>\n    </div>\n  );\n}\n\nfunction getDownloadName(title: string | undefined): string | undefined {\n  // Title often contains the filename by convention\n  return title?.includes('.') ? title : undefined;\n}\n", ".root {\n  display: grid;\n  grid-template-columns: 30% 70%;\n  margin: 0;\n\n  & > dt,\n  & > dd {\n    padding: var(--mantine-spacing-sm);\n    border-top: 0.1px solid light-dark(var(--mantine-color-gray-3), var(--mantine-color-dark-4));\n    margin: 0;\n  }\n\n  & > dt:first-of-type,\n  & > dd:first-of-type {\n    border-top: 0;\n    padding-top: 0;\n  }\n\n  & > dt:last-of-type,\n  & > dd:last-of-type {\n    padding-bottom: 0;\n  }\n}\n\n.compact {\n  grid-template-columns: auto 1fr;\n\n  & > dt,\n  & > dd {\n    padding: 0 0 var(--mantine-spacing-xs);\n    border-top: 0;\n  }\n\n  & > dt {\n    padding-right: var(--mantine-spacing-xs);\n  }\n\n  & > dd {\n    padding-left: var(--mantine-spacing-xs);\n  }\n\n  & > dt:last-of-type,\n  & > dd:last-of-type {\n    padding-bottom: 0;\n  }\n}\n", "import cx from 'clsx';\nimport { ReactNode } from 'react';\nimport classes from './DescriptionList.module.css';\n\nexport interface DescriptionListProps {\n  readonly children: ReactNode;\n  readonly compact?: boolean;\n}\n\nexport function DescriptionList(props: DescriptionListProps): JSX.Element {\n  const { children, compact } = props;\n  return <dl className={cx(classes.root, { [classes.compact]: compact })}>{children}</dl>;\n}\n\nexport interface DescriptionListEntryProps {\n  readonly term: string;\n  readonly children: ReactNode;\n}\n\nexport function DescriptionListEntry(props: DescriptionListEntryProps): JSX.Element {\n  return (\n    <>\n      <dt>{props.term}</dt>\n      <dd>{props.children}</dd>\n    </>\n  );\n}\n", "import { Attachment } from '@medplum/fhirtypes';\nimport { AttachmentDisplay } from '../AttachmentDisplay/AttachmentDisplay';\nimport { DescriptionListEntry } from '../DescriptionList/DescriptionList';\nimport { InternalSchemaElement, getPathDisplayName, isPopulated } from '@medplum/core';\n\nexport interface AttachmentArrayDisplayProps {\n  readonly path?: string;\n  readonly values?: Attachment[];\n  readonly maxWidth?: number;\n  readonly includeDescriptionListEntry?: boolean;\n  readonly property?: InternalSchemaElement;\n}\n\nexport function AttachmentArrayDisplay(props: AttachmentArrayDisplayProps): JSX.Element {\n  const attachmentElements = props.values?.map((v, index) => (\n    <div key={'attatchment-' + index}>\n      <AttachmentDisplay value={v} maxWidth={props.maxWidth} />\n    </div>\n  ));\n\n  let content: JSX.Element;\n  if (props.includeDescriptionListEntry) {\n    if (props.property === undefined) {\n      throw new Error('props.property is required when includeDescriptionListEntry is true');\n    }\n\n    if (!isPopulated(props.path)) {\n      throw new Error('props.path is required when includeDescriptionListEntry is true');\n    }\n\n    // Since arrays are responsible for rendering their own DescriptionListEntry, we must find the key\n    const key = props.path.split('.').pop() as string;\n    content = <DescriptionListEntry term={getPathDisplayName(key)}>{attachmentElements}</DescriptionListEntry>;\n  } else {\n    content = <>{attachmentElements}</>;\n  }\n  return content;\n}\n", "import { ActionIcon } from '@mantine/core';\nimport { Attachment } from '@medplum/fhirtypes';\nimport { IconCircleMinus, IconCloudUpload } from '@tabler/icons-react';\nimport { MouseEvent, useRef, useState } from 'react';\nimport { AttachmentButton } from '../AttachmentButton/AttachmentButton';\nimport { AttachmentDisplay } from '../AttachmentDisplay/AttachmentDisplay';\nimport { killEvent } from '../utils/dom';\n\nexport interface AttachmentArrayInputProps {\n  readonly name: string;\n  readonly defaultValue?: Attachment[];\n  readonly arrayElement?: boolean;\n  readonly onChange?: (value: Attachment[]) => void;\n}\n\nexport function AttachmentArrayInput(props: AttachmentArrayInputProps): JSX.Element {\n  const [values, setValues] = useState<Attachment[]>(props.defaultValue ?? []);\n\n  const valuesRef = useRef<Attachment[]>();\n  valuesRef.current = values;\n\n  function setValuesWrapper(newValues: Attachment[]): void {\n    setValues(newValues);\n    if (props.onChange) {\n      props.onChange(newValues);\n    }\n  }\n\n  return (\n    <table style={{ width: '100%' }}>\n      <colgroup>\n        <col width=\"97%\" />\n        <col width=\"3%\" />\n      </colgroup>\n      <tbody>\n        {values.map((v: Attachment, index: number) => (\n          <tr key={`${index}-${values.length}`}>\n            <td>\n              <AttachmentDisplay value={v} maxWidth={200} />\n            </td>\n            <td>\n              <ActionIcon\n                title=\"Remove\"\n                variant=\"subtle\"\n                size=\"sm\"\n                color=\"gray\"\n                onClick={(e: MouseEvent) => {\n                  killEvent(e);\n                  const copy = values.slice();\n                  copy.splice(index, 1);\n                  setValuesWrapper(copy);\n                }}\n              >\n                <IconCircleMinus />\n              </ActionIcon>\n            </td>\n          </tr>\n        ))}\n        <tr>\n          <td></td>\n          <td>\n            <AttachmentButton\n              onUpload={(attachment: Attachment) => {\n                setValuesWrapper([...(valuesRef.current as Attachment[]), attachment]);\n              }}\n            >\n              {(props) => (\n                <ActionIcon {...props} title=\"Add\" variant=\"subtle\" size=\"sm\" color=\"green\">\n                  <IconCloudUpload />\n                </ActionIcon>\n              )}\n            </AttachmentButton>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  );\n}\n", "import { normalizeOperationOutcome } from '@medplum/core';\nimport { Attachment, Binary, OperationOutcome } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { ChangeEvent, MouseEvent, ReactNode, useRef } from 'react';\nimport { killEvent } from '../utils/dom';\n\nexport interface AttachmentButtonProps {\n  readonly onUpload: (attachment: Attachment) => void;\n  readonly onUploadStart?: () => void;\n  readonly onUploadProgress?: (e: ProgressEvent) => void;\n  readonly onUploadError?: (outcome: OperationOutcome) => void;\n  children(props: { onClick(e: MouseEvent): void }): ReactNode;\n}\n\nexport function AttachmentButton(props: AttachmentButtonProps): JSX.Element {\n  const medplum = useMedplum();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  function onClick(e: MouseEvent): void {\n    killEvent(e);\n    fileInputRef.current?.click();\n  }\n\n  function onFileChange(e: ChangeEvent): void {\n    killEvent(e);\n    const files = (e.target as HTMLInputElement).files;\n    if (files) {\n      Array.from(files).forEach(processFile);\n    }\n  }\n\n  /**\n   * Processes a single file.\n   * @param file - The file descriptor.\n   */\n  function processFile(file: File): void {\n    if (!file) {\n      return;\n    }\n\n    const fileName = file.name;\n    if (!fileName) {\n      return;\n    }\n\n    if (props.onUploadStart) {\n      props.onUploadStart();\n    }\n\n    const filename = file.name;\n    const contentType = file.type || 'application/octet-stream';\n    medplum\n      .createBinary(file, filename, contentType, props.onUploadProgress)\n      .then((binary: Binary) => {\n        props.onUpload({\n          contentType: binary.contentType,\n          url: binary.url,\n          title: filename,\n        });\n      })\n      .catch((err) => {\n        if (props.onUploadError) {\n          props.onUploadError(normalizeOperationOutcome(err));\n        }\n      });\n  }\n\n  return (\n    <>\n      <input\n        type=\"file\"\n        data-testid=\"upload-file-input\"\n        style={{ display: 'none' }}\n        ref={fileInputRef}\n        onChange={(e) => onFileChange(e)}\n      />\n      {props.children({ onClick })}\n    </>\n  );\n}\n", "import { Button } from '@mantine/core';\nimport { Attachment } from '@medplum/fhirtypes';\nimport { MouseEvent, useState } from 'react';\nimport { AttachmentButton } from '../AttachmentButton/AttachmentButton';\nimport { AttachmentDisplay } from '../AttachmentDisplay/AttachmentDisplay';\nimport { killEvent } from '../utils/dom';\n\nexport interface AttachmentInputProps {\n  readonly name: string;\n  readonly defaultValue?: Attachment;\n  readonly arrayElement?: boolean;\n  readonly onChange?: (value: Attachment | undefined) => void;\n}\n\nexport function AttachmentInput(props: AttachmentInputProps): JSX.Element {\n  const [value, setValue] = useState(props.defaultValue);\n\n  function setValueWrapper(newValue: Attachment | undefined): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  if (value) {\n    return (\n      <>\n        <AttachmentDisplay value={value} maxWidth={200} />\n        <Button\n          onClick={(e: MouseEvent) => {\n            killEvent(e);\n            setValueWrapper(undefined);\n          }}\n        >\n          Remove\n        </Button>\n      </>\n    );\n  }\n\n  return (\n    <AttachmentButton onUpload={setValueWrapper}>{(props) => <Button {...props}>Upload...</Button>}</AttachmentButton>\n  );\n}\n", "import {\n  buildElementsContext,\n  ElementsContextType,\n  getPathDisplayName,\n  isEmpty,\n  tryGetDataType,\n  TypedValue,\n} from '@medplum/core';\nimport { DEFAULT_IGNORED_NON_NESTED_PROPERTIES, DEFAULT_IGNORED_PROPERTIES } from '../constants';\nimport { DescriptionList, DescriptionListEntry } from '../DescriptionList/DescriptionList';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport { getValueAndType } from '../ResourcePropertyDisplay/ResourcePropertyDisplay.utils';\nimport { useContext, useMemo } from 'react';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { maybeWrapWithContext } from '../utils/maybeWrapWithContext';\n\nconst EXTENSION_KEYS = ['extension', 'modifierExtension'];\nconst IGNORED_PROPERTIES = DEFAULT_IGNORED_PROPERTIES.filter((prop) => !EXTENSION_KEYS.includes(prop));\n\nexport interface BackboneElementDisplayProps {\n  readonly value: TypedValue;\n  /** The path identifies the element and is expressed as a \".\"-separated list of ancestor elements, beginning with the name of the resource or extension. */\n  readonly path: string;\n  readonly compact?: boolean;\n  readonly ignoreMissingValues?: boolean;\n  readonly link?: boolean;\n  /** (optional) Profile URL of the structure definition represented by the backbone element */\n  readonly profileUrl?: string;\n}\n\nexport function BackboneElementDisplay(props: BackboneElementDisplayProps): JSX.Element | null {\n  const typedValue = props.value;\n  const { value, type: typeName } = typedValue;\n  const parentElementsContext = useContext(ElementsContext);\n  const profileUrl = props.profileUrl ?? parentElementsContext?.profileUrl;\n  const typeSchema = useMemo(() => tryGetDataType(typeName, profileUrl), [profileUrl, typeName]);\n\n  const newElementsContext: ElementsContextType | undefined = useMemo(() => {\n    if (!typeSchema) {\n      return undefined;\n    }\n    return buildElementsContext({\n      parentContext: parentElementsContext,\n      elements: typeSchema.elements,\n      path: props.path,\n      profileUrl: typeSchema.url,\n    });\n  }, [typeSchema, props.path, parentElementsContext]);\n\n  if (isEmpty(value)) {\n    return null;\n  }\n\n  if (!typeSchema) {\n    return <div>{typeName}&nbsp;not implemented</div>;\n  }\n\n  if (\n    typeof value === 'object' &&\n    'name' in value &&\n    Object.keys(value).length === 1 &&\n    typeof value.name === 'string'\n  ) {\n    // Special case for common BackboneElement pattern\n    // Where there is an object with a single property 'name'\n    // Just display the name value.\n    return <div>{value.name}</div>;\n  }\n\n  // Since this component may create a new ElementsContext, compute the effective context for use in this component\n  const elementsContext = newElementsContext ?? parentElementsContext;\n\n  return maybeWrapWithContext(\n    ElementsContext.Provider,\n    newElementsContext,\n    <DescriptionList compact={props.compact}>\n      {Object.entries(elementsContext.elements).map(([key, property]) => {\n        if (EXTENSION_KEYS.includes(key) && isEmpty(property.slicing?.slices)) {\n          // an extension property without slices has no nested extensions\n          return null;\n        } else if (IGNORED_PROPERTIES.includes(key)) {\n          return null;\n        } else if (DEFAULT_IGNORED_NON_NESTED_PROPERTIES.includes(key) && property.path.split('.').length === 2) {\n          return null;\n        }\n\n        // Profiles can include nested elements in addition to their containing element, e.g.:\n        // identifier, identifier.use, identifier.system\n        // Skip nested elements, e.g. identifier.use, since they are handled by the containing element\n        if (key.includes('.')) {\n          return null;\n        }\n\n        const [propertyValue, propertyType] = getValueAndType(typedValue, key, elementsContext.profileUrl);\n        if ((props.ignoreMissingValues || property.max === 0) && isEmpty(propertyValue)) {\n          return null;\n        }\n\n        if (props.path.endsWith('.extension') && (key === 'url' || key === 'id')) {\n          return null;\n        }\n\n        // Array values provide their own DescriptionListEntry wrapper(s)\n        const isArrayProperty = property.max > 1 || property.isArray;\n        const resourcePropertyDisplay = (\n          <ResourcePropertyDisplay\n            key={key}\n            property={property}\n            propertyType={propertyType}\n            path={props.path + '.' + key}\n            value={propertyValue}\n            ignoreMissingValues={props.ignoreMissingValues}\n            includeArrayDescriptionListEntry={isArrayProperty}\n            link={props.link}\n          />\n        );\n\n        if (isArrayProperty) {\n          return resourcePropertyDisplay;\n        }\n\n        return (\n          <DescriptionListEntry key={key} term={getPathDisplayName(key)}>\n            {resourcePropertyDisplay}\n          </DescriptionListEntry>\n        );\n      })}\n    </DescriptionList>\n  );\n}\n", "export const DEFAULT_IGNORED_PROPERTIES = ['meta', 'implicitRules', 'contained', 'extension', 'modifierExtension'];\n\n// Ignored only when they are top-level properties\n// e.g. Patient.language is ignored, but Patient.communication.language is not ignored\nexport const DEFAULT_IGNORED_NON_NESTED_PROPERTIES = ['language', 'text'];\n", "import { ActionIcon, Box, CopyButton, Tooltip } from '@mantine/core';\nimport {\n  InternalSchemaElement,\n  PropertyType,\n  formatDateTime,\n  formatPeriod,\n  formatTiming,\n  isEmpty,\n} from '@medplum/core';\nimport { IconCheck, IconCopy } from '@tabler/icons-react';\nimport { AddressDisplay } from '../AddressDisplay/AddressDisplay';\nimport { AttachmentArrayDisplay } from '../AttachmentArrayDisplay/AttachmentArrayDisplay';\nimport { AttachmentDisplay } from '../AttachmentDisplay/AttachmentDisplay';\nimport { BackboneElementDisplay } from '../BackboneElementDisplay/BackboneElementDisplay';\nimport { CodeableConceptDisplay } from '../CodeableConceptDisplay/CodeableConceptDisplay';\nimport { CodingDisplay } from '../CodingDisplay/CodingDisplay';\nimport { ContactDetailDisplay } from '../ContactDetailDisplay/ContactDetailDisplay';\nimport { ContactPointDisplay } from '../ContactPointDisplay/ContactPointDisplay';\nimport { HumanNameDisplay } from '../HumanNameDisplay/HumanNameDisplay';\nimport { IdentifierDisplay } from '../IdentifierDisplay/IdentifierDisplay';\nimport { MoneyDisplay } from '../MoneyDisplay/MoneyDisplay';\nimport { QuantityDisplay } from '../QuantityDisplay/QuantityDisplay';\nimport { RangeDisplay } from '../RangeDisplay/RangeDisplay';\nimport { RatioDisplay } from '../RatioDisplay/RatioDisplay';\nimport { ReferenceDisplay } from '../ReferenceDisplay/ReferenceDisplay';\nimport { ResourceArrayDisplay } from '../ResourceArrayDisplay/ResourceArrayDisplay';\nimport { ExtensionDisplay } from '../ExtensionDisplay/ExtensionDisplay';\nimport { ElementDefinitionType } from '@medplum/fhirtypes';\n\nexport interface ResourcePropertyDisplayProps {\n  readonly property?: InternalSchemaElement;\n  /** The path identifies the element and is expressed as a \".\"-separated list of ancestor elements, beginning with the name of the resource or extension. */\n  readonly path?: string;\n  readonly propertyType: string;\n  readonly value: any;\n  readonly arrayElement?: boolean;\n  readonly maxWidth?: number;\n  readonly ignoreMissingValues?: boolean;\n  readonly link?: boolean;\n  /** (Optional) The `ElemendDefinitionType` to display the property against. Used when displaying extensions.  */\n  readonly elementDefinitionType?: ElementDefinitionType;\n  /** (Optional) If true and `property` is an array, output is wrapped with a DescriptionListEntry */\n  readonly includeArrayDescriptionListEntry?: boolean;\n}\n\n/**\n * Low-level component that renders a property from a given resource, given type information.\n * @param props - The ResourcePropertyDisplay React props.\n * @returns The ResourcePropertyDisplay React node.\n */\nexport function ResourcePropertyDisplay(props: ResourcePropertyDisplayProps): JSX.Element | null {\n  const { property, propertyType, value } = props;\n\n  const isIdProperty = property?.path?.endsWith('.id');\n  if (isIdProperty) {\n    return (\n      <Box component=\"div\" style={{ display: 'flex', gap: 3, alignItems: 'center' }}>\n        {value}\n        {!isEmpty(value) && (\n          <CopyButton value={value} timeout={2000}>\n            {({ copied, copy }) => (\n              <Tooltip label={copied ? 'Copied' : 'Copy'} withArrow position=\"right\">\n                <ActionIcon variant=\"subtle\" color={copied ? 'teal' : 'gray'} onClick={copy}>\n                  {copied ? <IconCheck size=\"1rem\" /> : <IconCopy size=\"1rem\" />}\n                </ActionIcon>\n              </Tooltip>\n            )}\n          </CopyButton>\n        )}\n      </Box>\n    );\n  }\n\n  const isArrayElement = Boolean(props.arrayElement);\n\n  if (property?.max && property.max > 1 && !isArrayElement) {\n    if (propertyType === PropertyType.Attachment) {\n      return (\n        <AttachmentArrayDisplay\n          values={value}\n          maxWidth={props.maxWidth}\n          includeDescriptionListEntry={props.includeArrayDescriptionListEntry}\n          property={property}\n          path={props.path}\n        />\n      );\n    }\n    return (\n      <ResourceArrayDisplay\n        path={props.path}\n        property={property}\n        propertyType={propertyType}\n        values={value}\n        includeDescriptionListEntry={props.includeArrayDescriptionListEntry}\n        ignoreMissingValues={props.ignoreMissingValues}\n        link={props.link}\n      />\n    );\n  }\n\n  switch (propertyType) {\n    case PropertyType.boolean:\n      return <>{value === undefined ? '' : Boolean(value).toString()}</>;\n    case PropertyType.SystemString:\n    case PropertyType.string:\n      return <div style={{ whiteSpace: 'pre-wrap' }}>{value}</div>;\n    case PropertyType.code:\n    case PropertyType.date:\n    case PropertyType.decimal:\n    case PropertyType.id:\n    case PropertyType.integer:\n    case PropertyType.positiveInt:\n    case PropertyType.unsignedInt:\n    case PropertyType.uri:\n    case PropertyType.url:\n      return <>{value}</>;\n    case PropertyType.canonical:\n      return <ReferenceDisplay value={{ reference: value }} link={props.link} />;\n    case PropertyType.dateTime:\n    case PropertyType.instant:\n      return <>{formatDateTime(value)}</>;\n    case PropertyType.markdown:\n      return <pre>{value}</pre>;\n    case PropertyType.Address:\n      return <AddressDisplay value={value} />;\n    case PropertyType.Annotation:\n      return <>{value?.text}</>;\n    case PropertyType.Attachment:\n      return <AttachmentDisplay value={value} maxWidth={props.maxWidth} />;\n    case PropertyType.CodeableConcept:\n      return <CodeableConceptDisplay value={value} />;\n    case PropertyType.Coding:\n      return <CodingDisplay value={value} />;\n    case PropertyType.ContactDetail:\n      return <ContactDetailDisplay value={value} />;\n    case PropertyType.ContactPoint:\n      return <ContactPointDisplay value={value} />;\n    case PropertyType.HumanName:\n      return <HumanNameDisplay value={value} />;\n    case PropertyType.Identifier:\n      return <IdentifierDisplay value={value} />;\n    case PropertyType.Money:\n      return <MoneyDisplay value={value} />;\n    case PropertyType.Period:\n      return <>{formatPeriod(value)}</>;\n    case PropertyType.Quantity:\n    case PropertyType.Duration:\n      return <QuantityDisplay value={value} />;\n    case PropertyType.Range:\n      return <RangeDisplay value={value} />;\n    case PropertyType.Ratio:\n      return <RatioDisplay value={value} />;\n    case PropertyType.Reference:\n      return <ReferenceDisplay value={value} link={props.link} />;\n    case PropertyType.Timing:\n      return <>{formatTiming(value)}</>;\n    case PropertyType.Dosage:\n    case PropertyType.UsageContext:\n      if (!props.path) {\n        throw Error(`Displaying property of type ${props.propertyType} requires path`);\n      }\n      return (\n        <BackboneElementDisplay\n          path={props.path}\n          value={{ type: propertyType, value }}\n          compact={true}\n          ignoreMissingValues={props.ignoreMissingValues}\n        />\n      );\n    case PropertyType.Extension:\n      if (!props.path) {\n        throw Error(`Displaying property of type ${props.propertyType} requires path`);\n      }\n      return (\n        <ExtensionDisplay\n          path={props.path}\n          value={value}\n          compact={true}\n          ignoreMissingValues={props.ignoreMissingValues}\n          elementDefinitionType={props.elementDefinitionType}\n        />\n      );\n    default:\n      if (!property) {\n        throw Error(`Displaying property of type ${props.propertyType} requires element schema`);\n      }\n      if (!props.path) {\n        throw Error(`Displaying property of type ${props.propertyType} requires path`);\n      }\n      return (\n        <BackboneElementDisplay\n          path={props.path}\n          value={{ type: property.type[0].code, value }}\n          compact={true}\n          ignoreMissingValues={props.ignoreMissingValues}\n        />\n      );\n  }\n}\n", "import { formatCodeableConcept } from '@medplum/core';\nimport { CodeableConcept } from '@medplum/fhirtypes';\n\nexport interface CodeableConceptDisplayProps {\n  readonly value?: CodeableConcept;\n}\n\nexport function CodeableConceptDisplay(props: CodeableConceptDisplayProps): JSX.Element {\n  return <>{formatCodeableConcept(props.value)}</>;\n}\n", "import { formatCoding } from '@medplum/core';\nimport { Coding } from '@medplum/fhirtypes';\n\nexport interface CodingDisplayProps {\n  readonly value?: Coding;\n}\n\nexport function CodingDisplay(props: CodingDisplayProps): JSX.Element {\n  return <>{formatCoding(props.value)}</>;\n}\n", "import { ContactPoint } from '@medplum/fhirtypes';\n\nexport interface ContactPointDisplayProps {\n  readonly value?: ContactPoint;\n}\n\nexport function ContactPointDisplay(props: ContactPointDisplayProps): JSX.Element | null {\n  const contactPoint = props.value;\n  if (!contactPoint) {\n    return null;\n  }\n\n  const builder = [];\n\n  if (contactPoint.value) {\n    builder.push(contactPoint.value);\n  }\n\n  if (contactPoint.use || contactPoint.system) {\n    builder.push(' [');\n\n    if (contactPoint.use) {\n      builder.push(contactPoint.use);\n    }\n\n    if (contactPoint.use && contactPoint.system) {\n      builder.push(' ');\n    }\n\n    if (contactPoint.system) {\n      builder.push(contactPoint.system);\n    }\n\n    builder.push(']');\n  }\n\n  return <>{builder.join('').trim()}</>;\n}\n", "import { ContactDetail } from '@medplum/fhirtypes';\nimport { ContactPointDisplay } from '../ContactPointDisplay/ContactPointDisplay';\n\nexport interface ContactDetailDisplayProps {\n  readonly value?: ContactDetail;\n}\n\nexport function ContactDetailDisplay(props: ContactDetailDisplayProps): JSX.Element | null {\n  const contactDetail = props.value;\n  if (!contactDetail) {\n    return null;\n  }\n\n  return (\n    <>\n      {contactDetail.name}\n      {contactDetail.name && ': '}\n      {contactDetail.telecom?.map((telecom) => (\n        <ContactPointDisplay key={`telecom-${contactDetail.name}-${telecom.value}`} value={telecom} />\n      ))}\n    </>\n  );\n}\n", "import { Identifier } from '@medplum/fhirtypes';\n\nexport interface IdentifierDisplayProps {\n  readonly value?: Identifier;\n}\n\nexport function IdentifierDisplay(props: IdentifierDisplayProps): JSX.Element {\n  return (\n    <div>\n      {props.value?.system}: {props.value?.value}\n    </div>\n  );\n}\n", "import { formatMoney } from '@medplum/core';\nimport { Money } from '@medplum/fhirtypes';\n\nexport interface MoneyDisplayProps {\n  readonly value?: Money;\n}\n\nexport function MoneyDisplay(props: MoneyDisplayProps): JSX.Element | null {\n  return <>{formatMoney(props.value)}</>;\n}\n", "import { formatQuantity } from '@medplum/core';\nimport { Quantity } from '@medplum/fhirtypes';\n\nexport interface QuantityDisplayProps {\n  readonly value?: Quantity;\n}\n\nexport function QuantityDisplay(props: QuantityDisplayProps): JSX.Element | null {\n  return <>{formatQuantity(props.value)}</>;\n}\n", "import { formatRange } from '@medplum/core';\nimport { Range } from '@medplum/fhirtypes';\n\nexport interface RangeDisplayProps {\n  readonly value?: Range;\n}\n\nexport function RangeDisplay(props: RangeDisplayProps): JSX.Element | null {\n  return <>{formatRange(props.value)}</>;\n}\n", "import { Ratio } from '@medplum/fhirtypes';\nimport { QuantityDisplay } from '../QuantityDisplay/QuantityDisplay';\n\nexport interface RatioDisplayProps {\n  readonly value?: Ratio;\n}\n\nexport function RatioDisplay(props: RatioDisplayProps): JSX.Element | null {\n  const value = props.value;\n  if (!value) {\n    return null;\n  }\n\n  return (\n    <>\n      <QuantityDisplay value={value.numerator} />\n      &nbsp;/&nbsp;\n      <QuantityDisplay value={value.denominator} />\n    </>\n  );\n}\n", "import { stringify } from '@medplum/core';\nimport { Reference } from '@medplum/fhirtypes';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\n\nexport interface ReferenceDisplayProps {\n  readonly value?: Reference;\n  readonly link?: boolean;\n}\n\nexport function ReferenceDisplay(props: ReferenceDisplayProps): JSX.Element | null {\n  if (!props.value) {\n    return null;\n  }\n\n  const displayString = props.value.display || props.value.reference || stringify(props.value);\n\n  // The \"link\" prop defaults to \"true\"; undefined is treated as \"true\"\n  // To disable the link, it must be explicitly \"false\"\n  if (props.link !== false && props.value.reference) {\n    return <MedplumLink to={props.value}>{displayString}</MedplumLink>;\n  } else {\n    return <>{displayString}</>;\n  }\n}\n", "import { InternalSchemaElement, SliceDefinitionWithTypes, getPathDisplayName, isPopulated } from '@medplum/core';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport { useState, useContext, useEffect, useMemo } from 'react';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { prepareSlices, assignValuesIntoSlices } from '../ResourceArrayInput/ResourceArrayInput.utils';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { SliceDisplay } from '../SliceDisplay/SliceDisplay';\nimport { DescriptionListEntry } from '../DescriptionList/DescriptionList';\n\nexport interface ResourceArrayDisplayProps {\n  /** The path identifies the element and is expressed as a \".\"-separated list of ancestor elements, beginning with the name of the resource or extension. */\n  readonly path?: string;\n  readonly property: InternalSchemaElement;\n  readonly propertyType: string;\n  readonly values: any[];\n  readonly ignoreMissingValues?: boolean;\n  readonly link?: boolean;\n  readonly includeDescriptionListEntry?: boolean;\n}\n\nexport function ResourceArrayDisplay(props: ResourceArrayDisplayProps): JSX.Element | null {\n  const { property, propertyType } = props;\n  const medplum = useMedplum();\n  const values = useMemo<any[]>(() => (Array.isArray(props.values) ? props.values : []), [props.values]);\n  const [loading, setLoading] = useState(true);\n  const [slices, setSlices] = useState<SliceDefinitionWithTypes[]>([]);\n  const [slicedValues, setSlicedValues] = useState<any[][]>(() => [values]);\n  const ctx = useContext(ElementsContext);\n\n  useEffect(() => {\n    prepareSlices({\n      medplum,\n      property,\n    })\n      .then((slices) => {\n        setSlices(slices);\n        const slicedValues = assignValuesIntoSlices(values, slices, property.slicing, ctx.profileUrl);\n        setSlicedValues(slicedValues);\n        setLoading(false);\n      })\n      .catch((reason) => {\n        console.error(reason);\n        setLoading(false);\n      });\n  }, [medplum, property, ctx.profileUrl, setSlicedValues, values]);\n\n  if (loading) {\n    return <div>Loading...</div>;\n  }\n\n  let nonSliceContent: JSX.Element | undefined;\n  const showNonSliceValues = property.type[0]?.code !== 'Extension';\n  if (showNonSliceValues) {\n    const nonSliceValues = slicedValues[slices.length];\n    const nonSliceElements = nonSliceValues.map((value, valueIndex) => (\n      <div key={`${valueIndex}-${nonSliceValues.length}`}>\n        <ResourcePropertyDisplay\n          path={props.path}\n          arrayElement={true}\n          property={property}\n          propertyType={propertyType}\n          value={value}\n          ignoreMissingValues={props.ignoreMissingValues}\n          link={props.link}\n        />\n      </div>\n    ));\n\n    if (props.includeDescriptionListEntry) {\n      // Since arrays are responsible for rendering their own DescriptionListEntry, we must find the key\n      if (!isPopulated(props.path)) {\n        throw new Error('props.path is required when includeDescriptionListEntry is true');\n      }\n      const key = props.path.split('.').pop() as string;\n      nonSliceContent = <DescriptionListEntry term={getPathDisplayName(key)}>{nonSliceElements}</DescriptionListEntry>;\n    } else {\n      nonSliceContent = <>{nonSliceElements}</>;\n    }\n  }\n\n  return (\n    <>\n      {slices.map((slice, sliceIndex) => {\n        if (!props.path) {\n          throw Error(`Displaying a resource property with slices of type ${props.propertyType} requires path`);\n        }\n        let sliceDisplay = (\n          <SliceDisplay\n            key={slice.name}\n            path={props.path}\n            slice={slice}\n            property={property}\n            value={slicedValues[sliceIndex]}\n            ignoreMissingValues={props.ignoreMissingValues}\n            link={props.link}\n          />\n        );\n\n        if (props.includeDescriptionListEntry) {\n          sliceDisplay = (\n            <DescriptionListEntry key={slice.name} term={getPathDisplayName(slice.name)}>\n              {sliceDisplay}\n            </DescriptionListEntry>\n          );\n        }\n        return sliceDisplay;\n      })}\n\n      {nonSliceContent}\n    </>\n  );\n}\n", "import { ElementsContextType } from '@medplum/core';\nimport React from 'react';\n\nexport const ElementsContext = React.createContext<ElementsContextType>({\n  path: '',\n  profileUrl: undefined,\n  elements: Object.create(null),\n  elementsByPath: Object.create(null),\n  debugMode: false,\n});\nElementsContext.displayName = 'ElementsContext';\n", "import {\n  InternalSchemaElement,\n  MedplumClient,\n  SliceDefinitionWithTypes,\n  SlicingRules,\n  getValueSliceName,\n  isPopulated,\n  isSliceDefinitionWithTypes,\n  tryGetProfile,\n} from '@medplum/core';\n\nexport function assignValuesIntoSlices(\n  values: any[],\n  slices: SliceDefinitionWithTypes[],\n  slicing: SlicingRules | undefined,\n  profileUrl: string | undefined\n): any[][] {\n  if (!isPopulated(slicing?.slices)) {\n    return [values];\n  }\n\n  // store values in an array of arrays: one for each slice plus another for non-sliced values\n  const slicedValues: any[][] = new Array(slices.length + 1);\n  for (let i = 0; i < slicedValues.length; i++) {\n    slicedValues[i] = [];\n  }\n\n  for (const value of values) {\n    const sliceName = getValueSliceName(value, slices, slicing.discriminator, profileUrl);\n\n    let sliceIndex = sliceName ? slices.findIndex((slice) => slice.name === sliceName) : -1;\n    // -1 can come from either findIndex or the ternary else\n    if (sliceIndex === -1) {\n      sliceIndex = slices.length;\n    }\n    slicedValues[sliceIndex].push(value);\n  }\n\n  return slicedValues;\n}\n\nexport async function prepareSlices({\n  medplum,\n  property,\n}: {\n  medplum: MedplumClient;\n  property: InternalSchemaElement;\n}): Promise<SliceDefinitionWithTypes[]> {\n  return new Promise((resolve, reject) => {\n    if (!property.slicing) {\n      resolve([]);\n      return;\n    }\n\n    const supportedSlices: SliceDefinitionWithTypes[] = [];\n    const profileUrls: (string | undefined)[] = [];\n    const promises: Promise<string[]>[] = [];\n    for (const slice of property.slicing.slices) {\n      if (!isSliceDefinitionWithTypes(slice)) {\n        console.debug('Unsupported slice definition', slice);\n        continue;\n      }\n\n      let profileUrl: string | undefined;\n      // If elements are not defined for the slice, look for a profile\n      if (!isPopulated(slice.elements)) {\n        profileUrl = slice.type[0]?.profile?.[0];\n      }\n\n      // important to keep these three arrays the same length;\n      supportedSlices.push(slice);\n      profileUrls.push(profileUrl);\n      if (profileUrl) {\n        promises.push(medplum.requestProfileSchema(profileUrl));\n      } else {\n        promises.push(Promise.resolve([]));\n      }\n    }\n\n    Promise.all(promises)\n      .then(() => {\n        for (let i = 0; i < supportedSlices.length; i++) {\n          const slice = supportedSlices[i];\n          const profileUrl = profileUrls[i];\n          if (profileUrl) {\n            const typeSchema = tryGetProfile(profileUrl);\n            slice.typeSchema = typeSchema;\n          }\n        }\n        resolve(supportedSlices);\n      })\n      .catch(reject);\n  });\n}\n", "import {\n  SliceDefinitionWithTypes,\n  InternalSchemaElement,\n  ElementsContextType,\n  buildElementsContext,\n  isPopulated,\n} from '@medplum/core';\nimport { useContext, useMemo } from 'react';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport { maybeWrapWithContext } from '../utils/maybeWrapWithContext';\n\nexport interface SliceDisplayProps {\n  readonly path: string;\n  readonly slice: SliceDefinitionWithTypes;\n  readonly property: InternalSchemaElement;\n  readonly value: any[];\n  readonly ignoreMissingValues?: boolean;\n  readonly link?: boolean;\n}\n\nexport function SliceDisplay(props: SliceDisplayProps): JSX.Element {\n  const { slice, property } = props;\n\n  const sliceElements = slice.typeSchema?.elements ?? slice.elements;\n\n  const parentContext = useContext(ElementsContext);\n\n  const contextValue: ElementsContextType | undefined = useMemo(() => {\n    if (isPopulated(sliceElements)) {\n      return buildElementsContext({\n        parentContext: parentContext,\n        elements: sliceElements,\n        path: props.path,\n        profileUrl: slice.typeSchema?.url,\n      });\n    }\n    return undefined;\n  }, [parentContext, props.path, slice.typeSchema?.url, sliceElements]);\n\n  return maybeWrapWithContext(\n    ElementsContext.Provider,\n    contextValue,\n    <>\n      {props.value.map((value, valueIndex) => {\n        return (\n          <div key={`${valueIndex}-${props.value.length}`}>\n            <ResourcePropertyDisplay\n              property={property}\n              path={props.path}\n              arrayElement={true}\n              elementDefinitionType={slice.type[0]}\n              propertyType={slice.type[0].code}\n              value={value}\n              ignoreMissingValues={props.ignoreMissingValues}\n              link={props.link}\n            />\n          </div>\n        );\n      })}\n    </>\n  );\n}\n", "export function maybeWrapWithContext<T>(\n  ContextProvider: React.Context<T>['Provider'],\n  contextValue: T | undefined,\n  contents: JSX.Element\n): JSX.Element {\n  if (contextValue !== undefined) {\n    return <ContextProvider value={contextValue}>{contents}</ContextProvider>;\n  }\n\n  return contents;\n}\n", "import {\n  ElementType,\n  InternalTypeSchema,\n  getDataType,\n  isPopulated,\n  isProfileLoaded,\n  tryGetProfile,\n} from '@medplum/core';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useContext, useEffect, useMemo, useState } from 'react';\nimport { BackboneElementDisplay } from '../BackboneElementDisplay/BackboneElementDisplay';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport { getValueAndType } from '../ResourcePropertyDisplay/ResourcePropertyDisplay.utils';\n\nexport type ExtensionDisplayProps = {\n  /** The path identifies the element and is expressed as a \".\"-separated list of ancestor elements, beginning with the name of the resource or extension. */\n  readonly path: string;\n  readonly elementDefinitionType?: ElementType;\n  readonly value: any;\n  readonly ignoreMissingValues?: boolean;\n  readonly link?: boolean;\n  readonly compact?: boolean;\n};\n\nexport function ExtensionDisplay(props: ExtensionDisplayProps): JSX.Element | null {\n  const { elementDefinitionType } = props;\n\n  const medplum = useMedplum();\n  const ctx = useContext(ElementsContext);\n  const [typeSchema, setTypeSchema] = useState<InternalTypeSchema>(getDataType('Extension'));\n  const profileUrl: string | undefined = useMemo(() => {\n    if (!isPopulated(elementDefinitionType?.profile)) {\n      return undefined;\n    }\n\n    return elementDefinitionType.profile[0] satisfies string;\n  }, [elementDefinitionType]);\n  const [loadingProfile, setLoadingProfile] = useState(profileUrl !== undefined);\n\n  useEffect(() => {\n    if (profileUrl) {\n      setLoadingProfile(true);\n      medplum\n        .requestProfileSchema(profileUrl)\n        .then(() => {\n          const profile = tryGetProfile(profileUrl);\n          setLoadingProfile(false);\n          if (profile) {\n            setTypeSchema(profile);\n          }\n        })\n        .catch((reason) => {\n          setLoadingProfile(false);\n          console.warn(reason);\n        });\n    }\n  }, [medplum, profileUrl]);\n\n  if (profileUrl && (loadingProfile || !isProfileLoaded(profileUrl))) {\n    return <div>Loading...</div>;\n  }\n\n  const valueElement = typeSchema.elements['value[x]'];\n  const extensionHasValue = valueElement?.max !== 0;\n  if (extensionHasValue) {\n    const [propertyValue, propertyType] = getValueAndType(\n      { type: 'Extension', value: props.value },\n      'value[x]',\n      profileUrl ?? ctx.profileUrl\n    );\n    return <ResourcePropertyDisplay propertyType={propertyType} value={propertyValue} />;\n  }\n\n  return (\n    <BackboneElementDisplay\n      path={props.path}\n      value={{ type: typeSchema.name, value: props.value }}\n      compact={props.compact}\n      ignoreMissingValues={props.ignoreMissingValues}\n      link={props.link}\n      profileUrl={profileUrl}\n    />\n  );\n}\n", "import {\n  getTypedPropertyValue,\n  getTypedPropertyValueWithSchema,\n  InternalSchemaElement,\n  TypedValue,\n} from '@medplum/core';\n\n/**\n * Returns the value of the property and the property type.\n * Some property definitions support multiple types.\n * For example, \"Observation.value[x]\" can be \"valueString\", \"valueInteger\", \"valueQuantity\", etc.\n * According to the spec, there can only be one property for a given element definition.\n * This function returns the value and the type.\n * @param context - The base context (usually a FHIR resource).\n * @param path - The property path.\n * @param profileUrl - The property path.\n * @returns The value of the property and the property type.\n */\nexport function getValueAndType(context: TypedValue, path: string, profileUrl?: string): [any, string] {\n  const typedResult = getTypedPropertyValue(context, path, { profileUrl });\n  if (!typedResult) {\n    return [undefined, 'undefined'];\n  }\n\n  if (Array.isArray(typedResult)) {\n    return [typedResult.map((e) => e.value), typedResult[0].type];\n  }\n\n  return [typedResult.value, typedResult.type];\n}\n\n/**\n * Returns the value of the property and the property type.\n * Some property definitions support multiple types.\n * For example, \"Observation.value[x]\" can be \"valueString\", \"valueInteger\", \"valueQuantity\", etc.\n * According to the spec, there can only be one property for a given element definition.\n * This function returns the value and the type.\n * @param typedValue - The base context (usually a FHIR resource).\n * @param path - The property path.\n * @param element - The property element definition.\n * @returns The value of the property and the property type.\n */\nexport function getValueAndTypeFromElement(\n  typedValue: TypedValue,\n  path: string,\n  element: InternalSchemaElement\n): [any, string] {\n  const typedResult = getTypedPropertyValueWithSchema(typedValue, path, element);\n  if (!typedResult) {\n    return [undefined, 'undefined'];\n  }\n\n  if (Array.isArray(typedResult)) {\n    return [typedResult.map((e) => e.value), typedResult[0].type];\n  }\n\n  return [typedResult.value, typedResult.type];\n}\n", "import { ElementsContextType, buildElementsContext, tryGetDataType } from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useContext, useMemo, useState } from 'react';\nimport { ElementsInput } from '../ElementsInput/ElementsInput';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { maybeWrapWithContext } from '../utils/maybeWrapWithContext';\n\nexport interface BackboneElementInputProps {\n  /** Type name the backbone element represents */\n  readonly typeName: string;\n  /** The path identifies the element and is expressed as a \".\"-separated list of ancestor elements, beginning with the name of the resource or extension. */\n  readonly path: string;\n  /** (optional) The contents of the resource represented by the backbone element */\n  readonly defaultValue?: any;\n  /** (optional) OperationOutcome from the last attempted system action*/\n  readonly outcome?: OperationOutcome;\n  /** (optional) callback function that is called when the value of the backbone element changes */\n  readonly onChange?: (value: any) => void;\n  /** (optional) Profile URL of the structure definition represented by the backbone element */\n  readonly profileUrl?: string;\n}\n\nexport function BackboneElementInput(props: BackboneElementInputProps): JSX.Element {\n  const [defaultValue] = useState(() => props.defaultValue ?? {});\n  const parentElementsContext = useContext(ElementsContext);\n  const profileUrl = props.profileUrl ?? parentElementsContext?.profileUrl;\n  const typeSchema = useMemo(() => tryGetDataType(props.typeName, profileUrl), [props.typeName, profileUrl]);\n  const type = typeSchema?.type ?? props.typeName;\n\n  const contextValue: ElementsContextType | undefined = useMemo(() => {\n    if (!typeSchema) {\n      return undefined;\n    }\n    return buildElementsContext({\n      parentContext: parentElementsContext,\n      elements: typeSchema.elements,\n      path: props.path,\n      profileUrl: typeSchema.url,\n    });\n  }, [typeSchema, props.path, parentElementsContext]);\n\n  if (!typeSchema) {\n    return <div>{type}&nbsp;not implemented</div>;\n  }\n\n  return maybeWrapWithContext(\n    ElementsContext.Provider,\n    contextValue,\n    <ElementsInput\n      path={props.path}\n      type={type}\n      defaultValue={defaultValue}\n      onChange={props.onChange}\n      outcome={props.outcome}\n    />\n  );\n}\n", "import { Stack } from '@mantine/core';\nimport { InternalSchemaElement, TypedValue, getPathDisplayName, isPopulated } from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useContext, useMemo, useState } from 'react';\nimport { CheckboxFormSection } from '../CheckboxFormSection/CheckboxFormSection';\nimport { FormSection } from '../FormSection/FormSection';\nimport { setPropertyValue } from '../ResourceForm/ResourceForm.utils';\nimport { getValueAndTypeFromElement } from '../ResourcePropertyDisplay/ResourcePropertyDisplay.utils';\nimport { ResourcePropertyInput } from '../ResourcePropertyInput/ResourcePropertyInput';\nimport { DEFAULT_IGNORED_NON_NESTED_PROPERTIES, DEFAULT_IGNORED_PROPERTIES } from '../constants';\nimport { ElementsContext } from './ElementsInput.utils';\n\nconst EXTENSION_KEYS = ['extension', 'modifierExtension'];\nconst IGNORED_PROPERTIES = ['id', ...DEFAULT_IGNORED_PROPERTIES].filter((prop) => !EXTENSION_KEYS.includes(prop));\n\nexport interface ElementsInputProps {\n  readonly type: string;\n  /** The path identifies the element and is expressed as a \".\"-separated list of ancestor elements, beginning with the name of the resource or extension. */\n  readonly path: string;\n  readonly defaultValue: any;\n  readonly outcome: OperationOutcome | undefined;\n  readonly onChange: ((value: any) => void) | undefined;\n  readonly testId?: string;\n}\n\nexport function ElementsInput(props: ElementsInputProps): JSX.Element {\n  const [value, setValue] = useState<any>(props.defaultValue ?? {});\n  const elementsContext = useContext(ElementsContext);\n  const elementsToRender = useMemo(() => {\n    return getElementsToRender(elementsContext.elements);\n  }, [elementsContext.elements]);\n\n  function setValueWrapper(newValue: any): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  const typedValue: TypedValue = { type: props.type, value };\n\n  return (\n    <Stack style={{ flexGrow: 1 }} data-testid={props.testId}>\n      {elementsToRender.map(([key, element]) => {\n        const [propertyValue, propertyType] = getValueAndTypeFromElement(typedValue, key, element);\n        const required = element.min !== undefined && element.min > 0;\n        const resourcePropertyInput = (\n          <ResourcePropertyInput\n            key={key}\n            property={element}\n            name={key}\n            path={props.path + '.' + key}\n            defaultValue={propertyValue}\n            defaultPropertyType={propertyType}\n            onChange={(newValue: any, propName?: string) => {\n              setValueWrapper(setPropertyValue({ ...value }, key, propName ?? key, element, newValue));\n            }}\n            arrayElement={undefined}\n            outcome={props.outcome}\n          />\n        );\n\n        // no FormSection wrapper for extensions\n        if (props.type === 'Extension' || EXTENSION_KEYS.includes(key)) {\n          return resourcePropertyInput;\n        }\n\n        if (element.type.length === 1 && element.type[0].code === 'boolean') {\n          return (\n            <CheckboxFormSection\n              key={key}\n              title={getPathDisplayName(key)}\n              description={element.description}\n              htmlFor={key}\n              fhirPath={element.path}\n              withAsterisk={required}\n            >\n              {resourcePropertyInput}\n            </CheckboxFormSection>\n          );\n        }\n\n        return (\n          <FormSection\n            key={key}\n            title={getPathDisplayName(key)}\n            description={element.description}\n            withAsterisk={required}\n            htmlFor={key}\n            outcome={props.outcome}\n            fhirPath={element.path}\n          >\n            {resourcePropertyInput}\n          </FormSection>\n        );\n      })}\n    </Stack>\n  );\n}\n\nfunction getElementsToRender(inputElements: Record<string, InternalSchemaElement>): [string, InternalSchemaElement][] {\n  const result = Object.entries(inputElements).filter(([key, element]) => {\n    if (!isPopulated(element.type)) {\n      return false;\n    }\n\n    if (element.max === 0) {\n      return false;\n    }\n\n    // toLowerCase to handle Extension.url as well as Extension.extension.url, etc.\n    if (element.path.toLowerCase().endsWith('extension.url') && element.fixed) {\n      return false;\n    }\n\n    if (EXTENSION_KEYS.includes(key) && !isPopulated(element.slicing?.slices)) {\n      // an extension property without slices has no nested extensions\n      return false;\n    } else if (IGNORED_PROPERTIES.includes(key)) {\n      return false;\n    } else if (DEFAULT_IGNORED_NON_NESTED_PROPERTIES.includes(key) && element.path.split('.').length === 2) {\n      return false;\n    }\n\n    // Profiles can include nested elements in addition to their containing element, e.g.:\n    // identifier, identifier.use, identifier.system\n    // Skip nested elements, e.g. identifier.use, since they are handled by the containing element\n    if (key.includes('.')) {\n      return false;\n    }\n\n    return true;\n  });\n\n  return result;\n}\n", "import { Group, Input } from '@mantine/core';\nimport { ReactNode, useContext } from 'react';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\n\nexport interface CheckboxFormSectionProps {\n  readonly htmlFor?: string;\n  readonly title?: string;\n  readonly description?: string;\n  readonly withAsterisk?: boolean;\n  readonly children?: ReactNode;\n  readonly testId?: string;\n  readonly fhirPath?: string;\n}\n\nexport function CheckboxFormSection(props: CheckboxFormSectionProps): JSX.Element {\n  const { debugMode } = useContext(ElementsContext);\n\n  let label: React.ReactNode;\n  if (debugMode && props.fhirPath) {\n    label = `${props.title} - ${props.fhirPath}`;\n  } else {\n    label = props.title;\n  }\n  return (\n    <Group wrap=\"nowrap\" data-testid={props.testId}>\n      <div>{props.children}</div>\n      <div>\n        <Input.Wrapper\n          id={props.htmlFor}\n          label={label}\n          description={props.description}\n          withAsterisk={props.withAsterisk}\n        >\n          {(() => null)()}\n        </Input.Wrapper>\n      </div>\n    </Group>\n  );\n}\n", "import { Input } from '@mantine/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { ReactNode, useContext } from 'react';\nimport { getErrorsForInput } from '../utils/outcomes';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\n\nexport interface FormSectionProps {\n  readonly title?: string;\n  readonly htmlFor?: string;\n  readonly description?: string;\n  readonly withAsterisk?: boolean;\n  readonly outcome?: OperationOutcome;\n  readonly children?: ReactNode;\n  readonly testId?: string;\n  readonly fhirPath?: string;\n}\n\nexport function FormSection(props: FormSectionProps): JSX.Element {\n  const { debugMode } = useContext(ElementsContext);\n\n  let label: React.ReactNode;\n  if (debugMode && props.fhirPath) {\n    label = `${props.title} - ${props.fhirPath}`;\n  } else {\n    label = props.title;\n  }\n  return (\n    <Input.Wrapper\n      id={props.htmlFor}\n      label={label}\n      description={props.description}\n      withAsterisk={props.withAsterisk}\n      error={getErrorsForInput(props.outcome, props.htmlFor)}\n      data-testid={props.testId}\n    >\n      {props.children}\n    </Input.Wrapper>\n  );\n}\n", "import { OperationOutcome, OperationOutcomeIssue } from '@medplum/fhirtypes';\n\nexport function getErrorsForInput(\n  outcome: OperationOutcome | undefined,\n  expression: string | undefined\n): string | undefined {\n  return outcome?.issue\n    ?.filter((issue) => isExpressionMatch(issue.expression?.[0], expression))\n    ?.map((issue) => issue.details?.text)\n    ?.join('\\n');\n}\n\nexport function getIssuesForExpression(\n  outcome: OperationOutcome | undefined,\n  expression: string | undefined\n): OperationOutcomeIssue[] | undefined {\n  return outcome?.issue?.filter((issue) => isExpressionMatch(issue.expression?.[0], expression));\n}\n\nfunction isExpressionMatch(expr1: string | undefined, expr2: string | undefined): boolean {\n  // Expression can be either \"fieldName\" or \"resourceType.fieldName\"\n  if (expr1 === expr2) {\n    return true;\n  }\n  if (!expr1 || !expr2) {\n    return false;\n  }\n  const dot1 = expr1.indexOf('.');\n  if (dot1 >= 0 && expr1.substring(dot1 + 1) === expr2) {\n    return true;\n  }\n  const dot2 = expr2.indexOf('.');\n  if (dot2 >= 0 && expr2.substring(dot2 + 1) === expr1) {\n    return true;\n  }\n  return false;\n}\n", "import { capitalize, InternalSchemaElement, isEmpty } from '@medplum/core';\nimport { StructureDefinition } from '@medplum/fhirtypes';\n\nexport function setPropertyValue(\n  obj: any,\n  key: string,\n  propName: string,\n  elementDefinition: InternalSchemaElement,\n  value: any\n): any {\n  const types = elementDefinition.type;\n  if (types.length > 1) {\n    for (const type of types) {\n      const compoundKey = key.replace('[x]', capitalize(type.code as string));\n      if (compoundKey in obj) {\n        delete obj[compoundKey];\n      }\n    }\n  }\n  obj[propName] = value;\n  return obj;\n}\n\nexport type SupportedProfileStructureDefinition = StructureDefinition & {\n  url: NonNullable<StructureDefinition['url']>;\n  name: NonNullable<StructureDefinition['name']>;\n};\n\nexport function isSupportedProfileStructureDefinition(\n  profile?: StructureDefinition\n): profile is SupportedProfileStructureDefinition {\n  return !!profile && !isEmpty(profile.url) && !isEmpty(profile.name);\n}\n", "import { Checkbox, Group, NativeSelect, Textarea, TextInput } from '@mantine/core';\nimport {\n  applyDefaultValuesToElement,\n  capitalize,\n  getPathDifference,\n  HTTP_HL7_ORG,\n  InternalSchemaElement,\n  isComplexTypeCode,\n  isEmpty,\n  isPopulated,\n  PropertyType,\n} from '@medplum/core';\nimport { ElementDefinitionBinding, ElementDefinitionType, OperationOutcome } from '@medplum/fhirtypes';\nimport { useContext, useMemo, useState } from 'react';\nimport { AddressInput } from '../AddressInput/AddressInput';\nimport { AnnotationInput } from '../AnnotationInput/AnnotationInput';\nimport { AttachmentArrayInput } from '../AttachmentArrayInput/AttachmentArrayInput';\nimport { AttachmentInput } from '../AttachmentInput/AttachmentInput';\nimport { BackboneElementInput } from '../BackboneElementInput/BackboneElementInput';\nimport { CodeableConceptInput } from '../CodeableConceptInput/CodeableConceptInput';\nimport { CodeInput } from '../CodeInput/CodeInput';\nimport { CodingInput } from '../CodingInput/CodingInput';\nimport { ContactDetailInput } from '../ContactDetailInput/ContactDetailInput';\nimport { ContactPointInput } from '../ContactPointInput/ContactPointInput';\nimport { DateTimeInput } from '../DateTimeInput/DateTimeInput';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { ExtensionInput } from '../ExtensionInput/ExtensionInput';\nimport { HumanNameInput } from '../HumanNameInput/HumanNameInput';\nimport { IdentifierInput } from '../IdentifierInput/IdentifierInput';\nimport { MoneyInput } from '../MoneyInput/MoneyInput';\nimport { PeriodInput } from '../PeriodInput/PeriodInput';\nimport { QuantityInput } from '../QuantityInput/QuantityInput';\nimport { RangeInput } from '../RangeInput/RangeInput';\nimport { RatioInput } from '../RatioInput/RatioInput';\nimport { ReferenceInput } from '../ReferenceInput/ReferenceInput';\nimport { ResourceArrayInput } from '../ResourceArrayInput/ResourceArrayInput';\nimport { SensitiveTextarea } from '../SensitiveTextarea/SensitiveTextarea';\nimport { TimingInput } from '../TimingInput/TimingInput';\nimport { getErrorsForInput } from '../utils/outcomes';\nimport { ComplexTypeInputProps } from './ResourcePropertyInput.utils';\n\nexport interface ResourcePropertyInputProps {\n  readonly property: InternalSchemaElement;\n  readonly name: string;\n  /** The path identifies the element and is expressed as a \".\"-separated list of ancestor elements, beginning with the name of the resource or extension. */\n  readonly path: string;\n  readonly defaultPropertyType?: string | undefined;\n  readonly defaultValue: any;\n  readonly arrayElement?: boolean | undefined;\n  readonly onChange: ((value: any, propName?: string) => void) | undefined;\n  readonly outcome: OperationOutcome | undefined;\n}\n\nexport function ResourcePropertyInput(props: ResourcePropertyInputProps): JSX.Element {\n  const { property, name, onChange, defaultValue } = props;\n  const defaultPropertyType =\n    props.defaultPropertyType && props.defaultPropertyType !== 'undefined'\n      ? props.defaultPropertyType\n      : property.type[0].code;\n  const propertyTypes = property.type as ElementDefinitionType[];\n\n  if ((property.isArray || property.max > 1) && !props.arrayElement) {\n    if (defaultPropertyType === PropertyType.Attachment) {\n      return <AttachmentArrayInput name={name} defaultValue={defaultValue} onChange={onChange} />;\n    }\n\n    // Extensions are a special type of array that shouldn't be indented\n    const indent = propertyTypes[0]?.code !== PropertyType.Extension;\n    return (\n      <ResourceArrayInput\n        property={property}\n        name={name}\n        path={props.path}\n        defaultValue={defaultValue}\n        indent={indent}\n        onChange={onChange}\n        outcome={props.outcome}\n      />\n    );\n  } else if (propertyTypes.length > 1) {\n    return <ElementDefinitionInputSelector elementDefinitionTypes={propertyTypes} {...props} />;\n  } else {\n    return (\n      <ElementDefinitionTypeInput\n        name={name}\n        defaultValue={defaultValue}\n        onChange={(newValue: any) => {\n          if (props.onChange) {\n            const newPropName = props.name.replace('[x]', capitalize(propertyTypes[0].code as string));\n            props.onChange(newValue, newPropName);\n          }\n        }}\n        outcome={props.outcome}\n        elementDefinitionType={propertyTypes[0]}\n        min={property.min}\n        max={property.min}\n        binding={property.binding}\n        path={props.path}\n      />\n    );\n  }\n}\n\nexport interface ElementDefinitionSelectorProps extends ResourcePropertyInputProps {\n  readonly elementDefinitionTypes: ElementDefinitionType[];\n}\n\nexport function ElementDefinitionInputSelector(props: ElementDefinitionSelectorProps): JSX.Element {\n  const propertyTypes = props.elementDefinitionTypes;\n  let initialPropertyType: ElementDefinitionType | undefined = undefined;\n  if (props.defaultPropertyType) {\n    initialPropertyType = propertyTypes.find((t) => t.code === props.defaultPropertyType) as ElementDefinitionType;\n  }\n  if (!initialPropertyType) {\n    initialPropertyType = propertyTypes[0];\n  }\n  const [selectedType, setSelectedType] = useState(initialPropertyType);\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\" align=\"flex-start\">\n      <NativeSelect\n        style={{ width: '200px' }}\n        defaultValue={selectedType.code}\n        data-testid={props.name && props.name + '-selector'}\n        onChange={(e) => {\n          setSelectedType(\n            propertyTypes.find(\n              (type: ElementDefinitionType) => type.code === e.currentTarget.value\n            ) as ElementDefinitionType\n          );\n        }}\n        data={propertyTypes.map((type: ElementDefinitionType) => ({\n          value: type.code as string,\n          label: type.code as string,\n        }))}\n      />\n      <ElementDefinitionTypeInput\n        name={props.name}\n        defaultValue={props.defaultValue}\n        outcome={props.outcome}\n        elementDefinitionType={selectedType}\n        onChange={(newValue: any) => {\n          if (props.onChange) {\n            props.onChange(newValue, props.name.replace('[x]', capitalize(selectedType.code as string)));\n          }\n        }}\n        min={props.property.min}\n        max={props.property.max}\n        binding={props.property.binding}\n        path={props.property.path}\n      />\n    </Group>\n  );\n}\n\n// Avoiding optional props on lower-level components like to make it more difficult to misuse\nexport interface ElementDefinitionTypeInputProps\n  extends Pick<ResourcePropertyInputProps, 'name' | 'path' | 'defaultValue' | 'onChange' | 'outcome'> {\n  readonly elementDefinitionType: ElementDefinitionType;\n  readonly min: number;\n  readonly max: number;\n  readonly binding: ElementDefinitionBinding | undefined;\n}\n\nexport function ElementDefinitionTypeInput(props: ElementDefinitionTypeInputProps): JSX.Element {\n  const { name, onChange, outcome, binding, path } = props;\n  const required = props.min !== undefined && props.min > 0;\n\n  const propertyType = props.elementDefinitionType.code;\n\n  const elementsContext = useContext(ElementsContext);\n  const defaultValue = useMemo(() => {\n    if (!isComplexTypeCode(propertyType)) {\n      return props.defaultValue;\n    }\n\n    if (!isEmpty(props.defaultValue)) {\n      return props.defaultValue;\n    }\n\n    const withDefaults = Object.create(null);\n    if (elementsContext.path === props.path) {\n      applyDefaultValuesToElement(withDefaults, elementsContext.elements);\n    } else {\n      const key = getPathDifference(elementsContext.path, props.path);\n      if (key === undefined) {\n        return props.defaultValue;\n      }\n      applyDefaultValuesToElement(withDefaults, elementsContext.elements, key);\n    }\n\n    if (isPopulated(withDefaults)) {\n      return withDefaults;\n    }\n\n    return props.defaultValue;\n  }, [propertyType, elementsContext.path, elementsContext.elements, props.path, props.defaultValue]);\n\n  if (!propertyType) {\n    return <div>Property type not specified </div>;\n  }\n\n  const properties: ComplexTypeInputProps<any> = { name, defaultValue, onChange, outcome, path };\n\n  switch (propertyType) {\n    // 2.24.0.1 Primitive Types\n    // https://www.hl7.org/fhir/datatypes.html#primitive\n\n    case PropertyType.SystemString:\n    case PropertyType.canonical:\n    case PropertyType.string:\n    case PropertyType.time:\n    case PropertyType.uri:\n    case PropertyType.url:\n      if (props.path === 'Project.secret.value[x]') {\n        return (\n          <SensitiveTextarea\n            id={name}\n            name={name}\n            data-testid={name}\n            defaultValue={defaultValue}\n            required={required}\n            onChange={(e) => {\n              if (props.onChange) {\n                props.onChange(e.currentTarget.value);\n              }\n            }}\n            error={getErrorsForInput(props.outcome, name)}\n          />\n        );\n      }\n\n      return (\n        <TextInput\n          id={name}\n          name={name}\n          data-testid={name}\n          defaultValue={defaultValue}\n          required={required}\n          onChange={(e) => {\n            if (onChange) {\n              onChange(e.currentTarget.value);\n            }\n          }}\n          error={getErrorsForInput(outcome, name)}\n        />\n      );\n    case PropertyType.date:\n      return (\n        <TextInput\n          type=\"date\"\n          id={name}\n          name={name}\n          data-testid={name}\n          defaultValue={defaultValue}\n          required={required}\n          onChange={(e) => {\n            if (onChange) {\n              onChange(e.currentTarget.value);\n            }\n          }}\n          error={getErrorsForInput(outcome, name)}\n        />\n      );\n    case PropertyType.dateTime:\n    case PropertyType.instant:\n      return <DateTimeInput name={name} defaultValue={defaultValue} onChange={onChange} outcome={outcome} />;\n    case PropertyType.decimal:\n    case PropertyType.integer:\n    case PropertyType.positiveInt:\n    case PropertyType.unsignedInt:\n      return (\n        <TextInput\n          type=\"number\"\n          step={propertyType === PropertyType.decimal ? 'any' : '1'}\n          id={name}\n          name={name}\n          data-testid={name}\n          defaultValue={defaultValue}\n          required={required}\n          onChange={(e) => {\n            if (onChange) {\n              onChange(e.currentTarget.valueAsNumber);\n            }\n          }}\n        />\n      );\n    case PropertyType.code:\n      return <CodeInput {...properties} binding={binding?.valueSet} />;\n    case PropertyType.boolean:\n      return (\n        <Checkbox\n          id={name}\n          name={name}\n          data-testid={name}\n          defaultChecked={!!defaultValue}\n          onChange={(e) => {\n            if (onChange) {\n              onChange(e.currentTarget.checked);\n            }\n          }}\n        />\n      );\n    case PropertyType.base64Binary:\n    case PropertyType.markdown:\n      return (\n        <Textarea\n          id={name}\n          spellCheck={propertyType !== PropertyType.base64Binary}\n          name={name}\n          data-testid={name}\n          defaultValue={defaultValue}\n          required={required}\n          onChange={(e) => {\n            if (onChange) {\n              onChange(e.currentTarget.value);\n            }\n          }}\n        />\n      );\n\n    // 2.24.0.2 Complex Types\n    // https://www.hl7.org/fhir/datatypes.html#complex\n\n    case PropertyType.Address:\n      return <AddressInput {...properties} />;\n    case PropertyType.Annotation:\n      return <AnnotationInput {...properties} />;\n    case PropertyType.Attachment:\n      return <AttachmentInput {...properties} />;\n    case PropertyType.CodeableConcept:\n      return <CodeableConceptInput binding={binding?.valueSet} {...properties} />;\n    case PropertyType.Coding:\n      return <CodingInput binding={binding?.valueSet} {...properties} />;\n    case PropertyType.ContactDetail:\n      return <ContactDetailInput {...properties} />;\n    case PropertyType.ContactPoint:\n      return <ContactPointInput {...properties} />;\n    case PropertyType.Extension:\n      return <ExtensionInput {...properties} propertyType={props.elementDefinitionType} />;\n    case PropertyType.HumanName:\n      return <HumanNameInput {...properties} />;\n    case PropertyType.Identifier:\n      return <IdentifierInput {...properties} />;\n    case PropertyType.Money:\n      return <MoneyInput {...properties} />;\n    case PropertyType.Period:\n      return <PeriodInput {...properties} />;\n    case PropertyType.Duration:\n    case PropertyType.Quantity:\n      return <QuantityInput {...properties} />;\n    case PropertyType.Range:\n      return <RangeInput {...properties} />;\n    case PropertyType.Ratio:\n      return <RatioInput {...properties} />;\n    case PropertyType.Reference:\n      return <ReferenceInput {...properties} targetTypes={getTargetTypes(props.elementDefinitionType)} />;\n    case PropertyType.Timing:\n      return <TimingInput {...properties} />;\n    case PropertyType.Dosage:\n    case PropertyType.UsageContext:\n    default:\n      return (\n        <BackboneElementInput\n          typeName={propertyType}\n          path={properties.path}\n          defaultValue={defaultValue}\n          onChange={onChange}\n          outcome={outcome}\n        />\n      );\n  }\n}\n\nconst RESOURCE_TYPE_URL_PREFIXES = [\n  `${HTTP_HL7_ORG}/fhir/StructureDefinition/`,\n  'https://medplum.com/fhir/StructureDefinition/',\n];\nfunction getTargetTypes(elementDefinitionType?: ElementDefinitionType): string[] | undefined {\n  return elementDefinitionType?.targetProfile?.map((p) => {\n    const resourceTypePrefix = RESOURCE_TYPE_URL_PREFIXES.find((prefix) => p.startsWith(prefix));\n    if (resourceTypePrefix) {\n      return p.slice(resourceTypePrefix.length);\n    } else {\n      return p;\n    }\n  });\n}\n", "import { CodeableConcept, ValueSetExpansionContains } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { ComplexTypeInputProps } from '../ResourcePropertyInput/ResourcePropertyInput.utils';\nimport { ValueSetAutocomplete, ValueSetAutocompleteProps } from '../ValueSetAutocomplete/ValueSetAutocomplete';\n\nexport interface CodeableConceptInputProps\n  extends Omit<ValueSetAutocompleteProps, 'name' | 'defaultValue' | 'onChange'>,\n    ComplexTypeInputProps<CodeableConcept> {\n  readonly onChange: ((value: CodeableConcept | undefined) => void) | undefined;\n}\n\nexport function CodeableConceptInput(props: CodeableConceptInputProps): JSX.Element {\n  const { defaultValue, onChange, withHelpText, ...rest } = props;\n  const [value, setValue] = useState<CodeableConcept | undefined>(defaultValue);\n\n  function handleChange(newValues: ValueSetExpansionContains[]): void {\n    const newConcept = valueSetElementToCodeableConcept(newValues);\n    setValue(newConcept);\n    if (onChange) {\n      onChange(newConcept);\n    }\n  }\n\n  return (\n    <ValueSetAutocomplete\n      defaultValue={value && codeableConceptToValueSetElement(value)}\n      onChange={handleChange}\n      withHelpText={withHelpText ?? true}\n      {...rest}\n    />\n  );\n}\n\nfunction codeableConceptToValueSetElement(concept: CodeableConcept): ValueSetExpansionContains[] | undefined {\n  return concept.coding?.map((c) => ({\n    system: c.system,\n    code: c.code,\n    display: c.display,\n  }));\n}\n\nfunction valueSetElementToCodeableConcept(elements: ValueSetExpansionContains[]): CodeableConcept | undefined {\n  if (elements.length === 0) {\n    return undefined;\n  }\n  return {\n    coding: elements.map((e) => ({\n      system: e.system,\n      code: e.code,\n      display: e.display,\n    })),\n  };\n}\n", "import { Coding, ValueSetExpansionContains } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { ValueSetAutocomplete, ValueSetAutocompleteProps } from '../ValueSetAutocomplete/ValueSetAutocomplete';\n\nexport interface CodingInputProps extends Omit<ValueSetAutocompleteProps, 'defaultValue' | 'onChange'> {\n  readonly defaultValue?: Coding;\n  readonly onChange?: (value: Coding | undefined) => void;\n}\n\nexport function CodingInput(props: CodingInputProps): JSX.Element {\n  const { defaultValue, onChange, withHelpText, ...rest } = props;\n  const [value, setValue] = useState<Coding | undefined>(defaultValue);\n\n  function handleChange(newValues: ValueSetExpansionContains[]): void {\n    const newValue = newValues[0];\n    const newConcept = newValue && valueSetElementToCoding(newValue);\n    setValue(newConcept);\n    if (onChange) {\n      onChange(newConcept);\n    }\n  }\n\n  return (\n    <ValueSetAutocomplete\n      defaultValue={value && codingToValueSetElement(value)}\n      maxValues={1}\n      onChange={handleChange}\n      withHelpText={withHelpText ?? true}\n      {...rest}\n    />\n  );\n}\n\nfunction codingToValueSetElement(coding: Coding): ValueSetExpansionContains {\n  return {\n    system: coding.system,\n    code: coding.code,\n    display: coding.display,\n  };\n}\n\nfunction valueSetElementToCoding(element: ValueSetExpansionContains): Coding {\n  return {\n    system: element.system,\n    code: element.code,\n    display: element.display,\n  };\n}\n", "import { Group, TextInput } from '@mantine/core';\nimport { ContactDetail, ContactPoint } from '@medplum/fhirtypes';\nimport { useRef, useState } from 'react';\nimport { ContactPointInput } from '../ContactPointInput/ContactPointInput';\nimport { ComplexTypeInputProps } from '../ResourcePropertyInput/ResourcePropertyInput.utils';\n\nexport type ContactDetailInputProps = ComplexTypeInputProps<ContactDetail>;\n\nexport function ContactDetailInput(props: ContactDetailInputProps): JSX.Element {\n  const [contactPoint, setContactDetail] = useState(props.defaultValue);\n\n  const ref = useRef<ContactDetail>();\n  ref.current = contactPoint;\n\n  function setContactDetailWrapper(newValue: ContactDetail): void {\n    setContactDetail(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  function setName(name: string): void {\n    const newValue: ContactDetail = { ...ref.current, name };\n    if (!name) {\n      delete newValue.name;\n    }\n    setContactDetailWrapper(newValue);\n  }\n\n  function setTelecom(telecom: ContactPoint | undefined): void {\n    const newValue: ContactDetail = { ...ref.current, telecom: telecom && [telecom] };\n    if (!telecom) {\n      delete newValue.telecom;\n    }\n    setContactDetailWrapper(newValue);\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\">\n      <TextInput\n        data-testid={props.name + '-name'}\n        name={props.name + '-name'}\n        placeholder=\"Name\"\n        style={{ width: 180 }}\n        defaultValue={contactPoint?.name}\n        onChange={(e) => setName(e.currentTarget.value)}\n      />\n      <ContactPointInput\n        name={props.name + '-telecom'}\n        path={props.path + '.telecom'}\n        defaultValue={contactPoint?.telecom?.[0]}\n        onChange={setTelecom}\n        outcome={props.outcome}\n      />\n    </Group>\n  );\n}\n", "import { Group, NativeSelect, TextInput } from '@mantine/core';\nimport { ContactPoint } from '@medplum/fhirtypes';\nimport { useContext, useMemo, useRef, useState } from 'react';\nimport { ComplexTypeInputProps } from '../ResourcePropertyInput/ResourcePropertyInput.utils';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { getErrorsForInput } from '../utils/outcomes';\n\nexport type ContactPointInputProps = ComplexTypeInputProps<ContactPoint> & {\n  readonly onChange: ((value: ContactPoint | undefined) => void) | undefined;\n};\n\nexport function ContactPointInput(props: ContactPointInputProps): JSX.Element {\n  const { path, outcome } = props;\n  const { elementsByPath } = useContext(ElementsContext);\n  const [contactPoint, setContactPoint] = useState(props.defaultValue);\n\n  const ref = useRef<ContactPoint>();\n  ref.current = contactPoint;\n\n  const [systemElement, useElement, valueElement] = useMemo(\n    () => ['system', 'use', 'value'].map((field) => elementsByPath[path + '.' + field]),\n    [elementsByPath, path]\n  );\n\n  function setContactPointWrapper(newValue: ContactPoint | undefined): void {\n    if (newValue && Object.keys(newValue).length === 0) {\n      newValue = undefined;\n    }\n    setContactPoint(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  function setSystem(system: 'url' | 'phone' | 'fax' | 'email' | 'pager' | 'sms' | 'other'): void {\n    const newValue: ContactPoint = { ...ref.current, system };\n    if (!system) {\n      delete newValue.system;\n    }\n    setContactPointWrapper(newValue);\n  }\n\n  function setUse(use: 'home' | 'work' | 'temp' | 'old' | 'mobile'): void {\n    const newValue: ContactPoint = { ...ref.current, use };\n    if (!use) {\n      delete newValue.use;\n    }\n    setContactPointWrapper(newValue);\n  }\n\n  function setValue(value: string): void {\n    const newValue: ContactPoint = { ...ref.current, value };\n    if (!value) {\n      delete newValue.value;\n    }\n    setContactPointWrapper(newValue);\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\" align=\"flex-start\">\n      <NativeSelect\n        data-testid=\"system\"\n        defaultValue={contactPoint?.system}\n        required={(systemElement?.min ?? 0) > 0}\n        onChange={(e) =>\n          setSystem(e.currentTarget.value as 'url' | 'phone' | 'fax' | 'email' | 'pager' | 'sms' | 'other')\n        }\n        data={['', 'email', 'phone', 'fax', 'pager', 'sms', 'other']}\n        error={getErrorsForInput(outcome, path + '.system')}\n      />\n      <NativeSelect\n        data-testid=\"use\"\n        defaultValue={contactPoint?.use}\n        required={(useElement?.min ?? 0) > 0}\n        onChange={(e) => setUse(e.currentTarget.value as 'home' | 'work' | 'temp' | 'old' | 'mobile')}\n        data={['', 'home', 'work', 'temp', 'old', 'mobile']}\n        error={getErrorsForInput(outcome, path + '.use')}\n      />\n      <TextInput\n        placeholder=\"Value\"\n        defaultValue={contactPoint?.value}\n        required={(valueElement?.min ?? 0) > 0}\n        onChange={(e) => setValue(e.currentTarget.value)}\n        error={getErrorsForInput(outcome, path + '.value')}\n      />\n    </Group>\n  );\n}\n", "import { TextInput } from '@mantine/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { ChangeEvent } from 'react';\nimport { getErrorsForInput } from '../utils/outcomes';\nimport { convertIsoToLocal, convertLocalToIso } from './DateTimeInput.utils';\n\nexport interface DateTimeInputProps {\n  readonly name?: string;\n  readonly placeholder?: string;\n  readonly defaultValue?: string;\n  readonly autoFocus?: boolean;\n  readonly required?: boolean;\n  readonly outcome?: OperationOutcome;\n  readonly onChange?: (value: string) => void;\n}\n\n/**\n * The DateTimeInput component is a wrapper around the HTML5 input type=\"datetime-local\".\n * The main purpose is to reconcile time zones.\n * Most of our date/time values are in ISO-8601, which includes a time zone offset.\n * The datetime-local input does not support the time zone offset.\n * @param props - The Input props.\n * @returns The JSX element to render.\n */\nexport function DateTimeInput(props: DateTimeInputProps): JSX.Element {\n  return (\n    <TextInput\n      id={props.name}\n      name={props.name}\n      data-autofocus={props.autoFocus}\n      data-testid={props.name}\n      placeholder={props.placeholder}\n      required={props.required}\n      type={getInputType()}\n      defaultValue={convertIsoToLocal(props.defaultValue)}\n      autoFocus={props.autoFocus}\n      error={getErrorsForInput(props.outcome, props.name)}\n      onChange={(e: ChangeEvent<HTMLInputElement>) => {\n        if (props.onChange) {\n          const newValue = e.currentTarget.value;\n          props.onChange(convertLocalToIso(newValue));\n        }\n      }}\n    />\n  );\n}\n\n/**\n * Returns the input type for the requested type.\n * JSDOM does not support many of the valid <input> type attributes.\n * For example, it won't fire change events for <input type=\"datetime-local\">.\n * @returns The input type for the current environment.\n */\nfunction getInputType(): string {\n  return import.meta.env.NODE_ENV === 'test' ? 'text' : 'datetime-local';\n}\n", "import { isValidDate } from '@medplum/core';\n\n/**\n * Converts an ISO-8601 date/time string to a local date/time string.\n * @param isoString - The ISO-8601 date/time string to convert.\n * @returns The local date/time string.\n */\nexport function convertIsoToLocal(isoString: string | undefined): string {\n  if (!isoString) {\n    return '';\n  }\n\n  // Convert the ISO-8601 date to a local datetime-local value.\n  // See: https://developer.mozilla.org/en-US/docs/Web/HTML/Date_and_time_formats#local_date_and_time_strings\n  // See: https://stackoverflow.com/a/60368477\n  const date = new Date(isoString);\n  if (!isValidDate(date)) {\n    // If the input string was malformed, return an empty string.\n    return '';\n  }\n\n  return date.toLocaleDateString('sv') + 'T' + date.toLocaleTimeString('sv');\n}\n\n/**\n * Converts a local date/time string to an ISO-8601 date/time string.\n * @param localString - The local date/time string to convert.\n * @returns The ISO-8601 date/time string.\n */\nexport function convertLocalToIso(localString: string | undefined): string {\n  if (!localString) {\n    return '';\n  }\n\n  // Try to parse the local string as a Date\n  // JavaScript's Date() constructor defaults to the local time zone.\n  // The Date() constructor will throw if the value is malformed.\n  const date = new Date(localString);\n  if (!isValidDate(date)) {\n    // If the input string was malformed, return an empty string.\n    return '';\n  }\n\n  return date.toISOString();\n}\n", "import { InternalTypeSchema, tryGetProfile, isProfileLoaded, isPopulated } from '@medplum/core';\nimport { ElementDefinitionType, Extension } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useEffect, useMemo, useState } from 'react';\nimport { BackboneElementInput } from '../BackboneElementInput/BackboneElementInput';\nimport { ComplexTypeInputProps } from '../ResourcePropertyInput/ResourcePropertyInput.utils';\n\nexport type ExtensionInputProps = ComplexTypeInputProps<Extension> & {\n  readonly propertyType: ElementDefinitionType;\n};\n\nexport function ExtensionInput(props: ExtensionInputProps): JSX.Element | null {\n  const { propertyType } = props;\n\n  const medplum = useMedplum();\n  const [typeSchema, setTypeSchema] = useState<InternalTypeSchema | undefined>();\n  const profileUrl: string | undefined = useMemo(() => {\n    if (!isPopulated(propertyType.profile)) {\n      return undefined;\n    }\n\n    return propertyType.profile[0] satisfies string;\n  }, [propertyType]);\n  const [loadingProfile, setLoadingProfile] = useState(profileUrl !== undefined);\n\n  useEffect(() => {\n    if (profileUrl) {\n      setLoadingProfile(true);\n      medplum\n        .requestProfileSchema(profileUrl)\n        .then(() => {\n          const profile = tryGetProfile(profileUrl);\n          setLoadingProfile(false);\n          setTypeSchema(profile);\n        })\n        .catch((reason) => {\n          setLoadingProfile(false);\n          console.warn(reason);\n        });\n    }\n  }, [medplum, profileUrl]);\n\n  if (profileUrl && (loadingProfile || !isProfileLoaded(profileUrl))) {\n    return <div>Loading...</div>;\n  }\n\n  /*\n    From the spec:\n    An extension SHALL have either a value (i.e. a value[x] element) or sub-extensions, but not both.\n    If present, the value[x] element SHALL have content (value attribute or other elements)\n  */\n\n  // const valueElement = typeSchema.elements['value[x]'];\n  // const extensionHasValue = valueElement.max !== 0;\n  // console.debug(typeSchema.name, { extensionHasValue });\n  // It seems like the behavior of ExtensionInput should differ based on extensionHasValue. It likely\n  // isn't strictly necessary to do so given the recursive use of BackboneElementInput\n\n  return (\n    <BackboneElementInput\n      profileUrl={profileUrl}\n      path={props.path}\n      typeName={typeSchema?.name ?? 'Extension'}\n      defaultValue={props.defaultValue}\n      onChange={props.onChange}\n    />\n  );\n}\n", "import { Group, NativeSelect, TextInput } from '@mantine/core';\nimport { HumanName } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { getErrorsForInput } from '../utils/outcomes';\nimport { ComplexTypeInputProps } from '../ResourcePropertyInput/ResourcePropertyInput.utils';\n\nexport type HumanNameInputProps = ComplexTypeInputProps<HumanName>;\n\nexport function HumanNameInput(props: HumanNameInputProps): JSX.Element {\n  const { outcome, path } = props;\n  const [value, setValue] = useState<HumanName | undefined>(props.defaultValue);\n\n  function setValueWrapper(newValue: HumanName): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  function setUse(use: 'temp' | 'old' | 'usual' | 'official' | 'nickname' | 'anonymous' | 'maiden' | undefined): void {\n    // || instead of ?? to handle empty strings\n    setValueWrapper({ ...value, use: use || undefined });\n  }\n\n  function setPrefix(prefix: string): void {\n    setValueWrapper({\n      ...value,\n      prefix: prefix ? prefix.split(' ') : undefined,\n    });\n  }\n\n  function setGiven(given: string): void {\n    setValueWrapper({\n      ...value,\n      given: given ? given.split(' ') : undefined,\n    });\n  }\n\n  function setFamily(family: string): void {\n    setValueWrapper({\n      ...value,\n      // || instead of ?? to handle empty strings\n      family: family || undefined,\n    });\n  }\n\n  function setSuffix(suffix: string): void {\n    setValueWrapper({\n      ...value,\n      suffix: suffix ? suffix.split(' ') : undefined,\n    });\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\">\n      <NativeSelect\n        defaultValue={value?.use}\n        name={props.name + '-use'}\n        data-testid=\"use\"\n        onChange={(e) =>\n          setUse(e.currentTarget.value as 'temp' | 'old' | 'usual' | 'official' | 'nickname' | 'anonymous' | 'maiden')\n        }\n        data={['', 'temp', 'old', 'usual', 'official', 'nickname', 'anonymous', 'maiden']}\n        error={getErrorsForInput(outcome, path + '.use')}\n      />\n      <TextInput\n        placeholder=\"Prefix\"\n        name={props.name + '-prefix'}\n        defaultValue={value?.prefix?.join(' ')}\n        onChange={(e) => setPrefix(e.currentTarget.value)}\n        error={getErrorsForInput(outcome, path + '.prefix')}\n      />\n      <TextInput\n        placeholder=\"Given\"\n        name={props.name + '-given'}\n        defaultValue={value?.given?.join(' ')}\n        onChange={(e) => setGiven(e.currentTarget.value)}\n        error={getErrorsForInput(outcome, path + '.given')}\n      />\n      <TextInput\n        name={props.name + '-family'}\n        placeholder=\"Family\"\n        defaultValue={value?.family}\n        onChange={(e) => setFamily(e.currentTarget.value)}\n        error={getErrorsForInput(outcome, path + '.family')}\n      />\n      <TextInput\n        placeholder=\"Suffix\"\n        name={props.name + '-suffix'}\n        defaultValue={value?.suffix?.join(' ')}\n        onChange={(e) => setSuffix(e.currentTarget.value)}\n        error={getErrorsForInput(outcome, path + '.suffix')}\n      />\n    </Group>\n  );\n}\n", "import { Group, TextInput } from '@mantine/core';\nimport { Identifier } from '@medplum/fhirtypes';\nimport { useContext, useMemo, useState } from 'react';\nimport { getErrorsForInput } from '../utils/outcomes';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { ComplexTypeInputProps } from '../ResourcePropertyInput/ResourcePropertyInput.utils';\n\nexport type IdentifierInputProps = ComplexTypeInputProps<Identifier>;\n\nexport function IdentifierInput(props: IdentifierInputProps): JSX.Element {\n  const { path, outcome } = props;\n  const [value, setValue] = useState(props.defaultValue);\n  const { elementsByPath } = useContext(ElementsContext);\n\n  const [systemElement, valueElement] = useMemo(\n    () => ['system', 'value'].map((field) => elementsByPath[path + '.' + field]),\n    [elementsByPath, path]\n  );\n\n  function setValueWrapper(newValue: Identifier): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\" align=\"flex-start\">\n      <TextInput\n        placeholder=\"System\"\n        required={(systemElement?.min ?? 0) > 0}\n        defaultValue={value?.system}\n        onChange={(e) => setValueWrapper({ ...value, system: e.currentTarget.value })}\n        error={getErrorsForInput(outcome, path + '.system')}\n      />\n      <TextInput\n        placeholder=\"Value\"\n        required={(valueElement?.min ?? 0) > 0}\n        defaultValue={value?.value}\n        onChange={(e) => setValueWrapper({ ...value, value: e.currentTarget.value })}\n        error={getErrorsForInput(outcome, path + '.value')}\n      />\n    </Group>\n  );\n}\n", "import { NativeSelect, TextInput } from '@mantine/core';\nimport { Money } from '@medplum/fhirtypes';\nimport { IconCurrencyDollar } from '@tabler/icons-react';\nimport { ChangeEvent, useCallback, useState } from 'react';\n\n/*\n * Based on: https://github.com/mantinedev/ui.mantine.dev/blob/master/components/CurrencyInput/CurrencyInput.tsx\n */\n\n/**\n * List of currencies.\n *\n * Full list of currencies:\n * https://www.hl7.org/fhir/valueset-currencies.html\n *\n * Latest browsers can report list of supported currencies, but it's not widely supported:\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/supportedValuesOf\n *\n * Using a short list for simplicity for now.\n */\nconst data = ['USD', 'EUR', 'CAD', 'GBP', 'AUD'];\n\nexport interface MoneyInputProps {\n  readonly name: string;\n  readonly label?: string;\n  readonly placeholder?: string;\n  readonly defaultValue?: Money;\n  readonly onChange?: (value: Money) => void;\n}\n\nexport function MoneyInput(props: MoneyInputProps): JSX.Element {\n  const { onChange } = props;\n  const [value, setValue] = useState(props.defaultValue);\n\n  const setValueWrapper = useCallback(\n    (newValue: Money): void => {\n      setValue(newValue);\n      if (onChange) {\n        onChange(newValue);\n      }\n    },\n    [onChange]\n  );\n\n  const handleCurrencyChange = useCallback(\n    (e: ChangeEvent<HTMLSelectElement>) => {\n      setValueWrapper({\n        ...value,\n        currency: e.currentTarget.value,\n      });\n    },\n    [value, setValueWrapper]\n  );\n\n  const handleValueChange = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      setValueWrapper({\n        ...value,\n        value: e.currentTarget.valueAsNumber,\n      });\n    },\n    [value, setValueWrapper]\n  );\n\n  const select = (\n    <NativeSelect\n      defaultValue={value?.currency}\n      data={data}\n      styles={{\n        input: {\n          fontWeight: 500,\n          borderTopLeftRadius: 0,\n          borderBottomLeftRadius: 0,\n          width: 92,\n        },\n      }}\n      onChange={handleCurrencyChange}\n    />\n  );\n\n  return (\n    <TextInput\n      type=\"number\"\n      name={props.name}\n      label={props.label}\n      placeholder={props.placeholder ?? 'Value'}\n      defaultValue={value?.value?.toString() ?? 'USD'}\n      leftSection={<IconCurrencyDollar size={14} />}\n      rightSection={select}\n      rightSectionWidth={92}\n      onChange={handleValueChange}\n    />\n  );\n}\n", "import { Group } from '@mantine/core';\nimport { Period } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { DateTimeInput } from '../DateTimeInput/DateTimeInput';\n\nexport interface PeriodInputProps {\n  readonly name: string;\n  readonly defaultValue?: Period;\n  readonly onChange?: (value: Period) => void;\n}\n\nexport function PeriodInput(props: PeriodInputProps): JSX.Element {\n  const [value, setValue] = useState(props.defaultValue);\n\n  function setValueWrapper(newValue: Period): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\">\n      <DateTimeInput\n        name={props.name + '.start'}\n        placeholder=\"Start\"\n        defaultValue={value?.start}\n        onChange={(newValue) => setValueWrapper({ ...value, start: newValue })}\n      />\n      <DateTimeInput\n        name={props.name + '.end'}\n        placeholder=\"End\"\n        defaultValue={value?.end}\n        onChange={(newValue) => setValueWrapper({ ...value, end: newValue })}\n      />\n    </Group>\n  );\n}\n", "import { Group, NativeSelect, TextInput } from '@mantine/core';\nimport { Quantity } from '@medplum/fhirtypes';\nimport { useState, WheelEvent } from 'react';\n\nexport interface QuantityInputProps {\n  readonly name: string;\n  readonly defaultValue?: Quantity;\n  readonly autoFocus?: boolean;\n  readonly required?: boolean;\n  readonly onChange?: (value: Quantity) => void;\n  readonly disableWheel?: boolean;\n}\n\nexport function QuantityInput(props: QuantityInputProps): JSX.Element {\n  const [value, setValue] = useState(props.defaultValue);\n\n  function setValueWrapper(newValue: Quantity): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\">\n      <NativeSelect\n        style={{ width: 80 }}\n        data-testid={props.name + '-comparator'}\n        defaultValue={value?.comparator}\n        data={['', '<', '<=', '>=', '>']}\n        onChange={(e) =>\n          setValueWrapper({\n            ...value,\n            comparator: e.currentTarget.value as '<' | '<=' | '>=' | '>',\n          })\n        }\n      />\n      <TextInput\n        id={props.name}\n        name={props.name}\n        required={props.required}\n        data-autofocus={props.autoFocus}\n        data-testid={props.name + '-value'}\n        type=\"number\"\n        placeholder=\"Value\"\n        defaultValue={value?.value}\n        autoFocus={props.autoFocus}\n        step=\"any\"\n        onWheel={(e: WheelEvent<HTMLInputElement>) => {\n          if (props.disableWheel) {\n            e.currentTarget.blur();\n          }\n        }}\n        onChange={(e) => {\n          setValueWrapper({\n            ...value,\n            value: tryParseNumber(e.currentTarget.value),\n          });\n        }}\n      />\n      <TextInput\n        placeholder=\"Unit\"\n        data-testid={props.name + '-unit'}\n        defaultValue={value?.unit}\n        onChange={(e) =>\n          setValueWrapper({\n            ...value,\n            unit: e.currentTarget.value,\n          })\n        }\n      />\n    </Group>\n  );\n}\n\nfunction tryParseNumber(str: string): number | undefined {\n  if (!str) {\n    return undefined;\n  }\n  return parseFloat(str);\n}\n", "import { Group } from '@mantine/core';\nimport { Range } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { QuantityInput } from '../QuantityInput/QuantityInput';\n\nexport interface RangeInputProps {\n  readonly name: string;\n  readonly defaultValue?: Range;\n  readonly onChange?: (value: Range) => void;\n}\n\n/**\n * Renders a Range input.\n * See: https://www.hl7.org/fhir/datatypes.html#Range\n * @param props - Range input properties.\n * @returns Range input element.\n */\nexport function RangeInput(props: RangeInputProps): JSX.Element {\n  const [value, setValue] = useState(props.defaultValue);\n\n  function setValueWrapper(newValue: Range): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\">\n      <QuantityInput\n        name={props.name + '-low'}\n        defaultValue={value?.low}\n        onChange={(v) =>\n          setValueWrapper({\n            ...value,\n            low: v,\n          })\n        }\n      />\n\n      <QuantityInput\n        name={props.name + '-high'}\n        defaultValue={value?.high}\n        onChange={(v) =>\n          setValueWrapper({\n            ...value,\n            high: v,\n          })\n        }\n      />\n    </Group>\n  );\n}\n", "import { Group } from '@mantine/core';\nimport { Ratio } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { QuantityInput } from '../QuantityInput/QuantityInput';\n\nexport interface RatioInputProps {\n  readonly name: string;\n  readonly defaultValue?: Ratio;\n  readonly onChange?: (value: Ratio) => void;\n}\n\n/**\n * Renders a Ratio input.\n * See: https://www.hl7.org/fhir/datatypes.html#Ratio\n * @param props - Ratio input properties.\n * @returns Ratio input element.\n */\nexport function RatioInput(props: RatioInputProps): JSX.Element {\n  const [value, setValue] = useState(props.defaultValue);\n\n  function setValueWrapper(newValue: Ratio): void {\n    setValue(newValue);\n    if (props.onChange) {\n      props.onChange(newValue);\n    }\n  }\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\">\n      <QuantityInput\n        name={props.name + '-numerator'}\n        defaultValue={value?.numerator}\n        onChange={(v) =>\n          setValueWrapper({\n            ...value,\n            numerator: v,\n          })\n        }\n      />\n      <QuantityInput\n        name={props.name + '-denominator'}\n        defaultValue={value?.denominator}\n        onChange={(v) =>\n          setValueWrapper({\n            ...value,\n            denominator: v,\n          })\n        }\n      />\n    </Group>\n  );\n}\n", "import { Group, NativeSelect } from '@mantine/core';\nimport {\n  LRUCache,\n  MedplumClient,\n  ReadablePromise,\n  createReference,\n  isEmpty,\n  isPopulated,\n  tryGetProfile,\n} from '@medplum/core';\nimport { Reference, Resource, ResourceType, StructureDefinition } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { ResourceInput } from '../ResourceInput/ResourceInput';\nimport { ResourceTypeInput } from '../ResourceTypeInput/ResourceTypeInput';\n\nexport interface ReferenceInputProps {\n  readonly name: string;\n  readonly placeholder?: string;\n  readonly defaultValue?: Reference;\n  readonly targetTypes?: string[];\n  readonly searchCriteria?: Record<string, string>;\n  readonly autoFocus?: boolean;\n  readonly required?: boolean;\n  readonly onChange?: (value: Reference | undefined) => void;\n}\n\ninterface BaseTargetType {\n  readonly value: string;\n}\n\ntype ProfileTargetType = BaseTargetType & {\n  readonly type: 'profile';\n  readonly name?: string;\n  readonly title?: string;\n  readonly resourceType?: string;\n  readonly error?: any;\n};\n\ntype ResourceTypeTargetType = BaseTargetType & {\n  readonly type: 'resourceType';\n  readonly resourceType: string;\n};\ntype TargetType = ResourceTypeTargetType | ProfileTargetType;\n\nexport function ReferenceInput(props: ReferenceInputProps): JSX.Element {\n  const { onChange } = props;\n  const medplum = useMedplum();\n  const [value, setValue] = useState<Reference | undefined>(props.defaultValue);\n  const [targetTypes, setTargetTypes] = useState<TargetType[] | undefined>(() => createTargetTypes(props.targetTypes));\n  const [targetType, setTargetType] = useState<TargetType | undefined>(() =>\n    getInitialTargetType(props.defaultValue, targetTypes)\n  );\n\n  const promiseCache = useRef(new LRUCache<ReadablePromise<TargetType>>());\n\n  const searchCriteria = useMemo<ReferenceInputProps['searchCriteria']>(() => {\n    if (targetType?.type === 'profile') {\n      return { ...props.searchCriteria, _profile: targetType.value };\n    }\n    return props.searchCriteria;\n  }, [props.searchCriteria, targetType]);\n\n  useEffect(() => {\n    let anyToFetch = false;\n    const newTargetTypePromises: Promise<TargetType>[] | undefined = targetTypes?.map((tt) => {\n      if (!shouldFetchResourceType(tt)) {\n        return Promise.resolve(tt);\n      }\n\n      anyToFetch = true;\n      const cacheKey = tt.value;\n      const cached = promiseCache.current.get(cacheKey);\n      if (cached) {\n        return cached;\n      }\n\n      const promise = fetchResourceTypeOfProfile(medplum, tt.value)\n        .then((profile) => {\n          const newTargetType = { ...tt };\n\n          if (!profile) {\n            console.error(`StructureDefinition not found for ${tt.value}`);\n            newTargetType.error = 'StructureDefinition not found';\n          } else if (!isPopulated(profile.type)) {\n            console.error(`StructureDefinition.type missing for ${tt.value}`);\n            newTargetType.error = 'StructureDefinition.type missing';\n          } else {\n            newTargetType.resourceType = profile.type;\n            newTargetType.name = profile.name;\n            newTargetType.title = profile.title;\n          }\n\n          return newTargetType;\n        })\n        .catch((reason) => {\n          console.error(reason);\n          return { ...tt, error: reason };\n        });\n\n      const readablePromise = new ReadablePromise(promise);\n      promiseCache.current.set(cacheKey, readablePromise);\n\n      return readablePromise;\n    });\n\n    if (!newTargetTypePromises || !anyToFetch) {\n      return;\n    }\n\n    Promise.all(newTargetTypePromises)\n      .then((newTargetTypes) => {\n        setTargetTypes(newTargetTypes);\n        if (!targetType) {\n          return;\n        }\n\n        const index = newTargetTypes.findIndex(\n          (tt) => tt.value === targetType.value || tt.resourceType === targetType.resourceType\n        );\n        if (index === -1) {\n          console.debug(`defaultValue had unexpected resourceType: ${targetType.resourceType}`);\n          return;\n        }\n        // orphaned targetType has been resolved\n        setTargetType(newTargetTypes[index]);\n      })\n      .catch(console.error);\n  }, [medplum, targetType, targetTypes]);\n\n  const setValueHelper = useCallback(\n    (item: Resource | undefined) => {\n      const newValue = item ? createReference(item) : undefined;\n      setValue(newValue);\n      if (onChange) {\n        onChange(newValue);\n      }\n    },\n    [onChange]\n  );\n\n  const typeSelectOptions = useMemo(() => {\n    if (targetTypes) {\n      return targetTypes.map((tt) => {\n        return {\n          value: tt.value,\n          label: tt.type === 'profile' ? tt.title ?? tt.name ?? tt.resourceType ?? tt.value : tt.value,\n        };\n      });\n    }\n    return [];\n  }, [targetTypes]);\n\n  return (\n    <Group gap=\"xs\" grow wrap=\"nowrap\">\n      {targetTypes && targetTypes.length > 1 && (\n        <NativeSelect\n          data-autofocus={props.autoFocus}\n          data-testid=\"reference-input-resource-type-select\"\n          defaultValue={targetType?.resourceType}\n          autoFocus={props.autoFocus}\n          onChange={(e) => {\n            const newValue = e.currentTarget.value;\n            const newTargetType = targetTypes.find((tt) => tt.value === newValue);\n            setTargetType(newTargetType);\n          }}\n          data={typeSelectOptions}\n        />\n      )}\n      {!targetTypes && (\n        <ResourceTypeInput\n          autoFocus={props.autoFocus}\n          testId=\"reference-input-resource-type-input\"\n          defaultValue={targetType?.resourceType as ResourceType}\n          onChange={(newResourceType) => {\n            if (newResourceType) {\n              setTargetType({ type: 'resourceType', value: newResourceType, resourceType: newResourceType });\n            } else {\n              setTargetType(undefined);\n            }\n          }}\n          name={props.name + '-resourceType'}\n          placeholder=\"Resource Type\"\n        />\n      )}\n      <ResourceInput\n        resourceType={targetType?.resourceType as ResourceType}\n        name={props.name + '-id'}\n        required={props.required}\n        placeholder={props.placeholder}\n        defaultValue={value}\n        searchCriteria={searchCriteria}\n        onChange={setValueHelper}\n      />\n    </Group>\n  );\n}\n\nfunction createTargetTypes(resourceTypesAndProfileUrls: string[] | undefined): TargetType[] | undefined {\n  if (\n    !resourceTypesAndProfileUrls ||\n    resourceTypesAndProfileUrls.length === 0 ||\n    (resourceTypesAndProfileUrls.length === 1 && resourceTypesAndProfileUrls[0] === 'Resource')\n  ) {\n    return undefined;\n  }\n\n  const results: TargetType[] = [];\n  for (const value of resourceTypesAndProfileUrls) {\n    // is there a less hacky way to distinguish resourceType from profile URLs?\n    if (value.includes('/')) {\n      results.push({ type: 'profile', value });\n    } else {\n      results.push({ type: 'resourceType', value, resourceType: value });\n    }\n  }\n  return results;\n}\n\nfunction getInitialTargetType(\n  defaultValue: Reference | undefined,\n  targetTypes: TargetType[] | undefined\n): TargetType | undefined {\n  const defaultValueResourceType = defaultValue?.reference?.split('/')[0];\n  if (defaultValueResourceType) {\n    const targetType = targetTypes?.find((tt) => tt.resourceType === defaultValueResourceType);\n    if (targetType) {\n      return targetType;\n    }\n\n    // An \"orphaned\" TargetType is created when defaultValue references a resourceType\n    // that is not yet represented in targetTypes due to profile URL resolution to resource type\n    // that has yet to occur. An orphan can also occur if a defaultValue is provided\n    // but targetTypes is not.\n    return {\n      type: 'resourceType',\n      value: defaultValueResourceType,\n      resourceType: defaultValueResourceType,\n    };\n  }\n\n  if (targetTypes && targetTypes.length > 0) {\n    return targetTypes[0];\n  }\n\n  return undefined;\n}\n\ninterface ResourceTypeGraphQLResponse {\n  readonly data: {\n    readonly StructureDefinitionList: Partial<StructureDefinition>[];\n  };\n}\n\nasync function fetchResourceTypeOfProfile(\n  medplum: MedplumClient,\n  profileUrl: string\n): Promise<Partial<StructureDefinition> | undefined> {\n  const profile = tryGetProfile(profileUrl);\n  if (profile) {\n    return { type: profile.type, name: profile.name, title: profile.title };\n  }\n\n  const query = `{\n      StructureDefinitionList(url: \"${profileUrl}\", _sort: \"_lastUpdated\", _count: 1) {\n        type,\n        name,\n        title,\n      }\n    }`.replace(/\\s+/g, ' ');\n\n  const response = (await medplum.graphql(query)) as ResourceTypeGraphQLResponse;\n\n  return response.data.StructureDefinitionList[0];\n}\n\nfunction shouldFetchResourceType(targetType: TargetType): targetType is ProfileTargetType {\n  return targetType.type === 'profile' && !targetType?.error && isEmpty(targetType.resourceType);\n}\n", "import { Group, Text } from '@mantine/core';\nimport { getDisplayString, getReferenceString, isPopulated } from '@medplum/core';\nimport { OperationOutcome, Patient, Reference, Resource } from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport { forwardRef, useCallback, useState } from 'react';\nimport { AsyncAutocomplete, AsyncAutocompleteOption } from '../AsyncAutocomplete/AsyncAutocomplete';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\n\n/**\n * Search parameter overrides for specific resource types.\n * Use this to specify the search parameter to use for a given resource type.\n * Otherwise it will fallback to \"name\" if the resource type is in NAME_RESOURCE_TYPES.\n * Otherwise it will fallback to \"_id\".\n */\nconst SEARCH_CODES: Record<string, string> = {\n  Observation: 'code',\n  User: 'email:contains',\n};\n\n/**\n * Resource types that should use the \"name\" search parameter.\n * This is the full list of resource types that have a \"name\" search parameter.\n * Otherwise it will fallback to \"_id\".\n */\nconst NAME_RESOURCE_TYPES = [\n  'AccessPolicy',\n  'Account',\n  'ActivityDefinition',\n  'Bot',\n  'CapabilityStatement',\n  'CareTeam',\n  'ClientApplication',\n  'CodeSystem',\n  'CompartmentDefinition',\n  'ConceptMap',\n  'EffectEvidenceSynthesis',\n  'Endpoint',\n  'EventDefinition',\n  'Evidence',\n  'EvidenceVariable',\n  'ExampleScenario',\n  'GraphDefinition',\n  'Group',\n  'HealthcareService',\n  'ImplementationGuide',\n  'InsurancePlan',\n  'Library',\n  'Location',\n  'Measure',\n  'MedicinalProduct',\n  'MessageDefinition',\n  'NamingSystem',\n  'OperationDefinition',\n  'Organization',\n  'Patient',\n  'Person',\n  'PlanDefinition',\n  'Practitioner',\n  'Project',\n  'Questionnaire',\n  'RelatedPerson',\n  'ResearchDefinition',\n  'ResearchElementDefinition',\n  'RiskEvidenceSynthesis',\n  'SearchParameter',\n  'StructureDefinition',\n  'StructureMap',\n  'TerminologyCapabilities',\n  'TestScript',\n  'UserConfiguration',\n  'ValueSet',\n];\n\nexport interface ResourceInputProps<T extends Resource = Resource> {\n  readonly resourceType: T['resourceType'];\n  readonly name: string;\n  readonly defaultValue?: T | Reference<T>;\n  readonly searchCriteria?: Record<string, string>;\n  readonly placeholder?: string;\n  readonly loadOnFocus?: boolean;\n  readonly required?: boolean;\n  readonly onChange?: (value: T | undefined) => void;\n}\n\nfunction toOption<T extends Resource>(resource: T): AsyncAutocompleteOption<T> {\n  return {\n    value: getReferenceString(resource),\n    label: getDisplayString(resource),\n    resource,\n  };\n}\n\nexport function ResourceInput<T extends Resource = Resource>(props: ResourceInputProps<T>): JSX.Element | null {\n  const medplum = useMedplum();\n  const { resourceType, searchCriteria } = props;\n  const [outcome, setOutcome] = useState<OperationOutcome>();\n  const defaultValue = useResource(props.defaultValue, setOutcome);\n  const onChange = props.onChange;\n\n  const loadValues = useCallback(\n    async (input: string, signal: AbortSignal): Promise<T[]> => {\n      const searchCode = getSearchParamForResourceType(resourceType);\n      const searchParams = new URLSearchParams({\n        [searchCode]: input ?? '',\n        _count: '10',\n        ...searchCriteria,\n      });\n\n      const resources = await medplum.searchResources(resourceType, searchParams, { signal });\n      return resources as unknown as T[];\n    },\n    [medplum, resourceType, searchCriteria]\n  );\n\n  const handleChange = useCallback(\n    (newResources: T[]) => {\n      if (onChange) {\n        onChange(newResources[0]);\n      }\n    },\n    [onChange]\n  );\n\n  if (isPopulated(props.defaultValue) && !outcome && !defaultValue) {\n    // If a default value was specified, but the default resource is not loaded yet,\n    // then return null to avoid rendering the input until the default resource is loaded.\n    // The Mantine <MultiSelect> component does not reliably handle changes to defaultValue.\n    return null;\n  }\n\n  return (\n    <AsyncAutocomplete<T>\n      name={props.name}\n      required={props.required}\n      itemComponent={ItemComponent}\n      defaultValue={defaultValue}\n      placeholder={props.placeholder}\n      maxValues={1}\n      toOption={toOption}\n      loadOptions={loadValues}\n      onChange={handleChange}\n      clearable\n    />\n  );\n}\n\nconst ItemComponent = forwardRef<HTMLDivElement, AsyncAutocompleteOption<Resource>>(\n  ({ label, resource, ...others }: AsyncAutocompleteOption<Resource>, ref) => {\n    return (\n      <div ref={ref} {...others}>\n        <Group wrap=\"nowrap\">\n          <ResourceAvatar value={resource} />\n          <div>\n            <Text>{label}</Text>\n            <Text size=\"xs\" c=\"dimmed\">\n              {(resource as Patient).birthDate}\n            </Text>\n          </div>\n        </Group>\n      </div>\n    );\n  }\n);\n\n/**\n * Returns the search parameter to use for the given resource type.\n * If the resource type is in SEARCH_CODES, then that value is used.\n * Otherwise, if the resource type is in NAME_RESOURCE_TYPES, then \"name\" is used.\n * Otherwise, \"_id\" is used.\n * @param resourceType - The FHIR resource type.\n * @returns The search parameter to use for the autocomplete input.\n */\nfunction getSearchParamForResourceType(resourceType: string): string {\n  return SEARCH_CODES[resourceType] ?? (NAME_RESOURCE_TYPES.includes(resourceType) ? 'name' : '_id');\n}\n", "import { Group, Stack } from '@mantine/core';\nimport { InternalSchemaElement, SliceDefinitionWithTypes, getPathDisplayName } from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { MouseEvent, useContext, useEffect, useState } from 'react';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { ResourcePropertyInput } from '../ResourcePropertyInput/ResourcePropertyInput';\nimport { SliceInput } from '../SliceInput/SliceInput';\nimport { ArrayAddButton } from '../buttons/ArrayAddButton';\nimport { ArrayRemoveButton } from '../buttons/ArrayRemoveButton';\nimport { killEvent } from '../utils/dom';\nimport classes from './ResourceArrayInput.module.css';\nimport { assignValuesIntoSlices, prepareSlices } from './ResourceArrayInput.utils';\n\nexport interface ResourceArrayInputProps {\n  readonly property: InternalSchemaElement;\n  readonly name: string;\n  readonly path: string;\n  readonly defaultValue?: any[];\n  readonly indent?: boolean;\n  readonly outcome: OperationOutcome | undefined;\n  readonly onChange?: (value: any[]) => void;\n  readonly hideNonSliceValues?: boolean;\n}\n\nexport function ResourceArrayInput(props: ResourceArrayInputProps): JSX.Element {\n  const { property } = props;\n  const medplum = useMedplum();\n  const [loading, setLoading] = useState(true);\n  const [slices, setSlices] = useState<SliceDefinitionWithTypes[]>([]);\n  // props.defaultValue should NOT be used after this; prefer the defaultValue state\n  const [defaultValue] = useState<any[]>(() => (Array.isArray(props.defaultValue) ? props.defaultValue : []));\n  const [slicedValues, setSlicedValues] = useState<any[][]>(() => [defaultValue]);\n  const ctx = useContext(ElementsContext);\n\n  const propertyTypeCode = property.type[0]?.code;\n  useEffect(() => {\n    prepareSlices({\n      medplum,\n      property,\n    })\n      .then((slices) => {\n        setSlices(slices);\n        const slicedValues = assignValuesIntoSlices(defaultValue, slices, property.slicing, ctx.profileUrl);\n        addPlaceholderValues(slicedValues, slices);\n        setSlicedValues(slicedValues);\n        setLoading(false);\n      })\n      .catch((reason) => {\n        console.error(reason);\n        setLoading(false);\n      });\n  }, [medplum, property, defaultValue, ctx.profileUrl, setSlicedValues]);\n\n  function setValuesWrapper(newValues: any[], sliceIndex: number): void {\n    const newSlicedValues = [...slicedValues];\n    newSlicedValues[sliceIndex] = newValues;\n    setSlicedValues(newSlicedValues);\n    if (props.onChange) {\n      // Remove any placeholder (i.e. undefined) values before propagating\n      const cleaned = newSlicedValues.flat().filter((val) => val !== undefined);\n      props.onChange(cleaned);\n    }\n  }\n\n  if (loading) {\n    return <div>Loading...</div>;\n  }\n\n  const nonSliceIndex = slices.length;\n  const nonSliceValues = slicedValues[nonSliceIndex];\n\n  // Hide non-sliced values when handling sliced extensions\n  const showNonSliceValues = !(props.hideNonSliceValues ?? (propertyTypeCode === 'Extension' && slices.length > 0));\n  const propertyDisplayName = getPathDisplayName(property.path);\n\n  return (\n    <Stack className={props.indent ? classes.indented : undefined}>\n      {slices.map((slice, sliceIndex) => {\n        return (\n          <SliceInput\n            slice={slice}\n            key={slice.name}\n            path={props.path}\n            property={property}\n            defaultValue={slicedValues[sliceIndex]}\n            onChange={(newValue: any[]) => {\n              setValuesWrapper(newValue, sliceIndex);\n            }}\n            testId={`slice-${slice.name}`}\n          />\n        );\n      })}\n\n      {showNonSliceValues &&\n        nonSliceValues.map((value, valueIndex) => (\n          <Group key={`${valueIndex}-${nonSliceValues.length}`} wrap=\"nowrap\" style={{ flexGrow: 1 }}>\n            <div style={{ flexGrow: 1 }}>\n              <ResourcePropertyInput\n                arrayElement={true}\n                property={props.property}\n                name={props.name + '.' + valueIndex}\n                path={props.path}\n                defaultValue={value}\n                onChange={(newValue: any) => {\n                  const newNonSliceValues = [...nonSliceValues];\n                  newNonSliceValues[valueIndex] = newValue;\n                  setValuesWrapper(newNonSliceValues, nonSliceIndex);\n                }}\n                defaultPropertyType={undefined}\n                outcome={props.outcome}\n              />\n            </div>\n            <ArrayRemoveButton\n              propertyDisplayName={propertyDisplayName}\n              testId={`nonsliced-remove-${valueIndex}`}\n              onClick={(e: MouseEvent) => {\n                killEvent(e);\n                const newNonSliceValues = [...nonSliceValues];\n                newNonSliceValues.splice(valueIndex, 1);\n                setValuesWrapper(newNonSliceValues, nonSliceIndex);\n              }}\n            />\n          </Group>\n        ))}\n      {showNonSliceValues && slicedValues.flat().length < property.max && (\n        <Group wrap=\"nowrap\" style={{ justifyContent: 'flex-start' }}>\n          <ArrayAddButton\n            propertyDisplayName={propertyDisplayName}\n            onClick={(e: MouseEvent) => {\n              killEvent(e);\n              const newNonSliceValues = [...nonSliceValues];\n              newNonSliceValues.push(undefined);\n              setValuesWrapper(newNonSliceValues, nonSliceIndex);\n            }}\n            testId=\"nonsliced-add\"\n          />\n        </Group>\n      )}\n    </Stack>\n  );\n}\n\nfunction addPlaceholderValues(slicedValues: any[][], slices: SliceDefinitionWithTypes[]): void {\n  for (let sliceIndex = 0; sliceIndex < slices.length; sliceIndex++) {\n    const slice = slices[sliceIndex];\n    const sliceValues = slicedValues[sliceIndex];\n\n    while (sliceValues.length < slice.min) {\n      sliceValues.push(undefined);\n    }\n  }\n}\n", "import { Group, Stack } from '@mantine/core';\nimport {\n  ElementsContextType,\n  InternalSchemaElement,\n  SliceDefinitionWithTypes,\n  buildElementsContext,\n  getPropertyDisplayName,\n  isEmpty,\n  isPopulated,\n} from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useContext, useMemo, useState } from 'react';\nimport { ElementsContext } from '../ElementsInput/ElementsInput.utils';\nimport { FormSection } from '../FormSection/FormSection';\nimport { ElementDefinitionTypeInput } from '../ResourcePropertyInput/ResourcePropertyInput';\nimport { ArrayAddButton } from '../buttons/ArrayAddButton';\nimport { ArrayRemoveButton } from '../buttons/ArrayRemoveButton';\nimport { killEvent } from '../utils/dom';\nimport classes from '../ResourceArrayInput/ResourceArrayInput.module.css';\nimport { maybeWrapWithContext } from '../utils/maybeWrapWithContext';\n\nexport interface SliceInputProps {\n  readonly path: string;\n  readonly slice: SliceDefinitionWithTypes;\n  readonly property: InternalSchemaElement;\n  readonly defaultValue: any[];\n  readonly onChange: (newValue: any[]) => void;\n  readonly outcome?: OperationOutcome;\n  readonly testId?: string;\n}\n\nexport function SliceInput(props: SliceInputProps): JSX.Element | null {\n  const { slice, property } = props;\n  const [values, setValues] = useState<any[]>(props.defaultValue);\n\n  const sliceElements = slice.typeSchema?.elements ?? slice.elements;\n\n  const parentElementsContextValue = useContext(ElementsContext);\n\n  const contextValue: ElementsContextType | undefined = useMemo(() => {\n    if (isPopulated(sliceElements)) {\n      return buildElementsContext({\n        parentContext: parentElementsContextValue,\n        elements: sliceElements,\n        path: props.path,\n        profileUrl: slice.typeSchema?.url,\n      });\n    }\n    return undefined;\n  }, [parentElementsContextValue, props.path, slice.typeSchema?.url, sliceElements]);\n\n  function setValuesWrapper(newValues: any[]): void {\n    setValues(newValues);\n    if (props.onChange) {\n      props.onChange(newValues);\n    }\n  }\n\n  const required = slice.min > 0;\n\n  // this is a bit of a hack targeted at nested extensions; indentation would ideally be controlled elsewhere\n  // e.g. USCorePatientProfile -> USCoreEthnicityExtension -> {ombCategory, detailed, text}\n  const indentedStack = isEmpty(slice.elements);\n  const propertyDisplayName = getPropertyDisplayName(slice.name);\n  return maybeWrapWithContext(\n    ElementsContext.Provider,\n    contextValue,\n    <FormSection\n      title={propertyDisplayName}\n      description={slice.definition}\n      withAsterisk={required}\n      fhirPath={`${property.path}:${slice.name}`}\n      testId={props.testId}\n    >\n      <Stack className={indentedStack ? classes.indented : undefined}>\n        {values.map((value, valueIndex) => {\n          return (\n            <Group key={`${valueIndex}-${values.length}`} wrap=\"nowrap\">\n              <div style={{ flexGrow: 1 }} data-testid={props.testId && `${props.testId}-elements-${valueIndex}`}>\n                <ElementDefinitionTypeInput\n                  elementDefinitionType={slice.type[0]}\n                  name={slice.name}\n                  defaultValue={value}\n                  onChange={(newValue) => {\n                    const newValues = [...values];\n                    newValues[valueIndex] = newValue;\n                    setValuesWrapper(newValues);\n                  }}\n                  outcome={props.outcome}\n                  min={slice.min}\n                  max={slice.max}\n                  binding={slice.binding}\n                  path={props.path}\n                />\n              </div>\n              {values.length > slice.min && (\n                <ArrayRemoveButton\n                  propertyDisplayName={propertyDisplayName}\n                  testId={props.testId && `${props.testId}-remove-${valueIndex}`}\n                  onClick={(e: React.MouseEvent) => {\n                    killEvent(e);\n                    const newValues = [...values];\n                    newValues.splice(valueIndex, 1);\n                    setValuesWrapper(newValues);\n                  }}\n                />\n              )}\n            </Group>\n          );\n        })}\n        {values.length < slice.max && (\n          <Group wrap=\"nowrap\" style={{ justifyContent: 'flex-start' }}>\n            <ArrayAddButton\n              propertyDisplayName={propertyDisplayName}\n              onClick={(e: React.MouseEvent) => {\n                killEvent(e);\n                const newValues = [...values, undefined];\n                setValuesWrapper(newValues);\n              }}\n              testId={props.testId && `${props.testId}-add`}\n            />\n          </Group>\n        )}\n      </Stack>\n    </FormSection>\n  );\n}\n", "import { Button, ActionIcon } from '@mantine/core';\nimport { IconCirclePlus } from '@tabler/icons-react';\n\nexport interface ArrayAddButtonProps {\n  readonly propertyDisplayName?: string;\n  readonly onClick: React.MouseEventHandler;\n  readonly testId?: string;\n}\n\nexport function ArrayAddButton({ propertyDisplayName, onClick, testId }: ArrayAddButtonProps): JSX.Element {\n  const text = propertyDisplayName ? `Add ${propertyDisplayName}` : 'Add';\n\n  return propertyDisplayName ? (\n    <Button\n      title={text}\n      size=\"sm\"\n      color=\"green.6\"\n      variant=\"subtle\"\n      data-testid={testId}\n      leftSection={<IconCirclePlus size=\"1.25rem\" />}\n      onClick={onClick}\n    >\n      {text}\n    </Button>\n  ) : (\n    <ActionIcon title={text} color=\"green.6\" data-testid={testId} onClick={onClick}>\n      <IconCirclePlus size=\"1.25rem\" />\n    </ActionIcon>\n  );\n}\n", "import { ActionIcon } from '@mantine/core';\nimport { IconCircleMinus } from '@tabler/icons-react';\n\nexport interface ArrayRemoveButtonProps {\n  readonly propertyDisplayName?: string;\n  readonly onClick: React.MouseEventHandler;\n  readonly testId?: string;\n}\n\nexport function ArrayRemoveButton({ propertyDisplayName, onClick, testId }: ArrayRemoveButtonProps): JSX.Element {\n  return (\n    <ActionIcon\n      title={propertyDisplayName ? `Remove ${propertyDisplayName}` : 'Remove'}\n      color=\"red.5\"\n      data-testid={testId}\n      variant=\"subtle\"\n      onClick={onClick}\n    >\n      <IconCircleMinus size=\"1.25rem\" />\n    </ActionIcon>\n  );\n}\n", ".indented {\n  margin-top: 0.5rem;\n  border-left: 3px solid var(--mantine-color-gray-4);\n  padding: 0.5rem 0 0.5rem 0.5rem;\n}\n", "import { ActionIcon, Flex, Textarea, TextareaProps } from '@mantine/core';\nimport { useClipboard } from '@mantine/hooks';\nimport { showNotification } from '@mantine/notifications';\nimport { IconCopy } from '@tabler/icons-react';\nimport { RefAttributes, useRef, useState } from 'react';\n\nexport interface SensitiveTextareaProps extends TextareaProps, RefAttributes<HTMLTextAreaElement> {}\n\nexport function SensitiveTextarea(props: Omit<SensitiveTextareaProps, 'ref'>): JSX.Element {\n  const [revealed, setRevealed] = useState(false);\n  const clipboard = useClipboard();\n  const ref = useRef<HTMLTextAreaElement | null>(null);\n\n  const styles: SensitiveTextareaProps['styles'] = {\n    ...props.styles,\n  };\n  if (!revealed) {\n    if (!styles.input) {\n      styles.input = {};\n    }\n\n    (styles.input as Record<string, string>)['WebkitTextSecurity'] = 'disc';\n  }\n\n  return (\n    <Flex gap=\"xs\">\n      <Textarea\n        {...props}\n        styles={{\n          ...styles,\n          root: {\n            ...(styles.root ?? {}),\n            flexGrow: 1,\n          },\n        }}\n        ref={ref}\n        autosize\n        minRows={1}\n        onFocus={() => setRevealed(true)}\n        onBlur={() => setRevealed(false)}\n      />\n      <ActionIcon\n        title=\"Copy secret\"\n        onClick={() => {\n          clipboard.copy(ref.current?.value);\n          showNotification({ color: 'green', message: 'Copied' });\n        }}\n      >\n        <IconCopy />\n      </ActionIcon>\n    </Flex>\n  );\n}\n", "import { Button, Chip, Group, Modal, NativeSelect, Stack, Switch, TextInput } from '@mantine/core';\nimport { formatTiming } from '@medplum/core';\nimport { Timing, TimingRepeat } from '@medplum/fhirtypes';\nimport { useRef, useState } from 'react';\nimport { DateTimeInput } from '../DateTimeInput/DateTimeInput';\nimport { FormSection } from '../FormSection/FormSection';\n\nconst daysOfWeek = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];\n\ntype DayOfWeek = 'sun' | 'mon' | 'tue' | 'wed' | 'thu' | 'fri' | 'sat';\n\ntype PeriodUnit = 'a' | 's' | 'min' | 'h' | 'd' | 'wk' | 'mo';\n\nexport interface TimingInputProps {\n  readonly name: string;\n  readonly defaultValue?: Timing;\n  readonly onChange?: (newValue: Timing) => void;\n}\n\nexport function TimingInput(props: TimingInputProps): JSX.Element {\n  const [value, setValue] = useState<Timing | undefined>(props.defaultValue);\n  const [open, setOpen] = useState(false);\n\n  const valueRef = useRef<Timing>();\n  valueRef.current = value;\n\n  return (\n    <>\n      <Group gap=\"xs\" grow wrap=\"nowrap\">\n        <span>{formatTiming(valueRef.current) || 'No repeat'}</span>\n        <Button onClick={() => setOpen(true)}>Edit</Button>\n      </Group>\n      <TimingEditorDialog\n        visible={open}\n        defaultValue={valueRef.current}\n        onOk={(newValue) => {\n          if (props.onChange) {\n            props.onChange(newValue);\n          }\n          setValue(newValue);\n          setOpen(false);\n        }}\n        onCancel={() => setOpen(false)}\n      />\n    </>\n  );\n}\n\ninterface TimingEditorDialogProps {\n  readonly visible: boolean;\n  readonly defaultValue?: Timing;\n  readonly onOk: (newValue: Timing) => void;\n  readonly onCancel: () => void;\n}\n\nconst defaultValue: Timing = {\n  repeat: {\n    period: 1,\n    periodUnit: 'd',\n  },\n};\n\nfunction TimingEditorDialog(props: TimingEditorDialogProps): JSX.Element {\n  const [value, setValue] = useState<Timing>(props.defaultValue || defaultValue);\n\n  const valueRef = useRef<Timing>();\n  valueRef.current = value;\n\n  function setStart(newStart: string): void {\n    setValue({ ...valueRef.current, event: [newStart] });\n  }\n\n  function setRepeat(repeat: TimingRepeat | undefined): void {\n    setValue({ ...valueRef.current, repeat });\n  }\n\n  function setPeriod(newPeriod: number | undefined): void {\n    setRepeat({ ...valueRef.current?.repeat, period: newPeriod });\n  }\n\n  function setPeriodUnit(newPeriodUnit: PeriodUnit | undefined): void {\n    setRepeat({ ...valueRef.current?.repeat, periodUnit: newPeriodUnit });\n  }\n\n  function setDaysOfWeek(newDaysOfWeek: DayOfWeek[] | undefined): void {\n    setRepeat({ ...valueRef.current?.repeat, dayOfWeek: newDaysOfWeek });\n  }\n\n  return (\n    <Modal\n      title=\"Timing\"\n      closeButtonProps={{ 'aria-label': 'Close' }}\n      opened={props.visible}\n      onClose={() => props.onCancel()}\n    >\n      <Stack>\n        <FormSection title=\"Starts on\" htmlFor=\"timing-dialog-start\">\n          <DateTimeInput name=\"timing-dialog-start\" onChange={(newValue) => setStart(newValue)} />\n        </FormSection>\n        <Switch\n          label=\"Repeat\"\n          checked={!!value.repeat}\n          onChange={(e) => setRepeat(e.currentTarget.checked ? defaultValue.repeat : undefined)}\n        />\n        {value.repeat && (\n          <>\n            <FormSection title=\"Repeat every\" htmlFor=\"timing-dialog-period\">\n              <Group gap=\"xs\" grow wrap=\"nowrap\">\n                <TextInput\n                  type=\"number\"\n                  step={1}\n                  id=\"timing-dialog-period\"\n                  name=\"timing-dialog-period\"\n                  defaultValue={value.repeat.period || 1}\n                  onChange={(e) => setPeriod(parseInt(e.currentTarget.value, 10) || 1)}\n                />\n                <NativeSelect\n                  id=\"timing-dialog-periodUnit\"\n                  name=\"timing-dialog-periodUnit\"\n                  defaultValue={value.repeat.periodUnit}\n                  onChange={(e) => setPeriodUnit(e.currentTarget.value as PeriodUnit | undefined)}\n                  data={[\n                    { label: 'second', value: 's' },\n                    { label: 'minute', value: 'min' },\n                    { label: 'hour', value: 'h' },\n                    { label: 'day', value: 'd' },\n                    { label: 'week', value: 'wk' },\n                    { label: 'month', value: 'mo' },\n                    { label: 'year', value: 'a' },\n                  ]}\n                />\n              </Group>\n            </FormSection>\n            {value.repeat.periodUnit === 'wk' && (\n              <FormSection title=\"Repeat on\">\n                <Chip.Group multiple onChange={setDaysOfWeek as (v: string[] | undefined) => void}>\n                  <Group justify=\"space-between\" mt=\"md\" gap=\"xs\">\n                    {daysOfWeek.map((day) => (\n                      <Chip key={day} value={day} size=\"xs\" radius=\"xl\">\n                        {day.charAt(0).toUpperCase()}\n                      </Chip>\n                    ))}\n                  </Group>\n                </Chip.Group>\n              </FormSection>\n            )}\n          </>\n        )}\n        <Group justify=\"flex-end\">\n          <Button onClick={() => props.onOk(value)}>OK</Button>\n        </Group>\n      </Stack>\n    </Modal>\n  );\n}\n", "import { Button, Group } from '@mantine/core';\nimport { Slot } from '@medplum/fhirtypes';\nimport { useMemo, useState } from 'react';\nimport classes from './CalendarInput.module.css';\nimport { getMonthString, getStartMonth } from './CalendarInput.utils';\n\nexport interface CalendarInputProps {\n  readonly slots: Slot[];\n  readonly onChangeMonth: (date: Date) => void;\n  readonly onClick: (date: Date) => void;\n}\n\ninterface CalendarCell {\n  readonly date: Date;\n  readonly available: boolean;\n}\n\ntype OptionalCalendarCell = CalendarCell | undefined;\n\nexport function CalendarInput(props: CalendarInputProps): JSX.Element {\n  const { onChangeMonth, onClick } = props;\n  const [month, setMonth] = useState<Date>(getStartMonth);\n\n  function moveMonth(delta: number): void {\n    setMonth((currMonth) => {\n      const newMonth = new Date(currMonth.getTime());\n      newMonth.setMonth(currMonth.getMonth() + delta);\n      onChangeMonth(newMonth);\n      return newMonth;\n    });\n  }\n\n  const grid = useMemo(() => buildGrid(month, props.slots), [month, props.slots]);\n\n  return (\n    <div>\n      <Group justify=\"space-between\" gap=\"xs\" grow wrap=\"nowrap\">\n        <p style={{ flex: 1 }}>{getMonthString(month)}</p>\n        <Group justify=\"flex-end\" gap=\"xs\">\n          <Button variant=\"outline\" aria-label=\"Previous month\" onClick={() => moveMonth(-1)}>\n            &lt;\n          </Button>\n          <Button variant=\"outline\" aria-label=\"Next month\" onClick={() => moveMonth(1)}>\n            &gt;\n          </Button>\n        </Group>\n      </Group>\n      <table className={classes.table}>\n        <thead>\n          <tr>\n            <th>SUN</th>\n            <th>MON</th>\n            <th>TUE</th>\n            <th>WED</th>\n            <th>THU</th>\n            <th>FRI</th>\n            <th>SAT</th>\n          </tr>\n        </thead>\n        <tbody>\n          {grid.map((week, weekIndex) => (\n            <tr key={'week-' + weekIndex}>\n              {week.map((day, dayIndex) => (\n                <td key={'day-' + dayIndex}>\n                  {day && (\n                    <Button variant=\"light\" disabled={!day.available} onClick={() => onClick(day.date)}>\n                      {day.date.getDate()}\n                    </Button>\n                  )}\n                </td>\n              ))}\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nfunction buildGrid(startDate: Date, slots: Slot[]): OptionalCalendarCell[][] {\n  const d = new Date(startDate.getFullYear(), startDate.getMonth());\n  const grid: OptionalCalendarCell[][] = [];\n  let row: OptionalCalendarCell[] = [];\n\n  // Fill leading empty days\n  for (let i = 0; i < d.getDay(); i++) {\n    row.push(undefined);\n  }\n\n  while (d.getMonth() === startDate.getMonth()) {\n    row.push({\n      date: new Date(d.getTime()),\n      available: isDayAvailable(d, slots),\n    });\n\n    if (d.getDay() === 6) {\n      grid.push(row);\n      row = [];\n    }\n\n    d.setDate(d.getDate() + 1);\n  }\n\n  // Fill trailing empty days\n  if (d.getDay() !== 0) {\n    for (let i = d.getDay(); i < 7; i++) {\n      row.push(undefined);\n    }\n    grid.push(row);\n  }\n\n  return grid;\n}\n\n/**\n * Returns true if the given date is available for booking.\n * @param day - The day to check.\n * @param slots - The list of available slots.\n * @returns True if there are any available slots for the day.\n */\nfunction isDayAvailable(day: Date, slots: Slot[]): boolean {\n  // Note that slot start and end time may or may not be in UTC.\n  for (const slot of slots) {\n    const slotStart = new Date(slot.start as string);\n    if (\n      slotStart.getFullYear() === day.getFullYear() &&\n      slotStart.getMonth() === day.getMonth() &&\n      slotStart.getDate() === day.getDate()\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n", "\n.table {\n  width: 350px;\n\n  & th {\n    font-weight: normal;\n    font-size: 11px;\n    padding: 8px;\n    text-align: center;\n  }\n\n  & td {\n    padding: 2px 4px;\n  }\n\n  & td button {\n    width: 44px;\n    height: 44px;\n    color: theme.colors[theme.primaryColor][5];\n    font-size: 16px;\n    font-weight: 500;\n    text-align: center;\n    padding: 0;\n    background-color: theme.colors[theme.primaryColor][0];\n    border: 0;\n    border-radius: 50px;\n    cursor: pointer;\n  }\n\n  & td button:hover {\n    background-color: theme.colors[theme.primaryColor][1];\n  }\n\n  & td button:disabled {\n    background-color: transparen;\n    cursor: defaul;\n    color: var(--mantine-color-gray-4);\n    font-weight: normal;\n  }\n}", "/**\n * Returns a month display string (e.g. \"January 2020\").\n * @param date - Any date within the month.\n * @returns The month display string (e.g. \"January 2020\")\n */\nexport function getMonthString(date: Date): string {\n  return date.toLocaleString('default', { month: 'long' }) + ' ' + date.getFullYear();\n}\n\nexport function getStartMonth(): Date {\n  const result = new Date();\n  result.setDate(1);\n  result.setHours(0, 0, 0, 0);\n  return result;\n}\n", "import { ContainerProps, Container as MantineContainer } from '@mantine/core';\nimport classes from './Container.module.css';\n\nexport function Container(props: ContainerProps): JSX.Element {\n  const { children, ...others } = props;\n\n  return (\n    <MantineContainer className={classes.root} {...others}>\n      {children}\n    </MantineContainer>\n  );\n}\n", ".root {\n  @media (max-width: 800px) {\n    padding-left: 4px;\n    padding-right: 4px;\n  }\n}\n", "import { ActionIcon, Center, Group, Loader, Menu, ScrollArea, TextInput } from '@mantine/core';\nimport { showNotification, updateNotification } from '@mantine/notifications';\nimport { getReferenceString, MedplumClient, normalizeErrorString, ProfileResource } from '@medplum/core';\nimport {\n  Attachment,\n  AuditEvent,\n  Bundle,\n  BundleEntry,\n  Communication,\n  DiagnosticReport,\n  Media,\n  OperationOutcome,\n  Reference,\n  Resource,\n  ResourceType,\n} from '@medplum/fhirtypes';\nimport { useMedplum, useMedplumNavigate, useResource } from '@medplum/react-hooks';\nimport {\n  IconCheck,\n  IconCloudUpload,\n  IconEdit,\n  IconFileAlert,\n  IconListDetails,\n  IconMessage,\n  IconPin,\n  IconPinnedOff,\n  IconTrash,\n} from '@tabler/icons-react';\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { AttachmentButton } from '../AttachmentButton/AttachmentButton';\nimport { AttachmentDisplay } from '../AttachmentDisplay/AttachmentDisplay';\nimport { DiagnosticReportDisplay } from '../DiagnosticReportDisplay/DiagnosticReportDisplay';\nimport { Form } from '../Form/Form';\nimport { Panel } from '../Panel/Panel';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\nimport { ResourceDiffTable } from '../ResourceDiffTable/ResourceDiffTable';\nimport { ResourceTable } from '../ResourceTable/ResourceTable';\nimport { Timeline, TimelineItem } from '../Timeline/Timeline';\nimport { sortByDateAndPriority } from '../utils/date';\nimport classes from './ResourceTimeline.module.css';\n\nexport interface ResourceTimelineProps<T extends Resource> {\n  readonly value: T | Reference<T>;\n  readonly loadTimelineResources: (\n    medplum: MedplumClient,\n    resourceType: ResourceType,\n    id: string\n  ) => Promise<PromiseSettledResult<Bundle>[]>;\n  readonly createCommunication?: (resource: T, sender: ProfileResource, text: string) => Communication;\n  readonly createMedia?: (resource: T, operator: ProfileResource, attachment: Attachment) => Media;\n}\n\nexport function ResourceTimeline<T extends Resource>(props: ResourceTimelineProps<T>): JSX.Element {\n  const medplum = useMedplum();\n  const navigate = useMedplumNavigate();\n  const sender = medplum.getProfile() as ProfileResource;\n  const inputRef = useRef<HTMLInputElement>(null);\n  const resource = useResource(props.value);\n  const [history, setHistory] = useState<Bundle>();\n  const [items, setItems] = useState<Resource[]>([]);\n  const loadTimelineResources = props.loadTimelineResources;\n\n  const itemsRef = useRef<Resource[]>(items);\n  itemsRef.current = items;\n\n  /**\n   * Sorts and sets the items.\n   *\n   * Sorting is primarily a function of meta.lastUpdated, but there are special cases.\n   * When displaying connected resources, for example a Communication in the context of an Encounter,\n   * the Communication.sent time is used rather than Communication.meta.lastUpdated.\n   *\n   * Other examples of special cases:\n   * - DiagnosticReport.issued\n   * - Media.issued\n   * - Observation.issued\n   * - DocumentReference.date\n   *\n   * See \"sortByDateAndPriority()\" for more details.\n   */\n  const sortAndSetItems = useCallback(\n    (newItmes: Resource[]): void => {\n      sortByDateAndPriority(newItmes, resource);\n      newItmes.reverse();\n      setItems(newItmes);\n    },\n    [resource]\n  );\n\n  /**\n   * Handles a batch request response.\n   * @param batchResponse - The batch response.\n   */\n  const handleBatchResponse = useCallback(\n    (batchResponse: PromiseSettledResult<Bundle>[]): void => {\n      const newItems = [];\n\n      for (const settledResult of batchResponse) {\n        if (settledResult.status !== 'fulfilled') {\n          // User may not have access to all resource types\n          continue;\n        }\n\n        const bundle = settledResult.value;\n        if (bundle.type === 'history') {\n          setHistory(bundle);\n        }\n\n        if (bundle.entry) {\n          for (const entry of bundle.entry) {\n            newItems.push(entry.resource as Resource);\n          }\n        }\n      }\n\n      sortAndSetItems(newItems);\n    },\n    [sortAndSetItems]\n  );\n\n  /**\n   * Adds an array of resources to the timeline.\n   * @param resource - Resource to add.\n   */\n  const addResource = useCallback(\n    (resource: Resource): void => sortAndSetItems([...itemsRef.current, resource]),\n    [sortAndSetItems]\n  );\n\n  /**\n   * Loads the timeline.\n   */\n  const loadTimeline = useCallback(() => {\n    let resourceType: ResourceType;\n    let id: string;\n    if ('resourceType' in props.value) {\n      resourceType = props.value.resourceType;\n      id = props.value.id as string;\n    } else {\n      [resourceType, id] = props.value.reference?.split('/') as [ResourceType, string];\n    }\n    loadTimelineResources(medplum, resourceType, id).then(handleBatchResponse).catch(console.log);\n  }, [medplum, props.value, loadTimelineResources, handleBatchResponse]);\n\n  useEffect(() => loadTimeline(), [loadTimeline]);\n\n  /**\n   * Adds a Communication resource to the timeline.\n   * @param contentString - The comment content.\n   */\n  function createComment(contentString: string): void {\n    if (!resource || !props.createCommunication) {\n      // Encounter not loaded yet\n      return;\n    }\n    medplum\n      .createResource(props.createCommunication(resource, sender, contentString))\n      .then((result) => addResource(result))\n      .catch(console.log);\n  }\n\n  /**\n   * Adds a Media resource to the timeline.\n   * @param attachment - The media attachment.\n   */\n  function createMedia(attachment: Attachment): void {\n    if (!resource || !props.createMedia) {\n      // Encounter not loaded yet\n      return;\n    }\n    medplum\n      .createResource(props.createMedia(resource, sender, attachment))\n      .then((result) => addResource(result))\n      .then(() =>\n        updateNotification({\n          id: 'upload-notification',\n          color: 'teal',\n          title: 'Upload complete',\n          message: '',\n          icon: <IconCheck size={16} />,\n          autoClose: 2000,\n        })\n      )\n      .catch((reason) =>\n        updateNotification({\n          id: 'upload-notification',\n          color: 'red',\n          title: 'Upload error',\n          message: normalizeErrorString(reason),\n          icon: <IconFileAlert size={16} />,\n          autoClose: 2000,\n        })\n      );\n  }\n\n  function setPriority(\n    communication: Communication,\n    priority: 'routine' | 'urgent' | 'asap' | 'stat'\n  ): Promise<Communication> {\n    return medplum.updateResource({ ...communication, priority });\n  }\n\n  function onPin(communication: Communication): void {\n    setPriority(communication, 'stat').then(loadTimeline).catch(console.log);\n  }\n\n  function onUnpin(communication: Communication): void {\n    setPriority(communication, 'routine').then(loadTimeline).catch(console.log);\n  }\n\n  function onDetails(timelineItem: Resource): void {\n    navigate(`/${timelineItem.resourceType}/${timelineItem.id}`);\n  }\n\n  function onEdit(timelineItem: Resource): void {\n    navigate(`/${timelineItem.resourceType}/${timelineItem.id}/edit`);\n  }\n\n  function onDelete(timelineItem: Resource): void {\n    navigate(`/${timelineItem.resourceType}/${timelineItem.id}/delete`);\n  }\n\n  function onVersionDetails(version: Resource): void {\n    navigate(`/${version.resourceType}/${version.id}/_history/${version.meta?.versionId}`);\n  }\n\n  function onUploadStart(): void {\n    showNotification({\n      id: 'upload-notification',\n      loading: true,\n      title: 'Initializing upload...',\n      message: 'Please wait...',\n      autoClose: false,\n      withCloseButton: false,\n    });\n  }\n\n  function onUploadProgress(e: ProgressEvent): void {\n    updateNotification({\n      id: 'upload-notification',\n      loading: true,\n      title: 'Uploading...',\n      message: getProgressMessage(e),\n      autoClose: false,\n      withCloseButton: false,\n    });\n  }\n\n  function onUploadError(outcome: OperationOutcome): void {\n    updateNotification({\n      id: 'upload-notification',\n      color: 'red',\n      title: 'Upload error',\n      message: normalizeErrorString(outcome),\n      icon: <IconFileAlert size={16} />,\n      autoClose: 2000,\n    });\n  }\n\n  if (!resource) {\n    return (\n      <Center style={{ width: '100%', height: '100%' }}>\n        <Loader />\n      </Center>\n    );\n  }\n\n  return (\n    <Timeline>\n      {props.createCommunication && (\n        <Panel>\n          <Form\n            testid=\"timeline-form\"\n            onSubmit={(formData: Record<string, string>) => {\n              createComment(formData.text);\n\n              const input = inputRef.current;\n              if (input) {\n                input.value = '';\n                input.focus();\n              }\n            }}\n          >\n            <Group gap=\"xs\" wrap=\"nowrap\" style={{ width: '100%' }}>\n              <ResourceAvatar value={sender} />\n              <TextInput\n                name=\"text\"\n                ref={inputRef}\n                placeholder=\"Add comment\"\n                style={{ width: '100%', maxWidth: 300 }}\n              />\n              <ActionIcon type=\"submit\" radius=\"xl\" color=\"blue\" variant=\"filled\">\n                <IconMessage size={16} />\n              </ActionIcon>\n              <AttachmentButton\n                onUpload={createMedia}\n                onUploadStart={onUploadStart}\n                onUploadProgress={onUploadProgress}\n                onUploadError={onUploadError}\n              >\n                {(props) => (\n                  <ActionIcon {...props} radius=\"xl\" color=\"blue\" variant=\"filled\">\n                    <IconCloudUpload size={16} />\n                  </ActionIcon>\n                )}\n              </AttachmentButton>\n            </Group>\n          </Form>\n        </Panel>\n      )}\n      {items.map((item) => {\n        if (!item) {\n          // TODO: Handle null history items for deleted versions.\n          return null;\n        }\n        const key = `${item.resourceType}/${item.id}/${item.meta?.versionId}`;\n        if (item.resourceType === resource.resourceType && item.id === resource.id) {\n          return (\n            <HistoryTimelineItem key={key} history={history as Bundle} resource={item} onDetails={onVersionDetails} />\n          );\n        }\n        switch (item.resourceType) {\n          case 'AuditEvent':\n            return <AuditEventTimelineItem key={key} resource={item} onDetails={onDetails} />;\n          case 'Communication':\n            return (\n              <CommunicationTimelineItem\n                key={key}\n                resource={item}\n                onPin={item.priority !== 'stat' ? onPin : undefined}\n                onUnpin={item.priority === 'stat' ? onUnpin : undefined}\n                onDetails={onDetails}\n                onEdit={onEdit}\n                onDelete={onDelete}\n              />\n            );\n          case 'DiagnosticReport':\n            return (\n              <DiagnosticReportTimelineItem\n                key={key}\n                resource={item}\n                onDetails={onDetails}\n                onEdit={onEdit}\n                onDelete={onDelete}\n              />\n            );\n          case 'Media':\n            return (\n              <MediaTimelineItem key={key} resource={item} onDetails={onDetails} onEdit={onEdit} onDelete={onDelete} />\n            );\n          default:\n            return (\n              <TimelineItem key={key} resource={item} padding={true}>\n                <ResourceTable value={item} ignoreMissingValues={true} />\n              </TimelineItem>\n            );\n        }\n      })}\n    </Timeline>\n  );\n}\n\ninterface BaseTimelineItemProps<T extends Resource> {\n  readonly resource: T;\n  readonly onPin?: (resource: T) => void;\n  readonly onUnpin?: (resource: T) => void;\n  readonly onDetails?: (resource: T) => void;\n  readonly onEdit?: (resource: T) => void;\n  readonly onDelete?: (resource: T) => void;\n}\n\nfunction TimelineItemPopupMenu<T extends Resource>(props: BaseTimelineItemProps<T>): JSX.Element {\n  return (\n    <Menu.Dropdown>\n      <Menu.Label>Resource</Menu.Label>\n      {props.onPin && (\n        <Menu.Item\n          leftSection={<IconPin size={14} />}\n          onClick={() => (props.onPin as (resource: T) => void)(props.resource)}\n          aria-label={`Pin ${getReferenceString(props.resource)}`}\n        >\n          Pin\n        </Menu.Item>\n      )}\n      {props.onUnpin && (\n        <Menu.Item\n          leftSection={<IconPinnedOff size={14} />}\n          onClick={() => (props.onUnpin as (resource: T) => void)(props.resource)}\n          aria-label={`Unpin ${getReferenceString(props.resource)}`}\n        >\n          Unpin\n        </Menu.Item>\n      )}\n      {props.onDetails && (\n        <Menu.Item\n          leftSection={<IconListDetails size={14} />}\n          onClick={() => (props.onDetails as (resource: T) => void)(props.resource)}\n          aria-label={`Details ${getReferenceString(props.resource)}`}\n        >\n          Details\n        </Menu.Item>\n      )}\n      {props.onEdit && (\n        <Menu.Item\n          leftSection={<IconEdit size={14} />}\n          onClick={() => (props.onEdit as (resource: T) => void)(props.resource)}\n          aria-label={`Edit ${getReferenceString(props.resource)}`}\n        >\n          Edit\n        </Menu.Item>\n      )}\n      {props.onDelete && (\n        <>\n          <Menu.Divider />\n          <Menu.Label>Danger zone</Menu.Label>\n          <Menu.Item\n            color=\"red\"\n            leftSection={<IconTrash size={14} />}\n            onClick={() => (props.onDelete as (resource: T) => void)(props.resource)}\n            aria-label={`Delete ${getReferenceString(props.resource)}`}\n          >\n            Delete\n          </Menu.Item>\n        </>\n      )}\n    </Menu.Dropdown>\n  );\n}\n\ninterface HistoryTimelineItemProps extends BaseTimelineItemProps<Resource> {\n  readonly history: Bundle;\n}\n\nfunction HistoryTimelineItem(props: HistoryTimelineItemProps): JSX.Element {\n  const previous = getPrevious(props.history, props.resource);\n  if (previous) {\n    return (\n      <TimelineItem resource={props.resource} padding={true} popupMenuItems={<TimelineItemPopupMenu {...props} />}>\n        <ResourceDiffTable original={previous} revised={props.resource} />\n      </TimelineItem>\n    );\n  } else {\n    return (\n      <TimelineItem resource={props.resource} padding={true} popupMenuItems={<TimelineItemPopupMenu {...props} />}>\n        <h3>Created</h3>\n        <ResourceTable value={props.resource} ignoreMissingValues forceUseInput />\n      </TimelineItem>\n    );\n  }\n}\n\nfunction getPrevious(history: Bundle, version: Resource): Resource | undefined {\n  const entries = history.entry as BundleEntry[];\n  const index = entries.findIndex((entry) => entry.resource?.meta?.versionId === version.meta?.versionId);\n  if (index >= entries.length - 1) {\n    return undefined;\n  }\n  return entries[index + 1].resource;\n}\n\nfunction CommunicationTimelineItem(props: BaseTimelineItemProps<Communication>): JSX.Element {\n  const routine = !props.resource.priority || props.resource.priority === 'routine';\n  const className = routine ? undefined : classes.pinnedComment;\n  return (\n    <TimelineItem\n      resource={props.resource}\n      profile={props.resource.sender}\n      dateTime={props.resource.sent}\n      padding={true}\n      className={className}\n      popupMenuItems={<TimelineItemPopupMenu {...props} />}\n    >\n      <p>{props.resource.payload?.[0]?.contentString}</p>\n    </TimelineItem>\n  );\n}\n\nfunction MediaTimelineItem(props: BaseTimelineItemProps<Media>): JSX.Element {\n  const contentType = props.resource.content?.contentType;\n  const padding =\n    contentType &&\n    !contentType.startsWith('image/') &&\n    !contentType.startsWith('video/') &&\n    contentType !== 'application/pdf';\n  return (\n    <TimelineItem resource={props.resource} padding={!!padding} popupMenuItems={<TimelineItemPopupMenu {...props} />}>\n      <AttachmentDisplay value={props.resource.content} />\n    </TimelineItem>\n  );\n}\n\nfunction AuditEventTimelineItem(props: BaseTimelineItemProps<AuditEvent>): JSX.Element {\n  return (\n    <TimelineItem resource={props.resource} padding={true} popupMenuItems={<TimelineItemPopupMenu {...props} />}>\n      <ScrollArea>\n        <pre>{props.resource.outcomeDesc}</pre>\n      </ScrollArea>\n    </TimelineItem>\n  );\n}\n\nfunction DiagnosticReportTimelineItem(props: BaseTimelineItemProps<DiagnosticReport>): JSX.Element {\n  return (\n    <TimelineItem resource={props.resource} padding={true} popupMenuItems={<TimelineItemPopupMenu {...props} />}>\n      <DiagnosticReportDisplay value={props.resource} />\n    </TimelineItem>\n  );\n}\n\nfunction getProgressMessage(e: ProgressEvent): string {\n  if (e.lengthComputable) {\n    const percent = (100 * e.loaded) / e.total;\n    return `Uploaded: ${formatFileSize(e.loaded)} / ${formatFileSize(e.total)} ${percent.toFixed(2)}%`;\n  }\n  return `Uploaded: ${formatFileSize(e.loaded)}`;\n}\n\nfunction formatFileSize(bytes: number): string {\n  if (bytes === 0) {\n    return '0.00 B';\n  }\n  const e = Math.floor(Math.log(bytes) / Math.log(1024));\n  return (bytes / Math.pow(1024, e)).toFixed(2) + ' ' + ' KMGTP'.charAt(e) + 'B';\n}\n", "import { Group, List, Stack, Text, Title } from '@mantine/core';\nimport { capitalize, formatCodeableConcept, formatDateTime, formatObservationValue, isReference } from '@medplum/core';\nimport {\n  Annotation,\n  DiagnosticReport,\n  Observation,\n  ObservationComponent,\n  ObservationReferenceRange,\n  Reference,\n  Specimen,\n} from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport cx from 'clsx';\nimport { useEffect, useState } from 'react';\nimport { CodeableConceptDisplay } from '../CodeableConceptDisplay/CodeableConceptDisplay';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\nimport { NoteDisplay } from '../NoteDisplay/NoteDisplay';\nimport { RangeDisplay } from '../RangeDisplay/RangeDisplay';\nimport { ReferenceDisplay } from '../ReferenceDisplay/ReferenceDisplay';\nimport { ResourceBadge } from '../ResourceBadge/ResourceBadge';\nimport { StatusBadge } from '../StatusBadge/StatusBadge';\nimport classes from './DiagnosticReportDisplay.module.css';\n\nexport interface DiagnosticReportDisplayProps {\n  readonly value?: DiagnosticReport | Reference<DiagnosticReport>;\n  readonly hideObservationNotes?: boolean;\n  readonly hideSpecimenInfo?: boolean;\n}\n\nDiagnosticReportDisplay.defaultProps = {\n  hideObservationNotes: false,\n  hideSpecimenInfo: false,\n} as DiagnosticReportDisplayProps;\n\nexport function DiagnosticReportDisplay(props: DiagnosticReportDisplayProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const diagnosticReport = useResource(props.value);\n  const [specimens, setSpecimens] = useState<Specimen[]>();\n\n  useEffect(() => {\n    if (diagnosticReport?.specimen) {\n      Promise.allSettled(diagnosticReport.specimen.map((ref) => medplum.readReference(ref)))\n        .then((outcomes) =>\n          outcomes\n            .filter((outcome) => outcome.status === 'fulfilled')\n            .map((outcome) => (outcome as PromiseFulfilledResult<Specimen>).value)\n        )\n        .then(setSpecimens)\n        .catch(console.error);\n    }\n  }, [medplum, diagnosticReport]);\n\n  if (!diagnosticReport) {\n    return null;\n  }\n\n  const specimenNotes: Annotation[] = specimens?.flatMap((spec) => spec.note || []) || [];\n\n  if (diagnosticReport.presentedForm && diagnosticReport.presentedForm.length > 0) {\n    const pf = diagnosticReport.presentedForm[0];\n    if (pf.contentType?.startsWith('text/plain') && pf.data) {\n      specimenNotes.push({ text: window.atob(pf.data) });\n    }\n  }\n\n  return (\n    <Stack>\n      <Title>Diagnostic Report</Title>\n      <DiagnosticReportHeader value={diagnosticReport} />\n      {specimens && !props.hideSpecimenInfo && SpecimenInfo(specimens)}\n      {diagnosticReport.result && (\n        <ObservationTable hideObservationNotes={props.hideObservationNotes} value={diagnosticReport.result} />\n      )}\n      {specimenNotes.length > 0 && <NoteDisplay value={specimenNotes} />}\n    </Stack>\n  );\n}\n\ninterface DiagnosticReportHeaderProps {\n  readonly value: DiagnosticReport;\n}\n\nfunction DiagnosticReportHeader({ value }: DiagnosticReportHeaderProps): JSX.Element {\n  return (\n    <Group mt=\"md\" gap={30}>\n      {value.subject && (\n        <div>\n          <Text size=\"xs\" tt=\"uppercase\" c=\"dimmed\">\n            Subject\n          </Text>\n          <ResourceBadge value={value.subject} link={true} />\n        </div>\n      )}\n      {value.resultsInterpreter?.map((interpreter) => (\n        <div key={interpreter.reference}>\n          <Text size=\"xs\" tt=\"uppercase\" c=\"dimmed\">\n            Interpreter\n          </Text>\n          <ResourceBadge value={interpreter} link={true} />\n        </div>\n      ))}\n      {value.performer?.map((performer) => (\n        <div key={performer.reference}>\n          <Text size=\"xs\" tt=\"uppercase\" c=\"dimmed\">\n            Performer\n          </Text>\n          <ResourceBadge value={performer} link={true} />\n        </div>\n      ))}\n      {value.issued && (\n        <div>\n          <Text size=\"xs\" tt=\"uppercase\" c=\"dimmed\">\n            Issued\n          </Text>\n          <Text>{formatDateTime(value.issued)}</Text>\n        </div>\n      )}\n      {value.status && (\n        <div>\n          <Text size=\"xs\" tt=\"uppercase\" c=\"dimmed\">\n            Status\n          </Text>\n          <Text>{capitalize(value.status)}</Text>\n        </div>\n      )}\n    </Group>\n  );\n}\n\nfunction SpecimenInfo(specimens: Specimen[] | undefined): JSX.Element {\n  return (\n    <Stack gap=\"xs\">\n      <Title order={2} size=\"h6\">\n        Specimens\n      </Title>\n\n      <List type=\"ordered\">\n        {specimens?.map((specimen) => (\n          <List.Item ml=\"sm\" key={`specimen-${specimen.id}`}>\n            <Group gap={20}>\n              <Group gap={5}>\n                <Text fw={500}>Collected:</Text> {formatDateTime(specimen.collection?.collectedDateTime)}\n              </Group>\n              <Group gap={5}>\n                <Text fw={500}>Received:</Text> {formatDateTime(specimen.receivedTime)}\n              </Group>\n            </Group>\n          </List.Item>\n        ))}\n      </List>\n    </Stack>\n  );\n}\n\nexport interface ObservationTableProps {\n  readonly value?: Observation[] | Reference<Observation>[];\n  readonly ancestorIds?: string[];\n  readonly hideObservationNotes?: boolean;\n}\n\nexport function ObservationTable(props: ObservationTableProps): JSX.Element {\n  return (\n    <table className={classes.table}>\n      <thead>\n        <tr>\n          <th>Test</th>\n          <th>Value</th>\n          <th>Reference Range</th>\n          <th>Interpretation</th>\n          <th>Category</th>\n          <th>Performer</th>\n          <th>Status</th>\n        </tr>\n      </thead>\n      <tbody>\n        <ObservationRowGroup\n          value={props.value}\n          ancestorIds={props.ancestorIds}\n          hideObservationNotes={props.hideObservationNotes}\n        />\n      </tbody>\n    </table>\n  );\n}\n\ninterface ObservationRowGroupProps {\n  readonly value?: Observation[] | Reference<Observation>[];\n  readonly ancestorIds?: string[];\n  readonly hideObservationNotes?: boolean;\n}\n\nfunction ObservationRowGroup(props: ObservationRowGroupProps): JSX.Element {\n  return (\n    <>\n      {props.value?.map((observation) => (\n        <ObservationRow\n          key={`obs-${isReference(observation) ? observation.reference : observation.id}`}\n          value={observation}\n          ancestorIds={props.ancestorIds}\n          hideObservationNotes={props.hideObservationNotes}\n        />\n      ))}\n    </>\n  );\n}\n\ninterface ObservationRowProps {\n  readonly value: Observation | Reference<Observation>;\n  readonly ancestorIds?: string[];\n  readonly hideObservationNotes?: boolean;\n}\n\nfunction ObservationRow(props: ObservationRowProps): JSX.Element | null {\n  const observation = useResource(props.value);\n\n  if (!observation || props.ancestorIds?.includes(observation.id as string)) {\n    return null;\n  }\n\n  const displayNotes = !props.hideObservationNotes && observation.note;\n\n  const critical = isCritical(observation);\n\n  return (\n    <>\n      <tr className={cx({ [classes.criticalRow]: critical })}>\n        <td rowSpan={displayNotes ? 2 : 1}>\n          <MedplumLink to={observation}>\n            <CodeableConceptDisplay value={observation.code} />\n          </MedplumLink>\n        </td>\n        <td>\n          <ObservationValueDisplay value={observation} />\n        </td>\n        <td>\n          <ReferenceRangeDisplay value={observation.referenceRange} />\n        </td>\n        <td>\n          {observation.interpretation && observation.interpretation.length > 0 && (\n            <CodeableConceptDisplay value={observation.interpretation[0]} />\n          )}\n        </td>\n        <td>\n          {observation.category && observation.category.length > 0 && (\n            <>\n              {observation.category.map((concept) => (\n                <div key={`category-${formatCodeableConcept(concept)}`}>\n                  <CodeableConceptDisplay value={concept} />\n                </div>\n              ))}\n            </>\n          )}\n        </td>\n        <td>\n          {observation.performer?.map((performer) => <ReferenceDisplay key={performer.reference} value={performer} />)}\n        </td>\n        <td>{observation.status && <StatusBadge status={observation.status} />}</td>\n      </tr>\n      {observation.hasMember && (\n        <ObservationRowGroup\n          value={observation.hasMember as Reference<Observation>[]}\n          ancestorIds={\n            props.ancestorIds ? [...props.ancestorIds, observation.id as string] : [observation.id as string]\n          }\n          hideObservationNotes={props.hideObservationNotes}\n        />\n      )}\n      {displayNotes && (\n        <tr>\n          <td colSpan={6}>\n            <NoteDisplay value={observation.note} />\n          </td>\n        </tr>\n      )}\n    </>\n  );\n}\n\ninterface ObservationValueDisplayProps {\n  readonly value?: Observation | ObservationComponent;\n}\n\nfunction ObservationValueDisplay(props: ObservationValueDisplayProps): JSX.Element | null {\n  const obs = props.value;\n  return <>{formatObservationValue(obs)}</>;\n}\n\ninterface ReferenceRangeProps {\n  readonly value?: ObservationReferenceRange[];\n}\n\nfunction ReferenceRangeDisplay(props: ReferenceRangeProps): JSX.Element | null {\n  const range = props.value && props.value.length > 0 && props.value[0];\n  if (!range) {\n    return null;\n  }\n  if (range.text) {\n    return <>{range.text}</>;\n  }\n  return <RangeDisplay value={range} />;\n}\n\n/**\n * Returns true if the observation is critical.\n * See: https://www.hl7.org/fhir/valueset-observation-interpretation.html\n * @param observation - The FHIR observation.\n * @returns True if the FHIR observation is a critical value.\n */\nfunction isCritical(observation: Observation): boolean {\n  const code = observation.interpretation?.[0]?.coding?.[0]?.code;\n  return code === 'AA' || code === 'LL' || code === 'HH' || code === 'A';\n}\n", "import { Blockquote, Stack } from '@mantine/core';\nimport { Annotation } from '@medplum/fhirtypes';\nimport classes from './NoteDisplay.module.css';\n\nexport interface NoteDisplayProps {\n  readonly value?: Annotation[];\n}\n\nexport function NoteDisplay({ value }: NoteDisplayProps): JSX.Element | null {\n  if (!value) {\n    return null;\n  }\n\n  return (\n    <Stack justify=\"flex-start\" gap=\"xs\">\n      {value.map(\n        (note) =>\n          note.text && (\n            <Blockquote\n              key={`note-${note.text}`}\n              classNames={{ cite: classes.noteCite, root: classes.noteRoot }}\n              cite={note.authorReference?.display || note.authorString}\n              icon={null}\n            >\n              {note.text}\n            </Blockquote>\n          )\n      )}\n    </Stack>\n  );\n}\n", ".noteBody {\n  font-size: var(--mantine-font-size-sm);\n}\n\n.noteCite {\n  font-size: var(--mantine-font-size-xs);\n  margin-block-start: 3;\n}\n\n.noteRoot {\n  padding: 5px;\n}\n", "import { Group } from '@mantine/core';\nimport { Reference, Resource } from '@medplum/fhirtypes';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\nimport { ResourceName } from '../ResourceName/ResourceName';\n\nexport interface ResourceBadgeProps {\n  readonly value?: Reference | Resource;\n  readonly link?: boolean;\n}\n\nexport function ResourceBadge(props: ResourceBadgeProps): JSX.Element {\n  return (\n    <Group gap=\"xs\">\n      <ResourceAvatar size={24} radius={12} value={props.value} link={props.link} />\n      <ResourceName value={props.value} link={props.link} />\n    </Group>\n  );\n}\n", "import { Text, TextProps } from '@mantine/core';\nimport { getDisplayString, isOk, normalizeErrorString } from '@medplum/core';\nimport { OperationOutcome, Reference, Resource } from '@medplum/fhirtypes';\nimport { useResource } from '@medplum/react-hooks';\nimport { useState } from 'react';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\n\nexport interface ResourceNameProps extends TextProps {\n  readonly value?: Reference | Resource;\n  readonly link?: boolean;\n}\n\nexport function ResourceName(props: ResourceNameProps): JSX.Element | null {\n  const { value, link, ...rest } = props;\n  const [outcome, setOutcome] = useState<OperationOutcome | undefined>();\n  const resource = useResource(value, setOutcome);\n  let text: string;\n\n  if (outcome && !isOk(outcome)) {\n    text = `[${normalizeErrorString(outcome)}]`;\n  } else if (resource) {\n    text = getDisplayString(resource);\n  } else {\n    return null;\n  }\n\n  return link ? (\n    <MedplumLink to={value} {...rest}>\n      {text}\n    </MedplumLink>\n  ) : (\n    <Text component=\"span\" {...rest}>\n      {text}\n    </Text>\n  );\n}\n", "import { Badge, DefaultMantineColor } from '@mantine/core';\n\n/*\n * Request status: https://hl7.org/fhir/valueset-request-status.html\n * draft, active, on-hold, revoked, completed, entered-in-error, unknown\n *\n * Publication status: https://hl7.org/fhir/valueset-publication-status.html\n * draft, active, retired, unknown\n *\n * Observation status: https://www.hl7.org/fhir/valueset-observation-status.html\n * registered, preliminary, final, amended,  corrected, cancelled, entered-in-error, unknown\n *\n * DiagnosticReport status: https://hl7.org/fhir/valueset-diagnostic-report-status.html\n * registered, preliminary, final, amended, corrected, appended, cancelled, entered-in-error, unknown\n *\n * Task status: https://hl7.org/fhir/valueset-task-status.html\n * draft, requested, received, accepted, rejected, ready, cancelled, in-progress, on-hold, failed, completed, entered-in-error\n *\n * Appointment status: https://www.hl7.org/fhir/valueset-appointmentstatus.html\n * proposed, pending, booked, arrived, fulfilled, cancelled, noshow, entered-in-error, chcked-in, waitlist\n *\n * Immunization status: https://hl7.org/fhir/r4/valueset-immunization-status.html\n * completed, entered-in-error, not-done\n */\n\nconst statusToColor: Record<string, DefaultMantineColor> = {\n  draft: 'blue',\n  active: 'blue',\n  'on-hold': 'yellow',\n  revoked: 'red',\n  completed: 'green',\n  'entered-in-error': 'red',\n  unknown: 'gray',\n  retired: 'gray',\n  registered: 'blue',\n  preliminary: 'blue',\n  final: 'green',\n  amended: 'yellow',\n  corrected: 'yellow',\n  cancelled: 'red',\n  requested: 'blue',\n  received: 'blue',\n  accepted: 'blue',\n  rejected: 'red',\n  ready: 'blue',\n  'in-progress': 'blue',\n  failed: 'red',\n  proposed: 'blue',\n  pending: 'blue',\n  booked: 'blue',\n  arrived: 'blue',\n  fulfilled: 'green',\n  noshow: 'red',\n  'checked-in': 'blue',\n  waitlist: 'gray',\n  routine: 'gray',\n  urgent: 'red',\n  asap: 'red',\n  stat: 'red',\n  'not-done': 'red',\n  connected: 'green',\n  disconnected: 'red',\n};\n\nexport interface StatusBadgeProps {\n  readonly status: string;\n}\n\nexport function StatusBadge(props: StatusBadgeProps): JSX.Element {\n  return <Badge color={statusToColor[props.status]}>{props.status}</Badge>;\n}\n", ".table {\n  border: 0.1px solid var(--mantine-color-gray-5);\n  border-collapse: collapse;\n\n  & td,\n  & th {\n    border: 0.1px solid var(--mantine-color-gray-5);\n    padding: 4px;\n  }\n}\n\n.criticalRow {\n  background: light-dark(var(--mantine-color-red-1), var(--mantine-color-red-7));\n  border: 0.1px solid var(--mantine-color-red-5);\n  color: var(--mantine-color-red-5);\n  font-weight: 500;\n\n  & td {\n    border: 0.1px solid var(--mantine-color-red-5);\n  }\n}\n\n.noteBody {\n  font-size: var(--mantine-font-size-sm);\n}\n\n.noteCite {\n  font-size: var(--mantine-font-size-xs);\n  margin-block-start: 3;\n}\n\n.noteRoot {\n  padding: 5px;\n}\n", "import { Paper, PaperProps } from '@mantine/core';\nimport cx from 'clsx';\nimport classes from './Panel.module.css';\n\nexport interface PanelProps extends PaperProps {\n  readonly width?: number;\n  readonly fill?: boolean;\n  readonly children?: React.ReactNode;\n}\n\nexport function Panel(props: PanelProps): JSX.Element {\n  const { width, fill, className, children, ...rest } = props;\n  const style = width ? { maxWidth: width } : undefined;\n  return (\n    <Paper\n      className={cx(classes.paper, fill && classes.fill, className)}\n      style={style}\n      shadow=\"sm\"\n      radius=\"sm\"\n      withBorder\n      {...rest}\n    >\n      {children}\n    </Paper>\n  );\n}\n", ".paper {\n  margin: var(--mantine-spacing-xl) auto;\n  padding: var(--mantine-spacing-md);\n\n  @media (max-width: 800px) {\n    padding: 8px;\n  }\n\n  & img {\n    width: 100%;\n    max-width: 100%;\n  }\n\n  & video {\n    width: 100%;\n    max-width: 100%;\n  }\n}\n\n.fill {\n  padding: 0;\n}\n", "import { Table } from '@mantine/core';\nimport {\n  InternalSchemaElement,\n  TypedValue,\n  arrayify,\n  capitalize,\n  evalFhirPathTyped,\n  getSearchParameterDetails,\n  toTypedValue,\n} from '@medplum/core';\nimport { Resource, SearchParameter } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useEffect, useMemo, useState } from 'react';\nimport { Operation, createPatch } from 'rfc6902';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport classes from './ResourceDiffTable.module.css';\n\nexport interface ResourceDiffTableProps {\n  readonly original: Resource;\n  readonly revised: Resource;\n}\n\nexport function ResourceDiffTable(props: ResourceDiffTableProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const { original, revised } = props;\n  const [schemaLoaded, setSchemaLoaded] = useState(false);\n\n  useEffect(() => {\n    medplum\n      .requestSchema(props.original.resourceType)\n      .then(() => setSchemaLoaded(true))\n      .catch(console.log);\n  }, [medplum, props.original.resourceType]);\n\n  const diffTable = useMemo(() => {\n    if (!schemaLoaded) {\n      return null;\n    }\n\n    const typedOriginal = [toTypedValue(original)];\n    const typedRevised = [toTypedValue(revised)];\n    const result = [];\n\n    // First, we filter and consolidate the patch operations\n    // We can do this because we do not use the \"value\" field in the patch operations\n    // Remove patch operations on meta elements such as \"meta.lastUpdated\" and \"meta.versionId\"\n    // Consolidate patch operations on arrays\n    const patch = mergePatchOperations(createPatch(original, revised));\n\n    // Next, convert the patch operations to a diff table\n    for (const op of patch) {\n      const path = op.path;\n      const fhirPath = jsonPathToFhirPath(path);\n      const property = tryGetElementDefinition(original.resourceType, fhirPath);\n      const originalValue = op.op === 'add' ? undefined : evalFhirPathTyped(fhirPath, typedOriginal);\n      const revisedValue = op.op === 'remove' ? undefined : evalFhirPathTyped(fhirPath, typedRevised);\n      result.push({\n        key: `op-${op.op}-${op.path}`,\n        name: `${capitalize(op.op)} ${fhirPath}`,\n        path: property?.path ?? original.resourceType + '.' + fhirPath,\n        property: property,\n        originalValue: touchUpValue(property, originalValue),\n        revisedValue: touchUpValue(property, revisedValue),\n      });\n    }\n\n    return result;\n  }, [schemaLoaded, original, revised]);\n\n  if (!diffTable) {\n    return null;\n  }\n\n  return (\n    <Table className={classes.root}>\n      <Table.Thead>\n        <Table.Tr>\n          <Table.Th />\n          <Table.Th>Before</Table.Th>\n          <Table.Th>After</Table.Th>\n        </Table.Tr>\n      </Table.Thead>\n      <Table.Tbody>\n        {diffTable.map((row) => (\n          <Table.Tr key={row.key}>\n            <Table.Td>{row.name}</Table.Td>\n            <Table.Td className={classes.removed}>\n              {row.originalValue && (\n                <ResourcePropertyDisplay\n                  path={row.path}\n                  property={row.property}\n                  propertyType={row.originalValue.type}\n                  value={row.originalValue.value}\n                  ignoreMissingValues={true}\n                />\n              )}\n            </Table.Td>\n            <Table.Td className={classes.added}>\n              {row.revisedValue && (\n                <ResourcePropertyDisplay\n                  path={row.path}\n                  property={row.property}\n                  propertyType={row.revisedValue.type}\n                  value={row.revisedValue.value}\n                  ignoreMissingValues={true}\n                />\n              )}\n            </Table.Td>\n          </Table.Tr>\n        ))}\n      </Table.Tbody>\n    </Table>\n  );\n}\n\nfunction mergePatchOperations(patch: Operation[]): Operation[] {\n  const result: Operation[] = [];\n  for (const patchOperation of patch) {\n    const { op, path } = patchOperation;\n    if (\n      path.startsWith('/meta/author') ||\n      path.startsWith('/meta/compartment') ||\n      path.startsWith('/meta/lastUpdated') ||\n      path.startsWith('/meta/versionId')\n    ) {\n      continue;\n    }\n    const count = patch.filter((el) => el.op === op && el.path === path).length;\n    const resultOperation = { op, path } as Operation;\n    if (count > 1 && (op === 'add' || op === 'remove') && /\\/[0-9-]+$/.test(path)) {\n      // Remove everything after the last slash\n      resultOperation.op = 'replace';\n      resultOperation.path = path.replace(/\\/[^/]+$/, '');\n    }\n    if (!result.some((el) => el.op === resultOperation.op && el.path === resultOperation.path)) {\n      // Only add the operation if it doesn't already exist\n      result.push(resultOperation);\n    }\n  }\n  return result;\n}\n\nfunction jsonPathToFhirPath(path: string): string {\n  const parts = path.split('/').filter(Boolean);\n  let result = '';\n  for (let i = 0; i < parts.length; i++) {\n    const part = parts[i];\n    if (part === '-') {\n      result += '.last()';\n    } else if (/^\\d+$/.test(part)) {\n      result += `[${part}]`;\n    } else {\n      if (i > 0) {\n        result += '.';\n      }\n      result += part;\n    }\n  }\n\n  // For attachments, remove the .url suffix\n  // Note that not all \".url\" properties are attachments, but it is the common case.\n  // If the property is not an attachment, the diff will simply render the parent element,\n  // which is still fine.\n  if (result.endsWith('.url')) {\n    result = result.replace(/\\.url$/, '');\n  }\n\n  return result;\n}\n\nfunction tryGetElementDefinition(resourceType: string, fhirPath: string): InternalSchemaElement | undefined {\n  const details = getSearchParameterDetails(resourceType, {\n    resourceType: 'SearchParameter',\n    base: [resourceType],\n    code: resourceType + '.' + fhirPath,\n    expression: resourceType + '.' + fhirPath,\n  } as SearchParameter);\n  return details?.elementDefinitions?.[0];\n}\n\nfunction touchUpValue(\n  property: InternalSchemaElement | undefined,\n  input: TypedValue[] | TypedValue | undefined\n): TypedValue | undefined {\n  if (!input) {\n    return input;\n  }\n  return {\n    type: Array.isArray(input) ? input[0].type : input.type,\n    value: fixArray(input, !!property?.isArray),\n  };\n}\n\nfunction fixArray(input: TypedValue[] | TypedValue, isArray: boolean): any {\n  const inputValue = (arrayify(input) as TypedValue[]).flatMap((v) => v.value);\n  return isArray ? inputValue : inputValue[0];\n}\n", ".root {\n  border-collapse: collapse;\n  width: 100%;\n\n  & tr {\n    border-top: 0.1px solid var(--mantine-color-gray-3);\n  }\n\n  & th,\n  & td {\n    padding: var(--mantine-spacing-sm) var(--mantine-spacing-sm);\n    vertical-align: top;\n  }\n}\n\n.removed {\n  color: var(--mantine-color-red-7);\n  text-decoration: line-through;\n}\n\n.added {\n  color: var(--mantine-color-green-7);\n}\n", "import { Reference, Resource } from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport { useEffect, useState } from 'react';\nimport { BackboneElementDisplay } from '../BackboneElementDisplay/BackboneElementDisplay';\nimport { tryGetProfile } from '@medplum/core';\n\nexport interface ResourceTableProps {\n  /**\n   * The input value either as a resource or a reference.\n   */\n  readonly value: Resource | Reference;\n\n  /**\n   * Optional flag to ignore missing values.\n   * By default, missing values are displayed as empty strings.\n   */\n  readonly ignoreMissingValues?: boolean;\n\n  /**\n   * Optional flag to force use the input value.\n   * This is useful when you want to display a specific version of the resource,\n   * and not use the latest version.\n   */\n  readonly forceUseInput?: boolean;\n\n  /** (optional) URL of the resource profile used to display the form. */\n  readonly profileUrl?: string;\n}\n\nexport function ResourceTable(props: ResourceTableProps): JSX.Element | null {\n  const { profileUrl } = props;\n  const medplum = useMedplum();\n  const value = useResource(props.value);\n  const [schemaLoaded, setSchemaLoaded] = useState<string>();\n\n  useEffect(() => {\n    if (!value) {\n      return;\n    }\n\n    if (profileUrl) {\n      medplum\n        .requestProfileSchema(profileUrl, { expandProfile: true })\n        .then(() => {\n          const profile = tryGetProfile(profileUrl);\n          if (profile) {\n            setSchemaLoaded(profile.name);\n          } else {\n            console.error(`Schema not found for ${profileUrl}`);\n          }\n        })\n        .catch((reason) => {\n          console.error('Error in requestProfileSchema', reason);\n        });\n    } else {\n      const schemaName = value.resourceType;\n      medplum\n        .requestSchema(schemaName)\n        .then(() => {\n          setSchemaLoaded(schemaName);\n        })\n        .catch(console.error);\n    }\n  }, [medplum, profileUrl, value]);\n\n  if (!schemaLoaded || !value) {\n    return null;\n  }\n\n  return (\n    <BackboneElementDisplay\n      path={value.resourceType}\n      value={{\n        type: schemaLoaded,\n        value: props.forceUseInput ? props.value : value,\n      }}\n      profileUrl={profileUrl}\n      ignoreMissingValues={props.ignoreMissingValues}\n    />\n  );\n}\n", "import { ActionIcon, Group, Menu, Text } from '@mantine/core';\nimport { formatDateTime, getReferenceString } from '@medplum/core';\nimport { Reference, Resource } from '@medplum/fhirtypes';\nimport { IconDots } from '@tabler/icons-react';\nimport { ReactNode } from 'react';\nimport { Container } from '../Container/Container';\nimport { ErrorBoundary } from '../ErrorBoundary/ErrorBoundary';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\nimport { Panel, PanelProps } from '../Panel/Panel';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\nimport { ResourceName } from '../ResourceName/ResourceName';\n\nexport interface TimelineProps {\n  readonly children?: ReactNode;\n}\n\nexport function Timeline(props: TimelineProps): JSX.Element {\n  return <Container>{props.children}</Container>;\n}\n\nexport interface TimelineItemProps extends PanelProps {\n  readonly resource: Resource;\n  readonly profile?: Reference;\n  readonly dateTime?: string;\n  readonly padding?: boolean;\n  readonly popupMenuItems?: ReactNode;\n}\n\nexport function TimelineItem(props: TimelineItemProps): JSX.Element {\n  const { resource, profile, padding, popupMenuItems, ...others } = props;\n  const author = profile ?? resource.meta?.author;\n  const dateTime = props.dateTime ?? resource.meta?.lastUpdated;\n\n  return (\n    <Panel data-testid=\"timeline-item\" fill={true} {...others}>\n      <Group justify=\"space-between\" gap={8} mx=\"xs\" my=\"sm\">\n        <ResourceAvatar value={author} link={true} size=\"md\" />\n        <div style={{ flex: 1 }}>\n          <Text size=\"sm\">\n            <ResourceName c=\"dark\" fw={500} value={author} link={true} />\n          </Text>\n          <Text size=\"xs\">\n            <MedplumLink c=\"dimmed\" to={props.resource}>\n              {formatDateTime(dateTime)}\n            </MedplumLink>\n            <Text component=\"span\" c=\"dimmed\" mx={8}>\n              &middot;\n            </Text>\n            <MedplumLink c=\"dimmed\" to={props.resource}>\n              {props.resource.resourceType}\n            </MedplumLink>\n          </Text>\n        </div>\n        {popupMenuItems && (\n          <Menu position=\"bottom-end\" shadow=\"md\" width={200}>\n            <Menu.Target>\n              <ActionIcon\n                color=\"gray\"\n                variant=\"subtle\"\n                radius=\"xl\"\n                aria-label={`Actions for ${getReferenceString(props.resource)}`}\n              >\n                <IconDots />\n              </ActionIcon>\n            </Menu.Target>\n            {popupMenuItems}\n          </Menu>\n        )}\n      </Group>\n      <ErrorBoundary>\n        {padding && <div style={{ padding: '0 16px 16px 16px' }}>{props.children}</div>}\n        {!padding && <>{props.children}</>}\n      </ErrorBoundary>\n    </Panel>\n  );\n}\n", "import { Resource } from '@medplum/fhirtypes';\n\n/**\n * Sorts an array of resources in place by meta.lastUpdated ascending.\n * @param resources - Array of resources.\n * @param timelineResource - Optional primary resource of a timeline view. If specified, the primary resource will be sorted by meta.lastUpdated descending.\n */\nexport function sortByDateAndPriority(resources: Resource[], timelineResource?: Resource): void {\n  resources.sort((a: Resource, b: Resource): number => {\n    const priority1 = getPriorityScore(a, timelineResource);\n    const priority2 = getPriorityScore(b, timelineResource);\n    if (priority1 > priority2) {\n      return 1;\n    }\n    if (priority1 < priority2) {\n      return -1;\n    }\n    return getTime(a, timelineResource) - getTime(b, timelineResource);\n  });\n}\n\nfunction getPriorityScore(resource: Resource, timelineResource: Resource | undefined): number {\n  if (!isSameResourceType(resource, timelineResource)) {\n    // Only use priority if not the primary resource of a timeline view.\n\n    const priority = (resource as any).priority;\n    if (typeof priority === 'string') {\n      return { stat: 4, asap: 3, urgent: 2 }[priority] ?? 0;\n    }\n  }\n  return 0;\n}\n\nfunction getTime(resource: Resource, timelineResource: Resource | undefined): number {\n  if (!isSameResourceType(resource, timelineResource)) {\n    // Only use special case timestamps if not the primary resource of a timeline view.\n\n    if (resource.resourceType === 'Communication' && resource.sent) {\n      return new Date(resource.sent).getTime();\n    }\n\n    if (\n      (resource.resourceType === 'DiagnosticReport' ||\n        resource.resourceType === 'Media' ||\n        resource.resourceType === 'Observation') &&\n      resource.issued\n    ) {\n      return new Date(resource.issued).getTime();\n    }\n\n    if (resource.resourceType === 'DocumentReference' && resource.date) {\n      return new Date(resource.date).getTime();\n    }\n  }\n\n  const dateTime = resource.meta?.lastUpdated;\n  if (!dateTime) {\n    return 0;\n  }\n  return new Date(dateTime).getTime();\n}\n\nfunction isSameResourceType(a: Resource, b: Resource | undefined): boolean {\n  return !!b && a.resourceType === b.resourceType && a.id === b.id;\n}\n", "\n.pinnedComment {\n  background-color: var(--mantine-color-blue-0);\n}", "import { MedplumClient } from '@medplum/core';\nimport { Reference, Resource, ResourceType } from '@medplum/fhirtypes';\nimport { ResourceTimeline } from '../ResourceTimeline/ResourceTimeline';\n\nexport interface DefaultResourceTimelineProps {\n  readonly resource: Resource | Reference;\n}\n\nexport function DefaultResourceTimeline(props: DefaultResourceTimelineProps): JSX.Element {\n  return (\n    <ResourceTimeline\n      value={props.resource}\n      loadTimelineResources={async (medplum: MedplumClient, resourceType: ResourceType, id: string) => {\n        const ref = `${resourceType}/${id}`;\n        const _count = 100;\n        return Promise.allSettled([\n          medplum.readHistory(resourceType, id),\n          medplum.search('Task', { _filter: `based-on eq ${ref} or focus eq ${ref} or subject eq ${ref}`, _count }),\n        ]);\n      }}\n    />\n  );\n}\n", "import { Container } from '../Container/Container';\nimport { Panel, PanelProps } from '../Panel/Panel';\n\nexport function Document(props: PanelProps): JSX.Element {\n  const { children, ...others } = props;\n  return (\n    <Container>\n      <Panel {...others}>{children}</Panel>\n    </Container>\n  );\n}\n", "import { createReference, MedplumClient, ProfileResource } from '@medplum/core';\nimport { Attachment, Encounter, Reference, ResourceType } from '@medplum/fhirtypes';\nimport { ResourceTimeline } from '../ResourceTimeline/ResourceTimeline';\n\nexport interface EncounterTimelineProps {\n  readonly encounter: Encounter | Reference<Encounter>;\n}\n\nexport function EncounterTimeline(props: EncounterTimelineProps): JSX.Element {\n  return (\n    <ResourceTimeline\n      value={props.encounter}\n      loadTimelineResources={async (medplum: MedplumClient, _resourceType: ResourceType, id: string) => {\n        return Promise.allSettled([\n          medplum.readHistory('Encounter', id),\n          medplum.search('Communication', 'encounter=Encounter/' + id),\n          medplum.search('Media', 'encounter=Encounter/' + id),\n        ]);\n      }}\n      createCommunication={(resource: Encounter, sender: ProfileResource, text: string) => ({\n        resourceType: 'Communication',\n        status: 'completed',\n        encounter: createReference(resource),\n        subject: resource.subject,\n        sender: createReference(sender),\n        sent: new Date().toISOString(),\n        payload: [{ contentString: text }],\n      })}\n      createMedia={(resource: Encounter, operator: ProfileResource, content: Attachment) => ({\n        resourceType: 'Media',\n        status: 'completed',\n        encounter: createReference(resource),\n        subject: resource.subject,\n        operator: createReference(operator),\n        issued: new Date().toISOString(),\n        content,\n      })}\n    />\n  );\n}\n", "import { Button, Loader, Table } from '@mantine/core';\nimport { normalizeOperationOutcome } from '@medplum/core';\nimport { OperationOutcome, Resource } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { ChangeEvent, MouseEvent, memo, useEffect, useRef, useState } from 'react';\nimport { FhirPathDisplay } from '../FhirPathDisplay/FhirPathDisplay';\nimport { SearchClickEvent } from '../SearchControl/SearchControl';\nimport { isCheckboxCell, killEvent } from '../utils/dom';\n\nexport interface FhirPathTableField {\n  readonly propertyType: string;\n  readonly name: string;\n  readonly fhirPath: string;\n}\n\nexport interface FhirPathTableProps {\n  readonly resourceType: string;\n  readonly query: string;\n  readonly fields: FhirPathTableField[];\n  readonly checkboxesEnabled?: boolean;\n  readonly onClick?: (e: SearchClickEvent) => void;\n  readonly onAuxClick?: (e: SearchClickEvent) => void;\n  readonly onBulk?: (ids: string[]) => void;\n}\n\nexport interface SmartSearchResponse {\n  readonly data: {\n    ResourceList: Resource[];\n  };\n}\n\n/**\n * The FhirPathTable component represents the embeddable search table control.\n * @param props - FhirPathTable React props.\n * @returns FhirPathTable React node.\n */\nexport function FhirPathTable(props: FhirPathTableProps): JSX.Element {\n  const medplum = useMedplum();\n  const [schemaLoaded, setSchemaLoaded] = useState(false);\n  const [outcome, setOutcome] = useState<OperationOutcome | undefined>();\n  const { query, fields } = props;\n  const [response, setResponse] = useState<SmartSearchResponse | undefined>();\n  const [selected, setSelected] = useState<{ [id: string]: boolean }>({});\n\n  const responseRef = useRef<SmartSearchResponse>();\n  responseRef.current = response;\n\n  const selectedRef = useRef<{ [id: string]: boolean }>({});\n  selectedRef.current = selected;\n\n  useEffect(() => {\n    setOutcome(undefined);\n    medplum\n      .graphql(query)\n      .then(setResponse)\n      .catch((err) => setOutcome(normalizeOperationOutcome(err)));\n  }, [medplum, query]);\n\n  function handleSingleCheckboxClick(e: ChangeEvent, id: string): void {\n    e.stopPropagation();\n\n    const el = e.target as HTMLInputElement;\n    const checked = el.checked;\n    const newSelected = { ...selectedRef.current };\n    if (checked) {\n      newSelected[id] = true;\n    } else {\n      delete newSelected[id];\n    }\n    setSelected(newSelected);\n  }\n\n  function handleAllCheckboxClick(e: ChangeEvent): void {\n    e.stopPropagation();\n\n    const el = e.target as HTMLInputElement;\n    const checked = el.checked;\n    const newSelected = {} as { [id: string]: boolean };\n    const resources = responseRef.current?.data.ResourceList;\n    if (checked && resources) {\n      resources.forEach((resource) => {\n        if (resource.id) {\n          newSelected[resource.id] = true;\n        }\n      });\n    }\n    setSelected(newSelected);\n  }\n\n  function isAllSelected(): boolean {\n    const resources = responseRef.current?.data.ResourceList;\n    if (!resources || resources.length === 0) {\n      return false;\n    }\n    for (const resource of resources) {\n      if (resource.id && !selectedRef.current[resource.id]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  function handleRowClick(e: MouseEvent, resource: Resource): void {\n    if (isCheckboxCell(e.target as Element)) {\n      // Ignore clicks on checkboxes\n      return;\n    }\n\n    killEvent(e);\n\n    if (e.button !== 1 && props.onClick) {\n      props.onClick(new SearchClickEvent(resource, e));\n    }\n\n    if (e.button === 1 && props.onAuxClick) {\n      props.onAuxClick(new SearchClickEvent(resource, e));\n    }\n  }\n\n  useEffect(() => {\n    medplum\n      .requestSchema(props.resourceType)\n      .then(() => setSchemaLoaded(true))\n      .catch(console.log);\n  }, [medplum, props.resourceType]);\n\n  if (!schemaLoaded) {\n    return <Loader />;\n  }\n\n  const checkboxColumn = props.checkboxesEnabled;\n\n  return (\n    <div onContextMenu={(e) => killEvent(e)} data-testid=\"search-control\">\n      <Table>\n        <Table.Thead>\n          <Table.Tr>\n            {checkboxColumn && (\n              <Table.Th>\n                <input\n                  type=\"checkbox\"\n                  value=\"checked\"\n                  aria-label=\"all-checkbox\"\n                  data-testid=\"all-checkbox\"\n                  checked={isAllSelected()}\n                  onChange={(e) => handleAllCheckboxClick(e)}\n                />\n              </Table.Th>\n            )}\n            {fields.map((field) => (\n              <Table.Th key={field.name}>{field.name}</Table.Th>\n            ))}\n          </Table.Tr>\n        </Table.Thead>\n        <Table.Tbody>\n          {response?.data.ResourceList.map(\n            (resource) =>\n              resource && (\n                <Table.Tr\n                  key={resource.id}\n                  data-testid=\"search-control-row\"\n                  onClick={(e) => handleRowClick(e, resource)}\n                  onAuxClick={(e) => handleRowClick(e, resource)}\n                >\n                  {checkboxColumn && (\n                    <Table.Td>\n                      <input\n                        type=\"checkbox\"\n                        value=\"checked\"\n                        data-testid=\"row-checkbox\"\n                        aria-label={`Checkbox for ${resource.id}`}\n                        checked={!!selected[resource.id as string]}\n                        onChange={(e) => handleSingleCheckboxClick(e, resource.id as string)}\n                      />\n                    </Table.Td>\n                  )}\n                  {fields.map((field) => {\n                    return (\n                      <Table.Td key={field.name}>\n                        <FhirPathDisplay propertyType={field.propertyType} path={field.fhirPath} resource={resource} />\n                      </Table.Td>\n                    );\n                  })}\n                </Table.Tr>\n              )\n          )}\n        </Table.Tbody>\n      </Table>\n      {response?.data.ResourceList.length === 0 && <div data-testid=\"empty-search\">No results</div>}\n      {outcome && (\n        <div data-testid=\"search-error\">\n          <pre style={{ textAlign: 'left' }}>{JSON.stringify(outcome, undefined, 2)}</pre>\n        </div>\n      )}\n      {props.onBulk && (\n        <Button onClick={() => (props.onBulk as (ids: string[]) => any)(Object.keys(selectedRef.current))}>\n          Bulk...\n        </Button>\n      )}\n    </div>\n  );\n}\n\nexport const MemoizedFhirPathTable = memo(FhirPathTable);\n", "import { evalFhirPath } from '@medplum/core';\nimport { Resource } from '@medplum/fhirtypes';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\n\nexport interface FhirPathDisplayProps {\n  readonly resource: Resource;\n  readonly path: string;\n  readonly propertyType: string;\n}\n\nexport function FhirPathDisplay(props: FhirPathDisplayProps): JSX.Element | null {\n  let value;\n\n  try {\n    value = evalFhirPath(props.path, props.resource);\n  } catch (err) {\n    console.warn('FhirPathDisplay:', err);\n    return null;\n  }\n\n  if (value.length > 1) {\n    throw new Error(\n      `Component \"path\" for \"FhirPathDisplay\" must resolve to a single element. \\\n       Received ${value.length} elements \\\n       [${JSON.stringify(value, null, 2)}]`\n    );\n  }\n  return <ResourcePropertyDisplay value={value[0] || ''} propertyType={props.propertyType} />;\n}\n", "import {\n  ActionIcon,\n  Button,\n  Center,\n  Group,\n  Loader,\n  Menu,\n  Pagination,\n  Table,\n  Text,\n  UnstyledButton,\n} from '@mantine/core';\nimport { DEFAULT_SEARCH_COUNT, Filter, SearchRequest, formatSearchQuery, isDataTypeLoaded } from '@medplum/core';\nimport { Bundle, OperationOutcome, Resource, ResourceType, SearchParameter } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport {\n  IconAdjustmentsHorizontal,\n  IconBoxMultiple,\n  IconColumns,\n  IconFilePlus,\n  IconFilter,\n  IconRefresh,\n  IconTableExport,\n  IconTrash,\n} from '@tabler/icons-react';\nimport { ChangeEvent, MouseEvent, memo, useCallback, useEffect, useRef, useState } from 'react';\nimport { Container } from '../Container/Container';\nimport { SearchExportDialog } from '../SearchExportDialog/SearchExportDialog';\nimport { SearchFieldEditor } from '../SearchFieldEditor/SearchFieldEditor';\nimport { SearchFilterEditor } from '../SearchFilterEditor/SearchFilterEditor';\nimport { SearchFilterValueDialog } from '../SearchFilterValueDialog/SearchFilterValueDialog';\nimport { SearchFilterValueDisplay } from '../SearchFilterValueDisplay/SearchFilterValueDisplay';\nimport { SearchPopupMenu } from '../SearchPopupMenu/SearchPopupMenu';\nimport { isCheckboxCell, killEvent } from '../utils/dom';\nimport classes from './SearchControl.module.css';\nimport { getFieldDefinitions } from './SearchControlField';\nimport { addFilter, buildFieldNameString, getOpString, renderValue, setPage } from './SearchUtils';\n\nexport class SearchChangeEvent extends Event {\n  readonly definition: SearchRequest;\n\n  constructor(definition: SearchRequest) {\n    super('change');\n    this.definition = definition;\n  }\n}\n\nexport class SearchLoadEvent extends Event {\n  readonly response: Bundle;\n\n  constructor(response: Bundle) {\n    super('load');\n    this.response = response;\n  }\n}\n\nexport class SearchClickEvent extends Event {\n  readonly resource: Resource;\n  readonly browserEvent: MouseEvent;\n\n  constructor(resource: Resource, browserEvent: MouseEvent) {\n    super('click');\n    this.resource = resource;\n    this.browserEvent = browserEvent;\n  }\n}\n\nexport interface SearchControlProps {\n  readonly search: SearchRequest;\n  readonly checkboxesEnabled?: boolean;\n  readonly hideToolbar?: boolean;\n  readonly hideFilters?: boolean;\n  readonly onLoad?: (e: SearchLoadEvent) => void;\n  readonly onChange?: (e: SearchChangeEvent) => void;\n  readonly onClick?: (e: SearchClickEvent) => void;\n  readonly onAuxClick?: (e: SearchClickEvent) => void;\n  readonly onNew?: () => void;\n  readonly onExport?: () => void;\n  readonly onExportCsv?: () => void;\n  readonly onExportTransactionBundle?: () => void;\n  readonly onDelete?: (ids: string[]) => void;\n  readonly onBulk?: (ids: string[]) => void;\n}\n\ninterface SearchControlState {\n  readonly searchResponse?: Bundle;\n  readonly selected: { [id: string]: boolean };\n  readonly fieldEditorVisible: boolean;\n  readonly filterEditorVisible: boolean;\n  readonly filterDialogVisible: boolean;\n  readonly exportDialogVisible: boolean;\n  readonly filterDialogFilter?: Filter;\n  readonly filterDialogSearchParam?: SearchParameter;\n}\n\n/**\n * The SearchControl component represents the embeddable search table control.\n * It includes the table, rows, headers, sorting, etc.\n * It does not include the field editor, filter editor, pagination buttons.\n * @param props - The SearchControl React props.\n * @returns The SearchControl React node.\n */\nexport function SearchControl(props: SearchControlProps): JSX.Element {\n  const medplum = useMedplum();\n  const [loadingSchema, setLoadingSchema] = useState<string>();\n  const [outcome, setOutcome] = useState<OperationOutcome | undefined>();\n  const { search, onLoad } = props;\n\n  const [state, setState] = useState<SearchControlState>({\n    selected: {},\n    fieldEditorVisible: false,\n    filterEditorVisible: false,\n    exportDialogVisible: false,\n    filterDialogVisible: false,\n  });\n\n  const stateRef = useRef<SearchControlState>(state);\n  stateRef.current = state;\n\n  const loadResults = useCallback(\n    (options?: RequestInit) => {\n      setOutcome(undefined);\n\n      medplum\n        .search(search.resourceType as ResourceType, formatSearchQuery({ ...search, fields: undefined }), options)\n        .then((response) => {\n          setState({ ...stateRef.current, searchResponse: response });\n          if (onLoad) {\n            onLoad(new SearchLoadEvent(response));\n          }\n        })\n        .catch((reason) => {\n          setState({ ...stateRef.current, searchResponse: undefined });\n          setOutcome(reason);\n        });\n    },\n    [medplum, search, onLoad]\n  );\n\n  const refreshResults = useCallback(() => {\n    setState({ ...stateRef.current, searchResponse: undefined });\n    loadResults({ cache: 'reload' });\n  }, [loadResults]);\n\n  useEffect(() => {\n    loadResults();\n  }, [loadResults]);\n\n  function handleSingleCheckboxClick(e: ChangeEvent, id: string): void {\n    e.stopPropagation();\n\n    const el = e.target as HTMLInputElement;\n    const checked = el.checked;\n    const newSelected = { ...stateRef.current.selected };\n    if (checked) {\n      newSelected[id] = true;\n    } else {\n      delete newSelected[id];\n    }\n    setState({ ...stateRef.current, selected: newSelected });\n  }\n\n  function handleAllCheckboxClick(e: ChangeEvent): void {\n    e.stopPropagation();\n\n    const el = e.target as HTMLInputElement;\n    const checked = el.checked;\n    const newSelected = {} as { [id: string]: boolean };\n    const searchResponse = stateRef.current.searchResponse;\n    if (checked && searchResponse?.entry) {\n      searchResponse.entry.forEach((entry) => {\n        if (entry.resource?.id) {\n          newSelected[entry.resource.id] = true;\n        }\n      });\n    }\n    setState({ ...stateRef.current, selected: newSelected });\n  }\n\n  function isAllSelected(): boolean {\n    const state = stateRef.current;\n    if (!state.searchResponse?.entry || state.searchResponse.entry.length === 0) {\n      return false;\n    }\n    for (const e of state.searchResponse.entry) {\n      if (e.resource?.id && !state.selected[e.resource.id]) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Emits a change event to the optional change listener.\n   * @param newSearch - The new search definition.\n   */\n  function emitSearchChange(newSearch: SearchRequest): void {\n    if (props.onChange) {\n      props.onChange(new SearchChangeEvent(newSearch));\n    }\n  }\n\n  /**\n   * Handles a click on a order row.\n   * @param e - The click event.\n   * @param resource - The FHIR resource.\n   */\n  function handleRowClick(e: MouseEvent, resource: Resource): void {\n    if (isCheckboxCell(e.target as Element)) {\n      // Ignore clicks on checkboxes\n      return;\n    }\n\n    if (e.button === 2) {\n      // Ignore right clicks\n      return;\n    }\n\n    killEvent(e);\n\n    const isAux = e.button === 1 || e.ctrlKey || e.metaKey;\n\n    if (!isAux && props.onClick) {\n      props.onClick(new SearchClickEvent(resource, e));\n    }\n\n    if (isAux && props.onAuxClick) {\n      props.onAuxClick(new SearchClickEvent(resource, e));\n    }\n  }\n\n  function isExportPassed(): boolean {\n    return !!(props.onExport ?? props.onExportCsv ?? props.onExportTransactionBundle);\n  }\n\n  useEffect(() => {\n    setLoadingSchema(props.search.resourceType);\n    medplum\n      .requestSchema(props.search.resourceType as ResourceType)\n      .catch(console.error)\n      .finally(() => setLoadingSchema(undefined));\n  }, [medplum, props.search.resourceType]);\n\n  if (!isDataTypeLoaded(props.search.resourceType) || loadingSchema === props.search.resourceType) {\n    return (\n      <Center style={{ width: '100%', height: '100%' }}>\n        <Loader />\n      </Center>\n    );\n  }\n\n  const checkboxColumn = props.checkboxesEnabled;\n  const fields = getFieldDefinitions(search);\n  const resourceType = search.resourceType;\n  const lastResult = state.searchResponse;\n  const entries = lastResult?.entry;\n  const resources = entries?.map((e) => e.resource);\n\n  const buttonVariant = 'subtle';\n  const buttonColor = 'gray';\n  const iconSize = 16;\n  const isMobile = window.innerWidth < 768;\n\n  return (\n    <div className={classes.root} data-testid=\"search-control\">\n      {!props.hideToolbar && (\n        <Group justify=\"space-between\" mb=\"xl\">\n          <Group gap={2}>\n            <Button\n              size=\"compact-md\"\n              variant={buttonVariant}\n              color={buttonColor}\n              leftSection={<IconColumns size={iconSize} />}\n              onClick={() => setState({ ...stateRef.current, fieldEditorVisible: true })}\n            >\n              Fields\n            </Button>\n            <Button\n              size=\"compact-md\"\n              variant={buttonVariant}\n              color={buttonColor}\n              leftSection={<IconFilter size={iconSize} />}\n              onClick={() => setState({ ...stateRef.current, filterEditorVisible: true })}\n            >\n              Filters\n            </Button>\n            {props.onNew && (\n              <Button\n                size=\"compact-md\"\n                variant={buttonVariant}\n                color={buttonColor}\n                leftSection={<IconFilePlus size={iconSize} />}\n                onClick={props.onNew}\n              >\n                New...\n              </Button>\n            )}\n            {!isMobile && isExportPassed() && (\n              <Button\n                size=\"compact-md\"\n                variant={buttonVariant}\n                color={buttonColor}\n                leftSection={<IconTableExport size={iconSize} />}\n                onClick={\n                  props.onExport ? props.onExport : () => setState({ ...stateRef.current, exportDialogVisible: true })\n                }\n              >\n                Export...\n              </Button>\n            )}\n            {!isMobile && props.onDelete && (\n              <Button\n                size=\"compact-md\"\n                variant={buttonVariant}\n                color={buttonColor}\n                leftSection={<IconTrash size={iconSize} />}\n                onClick={() => (props.onDelete as (ids: string[]) => any)(Object.keys(state.selected))}\n              >\n                Delete...\n              </Button>\n            )}\n            {!isMobile && props.onBulk && (\n              <Button\n                size=\"compact-md\"\n                variant={buttonVariant}\n                color={buttonColor}\n                leftSection={<IconBoxMultiple size={iconSize} />}\n                onClick={() => (props.onBulk as (ids: string[]) => any)(Object.keys(state.selected))}\n              >\n                Bulk...\n              </Button>\n            )}\n          </Group>\n          <Group gap={2}>\n            {lastResult && (\n              <Text size=\"xs\" c=\"dimmed\" data-testid=\"count-display\">\n                {getStart(search, lastResult).toLocaleString()}-{getEnd(search, lastResult).toLocaleString()}\n                {lastResult.total !== undefined &&\n                  ` of ${search.total === 'estimate' ? '~' : ''}${lastResult.total?.toLocaleString()}`}\n              </Text>\n            )}\n            <ActionIcon variant={buttonVariant} color={buttonColor} title=\"Refresh\" onClick={refreshResults}>\n              <IconRefresh size={iconSize} />\n            </ActionIcon>\n          </Group>\n        </Group>\n      )}\n      <Table className={classes.table}>\n        <Table.Thead>\n          <Table.Tr>\n            {checkboxColumn && (\n              <Table.Th>\n                <input\n                  type=\"checkbox\"\n                  value=\"checked\"\n                  aria-label=\"all-checkbox\"\n                  data-testid=\"all-checkbox\"\n                  checked={isAllSelected()}\n                  onChange={(e) => handleAllCheckboxClick(e)}\n                />\n              </Table.Th>\n            )}\n            {fields.map((field) => (\n              <Table.Th key={field.name}>\n                <Menu shadow=\"md\" width={240} position=\"bottom-end\">\n                  <Menu.Target>\n                    <UnstyledButton className={classes.control} p={2}>\n                      <Group justify=\"space-between\" wrap=\"nowrap\">\n                        <Text fw={500}>{buildFieldNameString(field.name)}</Text>\n                        <Center className={classes.icon}>\n                          <IconAdjustmentsHorizontal size={14} stroke={1.5} />\n                        </Center>\n                      </Group>\n                    </UnstyledButton>\n                  </Menu.Target>\n                  <SearchPopupMenu\n                    search={props.search}\n                    searchParams={field.searchParams}\n                    onPrompt={(searchParam, filter) => {\n                      setState({\n                        ...stateRef.current,\n                        filterDialogVisible: true,\n                        filterDialogSearchParam: searchParam,\n                        filterDialogFilter: filter,\n                      });\n                    }}\n                    onChange={(result) => {\n                      emitSearchChange(result);\n                    }}\n                  />\n                </Menu>\n              </Table.Th>\n            ))}\n          </Table.Tr>\n          {!props.hideFilters && (\n            <Table.Tr>\n              {checkboxColumn && <Table.Th />}\n              {fields.map((field) => (\n                <Table.Th key={field.name}>\n                  {field.searchParams && (\n                    <FilterDescription\n                      resourceType={resourceType}\n                      searchParams={field.searchParams}\n                      filters={props.search.filters}\n                    />\n                  )}\n                </Table.Th>\n              ))}\n            </Table.Tr>\n          )}\n        </Table.Thead>\n        <Table.Tbody>\n          {resources?.map(\n            (resource) =>\n              resource && (\n                <Table.Tr\n                  key={resource.id}\n                  className={classes.tr}\n                  data-testid=\"search-control-row\"\n                  onClick={(e) => handleRowClick(e, resource)}\n                  onAuxClick={(e) => handleRowClick(e, resource)}\n                >\n                  {checkboxColumn && (\n                    <Table.Td>\n                      <input\n                        type=\"checkbox\"\n                        value=\"checked\"\n                        data-testid=\"row-checkbox\"\n                        aria-label={`Checkbox for ${resource.id}`}\n                        checked={!!state.selected[resource.id as string]}\n                        onChange={(e) => handleSingleCheckboxClick(e, resource.id as string)}\n                      />\n                    </Table.Td>\n                  )}\n                  {fields.map((field) => (\n                    <Table.Td key={field.name}>{renderValue(resource, field)}</Table.Td>\n                  ))}\n                </Table.Tr>\n              )\n          )}\n        </Table.Tbody>\n      </Table>\n      {resources?.length === 0 && (\n        <Container>\n          <Center style={{ height: 150 }}>\n            <Text size=\"xl\" c=\"dimmed\">\n              No results\n            </Text>\n          </Center>\n        </Container>\n      )}\n      {lastResult && (\n        <Center m=\"md\" p=\"md\">\n          <Pagination\n            value={getPage(search)}\n            total={getTotalPages(search, lastResult)}\n            onChange={(newPage) => emitSearchChange(setPage(search, newPage))}\n            getControlProps={(control) => {\n              switch (control) {\n                case 'previous':\n                  return { 'aria-label': 'Previous page' };\n                case 'next':\n                  return { 'aria-label': 'Next page' };\n                default:\n                  return {};\n              }\n            }}\n          />\n        </Center>\n      )}\n      {outcome && (\n        <div data-testid=\"search-error\">\n          <pre style={{ textAlign: 'left' }}>{JSON.stringify(outcome, undefined, 2)}</pre>\n        </div>\n      )}\n      <SearchFieldEditor\n        search={props.search}\n        visible={stateRef.current.fieldEditorVisible}\n        onOk={(result) => {\n          emitSearchChange(result);\n          setState({\n            ...stateRef.current,\n            fieldEditorVisible: false,\n          });\n        }}\n        onCancel={() => {\n          setState({\n            ...stateRef.current,\n            fieldEditorVisible: false,\n          });\n        }}\n      />\n      <SearchFilterEditor\n        search={props.search}\n        visible={stateRef.current.filterEditorVisible}\n        onOk={(result) => {\n          emitSearchChange(result);\n          setState({\n            ...stateRef.current,\n            filterEditorVisible: false,\n          });\n        }}\n        onCancel={() => {\n          setState({\n            ...stateRef.current,\n            filterEditorVisible: false,\n          });\n        }}\n      />\n      <SearchExportDialog\n        visible={stateRef.current.exportDialogVisible}\n        exportCsv={props.onExportCsv}\n        exportTransactionBundle={props.onExportTransactionBundle}\n        onCancel={() => {\n          setState({\n            ...stateRef.current,\n            exportDialogVisible: false,\n          });\n        }}\n      />\n      <SearchFilterValueDialog\n        key={state.filterDialogSearchParam?.code}\n        visible={stateRef.current.filterDialogVisible}\n        title={state.filterDialogSearchParam?.code ? buildFieldNameString(state.filterDialogSearchParam.code) : ''}\n        resourceType={resourceType}\n        searchParam={state.filterDialogSearchParam}\n        filter={state.filterDialogFilter}\n        defaultValue=\"\"\n        onOk={(filter) => {\n          emitSearchChange(addFilter(props.search, filter.code, filter.operator, filter.value));\n          setState({\n            ...stateRef.current,\n            filterDialogVisible: false,\n          });\n        }}\n        onCancel={() => {\n          setState({\n            ...stateRef.current,\n            filterDialogVisible: false,\n          });\n        }}\n      />\n    </div>\n  );\n}\n\nexport const MemoizedSearchControl = memo(SearchControl);\n\ninterface FilterDescriptionProps {\n  readonly resourceType: string;\n  readonly searchParams: SearchParameter[];\n  readonly filters?: Filter[];\n}\n\nfunction FilterDescription(props: FilterDescriptionProps): JSX.Element {\n  const filters = (props.filters ?? []).filter((f) => props.searchParams.find((p) => p.code === f.code));\n  if (filters.length === 0) {\n    return <span>no filters</span>;\n  }\n\n  return (\n    <>\n      {filters.map((filter: Filter) => (\n        <div key={`filter-${filter.code}-${filter.operator}-${filter.value}`}>\n          {getOpString(filter.operator)}\n          &nbsp;\n          <SearchFilterValueDisplay resourceType={props.resourceType} filter={filter} />\n        </div>\n      ))}\n    </>\n  );\n}\n\nfunction getPage(search: SearchRequest): number {\n  return Math.floor((search.offset ?? 0) / (search.count ?? DEFAULT_SEARCH_COUNT)) + 1;\n}\n\nfunction getTotalPages(search: SearchRequest, lastResult: Bundle): number {\n  const pageSize = search.count ?? DEFAULT_SEARCH_COUNT;\n  const total = getTotal(search, lastResult);\n  return Math.ceil(total / pageSize);\n}\n\nfunction getStart(search: SearchRequest, lastResult: Bundle): number {\n  return Math.min(getTotal(search, lastResult), (search.offset ?? 0) + 1);\n}\n\nfunction getEnd(search: SearchRequest, lastResult: Bundle): number {\n  return getStart(search, lastResult) + (lastResult.entry?.length ?? 0) - 1;\n}\n\nfunction getTotal(search: SearchRequest, lastResult: Bundle): number {\n  let total = lastResult.total;\n  if (total === undefined) {\n    // If the total is not specified, then we have to estimate it\n    total =\n      (search.offset ?? 0) +\n      (lastResult.entry?.length ?? 0) +\n      (lastResult.link?.some((l) => l.relation === 'next') ? 1 : 0);\n  }\n  return total;\n}\n", "import { Box, Button, Modal, Text } from '@mantine/core';\n\ninterface SearchExportDialogProps {\n  readonly visible: boolean;\n  readonly exportCsv?: () => void;\n  readonly exportTransactionBundle?: () => void;\n  readonly onCancel: () => void;\n}\n\nexport function SearchExportDialog(props: SearchExportDialogProps): JSX.Element | null {\n  return (\n    <Modal title=\"Export\" closeButtonProps={{ 'aria-label': 'Close' }} opened={props.visible} onClose={props.onCancel}>\n      <Box display=\"flex\" style={{ justifyContent: 'space-between' }}>\n        {props.exportCsv && <ExportButton text=\"CSV\" exportLogic={props.exportCsv} onCancel={props.onCancel} />}\n        {props.exportTransactionBundle && (\n          <ExportButton\n            text=\"Transaction Bundle\"\n            exportLogic={props.exportTransactionBundle}\n            onCancel={props.onCancel}\n          />\n        )}\n      </Box>\n      <Text style={{ marginTop: '10px', marginLeft: '2px' }}>Limited to 1000 records</Text>\n    </Modal>\n  );\n}\n\ninterface ExportButtonProps {\n  readonly text: string;\n  readonly exportLogic: () => void;\n  readonly onCancel: () => void;\n}\n\nexport function ExportButton(props: ExportButtonProps): JSX.Element {\n  return (\n    <Button\n      onClick={() => {\n        props.exportLogic();\n        props.onCancel();\n      }}\n    >\n      {`Export as ${props.text}`}\n    </Button>\n  );\n}\n", "import { Button, Group, Modal, MultiSelect, Stack } from '@mantine/core';\nimport { InternalTypeSchema, SearchRequest, getDataType, getSearchParameters, stringify } from '@medplum/core';\nimport { SearchParameter } from '@medplum/fhirtypes';\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { buildFieldNameString } from '../SearchControl/SearchUtils';\n\nexport interface SearchFieldEditorProps {\n  readonly visible: boolean;\n  readonly search: SearchRequest;\n  readonly onOk: (search: SearchRequest) => void;\n  readonly onCancel: () => void;\n}\n\nexport function SearchFieldEditor(props: SearchFieldEditorProps): JSX.Element | null {\n  const wasDropdownOpen = useRef(false);\n  const [state, setState] = useState({\n    search: JSON.parse(stringify(props.search)) as SearchRequest,\n  });\n\n  const [isDropdownOpen, setIsDropdownOpen] = useState(false);\n\n  useEffect(() => {\n    setState({ search: props.search });\n  }, [props.search]);\n\n  const allFields = useMemo(() => {\n    if (!props.visible) {\n      return [];\n    }\n\n    const resourceType = props.search.resourceType;\n    const typeSchema = getDataType(resourceType);\n    const searchParams = getSearchParameters(resourceType);\n    return getFieldsList(typeSchema, searchParams)\n      .sort((a, b) => a.localeCompare(b))\n      .map((field) => {\n        return { value: field, label: buildFieldNameString(field) };\n      });\n  }, [props.visible, props.search.resourceType]);\n\n  if (!props.visible) {\n    return null;\n  }\n\n  function handleChange(newFields: string[]): void {\n    setState({ search: { ...state.search, fields: newFields } });\n  }\n\n  return (\n    <Modal\n      title=\"Fields\"\n      closeButtonProps={{ 'aria-label': 'Close' }}\n      opened={props.visible}\n      onClose={() => {\n        props.onCancel();\n      }}\n      size=\"auto\"\n      /*\n      By default, the MultiSelect dropdown does not interact well with Modal's closeOnClickOutside:\n      When the MultiSelect's dropdown is opened and the user clicks outside of the dropdown to close it\n      (and outside the modal, i.e. clicks on the Modal's overlay), the Modal is undesirably also closed\n      from the same click.\n\n      Due to the sequencing of the events fired during a click on the overlay and when React\n      rerenders of various components occur, it is not possible to simply do something such as setting\n      closeOnClickOutside={!isDropdownOpened}:\n\n      * user begins a click on the overlay which triggers\n      * mousedown event on the overlay which triggers\n      * blur event on the MultiSelect's input element which invokes\n      * the MultiSelect.onDropdownClose callback which calls setIsDropdownOpen(false) which causes\n      * rerender of SearchFieldEditor with isDropdownOpen set to false\n      * the user ends the click which triggers\n      * click event on the Modal which activates the closeOnClickOutside logic\n      * since isDropdownOpen is false, closeOnClickOutside is true, so the Modal closes\n\n      Instead, emulate closeOnClickOutside's behavior only when the MultiSelect dropdown\n      was not open at the beginning of the click\n      */\n      withOverlay\n      closeOnClickOutside={false}\n      overlayProps={{\n        onMouseDownCapture: () => {\n          // capture whether the MultiSelect dropdown is open when a click on the overlay begins (i.e. mousedown)\n          wasDropdownOpen.current = isDropdownOpen;\n        },\n        onClick: () => {\n          if (!wasDropdownOpen.current) {\n            // invoke onCancel callback since the dropdown wasn't open at the start of the click on the overlay\n            props.onCancel();\n          }\n\n          // not strictly needed since onMouseDownCapture should always precede onClick, but reset the ref\n          wasDropdownOpen.current = false;\n        },\n        children: <div data-testid=\"overlay-child\" />, // can't specify testid on the overlay itself\n      }}\n    >\n      <Stack>\n        <MultiSelect\n          // withinPortal={true}\n          style={{ width: 550 }}\n          placeholder=\"Select fields to display\"\n          data={allFields}\n          value={state.search.fields ?? []}\n          onChange={handleChange}\n          onDropdownOpen={() => setIsDropdownOpen(true)}\n          onDropdownClose={() => setIsDropdownOpen(false)}\n          /* shows at most ~6.5 items; the extra half to provide a hint that there are more entries to scroll through */\n          maxDropdownHeight=\"250px\"\n          // dropdownPosition=\"bottom\"\n          clearButtonProps={{ 'aria-label': 'Clear selection' }}\n          clearable\n          searchable\n        />\n        <Group justify=\"flex-end\">\n          <Button onClick={() => props.onOk(state.search)}>OK</Button>\n        </Group>\n      </Stack>\n    </Modal>\n  );\n}\n\n/**\n * Returns a list of fields/columns available for a type.\n * The result is the union of properties and search parameters.\n * @param typeSchema - The type definition.\n * @param searchParams - The search parameters.\n * @returns A list of fields/columns available for a resource type.\n */\nfunction getFieldsList(\n  typeSchema: InternalTypeSchema,\n  searchParams: Record<string, SearchParameter> | undefined\n): string[] {\n  const result = [] as string[];\n  const keys = new Set<string>();\n  const names = new Set<string>();\n\n  // Add properties first\n  for (const key of Object.keys(typeSchema.elements)) {\n    result.push(key);\n    keys.add(key.toLowerCase());\n    names.add(buildFieldNameString(key));\n  }\n\n  // Add search parameters if unique\n  if (searchParams) {\n    for (const code of Object.keys(searchParams)) {\n      const name = buildFieldNameString(code);\n      if (!keys.has(code) && !names.has(name)) {\n        result.push(code);\n        keys.add(code);\n        names.add(name);\n      }\n    }\n  }\n\n  return result;\n}\n", "import {\n  capitalize,\n  DEFAULT_SEARCH_COUNT,\n  evalFhirPathTyped,\n  Filter,\n  formatDateTime,\n  InternalSchemaElement,\n  Operator,\n  SearchRequest,\n} from '@medplum/core';\nimport { Resource, SearchParameter } from '@medplum/fhirtypes';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport { getValueAndType } from '../ResourcePropertyDisplay/ResourcePropertyDisplay.utils';\nimport { SearchControlField } from './SearchControlField';\n\nconst searchParamToOperators: Record<string, Operator[]> = {\n  string: [Operator.EQUALS, Operator.NOT, Operator.CONTAINS, Operator.EXACT],\n  fulltext: [Operator.EQUALS, Operator.NOT, Operator.CONTAINS, Operator.EXACT],\n  token: [Operator.EQUALS, Operator.NOT],\n  reference: [Operator.EQUALS, Operator.NOT],\n  numeric: [\n    Operator.EQUALS,\n    Operator.NOT_EQUALS,\n    Operator.GREATER_THAN,\n    Operator.LESS_THAN,\n    Operator.GREATER_THAN_OR_EQUALS,\n    Operator.LESS_THAN_OR_EQUALS,\n  ],\n  quantity: [\n    Operator.EQUALS,\n    Operator.NOT_EQUALS,\n    Operator.GREATER_THAN,\n    Operator.LESS_THAN,\n    Operator.GREATER_THAN_OR_EQUALS,\n    Operator.LESS_THAN_OR_EQUALS,\n  ],\n  date: [\n    Operator.EQUALS,\n    Operator.NOT_EQUALS,\n    Operator.GREATER_THAN,\n    Operator.LESS_THAN,\n    Operator.GREATER_THAN_OR_EQUALS,\n    Operator.LESS_THAN_OR_EQUALS,\n    Operator.STARTS_AFTER,\n    Operator.ENDS_BEFORE,\n    Operator.APPROXIMATELY,\n  ],\n  datetime: [\n    Operator.EQUALS,\n    Operator.NOT_EQUALS,\n    Operator.GREATER_THAN,\n    Operator.LESS_THAN,\n    Operator.GREATER_THAN_OR_EQUALS,\n    Operator.LESS_THAN_OR_EQUALS,\n    Operator.STARTS_AFTER,\n    Operator.ENDS_BEFORE,\n    Operator.APPROXIMATELY,\n  ],\n};\n\nconst operatorNames: Record<Operator, string> = {\n  eq: 'equals',\n  ne: 'not equals',\n  gt: 'greater than',\n  lt: 'less than',\n  ge: 'greater than or equals',\n  le: 'less than or equals',\n  sa: 'starts after',\n  eb: 'ends before',\n  ap: 'approximately',\n  contains: 'contains',\n  exact: 'exact',\n  text: 'text',\n  not: 'not',\n  above: 'above',\n  below: 'below',\n  in: 'in',\n  'not-in': 'not in',\n  'of-type': 'of type',\n  missing: 'missing',\n  identifier: 'identifier',\n  iterate: 'iterate',\n};\n\n/**\n * Sets the array of filters.\n * @param definition - The original search request.\n * @param filters - The new filters.\n * @returns The updated search request.\n */\nexport function setFilters(definition: SearchRequest, filters: Filter[]): SearchRequest {\n  return {\n    ...definition,\n    filters: filters,\n    offset: 0,\n    name: undefined,\n  };\n}\n\n/**\n * Clears all of the filters.\n * @param definition - The original search request.\n * @returns The updated search request.\n */\nexport function clearFilters(definition: SearchRequest): SearchRequest {\n  return setFilters(definition, []);\n}\n\n/**\n * Clears all of the filters on a certain field.\n * @param definition - The original search request.\n * @param code - The field key name to clear filters.\n * @returns The updated search request.\n */\nexport function clearFiltersOnField(definition: SearchRequest, code: string): SearchRequest {\n  return setFilters(\n    definition,\n    (definition.filters ?? []).filter((f) => f.code !== code)\n  );\n}\n\n/**\n * Adds a filter.\n * @param definition - The original search request.\n * @param field - The field key name.\n * @param op - The operation key name.\n * @param value - The filter value.\n * @param opt_clear - Optional flag to clear filters on the field.\n * @returns The updated search request.\n */\nexport function addFilter(\n  definition: SearchRequest,\n  field: string,\n  op: Operator,\n  value?: string,\n  opt_clear?: boolean\n): SearchRequest {\n  if (opt_clear) {\n    definition = clearFiltersOnField(definition, field);\n  }\n\n  const nextFilters: Filter[] = [];\n  if (definition.filters) {\n    nextFilters.push(...definition.filters);\n  }\n  nextFilters.push({ code: field, operator: op, value: value ?? '' });\n\n  return setFilters(definition, nextFilters);\n}\n\n/**\n * Adds a field.\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addField(definition: SearchRequest, field: string): SearchRequest {\n  if (definition.fields?.includes(field)) {\n    return definition;\n  }\n  const newFields = [];\n  if (definition.fields) {\n    newFields.push(...definition.fields);\n  }\n  newFields.push(field);\n  return {\n    ...definition,\n    fields: newFields,\n    name: undefined,\n  };\n}\n\n/**\n * Deletes a filter at the specified index.\n * @param definition - The original search request.\n * @param index - The filter index.\n * @returns The updated search request.\n */\nexport function deleteFilter(definition: SearchRequest, index: number): SearchRequest {\n  if (!definition.filters) {\n    return definition;\n  }\n  const newFilters = [...definition.filters];\n  newFilters.splice(index, 1);\n  return {\n    ...definition,\n    filters: newFilters,\n    name: undefined,\n  };\n}\n\n/**\n * Adds a filter that constrains the specified field to \"yesterday\".\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addYesterdayFilter(definition: SearchRequest, field: string): SearchRequest {\n  return addDayFilter(definition, field, -1);\n}\n\n/**\n * Adds a filter that constrains the specified field to \"today\".\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addTodayFilter(definition: SearchRequest, field: string): SearchRequest {\n  return addDayFilter(definition, field, 0);\n}\n\n/**\n * Adds a filter that constrains the specified field to \"tomorrow\".\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addTomorrowFilter(definition: SearchRequest, field: string): SearchRequest {\n  return addDayFilter(definition, field, 1);\n}\n\n/**\n * Adds a filter that constrains the specified field to a day.\n * The day is specified as a delta from the current day.\n * \"Today\" would be 0.\n * \"Yesterday\" would be -1.\n * \"Tomorrow\" would be 1.\n * @param definition - The original search request.\n * @param field - The field key name.\n * @param delta - The number of days from this day.\n * @returns The updated search request.\n */\nfunction addDayFilter(definition: SearchRequest, field: string, delta: number): SearchRequest {\n  const startTime = new Date();\n  startTime.setDate(startTime.getDate() + delta);\n  startTime.setHours(0, 0, 0, 0);\n\n  const endTime = new Date(startTime.getTime());\n  endTime.setDate(endTime.getDate() + 1);\n  endTime.setTime(endTime.getTime() - 1);\n\n  return addDateFilterBetween(definition, field, startTime, endTime);\n}\n\n/**\n * Adds a filter that constrains the specified field to \"last month\".\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addLastMonthFilter(definition: SearchRequest, field: string): SearchRequest {\n  return addMonthFilter(definition, field, -1);\n}\n\n/**\n * Adds a filter that constrains the specified field to \"this month\".\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addThisMonthFilter(definition: SearchRequest, field: string): SearchRequest {\n  return addMonthFilter(definition, field, 0);\n}\n\n/**\n * Adds a filter that constrains the specified field to \"next month\".\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addNextMonthFilter(definition: SearchRequest, field: string): SearchRequest {\n  return addMonthFilter(definition, field, 1);\n}\n\n/**\n * Adds a filter that constrains the specified field to a month.\n * The month is specified as a delta from the current month.\n * \"This month\" would be 0.\n * \"Last month\" would be -1.\n * \"Next month\" would be 1.\n * @param definition - The original search request.\n * @param field - The field key name.\n * @param delta - The number of months from this month.\n * @returns The updated search request.\n */\nfunction addMonthFilter(definition: SearchRequest, field: string, delta: number): SearchRequest {\n  const startTime = new Date();\n  startTime.setMonth(startTime.getMonth() + delta);\n  startTime.setDate(1);\n  startTime.setHours(0, 0, 0, 0);\n\n  const endTime = new Date(startTime.getTime());\n  endTime.setMonth(endTime.getMonth() + 1);\n  endTime.setDate(1);\n  endTime.setHours(0, 0, 0, 0);\n  endTime.setTime(endTime.getTime() - 1);\n\n  return addDateFilterBetween(definition, field, startTime, endTime);\n}\n\n/**\n * Adds a filter that constrains the specified field to the year to date.\n * @param definition - The original search request.\n * @param field - The field key name.\n * @returns The updated search request.\n */\nexport function addYearToDateFilter(definition: SearchRequest, field: string): SearchRequest {\n  const startTime = new Date();\n  startTime.setMonth(0);\n  startTime.setDate(1);\n  startTime.setHours(0, 0, 0, 0);\n\n  const endTime = new Date();\n\n  return addDateFilterBetween(definition, field, startTime, endTime);\n}\n\n/**\n * Adds a filter for a date between two dates (inclusive of both dates).\n * @param definition - The original search request.\n * @param field - The field key name.\n * @param d1 - The start date.\n * @param d2 - The end date.\n * @returns The updated search request.\n */\nexport function addDateFilterBetween(definition: SearchRequest, field: string, d1: Date, d2: Date): SearchRequest {\n  definition = clearFiltersOnField(definition, field);\n  definition = addDateFilterImpl(definition, field, Operator.GREATER_THAN_OR_EQUALS, d1);\n  definition = addDateFilterImpl(definition, field, Operator.LESS_THAN_OR_EQUALS, d2);\n  return definition;\n}\n\n/**\n * Adds a filter for a date before a certain date/time.\n * @param definition - The original search request.\n * @param field - The field key name.\n * @param op - The date/time operation.\n * @param value - The date.\n * @returns The updated search request.\n */\nfunction addDateFilterImpl(definition: SearchRequest, field: string, op: Operator, value: Date): SearchRequest {\n  return addFilter(definition, field, op, value.toISOString());\n}\n\n/**\n * Adds a filter that constrains the specified field to \"missing\".\n * @param definition - The original search request.\n * @param field - The field key name.\n * @param value - Optional boolean value. Default is true.\n * @returns The updated search request.\n */\nexport function addMissingFilter(definition: SearchRequest, field: string, value = true): SearchRequest {\n  return addFilter(definition, field, Operator.MISSING, value.toString());\n}\n\n/**\n * Sets the offset (starting at zero).\n * @param definition - The original search request.\n * @param offset - The offset number.\n * @returns The updated search request.\n */\nexport function setOffset(definition: SearchRequest, offset: number): SearchRequest {\n  if (definition.offset === offset) {\n    return definition;\n  }\n  return {\n    ...definition,\n    offset,\n    name: undefined,\n  };\n}\n\n/**\n * Creates a new search request with the search offset at the specified page.\n * @param definition - The search definition.\n * @param page - The new page number\n * @returns The new search definition.\n */\nexport function setPage(definition: SearchRequest, page: number): SearchRequest {\n  const count = definition.count ?? DEFAULT_SEARCH_COUNT;\n  const newOffset = (page - 1) * count;\n  return setOffset(definition, newOffset);\n}\n\n/**\n * Sorts the search by the specified key, and optional direction.\n * Direction defaults to ascending ('asc') if not specified.\n * @param definition - The original search request.\n * @param sort - The sort key.\n * @param desc - Optional descending flag. Default is false.\n * @returns The updated search request.\n */\nexport function setSort(definition: SearchRequest, sort: string, desc?: boolean): SearchRequest {\n  if (sort === getSortField(definition) && desc !== undefined && desc === isSortDescending(definition)) {\n    return definition;\n  }\n  return {\n    ...definition,\n    sortRules: [\n      {\n        code: sort,\n        descending: !!desc,\n      },\n    ],\n    name: undefined,\n  };\n}\n\n/**\n * Toggles the sort of the search by key.\n * If the search is already sorted by the key, reverses the direction.\n * If the search is not sorted by the key, sort in ascending order.\n * @param definition - The original search request.\n * @param key - The field key name.\n * @returns The updated search request.\n */\nexport function toggleSort(definition: SearchRequest, key: string): SearchRequest {\n  let desc = false;\n  if (getSortField(definition) === key) {\n    desc = !isSortDescending(definition);\n  }\n  return setSort(definition, key, desc);\n}\n\nexport function getSortField(definition: SearchRequest): string | undefined {\n  const sortRules = definition.sortRules;\n  if (!sortRules || sortRules.length === 0) {\n    return undefined;\n  }\n  const field = sortRules[0].code;\n  return field.startsWith('-') ? field.substr(1) : field;\n}\n\nexport function isSortDescending(definition: SearchRequest): boolean {\n  const sortRules = definition.sortRules;\n  if (!sortRules || sortRules.length === 0) {\n    return false;\n  }\n  return !!sortRules[0].descending;\n}\n\n/**\n * Returns a list of operators for a search parameter.\n * @param searchParam - The search parameter.\n * @returns The list of operators that can be used for the search parameter.\n */\nexport function getSearchOperators(searchParam: SearchParameter): Operator[] | undefined {\n  return searchParamToOperators[searchParam.type as string];\n}\n\n/**\n * Returns a string representing the operation.\n * @param op - The operation code.\n * @returns A display string for the operation.\n */\nexport function getOpString(op: Operator): string {\n  return operatorNames[op] ?? '';\n}\n\n/**\n * Returns a field display name.\n * @param key - The field key.\n * @returns The field display name.\n */\nexport function buildFieldNameString(key: string): string {\n  let tmp = key;\n\n  // If dot separated, only the last part\n  if (tmp.includes('.')) {\n    tmp = tmp.split('.').pop() as string;\n  }\n\n  // Special case for Version ID\n  if (tmp === 'versionId') {\n    return 'Version ID';\n  }\n\n  // Remove choice of type\n  tmp = tmp.replace('[x]', '');\n\n  // Convert camel case to space separated\n  tmp = tmp.replace(/([A-Z])/g, ' $1');\n\n  // Convert dashes and underscores to spaces\n  tmp = tmp.replace(/[-_]/g, ' ');\n\n  // Normalize whitespace to single space character\n  tmp = tmp.replace(/\\s+/g, ' ');\n\n  // Trim\n  tmp = tmp.trim();\n\n  // Special case for ID\n  if (tmp.toLowerCase() === 'id') {\n    return 'ID';\n  }\n\n  // Capitalize the first letter of each word\n  return tmp.split(/\\s/).map(capitalize).join(' ');\n}\n\n/**\n * Returns a fragment to be displayed in the search table for the value.\n * @param resource - The parent resource.\n * @param field - The search code or FHIRPath expression.\n * @returns The fragment to display.\n */\nexport function renderValue(resource: Resource, field: SearchControlField): string | JSX.Element | null | undefined {\n  const key = field.name;\n  if (key === 'id') {\n    return resource.id;\n  }\n\n  if (key === 'meta.versionId') {\n    return resource.meta?.versionId;\n  }\n\n  if (key === '_lastUpdated') {\n    return formatDateTime(resource.meta?.lastUpdated);\n  }\n\n  // Priority 1: InternalSchemaElement by exact match\n  if (field.elementDefinition && `${resource.resourceType}.${field.name}` === field.elementDefinition.path) {\n    return renderPropertyValue(resource, field.elementDefinition);\n  }\n\n  // Priority 2: SearchParameter by exact match\n  if (field.searchParams && field.searchParams.length === 1 && field.name === field.searchParams[0].code) {\n    return renderSearchParameterValue(resource, field.searchParams[0]);\n  }\n\n  // We don't know how to render this field definition\n  return null;\n}\n\n/**\n * Returns a fragment to be displayed in the search table for a resource property.\n * @param resource - The parent resource.\n * @param elementDefinition - The property element definition.\n * @returns A React element or null.\n */\nfunction renderPropertyValue(resource: Resource, elementDefinition: InternalSchemaElement): JSX.Element | null {\n  const path = elementDefinition.path?.split('.')?.pop()?.replaceAll('[x]', '') ?? '';\n  const [value, propertyType] = getValueAndType({ type: resource.resourceType, value: resource }, path);\n  if (!value) {\n    return null;\n  }\n\n  return (\n    <ResourcePropertyDisplay\n      path={elementDefinition.path}\n      property={elementDefinition}\n      propertyType={propertyType}\n      value={value}\n      maxWidth={200}\n      ignoreMissingValues={true}\n      link={false}\n    />\n  );\n}\n\n/**\n * Returns a fragment to be displayed in the search table for a search parameter.\n * @param resource - The parent resource.\n * @param searchParam - The search parameter.\n * @returns A React element or null.\n */\nfunction renderSearchParameterValue(resource: Resource, searchParam: SearchParameter): JSX.Element | null {\n  const value = evalFhirPathTyped(searchParam.expression as string, [{ type: resource.resourceType, value: resource }]);\n  if (!value || value.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      {value.map((v, index) => (\n        <ResourcePropertyDisplay\n          key={`${index}-${value.length}`}\n          propertyType={v.type}\n          value={v.value}\n          maxWidth={200}\n          ignoreMissingValues={true}\n          link={false}\n        />\n      ))}\n    </>\n  );\n}\n", "import { Button, Group, Modal, NativeSelect } from '@mantine/core';\nimport { Filter, Operator, SearchRequest, getSearchParameters, stringify } from '@medplum/core';\nimport { SearchParameter } from '@medplum/fhirtypes';\nimport { useEffect, useRef, useState } from 'react';\nimport {\n  addFilter,\n  buildFieldNameString,\n  deleteFilter,\n  getOpString,\n  getSearchOperators,\n  setFilters,\n} from '../SearchControl/SearchUtils';\nimport { SearchFilterValueDisplay } from '../SearchFilterValueDisplay/SearchFilterValueDisplay';\nimport { SearchFilterValueInput } from '../SearchFilterValueInput/SearchFilterValueInput';\n\nexport interface SearchFilterEditorProps {\n  readonly visible: boolean;\n  readonly search: SearchRequest;\n  readonly onOk: (search: SearchRequest) => void;\n  readonly onCancel: () => void;\n}\n\nexport function SearchFilterEditor(props: SearchFilterEditorProps): JSX.Element | null {\n  const [search, setSearch] = useState<SearchRequest>(JSON.parse(stringify(props.search)) as SearchRequest);\n  const [editingIndex, setEditingIndex] = useState<number>(-1);\n\n  const searchRef = useRef<SearchRequest>(search);\n  searchRef.current = search;\n\n  useEffect(() => {\n    setSearch(JSON.parse(stringify(props.search)) as SearchRequest);\n  }, [props.search]);\n\n  function onAddFilter(filter: Filter): void {\n    setSearch(addFilter(searchRef.current, filter.code, filter.operator, filter.value));\n  }\n\n  if (!props.visible) {\n    return null;\n  }\n\n  const resourceType = props.search.resourceType;\n  const searchParams = getSearchParameters(resourceType) ?? {};\n  const filters = search.filters || [];\n\n  return (\n    <Modal\n      title=\"Filters\"\n      closeButtonProps={{ 'aria-label': 'Close' }}\n      size={900}\n      opened={props.visible}\n      onClose={props.onCancel}\n    >\n      <div>\n        <table>\n          <colgroup>\n            <col style={{ width: 200 }} />\n            <col style={{ width: 200 }} />\n            <col style={{ width: 380 }} />\n            <col style={{ width: 120 }} />\n          </colgroup>\n          <thead>\n            <tr>\n              <th>Field</th>\n              <th>Operation</th>\n              <th>Value</th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody>\n            {filters.map((filter: Filter, index: number) => {\n              if (index === editingIndex) {\n                return (\n                  <FilterRowInput\n                    key={`filter-${filter.code}-${filter.operator}-${filter.value}-input`}\n                    resourceType={resourceType}\n                    searchParams={searchParams}\n                    defaultValue={filter}\n                    okText=\"Save\"\n                    onOk={(newFilter: Filter) => {\n                      const newFilters = [...filters];\n                      newFilters[index] = newFilter;\n                      setSearch(setFilters(searchRef.current, newFilters));\n                      setEditingIndex(-1);\n                    }}\n                    onCancel={() => setEditingIndex(-1)}\n                  />\n                );\n              } else {\n                return (\n                  <FilterRowDisplay\n                    key={`filter-${filter.code}-${filter.operator}-${filter.value}-display`}\n                    resourceType={resourceType}\n                    filter={filter}\n                    onEdit={() => setEditingIndex(index)}\n                    onDelete={() => setSearch(deleteFilter(searchRef.current, index))}\n                  />\n                );\n              }\n            })}\n            <FilterRowInput resourceType={resourceType} searchParams={searchParams} okText=\"Add\" onOk={onAddFilter} />\n          </tbody>\n        </table>\n      </div>\n      <Group justify=\"flex-end\" mt=\"xl\">\n        <Button onClick={() => props.onOk(searchRef.current)}>OK</Button>\n      </Group>\n    </Modal>\n  );\n}\n\ninterface FilterRowDisplayProps {\n  readonly resourceType: string;\n  readonly filter: Filter;\n  readonly onEdit: () => void;\n  readonly onDelete: () => void;\n}\n\nfunction FilterRowDisplay(props: FilterRowDisplayProps): JSX.Element | null {\n  const { filter } = props;\n  return (\n    <tr>\n      <td>{buildFieldNameString(filter.code)}</td>\n      <td>{getOpString(filter.operator)}</td>\n      <td>\n        <SearchFilterValueDisplay resourceType={props.resourceType} filter={filter} />\n      </td>\n      <td>\n        <Button size=\"compact-md\" variant=\"outline\" onClick={props.onEdit}>\n          Edit\n        </Button>\n        <Button size=\"compact-md\" variant=\"outline\" onClick={props.onDelete}>\n          Delete\n        </Button>\n      </td>\n    </tr>\n  );\n}\n\ninterface FilterRowInputProps {\n  readonly resourceType: string;\n  readonly searchParams: Record<string, SearchParameter>;\n  readonly defaultValue?: Filter;\n  readonly okText: string;\n  readonly onOk: (value: Filter) => void;\n  readonly onCancel?: () => void;\n}\n\nfunction FilterRowInput(props: FilterRowInputProps): JSX.Element {\n  const [value, setValue] = useState<Filter>(props.defaultValue ?? ({} as Filter));\n  const valueRef = useRef<Filter>(value);\n  valueRef.current = value;\n\n  function setFilterCode(newCode: string): void {\n    setValue({ ...valueRef.current, code: newCode });\n  }\n\n  function setFilterOperator(newOperator: Operator): void {\n    setValue({ ...valueRef.current, operator: newOperator });\n  }\n\n  function setFilterValue(newFilterValue: string): void {\n    setValue({ ...valueRef.current, value: newFilterValue });\n  }\n\n  const searchParam = props.searchParams[value.code];\n  const operators = searchParam && getSearchOperators(searchParam);\n\n  return (\n    <tr>\n      <td>\n        <NativeSelect\n          data-testid=\"filter-field\"\n          defaultValue={valueRef.current.code}\n          onChange={(e) => setFilterCode(e.currentTarget.value)}\n          data={[\n            '',\n            ...Object.keys(props.searchParams).map((param) => ({ value: param, label: buildFieldNameString(param) })),\n          ]}\n        />\n      </td>\n      <td>\n        {operators && (\n          <NativeSelect\n            data-testid=\"filter-operation\"\n            defaultValue={value.operator}\n            onChange={(e) => setFilterOperator(e.currentTarget.value as Operator)}\n            data={['', ...operators.map((op) => ({ value: op, label: getOpString(op) }))]}\n          />\n        )}\n      </td>\n      <td>\n        {searchParam && value.operator && (\n          <SearchFilterValueInput\n            resourceType={props.resourceType}\n            searchParam={searchParam}\n            defaultValue={value.value}\n            onChange={setFilterValue}\n          />\n        )}\n      </td>\n      <td>\n        {value.code && value.operator && (\n          <Button\n            size=\"compact-md\"\n            variant=\"outline\"\n            onClick={() => {\n              props.onOk(valueRef.current);\n              setValue({} as Filter);\n            }}\n          >\n            {props.okText}\n          </Button>\n        )}\n        {props.onCancel && (\n          <Button size=\"compact-md\" variant=\"outline\" onClick={props.onCancel}>\n            Cancel\n          </Button>\n        )}\n      </td>\n    </tr>\n  );\n}\n", "import {\n  Filter,\n  formatDateTime,\n  getSearchParameterDetails,\n  globalSchema,\n  Operator,\n  SearchParameterType,\n} from '@medplum/core';\nimport { ResourceName } from '../ResourceName/ResourceName';\n\nexport interface SearchFilterValueDisplayProps {\n  readonly resourceType: string;\n  readonly filter: Filter;\n}\n\nexport function SearchFilterValueDisplay(props: SearchFilterValueDisplayProps): JSX.Element {\n  const { resourceType, filter } = props;\n\n  const searchParam = globalSchema.types[resourceType].searchParams?.[filter.code];\n  if (searchParam) {\n    if (\n      searchParam.type === 'reference' &&\n      (filter.operator === Operator.EQUALS || filter.operator === Operator.NOT_EQUALS)\n    ) {\n      return <ResourceName value={{ reference: filter.value }} />;\n    }\n\n    const searchParamDetails = getSearchParameterDetails(resourceType, searchParam);\n    if (filter.code === '_lastUpdated' || searchParamDetails.type === SearchParameterType.DATETIME) {\n      return <>{formatDateTime(filter.value)}</>;\n    }\n  }\n\n  return <>{filter.value}</>;\n}\n", "import { Checkbox, TextInput } from '@mantine/core';\nimport { getSearchParameterDetails, SearchParameterType } from '@medplum/core';\nimport { Quantity, Reference, SearchParameter } from '@medplum/fhirtypes';\nimport { DateTimeInput } from '../DateTimeInput/DateTimeInput';\nimport { QuantityInput } from '../QuantityInput/QuantityInput';\nimport { ReferenceInput } from '../ReferenceInput/ReferenceInput';\n\nexport interface SearchFilterValueInputProps {\n  readonly resourceType: string;\n  readonly searchParam: SearchParameter;\n  readonly defaultValue?: string;\n  readonly autoFocus?: boolean;\n  readonly onChange: (value: string) => void;\n}\n\nexport function SearchFilterValueInput(props: SearchFilterValueInputProps): JSX.Element | null {\n  const details = getSearchParameterDetails(props.resourceType, props.searchParam);\n  const name = 'filter-value';\n\n  switch (details.type) {\n    case SearchParameterType.REFERENCE:\n      return (\n        <ReferenceInput\n          name={name}\n          defaultValue={props.defaultValue ? { reference: props.defaultValue } : undefined}\n          targetTypes={props.searchParam.target}\n          autoFocus={props.autoFocus}\n          onChange={(newReference: Reference | undefined) => {\n            if (newReference) {\n              props.onChange(newReference.reference as string);\n            } else {\n              props.onChange('');\n            }\n          }}\n        />\n      );\n\n    case SearchParameterType.BOOLEAN:\n      return (\n        <Checkbox\n          name={name}\n          data-autofocus={props.autoFocus}\n          data-testid={name}\n          defaultChecked={props.defaultValue === 'true'}\n          autoFocus={props.autoFocus}\n          onChange={(e) => props.onChange(e.currentTarget.checked.toString())}\n        />\n      );\n\n    case SearchParameterType.DATE:\n      return (\n        <TextInput\n          type=\"date\"\n          name={name}\n          data-autofocus={props.autoFocus}\n          data-testid={name}\n          defaultValue={props.defaultValue}\n          autoFocus={props.autoFocus}\n          onChange={(e) => props.onChange(e.currentTarget.value)}\n        />\n      );\n\n    case SearchParameterType.DATETIME:\n      return (\n        <DateTimeInput\n          name={name}\n          defaultValue={props.defaultValue}\n          autoFocus={props.autoFocus}\n          onChange={props.onChange}\n        />\n      );\n\n    case SearchParameterType.NUMBER:\n      return (\n        <TextInput\n          type=\"number\"\n          name={name}\n          data-autofocus={props.autoFocus}\n          data-testid={name}\n          defaultValue={props.defaultValue}\n          autoFocus={props.autoFocus}\n          onChange={(e) => props.onChange(e.currentTarget.value)}\n        />\n      );\n\n    case SearchParameterType.QUANTITY:\n      return (\n        <QuantityInput\n          name={name}\n          defaultValue={tryParseQuantity(props.defaultValue)}\n          autoFocus={props.autoFocus}\n          onChange={(newQuantity: Quantity | undefined) => {\n            if (newQuantity) {\n              props.onChange(`${newQuantity.value}`);\n            } else {\n              props.onChange('');\n            }\n          }}\n        />\n      );\n\n    default:\n      return (\n        <TextInput\n          name={name}\n          data-autofocus={props.autoFocus}\n          data-testid={name}\n          defaultValue={props.defaultValue}\n          autoFocus={props.autoFocus}\n          onChange={(e) => props.onChange(e.currentTarget.value)}\n          placeholder=\"Search value\"\n        />\n      );\n  }\n}\n\nfunction tryParseQuantity(value: string | undefined): Quantity | undefined {\n  if (value) {\n    const [valueString, systemString, unitString] = value.split('|');\n    if (valueString) {\n      return {\n        value: parseFloat(valueString),\n        system: systemString,\n        unit: unitString,\n      };\n    }\n  }\n  return undefined;\n}\n", "import { Button, Grid, Modal } from '@mantine/core';\nimport { Filter } from '@medplum/core';\nimport { SearchParameter } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { SearchFilterValueInput } from '../SearchFilterValueInput/SearchFilterValueInput';\n\nexport interface SearchFilterValueDialogProps {\n  readonly title: string;\n  readonly visible: boolean;\n  readonly resourceType: string;\n  readonly searchParam?: SearchParameter;\n  readonly filter?: Filter;\n  readonly defaultValue?: string;\n  readonly onOk: (filter: Filter) => void;\n  readonly onCancel: () => void;\n}\n\nexport function SearchFilterValueDialog(props: SearchFilterValueDialogProps): JSX.Element | null {\n  const [value, setValue] = useState<string>(props.defaultValue ?? '');\n\n  if (!props.visible || !props.searchParam || !props.filter) {\n    return null;\n  }\n\n  function onOk(): void {\n    props.onOk({ ...(props.filter as Filter), value });\n  }\n\n  return (\n    <Modal title={props.title} size=\"xl\" opened={props.visible} onClose={props.onCancel}>\n      <Form onSubmit={onOk}>\n        <Grid>\n          <Grid.Col span={10}>\n            <SearchFilterValueInput\n              resourceType={props.resourceType}\n              searchParam={props.searchParam}\n              defaultValue={value}\n              autoFocus={true}\n              onChange={setValue}\n            />\n          </Grid.Col>\n          <Grid.Col span={2}>\n            <Button onClick={onOk} fullWidth>\n              OK\n            </Button>\n          </Grid.Col>\n        </Grid>\n      </Form>\n    </Modal>\n  );\n}\n", "import { Menu } from '@mantine/core';\nimport { Filter, Operator, SearchRequest } from '@medplum/core';\nimport { SearchParameter } from '@medplum/fhirtypes';\nimport {\n  IconBleach,\n  IconBleachOff,\n  IconBracketsContain,\n  IconBucket,\n  IconBucketOff,\n  IconCalendar,\n  IconEqual,\n  IconEqualNot,\n  IconMathGreater,\n  IconMathLower,\n  IconSettings,\n  IconSortAscending,\n  IconSortDescending,\n  IconX,\n} from '@tabler/icons-react';\nimport {\n  addLastMonthFilter,\n  addMissingFilter,\n  addNextMonthFilter,\n  addThisMonthFilter,\n  addTodayFilter,\n  addTomorrowFilter,\n  addYearToDateFilter,\n  addYesterdayFilter,\n  buildFieldNameString,\n  clearFiltersOnField,\n  setSort,\n} from '../SearchControl/SearchUtils';\n\nexport interface SearchPopupMenuProps {\n  readonly search: SearchRequest;\n  readonly searchParams?: SearchParameter[];\n  readonly onPrompt: (searchParam: SearchParameter, filter: Filter) => void;\n  readonly onChange: (definition: SearchRequest) => void;\n}\n\nexport function SearchPopupMenu(props: SearchPopupMenuProps): JSX.Element | null {\n  if (!props.searchParams) {\n    return null;\n  }\n\n  function onSort(searchParam: SearchParameter, desc: boolean): void {\n    onChange(setSort(props.search, searchParam.code as string, desc));\n  }\n\n  function onClear(searchParam: SearchParameter): void {\n    onChange(clearFiltersOnField(props.search, searchParam.code as string));\n  }\n\n  function onPrompt(searchParam: SearchParameter, operator: Operator): void {\n    props.onPrompt(searchParam, { code: searchParam.code as string, operator, value: '' });\n  }\n\n  function onChange(definition: SearchRequest): void {\n    props.onChange(definition);\n  }\n\n  // If there is only one search parameter, then show it directly\n  if (props.searchParams.length === 1) {\n    return (\n      <SearchParameterSubMenu\n        search={props.search}\n        searchParam={props.searchParams[0]}\n        onSort={onSort}\n        onPrompt={onPrompt}\n        onChange={onChange}\n        onClear={onClear}\n      />\n    );\n  }\n\n  // Otherwise, show a menu, with each search parameter as a sub menu\n  return (\n    <Menu.Dropdown>\n      {props.searchParams.map((searchParam) => (\n        <Menu.Item key={searchParam.code}>{buildFieldNameString(searchParam.code as string)}</Menu.Item>\n      ))}\n    </Menu.Dropdown>\n  );\n}\n\ninterface SearchPopupSubMenuProps {\n  readonly search: SearchRequest;\n  readonly searchParam: SearchParameter;\n  readonly onSort: (searchParam: SearchParameter, descending: boolean) => void;\n  readonly onPrompt: (searchParam: SearchParameter, operator: Operator) => void;\n  readonly onChange: (search: SearchRequest) => void;\n  readonly onClear: (searchParam: SearchParameter) => void;\n}\n\nfunction SearchParameterSubMenu(props: SearchPopupSubMenuProps): JSX.Element {\n  switch (props.searchParam.type) {\n    case 'date':\n      return <DateFilterSubMenu {...props} />;\n    case 'number':\n    case 'quantity':\n      return <NumericFilterSubMenu {...props} />;\n    case 'reference':\n      return <ReferenceFilterSubMenu {...props} />;\n    case 'string':\n      return <TextFilterSubMenu {...props} />;\n    case 'token':\n    case 'uri':\n      return <TokenFilterSubMenu {...props} />;\n    default:\n      return <>Unknown search param type: {props.searchParam.type}</>;\n  }\n}\n\nfunction DateFilterSubMenu(props: SearchPopupSubMenuProps): JSX.Element {\n  const { searchParam } = props;\n  const code = searchParam.code as string;\n  return (\n    <Menu.Dropdown>\n      <Menu.Item leftSection={<IconSortAscending size={14} />} onClick={() => props.onSort(searchParam, false)}>\n        Sort Oldest to Newest\n      </Menu.Item>\n      <Menu.Item leftSection={<IconSortDescending size={14} />} onClick={() => props.onSort(searchParam, true)}>\n        Sort Newest to Oldest\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item leftSection={<IconEqual size={14} />} onClick={() => props.onPrompt(searchParam, Operator.EQUALS)}>\n        Equals...\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconEqualNot size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.NOT_EQUALS)}\n      >\n        Does not equal...\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item\n        leftSection={<IconMathLower size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.ENDS_BEFORE)}\n      >\n        Before...\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconMathGreater size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.STARTS_AFTER)}\n      >\n        After...\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconBracketsContain size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.EQUALS)}\n      >\n        Between...\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item\n        leftSection={<IconCalendar size={14} />}\n        onClick={() => props.onChange(addTomorrowFilter(props.search, code))}\n      >\n        Tomorrow\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconCalendar size={14} />}\n        onClick={() => props.onChange(addTodayFilter(props.search, code))}\n      >\n        Today\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconCalendar size={14} />}\n        onClick={() => props.onChange(addYesterdayFilter(props.search, code))}\n      >\n        Yesterday\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item\n        leftSection={<IconCalendar size={14} />}\n        onClick={() => props.onChange(addNextMonthFilter(props.search, code))}\n      >\n        Next Month\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconCalendar size={14} />}\n        onClick={() => props.onChange(addThisMonthFilter(props.search, code))}\n      >\n        This Month\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconCalendar size={14} />}\n        onClick={() => props.onChange(addLastMonthFilter(props.search, code))}\n      >\n        Last Month\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item\n        leftSection={<IconCalendar size={14} />}\n        onClick={() => props.onChange(addYearToDateFilter(props.search, code))}\n      >\n        Year to date\n      </Menu.Item>\n      <CommonMenuItems {...props} />\n    </Menu.Dropdown>\n  );\n}\n\nfunction NumericFilterSubMenu(props: SearchPopupSubMenuProps): JSX.Element {\n  const { searchParam } = props;\n  return (\n    <Menu.Dropdown>\n      <Menu.Item leftSection={<IconSortAscending size={14} />} onClick={() => props.onSort(searchParam, false)}>\n        Sort Smallest to Largest\n      </Menu.Item>\n      <Menu.Item leftSection={<IconSortDescending size={14} />} onClick={() => props.onSort(searchParam, true)}>\n        Sort Largest to Smallest\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item leftSection={<IconEqual size={14} />} onClick={() => props.onPrompt(searchParam, Operator.EQUALS)}>\n        Equals...\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconEqualNot size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.NOT_EQUALS)}\n      >\n        Does not equal...\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item\n        leftSection={<IconMathGreater size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.GREATER_THAN)}\n      >\n        Greater than...\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconSettings size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.GREATER_THAN_OR_EQUALS)}\n      >\n        Greater than or equal to...\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconMathLower size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.LESS_THAN)}\n      >\n        Less than...\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconSettings size={14} />}\n        onClick={() => props.onPrompt(searchParam, Operator.LESS_THAN_OR_EQUALS)}\n      >\n        Less than or equal to...\n      </Menu.Item>\n      <CommonMenuItems {...props} />\n    </Menu.Dropdown>\n  );\n}\n\nfunction ReferenceFilterSubMenu(props: SearchPopupSubMenuProps): JSX.Element {\n  const { searchParam } = props;\n  return (\n    <Menu.Dropdown>\n      <Menu.Item leftSection={<IconEqual size={14} />} onClick={() => props.onPrompt(searchParam, Operator.EQUALS)}>\n        Equals...\n      </Menu.Item>\n      <Menu.Item leftSection={<IconEqualNot size={14} />} onClick={() => props.onPrompt(searchParam, Operator.NOT)}>\n        Does not equal...\n      </Menu.Item>\n      <CommonMenuItems {...props} />\n    </Menu.Dropdown>\n  );\n}\n\nfunction TextFilterSubMenu(props: SearchPopupSubMenuProps): JSX.Element {\n  const { searchParam } = props;\n  return (\n    <Menu.Dropdown>\n      <Menu.Item leftSection={<IconSortAscending size={14} />} onClick={() => props.onSort(searchParam, false)}>\n        Sort A to Z\n      </Menu.Item>\n      <Menu.Item leftSection={<IconSortDescending size={14} />} onClick={() => props.onSort(searchParam, true)}>\n        Sort Z to A\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item leftSection={<IconEqual size={14} />} onClick={() => props.onPrompt(searchParam, Operator.EQUALS)}>\n        Equals...\n      </Menu.Item>\n      <Menu.Item leftSection={<IconEqualNot size={14} />} onClick={() => props.onPrompt(searchParam, Operator.NOT)}>\n        Does not equal...\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item leftSection={<IconBucket size={14} />} onClick={() => props.onPrompt(searchParam, Operator.CONTAINS)}>\n        Contains...\n      </Menu.Item>\n      <Menu.Item leftSection={<IconBucketOff size={14} />} onClick={() => props.onPrompt(searchParam, Operator.EQUALS)}>\n        Does not contain...\n      </Menu.Item>\n      <CommonMenuItems {...props} />\n    </Menu.Dropdown>\n  );\n}\n\nfunction TokenFilterSubMenu(props: SearchPopupSubMenuProps): JSX.Element {\n  const { searchParam } = props;\n  return (\n    <Menu.Dropdown>\n      <Menu.Item leftSection={<IconEqual size={14} />} onClick={() => props.onPrompt(searchParam, Operator.EQUALS)}>\n        Equals...\n      </Menu.Item>\n      <Menu.Item leftSection={<IconEqualNot size={14} />} onClick={() => props.onPrompt(searchParam, Operator.NOT)}>\n        Does not equal...\n      </Menu.Item>\n      <CommonMenuItems {...props} />\n    </Menu.Dropdown>\n  );\n}\n\nfunction CommonMenuItems(props: SearchPopupSubMenuProps): JSX.Element {\n  const { searchParam } = props;\n  const code = searchParam.code as string;\n  return (\n    <>\n      <Menu.Divider />\n      <Menu.Item\n        leftSection={<IconBleach size={14} />}\n        onClick={() => props.onChange(addMissingFilter(props.search, code))}\n      >\n        Missing\n      </Menu.Item>\n      <Menu.Item\n        leftSection={<IconBleachOff size={14} />}\n        onClick={() => props.onChange(addMissingFilter(props.search, code, false))}\n      >\n        Not missing\n      </Menu.Item>\n      <Menu.Divider />\n      <Menu.Item leftSection={<IconX size={14} />} onClick={() => props.onClear(searchParam)}>\n        Clear filters\n      </Menu.Item>\n    </>\n  );\n}\n", ".root {\n  max-width: 100%;\n  overflow: auto;\n  text-align: left;\n  margin-bottom: 20px;\n}\n\n.table {\n  cursor: pointer;\n}\n\n.tr {\n  &:hover {\n    background-color: light-dark(var(--mantine-color-gray-0), var(--mantine-color-dark-6));\n  }\n}\n\n.th {\n  padding: 0 !important;\n}\n\n.control {\n  width: 100%;\n  padding: var(--mantine-spacing-xs) var(--mantine-spacing-md);\n\n  &:hover {\n    background-color: light-dark(var(--mantine-color-gray-0), var(--mantine-color-dark-6));\n  }\n}\n\n.icon {\n  width: 21px;\n  height: 21px;\n  border-radius: 21px;\n}\n", "import {\n  getElementDefinition,\n  getSearchParameter,\n  getSearchParameterDetails,\n  getSearchParameters,\n  InternalSchemaElement,\n  SearchRequest,\n} from '@medplum/core';\nimport { ResourceType, SearchParameter } from '@medplum/fhirtypes';\n\n/**\n * The SearchControlField type describes a field in the search control.\n *\n * In a SearchRequest, a field is a simple string. Strings can be one of the following:\n * 1) Simple property names, which refer to InternalSchemaElement objects\n * 2) Search parameter names, which refer to SearchParameter resources\n *\n * Consider a few examples of how this becomes complicated.\n *\n * \"name\" (easy)\n *  - element definition path=\"Patient.name\"\n *  - search parameter code=\"name\"\n *\n * \"birthDate\" (medium)\n *  - refers to the element definition path=\"Patient.birthDate\"\n *  - refers to the search parameter code=\"birthdate\" (note the capitalization)\n *\n * \"email\" (hard)\n *  - refers to the search parameter code=\"email\"\n *  - refers to the element definition path=\"Patient.telecom\"\n *\n * In the last case, we start with the search parameter, and walk backwards to the\n * element definition in order to get type details for rendering.\n *\n * Overall, we want columns, fields, properties, and search parameters to feel seamless,\n * so we try our darndest to make this work.\n */\nexport interface SearchControlField {\n  readonly name: string;\n  readonly elementDefinition?: InternalSchemaElement;\n  readonly searchParams?: SearchParameter[];\n}\n\n/**\n * Returns the collection of field definitions for the search request.\n * @param search - The search request definition.\n * @returns An array of field definitions.\n */\nexport function getFieldDefinitions(search: SearchRequest): SearchControlField[] {\n  const resourceType = search.resourceType;\n  const fields = [] as SearchControlField[];\n\n  for (const name of search.fields || ['id', '_lastUpdated']) {\n    fields.push(getFieldDefinition(resourceType, name));\n  }\n  return fields;\n}\n\n/**\n * Return the field definition for a given field name.\n * Field names can be either property names or search parameter codes.\n * @param resourceType - The resource type.\n * @param name - The search field name (either property name or search parameter code).\n * @returns The field definition.\n */\nfunction getFieldDefinition(resourceType: string, name: string): SearchControlField {\n  if (name === '_lastUpdated') {\n    return {\n      name: '_lastUpdated',\n      searchParams: [\n        {\n          resourceType: 'SearchParameter',\n          base: ['Resource' as ResourceType],\n          code: '_lastUpdated',\n          name: '_lastUpdated',\n          type: 'date',\n          expression: 'Resource.meta.lastUpdated',\n        } as SearchParameter,\n      ],\n    };\n  }\n\n  if (name === 'meta.versionId') {\n    return {\n      name: 'meta.versionId',\n      searchParams: [\n        {\n          resourceType: 'SearchParameter',\n          base: ['Resource' as ResourceType],\n          code: '_versionId',\n          name: '_versionId',\n          type: 'token',\n          expression: 'Resource.meta.versionId',\n        } as SearchParameter,\n      ],\n    };\n  }\n\n  const exactElementDefinition = getElementDefinition(resourceType, name);\n  const exactSearchParam = getSearchParameter(resourceType, name.toLowerCase());\n\n  // Best case: Exact match of element definition or search parameter.\n  // Examples: ServiceRequest.subject, Patient.name, Patient.birthDate\n  // In this case, we only show the one search parameter.\n  if (exactElementDefinition && exactSearchParam) {\n    return { name, elementDefinition: exactElementDefinition, searchParams: [exactSearchParam] };\n  }\n\n  // Next best case: Exact match of element definition\n  // Examples: Observation.value\n  // In this case, there could be zero or more search parameters that are a function of the element definition.\n  // So search for those search parameters.\n  if (exactElementDefinition) {\n    const allSearchParams = getSearchParameters(resourceType);\n    let searchParams: SearchParameter[] | undefined = undefined;\n    if (allSearchParams) {\n      // To avoid matching names that happen to be prefixes of other names, e.g. id and identifier,\n      // match ${resourceType}.${name} followed by a non-name character OR the end of the string\n      // Name characters include letters, numbers, underscores, and hyphens\n      const pathRegex = new RegExp(`${resourceType}\\\\.${name.replaceAll('[x]', '')}([^\\\\w-]|$)`);\n\n      searchParams = Object.values(allSearchParams).filter((p) => !!p.expression && pathRegex.test(p?.expression));\n      if (searchParams.length === 0) {\n        searchParams = undefined;\n      }\n    }\n    return { name, elementDefinition: exactElementDefinition, searchParams };\n  }\n\n  // Search parameter case: Exact match of search parameter\n  // Examples: Observation.value-quantity, Patient.email\n  // Here we have a search parameter, but no element definition.\n  // Observation.value-quantity is a search parameter for the Observation.value element.\n  // Patient.email is a search parameter for the Patient.telecom element.\n  // So we need to walk backwards to find the element definition.\n  if (exactSearchParam) {\n    const details = getSearchParameterDetails(resourceType, exactSearchParam);\n    return { name, elementDefinition: details.elementDefinitions?.[0], searchParams: [exactSearchParam] };\n  }\n\n  // Worst case: no element definition and no search parameter.\n  // This is probably a malformed URL that includes an unknown field.\n  // We will render the column header, but all cells will be empty.\n  return { name };\n}\n", "export interface LogoProps {\n  readonly size: number;\n  readonly fill?: string;\n}\n\nexport function Logo(props: LogoProps): JSX.Element {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 491 491\" style={{ width: props.size, height: props.size }}>\n      <title>Medplum Logo</title>\n      <path fill={props.fill ?? '#ad7136'} d=\"M282 67c6-16 16-29 29-40L289 0c-22 17-37 41-43 68l17 23 19-24z\" />\n      <path\n        fill={props.fill ?? '#946af9'}\n        d=\"M311 63c-17 0-33 4-48 11-16-7-32-11-49-11-87 0-158 96-158 214s71 214 158 214c17 0 33-4 49-11 15 7 31 11 48 11 87 0 158-96 158-214S398 63 311 63z\"\n      />\n      <path\n        fill={props.fill ?? '#7857c5'}\n        d=\"M231 489l-17 2c-87 0-158-96-158-214S127 63 214 63l17 1c-39 12-70 102-70 213s31 201 70 212z\"\n      />\n      <path\n        fill={props.fill ?? '#40bc26'}\n        d=\"M207 220a176 176 0 01-177 43A176 176 0 01251 43l1 5c17 59 2 125-45 172z\"\n      />\n      <path fill={props.fill ?? '#33961e'} d=\"M252 48A421 421 0 0057 270l-27-7A176 176 0 01251 43l1 5z\" />\n    </svg>\n  );\n}\n", "import { Box, SimpleGrid } from '@mantine/core';\nimport { MeasureReport, MeasureReportGroup, Reference } from '@medplum/fhirtypes';\nimport { useResource, useSearchOne } from '@medplum/react-hooks';\nimport { MeasureReportGroupDisplay, MeasureTitle } from './MeasureReportGroupDisplay/MeasureReportGroupDisplay';\n\nexport interface MeasureReportDisplayProps {\n  readonly measureReport: MeasureReport | Reference<MeasureReport>;\n}\n\nexport function MeasureReportDisplay(props: MeasureReportDisplayProps): JSX.Element | null {\n  const report = useResource(props.measureReport);\n  const [measure] = useSearchOne('Measure', { url: report?.measure });\n\n  if (!report) {\n    return null;\n  }\n\n  return (\n    <Box>\n      {measure && <MeasureTitle measure={measure} />}\n      <SimpleGrid cols={{ base: 3, sm: 1 }} spacing={{ base: 'md', sm: 'sm' }}>\n        {report.group?.map((group: MeasureReportGroup, idx: number) => (\n          <MeasureReportGroupDisplay key={group.id ?? idx} group={group} />\n        ))}\n      </SimpleGrid>\n    </Box>\n  );\n}\n", "import { Box, Flex, Group, Paper, RingProgress, Text, Title } from '@mantine/core';\nimport { formatCodeableConcept } from '@medplum/core';\nimport { Measure, MeasureReportGroup } from '@medplum/fhirtypes';\nimport { QuantityDisplay } from '../../QuantityDisplay/QuantityDisplay';\n\ninterface MeasureReportGroupDisplayProps {\n  readonly group: MeasureReportGroup;\n}\n\ninterface MeasureProps {\n  readonly measure: Measure;\n}\n\nexport function MeasureReportGroupDisplay(props: MeasureReportGroupDisplayProps): JSX.Element | null {\n  const { group } = props;\n  return (\n    <Paper withBorder radius=\"md\" p=\"xs\" display=\"flex\" style={{ alignItems: 'center', justifyContent: 'center' }}>\n      <Group>\n        {group.measureScore && <MeasureScore group={group} />}\n        {!group.measureScore && <MeasureReportPopulation group={group} />}\n      </Group>\n    </Paper>\n  );\n}\n\nexport function MeasureTitle(props: MeasureProps): JSX.Element {\n  const { measure } = props;\n  return (\n    <>\n      <Text fz=\"md\" fw={500} mb={8}>\n        {measure.title}\n      </Text>\n      <Text fz=\"xs\" c=\"dimmed\" mb={8}>\n        {measure.subtitle}\n      </Text>\n    </>\n  );\n}\n\nfunction MeasureReportPopulation(props: MeasureReportGroupDisplayProps): JSX.Element {\n  const { group } = props;\n  const populations = group.population;\n  const numerator = populations?.find((p: any) => formatCodeableConcept(p.code) === 'numerator');\n  const denominator = populations?.find((p: any) => formatCodeableConcept(p.code) === 'denominator');\n\n  const numeratorCount = numerator?.count;\n  const denominatorCount = denominator?.count;\n\n  if (denominatorCount === 0) {\n    return (\n      <Box>\n        <Title order={3}>Not Applicable</Title>\n        <Text>{`Denominator: ${denominatorCount}`}</Text>\n      </Box>\n    );\n  }\n\n  if (numeratorCount === undefined || denominatorCount === undefined) {\n    return (\n      <Box>\n        <Title order={3}>Insufficient Data</Title>\n        <Text>{`Numerator: ${numeratorCount}`}</Text>\n        <Text>{`Denominator: ${denominatorCount}`}</Text>\n      </Box>\n    );\n  }\n\n  const value = (numeratorCount / denominatorCount) * 100;\n  return (\n    <RingProgress\n      size={120}\n      thickness={12}\n      roundCaps\n      sections={[{ value: value, color: groupColor(value) }]}\n      label={\n        <Flex justify=\"center\">\n          <Text fw={700} fz={18}>\n            {numeratorCount} / {denominatorCount}\n          </Text>\n        </Flex>\n      }\n    />\n  );\n}\n\nfunction MeasureScore(props: MeasureReportGroupDisplayProps): JSX.Element {\n  const { group } = props;\n  const unit = group.measureScore?.unit ?? group.measureScore?.code;\n\n  return (\n    <>\n      {unit === '%' ? (\n        <RingProgress\n          size={120}\n          thickness={12}\n          roundCaps\n          sections={[{ value: groupValue(group), color: groupColor(group?.measureScore?.value ?? 0) }]}\n          label={\n            <Flex justify=\"center\">\n              <Text fw={700} fz={18}>\n                <QuantityDisplay value={group.measureScore} />\n              </Text>\n            </Flex>\n          }\n        />\n      ) : (\n        <Flex h={120} align=\"center\">\n          <Title order={3}>\n            <QuantityDisplay value={group.measureScore} />\n          </Title>\n        </Flex>\n      )}\n    </>\n  );\n}\n\nfunction groupValue(group: MeasureReportGroup): number {\n  const score = group.measureScore?.value;\n  const unit = group.measureScore?.unit;\n  if (!score) {\n    return 0;\n  }\n  if (score <= 1 && unit === '%') {\n    return score * 100;\n  }\n  return score;\n}\n\nfunction groupColor(score: number): string {\n  if (score <= 33) {\n    return 'red';\n  }\n  if (score <= 67) {\n    return 'yellow';\n  }\n  return 'green';\n}\n", "import { ActionIcon, Indicator, Tooltip } from '@mantine/core';\nimport { ResourceType } from '@medplum/fhirtypes';\nimport { useMedplum, useSubscription } from '@medplum/react-hooks';\nimport { useCallback, useEffect, useState } from 'react';\n\nexport interface NotificationIconProps {\n  readonly iconComponent: JSX.Element;\n  readonly label: string;\n  readonly resourceType: ResourceType;\n  readonly countCriteria: string;\n  readonly subscriptionCriteria: string;\n  readonly onClick: () => void;\n}\n\nexport function NotificationIcon(props: NotificationIconProps): JSX.Element {\n  const medplum = useMedplum();\n  const { label, resourceType, countCriteria, subscriptionCriteria, onClick } = props;\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  const updateCount = useCallback(\n    (cache: 'default' | 'reload') => {\n      medplum\n        .search(resourceType, countCriteria, { cache })\n        .then((result) => setUnreadCount(result.total as number))\n        .catch(console.error);\n    },\n    [medplum, resourceType, countCriteria]\n  );\n\n  // Initial count\n  useEffect(() => {\n    // Cache=default to use the default cache policy, and accept most recent data\n    updateCount('default');\n  }, [updateCount]);\n\n  // Subscribe to the criteria\n  useSubscription(subscriptionCriteria, () => {\n    // Cache=reload to force a reload\n    updateCount('reload');\n  });\n\n  const icon = (\n    <Tooltip label={label}>\n      <ActionIcon variant=\"subtle\" color=\"gray\" size=\"lg\" aria-label={label} onClick={onClick}>\n        {props.iconComponent}\n      </ActionIcon>\n    </Tooltip>\n  );\n\n  return unreadCount > 0 ? (\n    <Indicator inline label={unreadCount.toLocaleString()} size={16} offset={2} position=\"bottom-end\" color=\"red\">\n      {icon}\n    </Indicator>\n  ) : (\n    icon\n  );\n}\n", "import { Alert } from '@mantine/core';\nimport { operationOutcomeIssueToString } from '@medplum/core';\nimport { OperationOutcome, OperationOutcomeIssue } from '@medplum/fhirtypes';\nimport { IconAlertCircle } from '@tabler/icons-react';\n\nexport interface OperationOutcomeAlertProps {\n  readonly outcome?: OperationOutcome;\n  readonly issues?: OperationOutcomeIssue[];\n}\n\nexport function OperationOutcomeAlert(props: OperationOutcomeAlertProps): JSX.Element | null {\n  const issues = props.outcome?.issue || props.issues;\n  if (!issues || issues.length === 0) {\n    return null;\n  }\n  return (\n    <Alert icon={<IconAlertCircle size={16} />} color=\"red\">\n      {issues.map((issue) => (\n        <div data-testid=\"text-field-error\" key={issue.details?.text}>\n          {operationOutcomeIssueToString(issue)}\n        </div>\n      ))}\n    </Alert>\n  );\n}\n", "import { Anchor, Card, CardProps, Divider, Flex, Group, Paper, Stack, Text } from '@mantine/core';\nimport { calculateAgeString, formatHumanName, resolveId } from '@medplum/core';\nimport {\n  AllergyIntolerance,\n  Condition,\n  HumanName,\n  MedicationRequest,\n  Observation,\n  Patient,\n  Reference,\n} from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { IconGenderFemale, IconStethoscope, IconUserSquare } from '@tabler/icons-react';\nimport { useEffect, useState } from 'react';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\nimport { Allergies } from './Allergies';\nimport { Medications } from './Medications';\nimport { ProblemList } from './ProblemList';\nimport { SmokingStatus } from './SmokingStatus';\nimport { Vitals } from './Vitals';\n\nexport interface PatientSummaryProps extends Omit<CardProps, 'children'> {\n  readonly patient: Patient | Reference<Patient>;\n  readonly background?: string;\n}\n\nexport function PatientSummary(props: PatientSummaryProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const { patient: propsPatient, background, ...rest } = props;\n  const [patient, setPatient] = useState<Patient>();\n  const [allergies, setAllergies] = useState<AllergyIntolerance[]>();\n  const [problems, setProblems] = useState<Condition[]>();\n  const [smokingStatus, setSmokingStatus] = useState<Observation>();\n  const [vitals, setVitals] = useState<Observation[]>();\n  const [medicationRequest, setMedicationRequest] = useState<MedicationRequest[]>();\n\n  useEffect(() => {\n    const id = resolveId(propsPatient) as string;\n    const ref = `Patient/${id}`;\n    const searchMeta = { _count: 100, _sort: '-_lastUpdated' };\n\n    Promise.all([\n      medplum.readResource('Patient', id),\n      medplum.searchResources('AllergyIntolerance', { patient: ref, ...searchMeta }),\n      medplum.searchResources('Condition', { patient: ref, ...searchMeta }),\n      medplum.searchResources('MedicationRequest', { subject: ref, ...searchMeta }),\n      medplum.searchResources('Observation', { subject: ref, ...searchMeta }),\n    ])\n      .then((results) => {\n        setPatient(results[0] as Patient);\n        setAllergies(results[1] as AllergyIntolerance[]);\n        setProblems(results[2] as Condition[]);\n        setMedicationRequest(results[3] as MedicationRequest[]);\n\n        const observations = results[4] as Observation[];\n        setSmokingStatus(observations.find((obs) => obs.code?.coding?.[0].code === '72166-2'));\n        setVitals(observations.filter((obs) => obs.category?.[0]?.coding?.[0].code === 'vital-signs'));\n      })\n      .catch(console.error);\n  }, [medplum, propsPatient]);\n\n  if (!patient) {\n    return null;\n  }\n\n  return (\n    <Card {...rest}>\n      <Card.Section h={100} style={{ background }} />\n      <ResourceAvatar value={patient} size={80} radius={80} mx=\"auto\" mt={-50} style={{ border: '2px solid white' }} />\n      <Text ta=\"center\" fz=\"lg\" fw={500}>\n        {formatHumanName(patient.name?.[0] as HumanName)}\n      </Text>\n      <Text ta=\"center\" fz=\"xs\" color=\"dimmed\">\n        {patient.birthDate} ({calculateAgeString(patient.birthDate as string)})\n      </Text>\n      <Paper withBorder p=\"md\" my=\"md\">\n        <Group grow>\n          <Flex justify=\"center\" align=\"center\" direction=\"column\" gap={0} maw=\"33%\">\n            <IconUserSquare size={24} color=\"gray\" />\n            <Text fz=\"xs\" ta=\"center\" style={{ whiteSpace: 'nowrap' }}>\n              Self\n            </Text>\n          </Flex>\n          <Flex justify=\"center\" align=\"center\" direction=\"column\" gap={0}>\n            <IconStethoscope size={24} color=\"gray\" />\n            <Text fz=\"xs\" style={{ whiteSpace: 'nowrap' }}>\n              {patient?.generalPractitioner?.[0]?.display ?? 'No provider'}\n            </Text>\n          </Flex>\n          <Flex justify=\"center\" align=\"center\" direction=\"column\" gap={0}>\n            <IconGenderFemale size={24} color=\"gray\" />\n            <Text fz=\"xs\" style={{ whiteSpace: 'nowrap' }}>\n              {patient.gender}\n            </Text>\n          </Flex>\n        </Group>\n      </Paper>\n      <Stack gap=\"xs\">\n        <Anchor href=\"#\">No upcoming appointments</Anchor>\n        <Anchor href=\"#\">No documented visits</Anchor>\n        <Divider />\n        <Allergies patient={patient} allergies={allergies as AllergyIntolerance[]} />\n        <Divider />\n        <ProblemList patient={patient} problems={problems as Condition[]} />\n        <Divider />\n        <Medications patient={patient} medicationRequests={medicationRequest as MedicationRequest[]} />\n        <Divider />\n        <SmokingStatus patient={patient} smokingStatus={smokingStatus} />\n        <Divider />\n        <Vitals patient={patient} vitals={vitals as Observation[]} />\n      </Stack>\n    </Card>\n  );\n}\n", "import { Anchor, Badge, Box, Button, Group, Modal, NativeSelect, Stack, Text, TextInput } from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport { createReference } from '@medplum/core';\nimport { AllergyIntolerance, CodeableConcept, Encounter, Patient } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useCallback, useState } from 'react';\nimport { CodeableConceptDisplay } from '../CodeableConceptDisplay/CodeableConceptDisplay';\nimport { CodeableConceptInput } from '../CodeableConceptInput/CodeableConceptInput';\nimport { Form } from '../Form/Form';\nimport { killEvent } from '../utils/dom';\n\nexport interface AllergiesProps {\n  readonly patient: Patient;\n  readonly encounter?: Encounter;\n  readonly allergies: AllergyIntolerance[];\n}\n\nexport function Allergies(props: AllergiesProps): JSX.Element {\n  const medplum = useMedplum();\n  const { patient, encounter } = props;\n  const [allergies, setAllergies] = useState<AllergyIntolerance[]>(props.allergies);\n  const [opened, { open, close }] = useDisclosure(false);\n  const [code, setCode] = useState<CodeableConcept>();\n\n  const handleSubmit = useCallback(\n    (formData: Record<string, string>) => {\n      medplum\n        .createResource<AllergyIntolerance>({\n          resourceType: 'AllergyIntolerance',\n          patient: createReference(patient),\n          encounter: encounter ? createReference(encounter) : undefined,\n          code,\n          onsetDateTime: formData.onset ? formData.onset : undefined,\n          reaction: formData.reaction ? [{ manifestation: [{ text: formData.reaction }] }] : undefined,\n        })\n        .then((newAllergy) => {\n          setAllergies([...allergies, newAllergy]);\n          close();\n        })\n        .catch(console.error);\n    },\n    [medplum, patient, encounter, allergies, close, code]\n  );\n\n  return (\n    <>\n      <Group justify=\"space-between\">\n        <Text fz=\"md\" fw={700}>\n          Allergies\n        </Text>\n        <Anchor\n          href=\"#\"\n          onClick={(e) => {\n            killEvent(e);\n            open();\n          }}\n        >\n          + Add\n        </Anchor>\n      </Group>\n      {allergies.length > 0 ? (\n        <Box>\n          {allergies.map((allergy) => (\n            <Badge key={allergy.id} variant=\"light\" maw=\"100%\">\n              <CodeableConceptDisplay value={allergy.code} />\n            </Badge>\n          ))}\n        </Box>\n      ) : (\n        <Text>(none)</Text>\n      )}\n      <Modal opened={opened} onClose={close} title=\"Add Allergy\">\n        <Form onSubmit={handleSubmit}>\n          <Stack>\n            <CodeableConceptInput\n              name=\"allergy\"\n              path=\"AllergyIntolerance.code\"\n              data-autofocus={true}\n              binding=\"http://hl7.org/fhir/us/core/ValueSet/us-core-allergy-substance\"\n              onChange={(allergy) => setCode(allergy)}\n              outcome={undefined}\n            />\n            <TextInput name=\"reaction\" label=\"Reaction\" />\n            <NativeSelect name=\"status\" label=\"Status\" data={['active']} />\n            <TextInput name=\"onset\" label=\"Onset\" type=\"date\" />\n            <Group justify=\"flex-end\" gap={4} mt=\"md\">\n              <Button type=\"submit\">Save</Button>\n            </Group>\n          </Stack>\n        </Form>\n      </Modal>\n    </>\n  );\n}\n", "import { Anchor, Badge, Box, Button, Group, Modal, Radio, Stack, Text } from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport { createReference } from '@medplum/core';\nimport { CodeableConcept, Encounter, MedicationRequest, Patient } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useCallback, useState } from 'react';\nimport { CodeableConceptDisplay } from '../CodeableConceptDisplay/CodeableConceptDisplay';\nimport { CodeableConceptInput } from '../CodeableConceptInput/CodeableConceptInput';\nimport { Form } from '../Form/Form';\nimport { killEvent } from '../utils/dom';\n\nexport interface MedicationsProps {\n  readonly patient: Patient;\n  readonly encounter?: Encounter;\n  readonly medicationRequests: MedicationRequest[];\n}\n\nexport function Medications(props: MedicationsProps): JSX.Element {\n  const medplum = useMedplum();\n  const [medicationRequests, setMedicationRequests] = useState<MedicationRequest[]>(props.medicationRequests);\n  const [opened, { open, close }] = useDisclosure(false);\n  const [code, setCode] = useState<CodeableConcept>();\n\n  const handleSubmit = useCallback(\n    (formData: Record<string, string>) => {\n      const status = formData.status as 'active' | 'stopped';\n      medplum\n        .createResource<MedicationRequest>({\n          resourceType: 'MedicationRequest',\n          status,\n          intent: 'order',\n          encounter: props.encounter ? createReference(props.encounter) : undefined,\n          medicationCodeableConcept: code,\n          subject: createReference(props.patient),\n        })\n        .then((newRequest) => {\n          setMedicationRequests([newRequest, ...medicationRequests]);\n          close();\n        })\n        .catch(console.error);\n    },\n    [medplum, props.patient, props.encounter, medicationRequests, close, code]\n  );\n\n  return (\n    <>\n      <Group justify=\"space-between\">\n        <Text fz=\"md\" fw={700}>\n          Medications\n        </Text>\n        <Anchor\n          href=\"#\"\n          onClick={(e) => {\n            killEvent(e);\n            open();\n          }}\n        >\n          + Add\n        </Anchor>\n      </Group>\n      {medicationRequests.length > 0 ? (\n        <Box>\n          {medicationRequests.map((request) => (\n            <Badge\n              mt={4}\n              key={request.id}\n              variant=\"light\"\n              maw=\"50%\"\n              color={request.status === 'active' ? 'blue' : 'gray'}\n            >\n              <CodeableConceptDisplay value={request.medicationCodeableConcept} />\n            </Badge>\n          ))}\n        </Box>\n      ) : (\n        <Text>(none)</Text>\n      )}\n      <Modal opened={opened} onClose={close} title=\"Add Medication Request\">\n        <Form onSubmit={handleSubmit}>\n          <Stack h={275}>\n            <CodeableConceptInput\n              name=\"request\"\n              path=\"MedicationRequest.medication[x]\"\n              data-autofocus={true}\n              binding=\"https://app.medplum.com/ValueSet/16d6f7b7-7eeb-4d0e-a83b-83be082aa10b\"\n              onChange={(request) => setCode(request)}\n              outcome={undefined}\n            />\n            <Radio.Group mt={32} name=\"status\" label=\"Request Status\" required>\n              <Radio key=\"active\" value=\"active\" label=\"active\" my=\"xs\" />\n              <Radio key=\"stopped\" value=\"stopped\" label=\"stopped\" my=\"xs\" />\n            </Radio.Group>\n            <Group justify=\"flex-end\" gap={4} mt=\"md\">\n              <Button type=\"submit\">Save</Button>\n            </Group>\n          </Stack>\n        </Form>\n      </Modal>\n    </>\n  );\n}\n", "import {\n  Anchor,\n  Badge,\n  Button,\n  Grid,\n  Group,\n  Modal,\n  NativeSelect,\n  Stack,\n  Text,\n  Textarea,\n  TextInput,\n} from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport { createReference } from '@medplum/core';\nimport { Condition, Encounter, Patient } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { Fragment, useCallback, useState } from 'react';\nimport { CodeableConceptDisplay } from '../CodeableConceptDisplay/CodeableConceptDisplay';\nimport { Form } from '../Form/Form';\nimport { killEvent } from '../utils/dom';\n\nexport interface ProblemListProps {\n  readonly patient: Patient;\n  readonly encounter?: Encounter;\n  readonly problems: Condition[];\n}\n\nexport function ProblemList(props: ProblemListProps): JSX.Element {\n  const medplum = useMedplum();\n  const { patient, encounter } = props;\n  const [problems, setProblems] = useState<Condition[]>(props.problems);\n  const [opened, { open, close }] = useDisclosure(false);\n\n  const handleSubmit = useCallback(\n    (formData: Record<string, string>) => {\n      medplum\n        .createResource<Condition>({\n          resourceType: 'Condition',\n          subject: createReference(patient),\n          encounter: encounter ? createReference(encounter) : undefined,\n          code: { coding: [{ code: formData.problem, display: formData.problem }] },\n          onsetDateTime: formData.onset ? formData.onset : undefined,\n        })\n        .then((newProblem) => {\n          setProblems([...problems, newProblem]);\n          close();\n        })\n        .catch(console.error);\n    },\n    [medplum, patient, encounter, problems, close]\n  );\n\n  return (\n    <>\n      <Group justify=\"space-between\">\n        <Text fz=\"md\" fw={700}>\n          Problem List\n        </Text>\n        <Anchor\n          href=\"#\"\n          onClick={(e) => {\n            killEvent(e);\n            open();\n          }}\n        >\n          + Add\n        </Anchor>\n      </Group>\n      {problems.length > 0 ? (\n        <Grid gutter=\"xs\">\n          {problems.map((problem) => (\n            <Fragment key={problem.id}>\n              <Grid.Col span={2}>{problem.onsetDateTime?.substring(0, 4)}</Grid.Col>\n              <Grid.Col span={10}>\n                <Badge key={problem.id} variant=\"light\" maw=\"100%\">\n                  <CodeableConceptDisplay value={problem.code} />\n                </Badge>\n              </Grid.Col>\n            </Fragment>\n          ))}\n        </Grid>\n      ) : (\n        <Text>(none)</Text>\n      )}\n      <Modal opened={opened} onClose={close} title=\"Add Problem\">\n        <Form onSubmit={handleSubmit}>\n          <Stack>\n            <TextInput name=\"problem\" label=\"Problem\" data-autofocus={true} autoFocus required />\n            <TextInput name=\"onset\" label=\"Dx Date\" type=\"date\" required />\n            <NativeSelect name=\"status\" label=\"Status\" data={['active']} />\n            <Textarea name=\"notes\" label=\"Notes\" />\n            <Group justify=\"flex-end\" gap={4} mt=\"md\">\n              <Button type=\"submit\">Save</Button>\n            </Group>\n          </Stack>\n        </Form>\n      </Modal>\n    </>\n  );\n}\n", "import { Anchor, Badge, Box, Button, Group, Modal, Radio, Stack, Text } from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport { HTTP_HL7_ORG, LOINC, SNOMED, createReference } from '@medplum/core';\nimport { Encounter, Observation, Patient } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useCallback, useState } from 'react';\nimport { CodeableConceptDisplay } from '../CodeableConceptDisplay/CodeableConceptDisplay';\nimport { Form } from '../Form/Form';\nimport { killEvent } from '../utils/dom';\n\n// Smoking Status widget\n// See: https://build.fhir.org/ig/HL7/US-Core/StructureDefinition-us-core-smokingstatus.html\n\nconst smokingStatusOptions: Record<string, string> = {\n  '266919005': 'Never smoked tobacco',\n  '266927001': 'Tobacco smoking consumption unknown',\n  '428041000124106': 'Occasional tobacco smoker',\n  '428061000124105': 'Light tobacco smoker',\n  '428071000124103': 'Heavy tobacco smoker',\n  '449868002': 'Smokes tobacco daily',\n  '77176002': 'Smoker',\n  '8517006': 'Ex-smoker',\n};\n\nexport interface SmokingStatusProps {\n  readonly patient: Patient;\n  readonly encounter?: Encounter;\n  readonly smokingStatus?: Observation;\n}\n\nexport function SmokingStatus(props: SmokingStatusProps): JSX.Element {\n  const medplum = useMedplum();\n  const { patient, encounter } = props;\n  const [smokingStatus, setSmokingStatus] = useState<Observation | undefined>(props.smokingStatus);\n  const [opened, { open, close }] = useDisclosure(false);\n\n  const handleSubmit = useCallback(\n    (formData: Record<string, string>) => {\n      medplum\n        .createResource<Observation>({\n          resourceType: 'Observation',\n          meta: {\n            profile: [HTTP_HL7_ORG + '/fhir/us/core/StructureDefinition/us-core-smokingstatus'],\n          },\n          status: 'final',\n          category: [\n            {\n              coding: [\n                {\n                  system: 'http://terminology.hl7.org/CodeSystem/observation-category',\n                  code: 'social-history',\n                  display: 'Social History',\n                },\n              ],\n              text: 'Social History',\n            },\n          ],\n          code: {\n            coding: [\n              {\n                system: LOINC,\n                code: '72166-2',\n                display: 'Tobacco smoking status',\n              },\n            ],\n            text: 'Tobacco smoking status',\n          },\n          subject: createReference(patient),\n          encounter: encounter ? createReference(encounter) : undefined,\n          effectiveDateTime: new Date().toISOString(),\n          valueCodeableConcept: {\n            coding: [\n              {\n                system: SNOMED,\n                version: SNOMED + '/731000124108',\n                code: formData.smokingStatus,\n              },\n            ],\n            text: smokingStatusOptions[formData.smokingStatus],\n          },\n        })\n        .then((newSmokingStatus) => {\n          setSmokingStatus(newSmokingStatus);\n          close();\n        })\n        .catch(console.error);\n    },\n    [medplum, patient, encounter, close]\n  );\n\n  return (\n    <>\n      <Group justify=\"space-between\">\n        <Text fz=\"md\" fw={700}>\n          Smoking Status\n        </Text>\n        <Anchor\n          href=\"#\"\n          onClick={(e) => {\n            killEvent(e);\n            open();\n          }}\n        >\n          + Edit\n        </Anchor>\n      </Group>\n      {smokingStatus?.valueCodeableConcept ? (\n        <Box>\n          <Badge variant=\"light\">\n            <CodeableConceptDisplay value={smokingStatus.valueCodeableConcept} />\n          </Badge>\n        </Box>\n      ) : (\n        <Text>(none)</Text>\n      )}\n      <Modal opened={opened} onClose={close} title=\"Set Smoking Status\">\n        <Form onSubmit={handleSubmit}>\n          <Stack>\n            <Radio.Group name=\"smokingStatus\" label=\"Smoking Status\" required>\n              {Object.entries(smokingStatusOptions).map(([code, text]) => (\n                <Radio key={code} value={code} label={text} my=\"xs\" />\n              ))}\n            </Radio.Group>\n            <Group justify=\"flex-end\" gap={4} mt=\"md\">\n              <Button type=\"submit\">Save</Button>\n            </Group>\n          </Stack>\n        </Form>\n      </Modal>\n    </>\n  );\n}\n", "import { Anchor, Button, Grid, Group, Modal, Stack, Text, Textarea, TextInput } from '@mantine/core';\nimport { useDisclosure } from '@mantine/hooks';\nimport { Encounter, Observation, Patient } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useCallback, useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { QuantityDisplay } from '../QuantityDisplay/QuantityDisplay';\nimport { killEvent } from '../utils/dom';\nimport {\n  createCompoundObservation,\n  createLoincCode,\n  createObservation,\n  createQuantity,\n  getCompoundObservationValue,\n  getObservationValue,\n} from './Vitals.utils';\n\ninterface ObservationMeta {\n  readonly code: string;\n  readonly title: string;\n  readonly unit: string;\n}\n\nconst LOINC_CODES: Record<string, ObservationMeta> = {\n  bloodPressure: {\n    code: '85354-9',\n    title: 'Blood Pressure',\n    unit: 'mm[Hg]',\n  },\n  heartRate: {\n    code: '8867-4',\n    title: 'Heart Rate',\n    unit: '/min',\n  },\n  bodyTemperature: {\n    code: '8310-5',\n    title: 'Body Temperature',\n    unit: 'Cel',\n  },\n  respiratoryRate: {\n    code: '9279-1',\n    title: 'Respiratory Rate',\n    unit: '/min',\n  },\n  height: {\n    code: '8302-2',\n    title: 'height',\n    unit: 'cm',\n  },\n  weight: {\n    code: '29463-7',\n    title: 'weight',\n    unit: 'kg',\n  },\n  bmi: {\n    code: '39156-5',\n    title: 'BMI',\n    unit: 'kg/m2',\n  },\n  oxygen: {\n    code: '2708-6',\n    title: 'Oxygen',\n    unit: '%',\n  },\n  headCircumference: {\n    code: '9843-4',\n    title: 'Head Circumference',\n    unit: 'cm',\n  },\n};\n\nconst SYSTOLIC = '8480-6';\nconst DIASTOLIC = '8462-4';\n\nexport interface VitalsProps {\n  readonly patient: Patient;\n  readonly encounter?: Encounter;\n  readonly vitals: Observation[];\n}\n\nexport function Vitals(props: VitalsProps): JSX.Element {\n  const medplum = useMedplum();\n  const { patient, encounter } = props;\n  const [vitals, setVitals] = useState<Observation[]>(props.vitals);\n  const [opened, { open, close }] = useDisclosure(false);\n\n  const handleSubmit = useCallback(\n    (formData: Record<string, string>) => {\n      const newObservations = Object.entries(LOINC_CODES)\n        .map(([name, meta]) => {\n          if (name === 'bloodPressure') {\n            return createCompoundObservation(patient, encounter, meta.code, meta.title, [\n              {\n                code: createLoincCode(SYSTOLIC, 'Systolic blood pressure'),\n                valueQuantity: createQuantity(parseFloat(formData['systolic']), 'mm[Hg]'),\n              },\n              {\n                code: createLoincCode(DIASTOLIC, 'Diastolic blood pressure'),\n                valueQuantity: createQuantity(parseFloat(formData['diastolic']), 'mm[Hg]'),\n              },\n            ]);\n          }\n          return createObservation(\n            patient,\n            encounter,\n            meta.code,\n            meta.title,\n            createQuantity(parseFloat(formData[name]), meta.unit)\n          );\n        })\n        .filter(Boolean) as Observation[];\n\n      // Execute all create requests in parallel to take advantage of autobatching\n      Promise.all(newObservations.map((obs) => medplum.createResource<Observation>(obs)))\n        .then((newVitals) => setVitals([...newVitals, ...vitals]))\n        .catch(console.error);\n\n      close();\n    },\n    [medplum, patient, encounter, vitals, close]\n  );\n\n  return (\n    <>\n      <Group justify=\"space-between\">\n        <Text fz=\"md\" fw={700}>\n          Vitals\n        </Text>\n        <Anchor\n          href=\"#\"\n          onClick={(e) => {\n            killEvent(e);\n            open();\n          }}\n        >\n          + Add\n        </Anchor>\n      </Group>\n      <Grid>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          BP Sys\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getCompoundObservationValue(vitals, LOINC_CODES.bloodPressure.code, SYSTOLIC)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          BP Dias\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getCompoundObservationValue(vitals, LOINC_CODES.bloodPressure.code, DIASTOLIC)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          HR\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.heartRate.code)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          Temp\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.bodyTemperature.code)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          RR\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.respiratoryRate.code)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          Height\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.height.code)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          Weight\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.weight.code)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          BMI\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.bmi.code)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          O2\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.oxygen.code)} />\n        </Grid.Col>\n        <Grid.Col span={3} ta=\"right\" c=\"dimmed\">\n          HC\n        </Grid.Col>\n        <Grid.Col span={3}>\n          <QuantityDisplay value={getObservationValue(vitals, LOINC_CODES.headCircumference.code)} />\n        </Grid.Col>\n      </Grid>\n      <Modal opened={opened} onClose={close} title=\"Add Vitals\">\n        <Form onSubmit={handleSubmit}>\n          <Stack>\n            <Group grow>\n              <TextInput name=\"systolic\" label=\"BP Sys\" data-autofocus={true} autoFocus />\n              <TextInput name=\"diastolic\" label=\"BP Dias\" />\n            </Group>\n            <Group grow>\n              <TextInput name=\"heartRate\" label=\"HR\" />\n              <TextInput name=\"bodyTemperature\" label=\"Temp\" />\n            </Group>\n            <Group grow>\n              <TextInput name=\"respiratoryRate\" label=\"RR\" />\n              <TextInput name=\"height\" label=\"height\" />\n            </Group>\n            <Group grow>\n              <TextInput name=\"weight\" label=\"Wt\" />\n              <TextInput name=\"bmi\" label=\"BMI\" />\n            </Group>\n            <Group grow>\n              <TextInput name=\"oxygen\" label=\"O2\" />\n              <TextInput name=\"headCircumference\" label=\"HC\" />\n            </Group>\n            <Textarea name=\"notes\" label=\"Notes\" />\n          </Stack>\n          <Group justify=\"flex-end\" gap={4} mt=\"md\">\n            <Button type=\"submit\">Save</Button>\n          </Group>\n        </Form>\n      </Modal>\n    </>\n  );\n}\n", "import { LOINC, UCUM, createReference } from '@medplum/core';\nimport { CodeableConcept, Encounter, Observation, ObservationComponent, Patient, Quantity } from '@medplum/fhirtypes';\n\nexport function getObservationValue(observations: Observation[], code: string): Quantity | undefined {\n  const observation = observations.find((o) => o.code?.coding?.[0].code === code);\n  return observation?.valueQuantity;\n}\n\nexport function getCompoundObservationValue(\n  observations: Observation[],\n  code: string,\n  innerCode: string\n): Quantity | undefined {\n  const observation = observations.find((o) => o.code?.coding?.[0].code === code);\n  const component = observation?.component?.find((c) => c.code?.coding?.[0].code === innerCode);\n  return component?.valueQuantity;\n}\n\nexport function createObservation(\n  patient: Patient,\n  encounter: Encounter | undefined,\n  code: string,\n  title: string,\n  valueQuantity: Quantity\n): Observation | undefined {\n  if (!isValidNumber(valueQuantity.value)) {\n    return undefined;\n  }\n  return {\n    ...createBaseObservation(patient, encounter, code, title),\n    valueQuantity,\n  };\n}\n\nexport function createCompoundObservation(\n  patient: Patient,\n  encounter: Encounter | undefined,\n  code: string,\n  title: string,\n  components: ObservationComponent[]\n): Observation | undefined {\n  const component = components.filter((c) => isValidNumber(c.valueQuantity?.value));\n  if (component.length === 0) {\n    return undefined;\n  }\n  return {\n    ...createBaseObservation(patient, encounter, code, title),\n    component,\n  };\n}\n\nexport function createBaseObservation(\n  patient: Patient,\n  encounter: Encounter | undefined,\n  code: string,\n  title: string\n): Observation {\n  return {\n    resourceType: 'Observation',\n    status: 'preliminary',\n    subject: createReference(patient),\n    encounter: encounter ? createReference(encounter) : undefined,\n    effectiveDateTime: new Date().toISOString(),\n    category: [\n      {\n        coding: [\n          {\n            system: 'http://terminology.hl7.org/CodeSystem/observation-category',\n            code: 'vital-signs',\n            display: 'Vital Signs',\n          },\n        ],\n      },\n    ],\n    code: createLoincCode(code, title),\n  };\n}\n\nexport function createLoincCode(code: string, display: string): CodeableConcept {\n  return {\n    coding: [\n      {\n        code,\n        display,\n        system: LOINC,\n      },\n    ],\n    text: display,\n  };\n}\n\nexport function createQuantity(value: number, unit: string): Quantity {\n  return {\n    value,\n    system: UCUM,\n    unit,\n    code: unit,\n  };\n}\n\nfunction isValidNumber(value: number | undefined): boolean {\n  return value !== undefined && !isNaN(value) && isFinite(value);\n}\n", "import { createReference, MedplumClient, ProfileResource } from '@medplum/core';\nimport { Attachment, Patient, Reference, ResourceType } from '@medplum/fhirtypes';\nimport { useCallback } from 'react';\nimport { ResourceTimeline } from '../ResourceTimeline/ResourceTimeline';\n\nexport interface PatientTimelineProps {\n  readonly patient: Patient | Reference<Patient>;\n}\n\nexport function PatientTimeline(props: PatientTimelineProps): JSX.Element {\n  const loadTimelineResources = useCallback((medplum: MedplumClient, resourceType: ResourceType, id: string) => {\n    const ref = `${resourceType}/${id}`;\n    const _count = 100;\n    return Promise.allSettled([\n      medplum.readHistory('Patient', id),\n      medplum.search('Communication', { subject: ref, _count }),\n      medplum.search('Device', { patient: ref, _count }),\n      medplum.search('DeviceRequest', { patient: ref, _count }),\n      medplum.search('DiagnosticReport', { subject: ref, _count }),\n      medplum.search('Media', { subject: ref, _count }),\n      medplum.search('ServiceRequest', { subject: ref, _count }),\n      medplum.search('Task', { subject: ref, _count }),\n    ]);\n  }, []);\n\n  return (\n    <ResourceTimeline\n      value={props.patient}\n      loadTimelineResources={loadTimelineResources}\n      createCommunication={(resource: Patient, sender: ProfileResource, text: string) => ({\n        resourceType: 'Communication',\n        status: 'completed',\n        subject: createReference(resource),\n        sender: createReference(sender),\n        sent: new Date().toISOString(),\n        payload: [{ contentString: text }],\n      })}\n      createMedia={(resource: Patient, operator: ProfileResource, content: Attachment) => ({\n        resourceType: 'Media',\n        status: 'completed',\n        subject: createReference(resource),\n        operator: createReference(operator),\n        issued: new Date().toISOString(),\n        content,\n      })}\n    />\n  );\n}\n", "import { Anchor, Button, NativeSelect, Stack, TextInput } from '@mantine/core';\nimport { InternalSchemaElement, getReferenceString } from '@medplum/core';\nimport { PlanDefinition, PlanDefinitionAction, Reference, ResourceType } from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport cx from 'clsx';\nimport { MouseEvent, SyntheticEvent, useEffect, useRef, useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { FormSection } from '../FormSection/FormSection';\nimport { ReferenceDisplay } from '../ReferenceDisplay/ReferenceDisplay';\nimport { setPropertyValue } from '../ResourceForm/ResourceForm.utils';\nimport { ResourceInput } from '../ResourceInput/ResourceInput';\nimport { ResourcePropertyDisplay } from '../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport { getValueAndType } from '../ResourcePropertyDisplay/ResourcePropertyDisplay.utils';\nimport { ResourcePropertyInput } from '../ResourcePropertyInput/ResourcePropertyInput';\nimport { killEvent } from '../utils/dom';\nimport classes from './PlanDefinitionBuilder.module.css';\n\nexport interface PlanDefinitionBuilderProps {\n  readonly value: Partial<PlanDefinition> | Reference<PlanDefinition>;\n  readonly onSubmit: (result: PlanDefinition) => void;\n}\n\nexport function PlanDefinitionBuilder(props: PlanDefinitionBuilderProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const defaultValue = useResource(props.value);\n  const [schemaLoaded, setSchemaLoaded] = useState(false);\n  const [selectedKey, setSelectedKey] = useState<string>();\n  const [hoverKey, setHoverKey] = useState<string>();\n  const [value, setValue] = useState<PlanDefinition>();\n\n  function handleDocumentMouseOver(): void {\n    setHoverKey(undefined);\n  }\n\n  function handleDocumentClick(): void {\n    setSelectedKey(undefined);\n  }\n\n  const valueRef = useRef<PlanDefinition>();\n  valueRef.current = value;\n\n  useEffect(() => {\n    medplum\n      .requestSchema('PlanDefinition')\n      .then(() => setSchemaLoaded(true))\n      .catch(console.log);\n  }, [medplum]);\n\n  useEffect(() => {\n    setValue(ensurePlanDefinitionKeys(defaultValue ?? { resourceType: 'PlanDefinition', status: 'active' }));\n    document.addEventListener('mouseover', handleDocumentMouseOver);\n    document.addEventListener('click', handleDocumentClick);\n    return () => {\n      document.removeEventListener('mouseover', handleDocumentMouseOver);\n      document.removeEventListener('click', handleDocumentClick);\n    };\n  }, [defaultValue]);\n\n  if (!schemaLoaded || !value) {\n    return null;\n  }\n\n  function changeProperty(property: string, newValue: any): void {\n    setValue({\n      ...valueRef.current,\n      [property]: newValue,\n    } as PlanDefinition);\n  }\n\n  return (\n    <div>\n      <Form testid=\"questionnaire-form\" onSubmit={() => props.onSubmit(value)}>\n        <TextInput\n          label=\"Plan Title\"\n          defaultValue={value.title}\n          onChange={(e) => changeProperty('title', e.currentTarget.value)}\n        />\n        <ActionArrayBuilder\n          actions={value.action || []}\n          selectedKey={selectedKey}\n          setSelectedKey={setSelectedKey}\n          hoverKey={hoverKey}\n          setHoverKey={setHoverKey}\n          onChange={(x) => changeProperty('action', x)}\n        />\n        <Button type=\"submit\">Save</Button>\n      </Form>\n    </div>\n  );\n}\n\ninterface ActionArrayBuilderProps {\n  readonly actions: PlanDefinitionAction[];\n  readonly selectedKey: string | undefined;\n  readonly setSelectedKey: (key: string | undefined) => void;\n  readonly hoverKey: string | undefined;\n  readonly setHoverKey: (key: string | undefined) => void;\n  readonly onChange: (actions: PlanDefinitionAction[]) => void;\n}\n\nfunction ActionArrayBuilder(props: ActionArrayBuilderProps): JSX.Element {\n  const actionsRef = useRef<PlanDefinitionAction[]>();\n  actionsRef.current = props.actions;\n\n  function changeAction(changedAction: PlanDefinitionAction): void {\n    props.onChange(\n      (actionsRef.current as PlanDefinition[]).map((i) => (i.id === changedAction.id ? changedAction : i))\n    );\n  }\n\n  function addAction(addedAction: PlanDefinitionAction): void {\n    props.onChange([...(actionsRef.current as PlanDefinition[]), addedAction]);\n    props.setSelectedKey(addedAction.id);\n  }\n\n  function removeAction(removedAction: PlanDefinitionAction): void {\n    props.onChange((actionsRef.current as PlanDefinition[]).filter((i) => i !== removedAction));\n  }\n\n  return (\n    <div className={classes.section}>\n      {props.actions.map((action) => (\n        <div key={action.id}>\n          <ActionBuilder\n            action={action}\n            selectedKey={props.selectedKey}\n            setSelectedKey={props.setSelectedKey}\n            hoverKey={props.hoverKey}\n            setHoverKey={props.setHoverKey}\n            onChange={changeAction}\n            onRemove={() => removeAction(action)}\n          />\n        </div>\n      ))}\n      <div className={classes.bottomActions}>\n        <Anchor\n          href=\"#\"\n          onClick={(e: MouseEvent) => {\n            killEvent(e);\n            addAction({ id: generateId() });\n          }}\n        >\n          Add action\n        </Anchor>\n      </div>\n    </div>\n  );\n}\n\ninterface ActionBuilderProps {\n  readonly action: PlanDefinitionAction;\n  readonly selectedKey: string | undefined;\n  readonly setSelectedKey: (key: string | undefined) => void;\n  readonly hoverKey: string | undefined;\n  readonly setHoverKey: (key: string | undefined) => void;\n  readonly onChange: (action: PlanDefinitionAction) => void;\n  readonly onRemove: () => void;\n}\n\nfunction ActionBuilder(props: ActionBuilderProps): JSX.Element {\n  const { action } = props;\n  const actionType = getInitialActionType(action);\n  const editing = props.selectedKey === props.action.id;\n  const hovering = props.hoverKey === props.action.id;\n\n  function onClick(e: SyntheticEvent): void {\n    e.stopPropagation();\n    props.setSelectedKey(props.action.id);\n  }\n\n  function onHover(e: SyntheticEvent): void {\n    killEvent(e);\n    props.setHoverKey(props.action.id);\n  }\n\n  const className = cx(classes.section, {\n    [classes.editing]: editing,\n    [classes.hovering]: hovering && !editing,\n  });\n\n  return (\n    <div data-testid={action.id} className={className} onClick={onClick} onMouseOver={onHover} onFocus={onHover}>\n      {editing ? (\n        <ActionEditor\n          action={action}\n          actionType={actionType}\n          onChange={props.onChange}\n          selectedKey={props.selectedKey}\n          setSelectedKey={props.setSelectedKey}\n          hoverKey={props.hoverKey}\n          setHoverKey={props.setHoverKey}\n          onRemove={props.onRemove}\n        />\n      ) : (\n        <ActionDisplay action={action} actionType={actionType} />\n      )}\n      <div className={classes.bottomActions}>\n        <Anchor\n          href=\"#\"\n          onClick={(e: MouseEvent) => {\n            e.preventDefault();\n            props.onRemove();\n          }}\n        >\n          Remove\n        </Anchor>\n      </div>\n    </div>\n  );\n}\n\nconst timingProperty: InternalSchemaElement = {\n  path: 'PlanDefinition.action.timing[x]',\n  min: 0,\n  max: 1,\n  description: '',\n  isArray: false,\n  constraints: [],\n  type: ['dateTime', 'Period', 'Range', 'Timing'].map((t) => ({ code: t })),\n};\n\ninterface ActionDisplayProps {\n  readonly action: PlanDefinitionAction;\n  readonly actionType: string | undefined;\n}\n\nfunction ActionDisplay(props: ActionDisplayProps): JSX.Element {\n  const { action, actionType } = props;\n  const [propertyValue, propertyType] = getActionTiming(action);\n  return (\n    <div>\n      <div>\n        {action.title || 'Untitled'} {actionType && `(${actionType})`}\n      </div>\n      {action.definitionCanonical && (\n        <div>\n          <ReferenceDisplay value={{ reference: action.definitionCanonical }} />\n        </div>\n      )}\n      {propertyValue && (\n        <div>\n          <ResourcePropertyDisplay property={timingProperty} propertyType={propertyType} value={propertyValue} />\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface ActionEditorProps {\n  readonly action: PlanDefinitionAction;\n  readonly actionType: string | undefined;\n  readonly selectedKey: string | undefined;\n  readonly setSelectedKey: (key: string | undefined) => void;\n  readonly hoverKey: string | undefined;\n  readonly setHoverKey: (key: string | undefined) => void;\n  readonly onChange: (action: PlanDefinitionAction) => void;\n  readonly onRemove: () => void;\n}\n\nfunction ActionEditor(props: ActionEditorProps): JSX.Element {\n  const { action } = props;\n  const [actionType, setActionType] = useState<string | undefined>(props.actionType);\n\n  function changeProperty(property: string, value: any): void {\n    props.onChange({\n      ...action,\n      [property]: value,\n    } as PlanDefinitionAction);\n  }\n\n  return (\n    <Stack gap=\"xl\">\n      <TextInput\n        name={`actionTitle-${action.id}`}\n        label=\"Title\"\n        defaultValue={action.title}\n        onChange={(e) => changeProperty('title', e.currentTarget.value)}\n      />\n      <TextInput\n        name={`actionDescription-${action.id}`}\n        label=\"Description\"\n        defaultValue={action.description}\n        onChange={(e) => changeProperty('description', e.currentTarget.value)}\n      />\n      <NativeSelect\n        label=\"Type of Action\"\n        description=\"The type of the action to be performed.\"\n        name={`actionType-${action.id}`}\n        defaultValue={actionType}\n        onChange={(e) => setActionType(e.currentTarget.value)}\n        data={['', 'appointment', 'lab', 'questionnaire', 'task']}\n      />\n      {action.action && action.action.length > 0 && (\n        <ActionArrayBuilder\n          actions={action.action}\n          selectedKey={props.selectedKey}\n          setSelectedKey={props.setSelectedKey}\n          hoverKey={props.hoverKey}\n          setHoverKey={props.setHoverKey}\n          onChange={(x) => changeProperty('action', x)}\n        />\n      )}\n      {(() => {\n        switch (actionType) {\n          case 'appointment':\n            return (\n              <ActionResourceTypeBuilder\n                title=\"Appointment\"\n                description=\"The subject must schedule an appointment from the schedule.\"\n                resourceType=\"Schedule\"\n                action={action}\n                onChange={props.onChange}\n              />\n            );\n          case 'lab':\n            return (\n              <ActionResourceTypeBuilder\n                title=\"Lab\"\n                description=\"The subject must complete the following lab panel.\"\n                resourceType=\"ActivityDefinition\"\n                action={action}\n                onChange={props.onChange}\n              />\n            );\n          case 'questionnaire':\n            return (\n              <ActionResourceTypeBuilder\n                title=\"Questionnaire\"\n                description=\"The subject must complete the selected questionnaire.\"\n                resourceType=\"Questionnaire\"\n                action={action}\n                onChange={props.onChange}\n              />\n            );\n          case 'task':\n            return (\n              <ActionResourceTypeBuilder\n                title=\"Task\"\n                description=\"The subject must complete the following task.\"\n                resourceType=\"ActivityDefinition\"\n                action={action}\n                onChange={props.onChange}\n              />\n            );\n          default:\n            return null;\n        }\n      })()}\n      <FormSection title=\"Timing\" description=\"When the action should take place.\">\n        <ActionTimingInput name={'timing-' + action.id} action={action} onChange={props.onChange} />\n      </FormSection>\n    </Stack>\n  );\n}\n\ninterface ActionResourceTypeBuilderProps {\n  readonly action: PlanDefinitionAction;\n  readonly title: string;\n  readonly description: string;\n  readonly resourceType: ResourceType;\n  readonly onChange: (action: PlanDefinitionAction) => void;\n}\n\nfunction ActionResourceTypeBuilder(props: ActionResourceTypeBuilderProps): JSX.Element {\n  const { id, definitionCanonical } = props.action;\n  const reference = definitionCanonical?.startsWith(props.resourceType + '/')\n    ? { reference: definitionCanonical }\n    : undefined;\n  return (\n    <ResourceInput\n      name={id as string}\n      resourceType={props.resourceType}\n      defaultValue={reference}\n      loadOnFocus={true}\n      onChange={(newValue) => {\n        if (newValue) {\n          props.onChange({ ...props.action, definitionCanonical: getReferenceString(newValue) });\n        } else {\n          props.onChange({ ...props.action, definitionCanonical: undefined });\n        }\n      }}\n    />\n  );\n}\n\ninterface ActionTimingInputProps {\n  readonly name: string;\n  readonly action: PlanDefinitionAction;\n  readonly onChange: (action: PlanDefinitionAction) => void;\n}\n\nfunction ActionTimingInput(props: ActionTimingInputProps): JSX.Element {\n  const value = props.action;\n  const key = 'timing';\n  const [propertyValue, propertyType] = getActionTiming(value);\n  return (\n    <ResourcePropertyInput\n      property={timingProperty}\n      name=\"timing[x]\"\n      path=\"PlanDefinition.timing[x]\"\n      defaultValue={propertyValue}\n      defaultPropertyType={propertyType}\n      onChange={(newValue: any, propName?: string) => {\n        props.onChange(setPropertyValue(value, key, propName ?? key, timingProperty, newValue));\n      }}\n      outcome={undefined}\n    />\n  );\n}\n\nfunction getInitialActionType(action: PlanDefinitionAction): string | undefined {\n  if (action.definitionCanonical?.startsWith('Schedule')) {\n    return 'appointment';\n  }\n\n  if (action.definitionCanonical?.startsWith('Questionnaire/')) {\n    return 'questionnaire';\n  }\n\n  if (action.definitionCanonical?.startsWith('ActivityDefinition/')) {\n    return 'task';\n  }\n\n  return undefined;\n}\n\nfunction getActionTiming(action: PlanDefinitionAction): [any, string] {\n  return getValueAndType({ type: 'PlanDefinitionAction', value: action }, 'timing');\n}\n\nlet nextId = 1;\n\n/**\n * Generates a unique ID.\n * React needs unique IDs for components for rendering performance.\n * All of the important components in the questionnaire builder have id properties for this:\n * Questionnaire, QuestionnaireItem, and QuestionnaireItemAnswerOption.\n * @param existing - Optional existing id which will update nextId.\n * @returns A unique key.\n */\nfunction generateId(existing?: string): string {\n  if (existing) {\n    if (existing.startsWith('id-')) {\n      const existingNum = parseInt(existing.substring(3), 10);\n      if (!isNaN(existingNum)) {\n        nextId = Math.max(nextId, existingNum + 1);\n      }\n    }\n    return existing;\n  }\n  return 'id-' + nextId++;\n}\n\nfunction ensurePlanDefinitionKeys(planDefinition: PlanDefinition): PlanDefinition {\n  return {\n    ...planDefinition,\n    action: ensurePlanDefinitionActionKeys(planDefinition.action),\n  } as PlanDefinition;\n}\n\nfunction ensurePlanDefinitionActionKeys(\n  actions: PlanDefinitionAction[] | undefined\n): PlanDefinitionAction[] | undefined {\n  if (!actions) {\n    return undefined;\n  }\n  return actions.map((action) => ({\n    ...action,\n    id: generateId(action.id),\n    action: ensurePlanDefinitionActionKeys(action.action),\n  }));\n}\n", "\n.section {\n  position: relative;\n  margin: 4px 4px 8px;\n  padding: 6px 12px 16px 6px;\n  border: 1.5px solid var(--mantine-color-gray-1);\n  border-radius: var(--mantine-radius-sm);\n  transition: all 0.1;\n}\n\n.hovering {\n  border: 1.5px solid var(--mantine-color-blue-5);\n}\n\n.editing {\n  border: 1.5px solid var(--mantine-color-gray-1);\n  border-left: 4px solid var(--mantine-color-blue-5);\n}\n\n.bottomActions {\n  position: absolute;\n  right: 4px;\n  bottom: 0;\n  font-size: var(--mantine-font-size-xs);\n\n  & a {\n    margin-left: 8px;\n  }\n}", "import { Anchor, Box, Button, Group, NativeSelect, Space, Textarea, TextInput, Title } from '@mantine/core';\nimport { getElementDefinition, isResource as isResourceType } from '@medplum/core';\nimport {\n  Extension,\n  Questionnaire,\n  QuestionnaireItem,\n  QuestionnaireItemAnswerOption,\n  Reference,\n  ResourceType,\n} from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport { IconArrowDown, IconArrowUp } from '@tabler/icons-react';\nimport cx from 'clsx';\nimport { MouseEvent, SyntheticEvent, useEffect, useRef, useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { QuestionnaireFormItem } from '../QuestionnaireForm/QuestionnaireFormItem/QuestionnaireFormItem';\nimport { getValueAndType } from '../ResourcePropertyDisplay/ResourcePropertyDisplay.utils';\nimport { ResourcePropertyInput } from '../ResourcePropertyInput/ResourcePropertyInput';\nimport { ResourceTypeInput } from '../ResourceTypeInput/ResourceTypeInput';\nimport { killEvent } from '../utils/dom';\nimport {\n  getQuestionnaireItemReferenceTargetTypes,\n  isChoiceQuestion,\n  QuestionnaireItemType,\n  setQuestionnaireItemReferenceTargetTypes,\n} from '../utils/questionnaire';\nimport classes from './QuestionnaireBuilder.module.css';\n\nexport interface QuestionnaireBuilderProps {\n  readonly questionnaire: Partial<Questionnaire> | Reference<Questionnaire>;\n  readonly onSubmit: (result: Questionnaire) => void;\n  readonly autoSave?: boolean;\n}\n\nexport function QuestionnaireBuilder(props: QuestionnaireBuilderProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const defaultValue = useResource(props.questionnaire);\n  const [schemaLoaded, setSchemaLoaded] = useState(false);\n  const [value, setValue] = useState<Questionnaire>();\n  const [selectedKey, setSelectedKey] = useState<string>();\n  const [hoverKey, setHoverKey] = useState<string>();\n\n  function handleDocumentMouseOver(): void {\n    setHoverKey(undefined);\n  }\n\n  function handleDocumentClick(): void {\n    setSelectedKey(undefined);\n  }\n\n  useEffect(() => {\n    medplum\n      .requestSchema('Questionnaire')\n      .then(() => setSchemaLoaded(true))\n      .catch(console.log);\n  }, [medplum]);\n\n  useEffect(() => {\n    setValue(ensureQuestionnaireKeys(defaultValue ?? { resourceType: 'Questionnaire', status: 'active' }));\n    document.addEventListener('mouseover', handleDocumentMouseOver);\n    document.addEventListener('click', handleDocumentClick);\n    return () => {\n      document.removeEventListener('mouseover', handleDocumentMouseOver);\n      document.removeEventListener('click', handleDocumentClick);\n    };\n  }, [defaultValue]);\n\n  const handleChange = (questionnaire: Questionnaire, disableSubmit?: boolean): void => {\n    setValue(questionnaire);\n    if (props.autoSave && !disableSubmit && props.onSubmit) {\n      props.onSubmit(questionnaire);\n    }\n  };\n\n  if (!schemaLoaded || !value) {\n    return null;\n  }\n\n  return (\n    <div>\n      <Form testid=\"questionnaire-form\" onSubmit={() => props.onSubmit(value)}>\n        <ItemBuilder\n          item={value}\n          selectedKey={selectedKey}\n          setSelectedKey={setSelectedKey}\n          hoverKey={hoverKey}\n          setHoverKey={setHoverKey}\n          onChange={handleChange}\n        />\n        <Button type=\"submit\">Save</Button>\n      </Form>\n    </div>\n  );\n}\n\ninterface ItemBuilderProps<T extends Questionnaire | QuestionnaireItem> {\n  readonly item: T;\n  readonly selectedKey: string | undefined;\n  readonly setSelectedKey: (key: string | undefined) => void;\n  readonly hoverKey: string | undefined;\n  readonly isFirst?: boolean;\n  readonly isLast?: boolean;\n  readonly setHoverKey: (key: string | undefined) => void;\n  readonly onChange: (item: T, disableSubmit?: boolean) => void;\n  readonly onRemove?: () => void;\n  readonly onRepeatable?: (item: QuestionnaireItem) => void;\n  onMoveUp?(): void;\n  onMoveDown?(): void;\n}\n\nfunction ItemBuilder<T extends Questionnaire | QuestionnaireItem>(props: ItemBuilderProps<T>): JSX.Element {\n  const resource = props.item as Questionnaire;\n  const item = props.item as QuestionnaireItem;\n  const isResource = isResourceType(props.item);\n  const isContainer = isResource || item.type === QuestionnaireItemType.group;\n  const linkId = item.linkId ?? '[untitled]';\n  const editing = props.selectedKey === props.item.id;\n  const hovering = props.hoverKey === props.item.id;\n\n  const itemRef = useRef<T>();\n  itemRef.current = props.item;\n\n  function onClick(e: SyntheticEvent): void {\n    killEvent(e);\n    props.setSelectedKey(props.item.id);\n  }\n\n  function onHover(e: SyntheticEvent): void {\n    killEvent(e);\n    props.setHoverKey(props.item.id);\n  }\n\n  function changeItem(changedItem: QuestionnaireItem): void {\n    const curr = itemRef.current as T;\n    props.onChange({\n      ...curr,\n      item: curr.item?.map((i) => (i.id === changedItem.id ? changedItem : i)),\n    } as T);\n  }\n\n  function addItem(addedItem: QuestionnaireItem, disableSubmit?: boolean): void {\n    props.onChange(\n      {\n        ...props.item,\n        item: [...(props.item.item ?? []), addedItem],\n      },\n      disableSubmit\n    );\n  }\n\n  function removeItem(removedItem: QuestionnaireItem): void {\n    props.onChange({\n      ...props.item,\n      item: props.item.item?.filter((i) => i !== removedItem),\n    });\n  }\n\n  function changeProperty(property: string, value: any): void {\n    props.onChange({\n      ...itemRef.current,\n      [property]: value,\n    } as T);\n  }\n\n  function updateItem(updatedItem: QuestionnaireItem): void {\n    props.onChange({\n      ...props.item,\n      ...updatedItem,\n    });\n  }\n\n  function toggleRepeatable(item: QuestionnaireItem): void {\n    props.onChange({\n      ...props.item,\n      item: props.item.item?.map((i) => (i === item ? { ...i, repeats: !i.repeats } : i)),\n    });\n  }\n\n  function moveItem(itemIndex: number, delta: number): void {\n    const updatedItems = reorderItems(props.item.item, itemIndex, delta);\n\n    props.onChange({\n      ...props.item,\n      item: updatedItems,\n    });\n  }\n\n  const className = cx(classes.section, {\n    [classes.editing]: editing,\n    [classes.hovering]: hovering && !editing,\n  });\n\n  return (\n    <div data-testid={item.linkId} className={className} onClick={onClick} onMouseOver={onHover} onFocus={onHover}>\n      <div className={classes.questionBody}>\n        {editing ? (\n          <>\n            {isResource && (\n              <TextInput\n                size=\"xl\"\n                defaultValue={resource.title}\n                onBlur={(e) => changeProperty('title', e.currentTarget.value)}\n              />\n            )}\n            {!isResource && (\n              <Textarea\n                autosize\n                minRows={2}\n                defaultValue={item.text}\n                onBlur={(e) => changeProperty('text', e.currentTarget.value)}\n              />\n            )}\n            {item.type === 'reference' && <ReferenceProfiles item={item} onChange={updateItem} />}\n            {isChoiceQuestion(item) && <AnswerBuilder item={item} onChange={(item) => updateItem(item)} />}\n          </>\n        ) : (\n          <>\n            {resource.title && <Title>{resource.title}</Title>}\n            {item.text && <div>{item.text}</div>}\n            {!isContainer && (\n              <QuestionnaireFormItem\n                item={item}\n                index={0}\n                onChange={() => undefined}\n                response={{ linkId: item.linkId }}\n              />\n            )}\n          </>\n        )}\n      </div>\n      {item.item?.map((item, i) => (\n        <div key={item.id}>\n          <ItemBuilder\n            item={item}\n            selectedKey={props.selectedKey}\n            setSelectedKey={props.setSelectedKey}\n            hoverKey={props.hoverKey}\n            isFirst={i === 0}\n            isLast={i === (props.item.item ?? []).length - 1}\n            setHoverKey={props.setHoverKey}\n            onChange={changeItem}\n            onRemove={() => removeItem(item)}\n            onRepeatable={toggleRepeatable}\n            onMoveUp={() => moveItem(i, -1)}\n            onMoveDown={() => moveItem(i, 1)}\n          />\n        </div>\n      ))}\n      {!isContainer && (\n        <div className={classes.topActions}>\n          {editing ? (\n            <>\n              <TextInput\n                size=\"xs\"\n                className={classes.linkIdInput}\n                defaultValue={item.linkId}\n                onBlur={(e) => changeProperty('linkId', e.currentTarget.value)}\n              />\n              {!isContainer && (\n                <NativeSelect\n                  size=\"xs\"\n                  className={classes.typeSelect}\n                  defaultValue={item.type}\n                  onChange={(e) => changeProperty('type', e.currentTarget.value)}\n                  data={[\n                    { value: 'display', label: 'Display' },\n                    { value: 'boolean', label: 'Boolean' },\n                    { value: 'decimal', label: 'Decimal' },\n                    { value: 'integer', label: 'Integer' },\n                    { value: 'date', label: 'Date' },\n                    { value: 'dateTime', label: 'Date/Time' },\n                    { value: 'time', label: 'Time' },\n                    { value: 'string', label: 'String' },\n                    { value: 'text', label: 'Text' },\n                    { value: 'url', label: 'URL' },\n                    { value: 'choice', label: 'Choice' },\n                    { value: 'open-choice', label: 'Open Choice' },\n                    { value: 'attachment', label: 'Attachment' },\n                    { value: 'reference', label: 'Reference' },\n                    { value: 'quantity', label: 'Quantity' },\n                  ]}\n                />\n              )}\n            </>\n          ) : (\n            <div>{linkId}</div>\n          )}\n        </div>\n      )}\n      {!isResource && (\n        <Box className={classes.movementActions}>\n          <Box className={classes.columnAlignment}>\n            {!props.isFirst && (\n              <Anchor\n                href=\"#\"\n                onClick={(e: MouseEvent) => {\n                  e.preventDefault();\n                  if (props.onMoveUp) {\n                    props.onMoveUp();\n                  }\n                }}\n              >\n                <IconArrowUp data-testid=\"up-button\" size={15} className={classes.movementIcons} />\n              </Anchor>\n            )}\n            {!props.isLast && (\n              <Anchor\n                href=\"#\"\n                onClick={(e: MouseEvent) => {\n                  e.preventDefault();\n                  if (props.onMoveDown) {\n                    props.onMoveDown();\n                  }\n                }}\n              >\n                <IconArrowDown data-testid=\"down-button\" size={15} className={classes.movementIcons} />\n              </Anchor>\n            )}\n          </Box>\n        </Box>\n      )}\n      <div className={classes.bottomActions}>\n        {isContainer && (\n          <>\n            <Anchor\n              href=\"#\"\n              onClick={(e: MouseEvent) => {\n                e.preventDefault();\n                addItem({\n                  id: generateId(),\n                  linkId: generateLinkId('q'),\n                  type: 'string',\n                  text: 'Question',\n                } as QuestionnaireItem);\n              }}\n            >\n              Add item\n            </Anchor>\n            <Anchor\n              href=\"#\"\n              onClick={(e: MouseEvent) => {\n                e.preventDefault();\n                addItem(\n                  {\n                    id: generateId(),\n                    linkId: generateLinkId('g'),\n                    type: 'group',\n                    text: 'Group',\n                  } as QuestionnaireItem,\n                  true\n                );\n              }}\n            >\n              Add group\n            </Anchor>\n          </>\n        )}\n        {isResource && (\n          <Anchor\n            href=\"#\"\n            onClick={(e: MouseEvent) => {\n              e.preventDefault();\n              addItem(createPage(), true);\n            }}\n          >\n            Add Page\n          </Anchor>\n        )}\n        {editing && !isResource && (\n          <>\n            <Anchor\n              href=\"#\"\n              onClick={(e: MouseEvent) => {\n                e.preventDefault();\n                if (props.onRepeatable) {\n                  props.onRepeatable(item);\n                }\n              }}\n            >\n              {item.repeats ? 'Remove Repeatable' : 'Make Repeatable'}\n            </Anchor>\n            <Anchor\n              href=\"#\"\n              onClick={(e: MouseEvent) => {\n                e.preventDefault();\n                if (props.onRemove) {\n                  props.onRemove();\n                }\n              }}\n            >\n              Remove\n            </Anchor>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n\ninterface AnswerBuilderProps {\n  readonly item: QuestionnaireItem;\n  readonly onChange: (item: QuestionnaireItem) => void;\n}\n\nfunction AnswerBuilder(props: AnswerBuilderProps): JSX.Element {\n  const property = getElementDefinition('QuestionnaireItemAnswerOption', 'value[x]');\n  const options = props.item.answerOption ?? [];\n  return (\n    <div>\n      {props.item.answerValueSet !== undefined ? (\n        <TextInput\n          placeholder=\"Enter Value Set\"\n          defaultValue={props.item.answerValueSet}\n          onChange={(e) => props.onChange({ ...props.item, answerValueSet: e.target.value })}\n        />\n      ) : (\n        <AnswerOptionsInput options={options} property={property} item={props.item} onChange={props.onChange} />\n      )}\n      <Box display=\"flex\">\n        <Anchor\n          href=\"#\"\n          onClick={(e: SyntheticEvent) => {\n            killEvent(e);\n            props.onChange({\n              ...props.item,\n              answerValueSet: undefined,\n              answerOption: [\n                ...options,\n                {\n                  id: generateId(),\n                },\n              ],\n            });\n          }}\n        >\n          Add choice\n        </Anchor>\n        <Space w=\"lg\" />\n        <Anchor\n          href=\"#\"\n          onClick={(e: SyntheticEvent) => {\n            killEvent(e);\n            props.onChange({\n              ...props.item,\n              answerOption: [],\n              answerValueSet: '',\n            });\n          }}\n        >\n          Add value set\n        </Anchor>\n      </Box>\n    </div>\n  );\n}\n\ninterface AnswerOptionsInputProps {\n  readonly options: QuestionnaireItemAnswerOption[];\n  readonly property: any;\n  readonly item: QuestionnaireItem;\n  readonly onChange: (item: QuestionnaireItem) => void;\n}\n\nfunction AnswerOptionsInput(props: AnswerOptionsInputProps): JSX.Element {\n  return (\n    <div>\n      {props.options.map((option: QuestionnaireItemAnswerOption) => {\n        const [propertyValue, propertyType] = getValueAndType(\n          { type: 'QuestionnaireItemAnswerOption', value: option },\n          'value'\n        );\n        return (\n          <div\n            key={option.id}\n            style={{\n              display: 'flex',\n              flexDirection: 'row',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              width: '80%',\n            }}\n          >\n            <div>\n              <ResourcePropertyInput\n                key={option.id}\n                name=\"value[x]\"\n                path=\"Questionnaire.answerOption.value[x]\"\n                property={props.property}\n                defaultPropertyType={propertyType}\n                defaultValue={propertyValue}\n                onChange={(newValue: any, propName?: string) => {\n                  const newOptions = [...props.options];\n                  const index = newOptions.findIndex((o) => o.id === option.id);\n                  newOptions[index] = { id: option.id, [propName as string]: newValue };\n                  props.onChange({\n                    ...props.item,\n                    answerOption: newOptions,\n                  });\n                }}\n                outcome={undefined}\n              />\n            </div>\n\n            <div>\n              <Anchor\n                href=\"#\"\n                onClick={(e: SyntheticEvent) => {\n                  killEvent(e);\n                  props.onChange({\n                    ...props.item,\n                    answerOption: props.options.filter((o) => o.id !== option.id),\n                  });\n                }}\n              >\n                Remove\n              </Anchor>\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\ninterface ReferenceTypeProps {\n  readonly item: QuestionnaireItem;\n  readonly onChange: (updatedItem: QuestionnaireItem) => void;\n}\n\nfunction ReferenceProfiles(props: ReferenceTypeProps): JSX.Element {\n  const targetTypes = getQuestionnaireItemReferenceTargetTypes(props.item) ?? [];\n  return (\n    <>\n      {targetTypes.map((targetType: ResourceType, index: number) => {\n        return (\n          <Group key={`${targetType}-${index}`}>\n            <ResourceTypeInput\n              name=\"resourceType\"\n              placeholder=\"Resource Type\"\n              defaultValue={targetType}\n              onChange={(newValue) => {\n                props.onChange(\n                  setQuestionnaireItemReferenceTargetTypes(\n                    props.item,\n                    targetTypes.map((t) => (t === targetType ? (newValue as ResourceType) : t))\n                  )\n                );\n              }}\n            />\n            <Anchor\n              href=\"#\"\n              onClick={(e: SyntheticEvent) => {\n                killEvent(e);\n                props.onChange(\n                  setQuestionnaireItemReferenceTargetTypes(\n                    props.item,\n                    targetTypes.filter((t) => t !== targetType)\n                  )\n                );\n              }}\n            >\n              Remove\n            </Anchor>\n          </Group>\n        );\n      })}\n      <Anchor\n        href=\"#\"\n        onClick={(e: SyntheticEvent) => {\n          killEvent(e);\n          props.onChange(setQuestionnaireItemReferenceTargetTypes(props.item, [...targetTypes, '' as ResourceType]));\n        }}\n      >\n        Add Resource Type\n      </Anchor>\n    </>\n  );\n}\n\nlet nextLinkId = 1;\nlet nextId = 1;\n\n/**\n * Generates a link ID for an item.\n * Link IDs are required properties on QuestionnaireItem objects.\n * @param prefix - The link ID prefix string.\n * @returns A unique link ID.\n */\nfunction generateLinkId(prefix: string): string {\n  return prefix + nextLinkId++;\n}\n\n/**\n * Generates a unique ID.\n * React needs unique IDs for components for rendering performance.\n * All of the important components in the questionnaire builder have id properties for this:\n * Questionnaire, QuestionnaireItem, and QuestionnaireItemAnswerOption.\n * @returns A unique key.\n */\nfunction generateId(): string {\n  return 'id-' + nextId++;\n}\n\nfunction ensureQuestionnaireKeys(questionnaire: Questionnaire): Questionnaire {\n  return {\n    ...questionnaire,\n    id: questionnaire.id || generateId(),\n    item: ensureQuestionnaireItemKeys(questionnaire.item),\n  } as Questionnaire;\n}\n\nfunction ensureQuestionnaireItemKeys(items: QuestionnaireItem[] | undefined): QuestionnaireItem[] | undefined {\n  if (!items) {\n    return undefined;\n  }\n  items.forEach((item) => {\n    if (item.id?.match(/^id-\\d+$/)) {\n      nextId = Math.max(nextId, parseInt(item.id.substring(3), 10) + 1);\n    }\n    if (item.linkId?.match(/^q\\d+$/)) {\n      nextLinkId = Math.max(nextLinkId, parseInt(item.linkId.substring(1), 10) + 1);\n    }\n  });\n  return items.map((item) => ({\n    ...item,\n    id: item.id || generateId(),\n    item: ensureQuestionnaireItemKeys(item.item),\n    answerOption: ensureQuestionnaireOptionKeys(item.answerOption),\n  }));\n}\n\nfunction ensureQuestionnaireOptionKeys(\n  options: QuestionnaireItemAnswerOption[] | undefined\n): QuestionnaireItemAnswerOption[] | undefined {\n  if (!options) {\n    return undefined;\n  }\n  return options.map((option) => ({\n    ...option,\n    id: option.id || generateId(),\n  }));\n}\n\nfunction createPage(): QuestionnaireItem {\n  return {\n    id: generateId(),\n    linkId: generateLinkId('s'),\n    type: 'group',\n    text: `New Page`,\n    extension: [\n      {\n        url: 'http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl',\n        valueCodeableConcept: {\n          coding: [\n            {\n              system: 'http://hl7.org/fhir/questionnaire-item-control',\n              code: 'page',\n            },\n          ],\n        },\n      } as Extension,\n    ],\n  } as QuestionnaireItem;\n}\n\nfunction reorderItems(items: QuestionnaireItem[] | undefined, itemIndex: number, delta: number): QuestionnaireItem[] {\n  const currentItems = items ?? [];\n  const newIndex = itemIndex + delta;\n  if (newIndex < 0 || newIndex >= currentItems.length) {\n    return currentItems;\n  }\n\n  const updatedItems = [...currentItems];\n  [updatedItems[itemIndex], updatedItems[newIndex]] = [updatedItems[newIndex], updatedItems[itemIndex]];\n\n  return updatedItems;\n}\n", "import { Checkbox, Group, MultiSelect, NativeSelect, Radio, Textarea, TextInput } from '@mantine/core';\nimport {\n  capitalize,\n  deepEquals,\n  formatCodeableConcept,\n  formatCoding,\n  getElementDefinition,\n  getTypedPropertyValue,\n  stringify,\n  TypedValue,\n} from '@medplum/core';\nimport {\n  QuestionnaireItem,\n  QuestionnaireItemAnswerOption,\n  QuestionnaireItemInitial,\n  QuestionnaireResponseItem,\n  QuestionnaireResponseItemAnswer,\n} from '@medplum/fhirtypes';\nimport { ChangeEvent, useContext } from 'react';\nimport { AttachmentInput } from '../../AttachmentInput/AttachmentInput';\nimport { CheckboxFormSection } from '../../CheckboxFormSection/CheckboxFormSection';\nimport { CodingInput } from '../../CodingInput/CodingInput';\nimport { DateTimeInput } from '../../DateTimeInput/DateTimeInput';\nimport { QuantityInput } from '../../QuantityInput/QuantityInput';\nimport { ReferenceInput } from '../../ReferenceInput/ReferenceInput';\nimport { ResourcePropertyDisplay } from '../../ResourcePropertyDisplay/ResourcePropertyDisplay';\nimport {\n  formatReferenceString,\n  getNewMultiSelectValues,\n  getQuestionnaireItemReferenceFilter,\n  getQuestionnaireItemReferenceTargetTypes,\n  QuestionnaireItemType,\n} from '../../utils/questionnaire';\nimport { QuestionnaireFormContext } from '../QuestionnaireForm.context';\n\nexport interface QuestionnaireFormItemProps {\n  readonly item: QuestionnaireItem;\n  readonly index: number;\n  readonly response: QuestionnaireResponseItem;\n  readonly onChange: (newResponseItem: QuestionnaireResponseItem) => void;\n}\n\nexport function QuestionnaireFormItem(props: QuestionnaireFormItemProps): JSX.Element | null {\n  const context = useContext(QuestionnaireFormContext);\n  const item = props.item;\n  const response = props.response;\n\n  function onChangeAnswer(\n    newResponseAnswer: QuestionnaireResponseItemAnswer | QuestionnaireResponseItemAnswer[]\n  ): void {\n    let updatedAnswers: QuestionnaireResponseItemAnswer[];\n    if (Array.isArray(newResponseAnswer)) {\n      // It's a multi-select case, so use the array directly.\n      updatedAnswers = newResponseAnswer;\n    } else if (props.index >= (props.response?.answer?.length ?? 0)) {\n      // if adding a new answer\n      updatedAnswers = (props.response?.answer ?? []).concat([newResponseAnswer]);\n    } else {\n      // if updating an existing answer\n      const newAnswers = (props.response?.answer ?? []).map((a, idx) =>\n        idx === props.index ? newResponseAnswer : a\n      ) as QuestionnaireResponseItemAnswer[];\n      updatedAnswers = newAnswers ?? [];\n    }\n    props.onChange({\n      id: response?.id,\n      linkId: response?.linkId,\n      text: item.text,\n      answer: updatedAnswers,\n    });\n  }\n\n  const type = item.type;\n  if (!type) {\n    return null;\n  }\n\n  const name = item.linkId;\n  if (!name) {\n    return null;\n  }\n\n  const initial = item.initial && item.initial.length > 0 ? item.initial[0] : undefined;\n  const defaultValue =\n    getCurrentAnswer(response, props.index) ??\n    getTypedPropertyValue({ type: 'QuestionnaireItemInitial', value: initial }, 'value');\n\n  switch (type) {\n    case QuestionnaireItemType.display:\n      return <p key={props.item.linkId}>{props.item.text}</p>;\n    case QuestionnaireItemType.boolean:\n      return (\n        <CheckboxFormSection key={props.item.linkId} title={props.item.text} htmlFor={props.item.linkId}>\n          <Checkbox\n            id={props.item.linkId}\n            name={props.item.linkId}\n            defaultChecked={defaultValue?.value}\n            onChange={(e) => onChangeAnswer({ valueBoolean: e.currentTarget.checked })}\n          />\n        </CheckboxFormSection>\n      );\n    case QuestionnaireItemType.decimal:\n      return (\n        <TextInput\n          type=\"number\"\n          step=\"any\"\n          id={name}\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(e) => onChangeAnswer({ valueDecimal: e.currentTarget.valueAsNumber })}\n        />\n      );\n    case QuestionnaireItemType.integer:\n      return (\n        <TextInput\n          type=\"number\"\n          step={1}\n          id={name}\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(e) => onChangeAnswer({ valueInteger: e.currentTarget.valueAsNumber })}\n        />\n      );\n    case QuestionnaireItemType.date:\n      return (\n        <TextInput\n          type=\"date\"\n          id={name}\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(e) => onChangeAnswer({ valueDate: e.currentTarget.value })}\n        />\n      );\n    case QuestionnaireItemType.dateTime:\n      return (\n        <DateTimeInput\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(newValue: string) => onChangeAnswer({ valueDateTime: newValue })}\n        />\n      );\n    case QuestionnaireItemType.time:\n      return (\n        <TextInput\n          type=\"time\"\n          id={name}\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(e) => onChangeAnswer({ valueTime: e.currentTarget.value })}\n        />\n      );\n    case QuestionnaireItemType.string:\n    case QuestionnaireItemType.url:\n      return (\n        <TextInput\n          id={name}\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(e) => onChangeAnswer({ valueString: e.currentTarget.value })}\n        />\n      );\n    case QuestionnaireItemType.text:\n      return (\n        <Textarea\n          id={name}\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(e) => onChangeAnswer({ valueString: e.currentTarget.value })}\n        />\n      );\n    case QuestionnaireItemType.attachment:\n      return (\n        <Group py={4}>\n          <AttachmentInput\n            name={name}\n            defaultValue={defaultValue?.value}\n            onChange={(newValue) => onChangeAnswer({ valueAttachment: newValue })}\n          />\n        </Group>\n      );\n    case QuestionnaireItemType.reference:\n      return (\n        <ReferenceInput\n          name={name}\n          required={item.required}\n          targetTypes={getQuestionnaireItemReferenceTargetTypes(item)}\n          searchCriteria={getQuestionnaireItemReferenceFilter(item, context.subject, context.encounter)}\n          defaultValue={defaultValue?.value}\n          onChange={(newValue) => onChangeAnswer({ valueReference: newValue })}\n        />\n      );\n    case QuestionnaireItemType.quantity:\n      return (\n        <QuantityInput\n          name={name}\n          required={item.required}\n          defaultValue={defaultValue?.value}\n          onChange={(newValue) => onChangeAnswer({ valueQuantity: newValue })}\n          disableWheel\n        />\n      );\n    case QuestionnaireItemType.choice:\n    case QuestionnaireItemType.openChoice:\n      if (isDropDownChoice(item) && !item.answerValueSet) {\n        return (\n          <QuestionnaireChoiceDropDownInput\n            name={name}\n            item={item}\n            initial={initial}\n            response={response}\n            onChangeAnswer={(e) => onChangeAnswer(e)}\n          />\n        );\n      } else {\n        return (\n          <QuestionnaireChoiceSetInput\n            name={name}\n            item={item}\n            initial={initial}\n            response={response}\n            onChangeAnswer={(e) => onChangeAnswer(e)}\n          />\n        );\n      }\n    default:\n      return null;\n  }\n}\n\ninterface QuestionnaireChoiceInputProps {\n  readonly name: string;\n  readonly item: QuestionnaireItem;\n  readonly initial: QuestionnaireItemInitial | undefined;\n  readonly response: QuestionnaireResponseItem;\n  readonly onChangeAnswer: (\n    newResponseAnswer: QuestionnaireResponseItemAnswer | QuestionnaireResponseItemAnswer[]\n  ) => void;\n}\n\nfunction QuestionnaireChoiceDropDownInput(props: QuestionnaireChoiceInputProps): JSX.Element {\n  const { name, item, initial, response } = props;\n\n  if (!item.answerOption?.length) {\n    return <NoAnswerDisplay />;\n  }\n\n  const initialValue = getTypedPropertyValue({ type: 'QuestionnaireItemInitial', value: initial }, 'value') as\n    | TypedValue\n    | undefined;\n\n  const data = [''];\n\n  for (const option of item.answerOption) {\n    const optionValue = getTypedPropertyValue(\n      { type: 'QuestionnaireItemAnswerOption', value: option },\n      'value'\n    ) as TypedValue;\n    data.push(typedValueToString(optionValue) as string);\n  }\n\n  const defaultValue = getCurrentAnswer(response) ?? initialValue;\n\n  if (item.repeats) {\n    const { propertyName, data } = formatSelectData(props.item);\n    const currentAnswer = getCurrentMultiSelectAnswer(response);\n\n    return (\n      <MultiSelect\n        data={data}\n        placeholder=\"Select items\"\n        searchable\n        defaultValue={currentAnswer || [typedValueToString(initialValue)]}\n        onChange={(selected) => {\n          const values = getNewMultiSelectValues(selected, propertyName, item);\n          props.onChangeAnswer(values);\n        }}\n      />\n    );\n  }\n\n  return (\n    <NativeSelect\n      id={name}\n      name={name}\n      onChange={(e: ChangeEvent<HTMLSelectElement>) => {\n        const index = e.currentTarget.selectedIndex;\n        if (index === 0) {\n          props.onChangeAnswer({});\n          return;\n        }\n        const option = (item.answerOption as QuestionnaireItemAnswerOption[])[index - 1];\n        const optionValue = getTypedPropertyValue(\n          { type: 'QuestionnaireItemAnswerOption', value: option },\n          'value'\n        ) as TypedValue;\n        const propertyName = 'value' + capitalize(optionValue.type);\n        props.onChangeAnswer({ [propertyName]: optionValue.value });\n      }}\n      defaultValue={formatCoding(defaultValue?.value) || defaultValue?.value}\n      data={data}\n    />\n  );\n}\n\nfunction QuestionnaireChoiceSetInput(props: QuestionnaireChoiceInputProps): JSX.Element {\n  const { name, item, initial, onChangeAnswer, response } = props;\n\n  if (!item.answerOption?.length && !item.answerValueSet) {\n    return <NoAnswerDisplay />;\n  }\n\n  if (item.answerValueSet) {\n    return (\n      <CodingInput\n        name={name}\n        binding={item.answerValueSet}\n        onChange={(code) => onChangeAnswer({ valueCoding: code })}\n        creatable={item.type === QuestionnaireItemType.openChoice}\n      />\n    );\n  }\n  return (\n    <QuestionnaireChoiceRadioInput\n      name={response?.id ?? name}\n      item={item}\n      initial={initial}\n      response={response}\n      onChangeAnswer={onChangeAnswer}\n    />\n  );\n}\n\nfunction QuestionnaireChoiceRadioInput(props: QuestionnaireChoiceInputProps): JSX.Element {\n  const { name, item, initial, onChangeAnswer, response } = props;\n  const valueElementDefinition = getElementDefinition('QuestionnaireItemAnswerOption', 'value[x]');\n  const initialValue = getTypedPropertyValue({ type: 'QuestionnaireItemInitial', value: initial }, 'value') as\n    | TypedValue\n    | undefined;\n\n  const options: [string, TypedValue][] = [];\n  let defaultValue = undefined;\n  if (item.answerOption) {\n    for (let i = 0; i < item.answerOption.length; i++) {\n      const option = item.answerOption[i];\n      const optionName = `${name}-option-${i}`;\n      const optionValue = getTypedPropertyValue(\n        { type: 'QuestionnaireItemAnswerOption', value: option },\n        'value'\n      ) as TypedValue;\n\n      if (!optionValue?.value) {\n        continue;\n      }\n\n      if (initialValue && stringify(optionValue) === stringify(initialValue)) {\n        defaultValue = optionName;\n      }\n      options.push([optionName, optionValue]);\n    }\n  }\n\n  const defaultAnswer = getCurrentAnswer(response);\n  const answerLinkId = getCurrentRadioAnswer(options, defaultAnswer);\n\n  return (\n    <Radio.Group\n      name={name}\n      value={answerLinkId ?? defaultValue}\n      onChange={(newValue) => {\n        const option = options.find((option) => option[0] === newValue);\n        if (option) {\n          const optionValue = option[1];\n          const propertyName = 'value' + capitalize(optionValue.type);\n          onChangeAnswer({ [propertyName]: optionValue.value });\n        }\n      }}\n    >\n      {options.map(([optionName, optionValue]) => (\n        <Radio\n          key={optionName}\n          id={optionName}\n          value={optionName}\n          py={4}\n          label={\n            <ResourcePropertyDisplay\n              property={valueElementDefinition}\n              propertyType={optionValue.type}\n              value={optionValue.value}\n            />\n          }\n        />\n      ))}\n    </Radio.Group>\n  );\n}\n\nfunction NoAnswerDisplay(): JSX.Element {\n  return <TextInput disabled placeholder=\"No Answers Defined\" />;\n}\n\nfunction getItemValue(answer: QuestionnaireResponseItemAnswer): TypedValue {\n  const itemValue = getTypedPropertyValue({ type: 'QuestionnaireItemAnswer', value: answer }, 'value') as TypedValue;\n  return itemValue;\n}\n\nfunction getCurrentAnswer(response: QuestionnaireResponseItem, index: number = 0): TypedValue {\n  const results = response.answer;\n  return getItemValue(results?.[index] ?? {});\n}\n\nfunction getCurrentMultiSelectAnswer(response: QuestionnaireResponseItem): string[] {\n  const results = response.answer;\n  if (!results) {\n    return [];\n  }\n  const typedValues = results.map((a) => getItemValue(a));\n  return typedValues.map((type) => formatCoding(type?.value) || type?.value);\n}\n\nfunction getCurrentRadioAnswer(options: [string, TypedValue][], defaultAnswer: TypedValue): string | undefined {\n  return options.find((option) => deepEquals(option[1].value, defaultAnswer?.value))?.[0];\n}\n\nfunction typedValueToString(typedValue: TypedValue | undefined): string | undefined {\n  if (!typedValue) {\n    return undefined;\n  }\n  if (typedValue.type === 'CodeableConcept') {\n    return formatCodeableConcept(typedValue.value);\n  }\n  if (typedValue.type === 'Coding') {\n    return formatCoding(typedValue.value);\n  }\n  if (typedValue.type === 'Reference') {\n    return formatReferenceString(typedValue);\n  }\n  return typedValue.value.toString();\n}\n\nfunction isDropDownChoice(item: QuestionnaireItem): boolean {\n  return !!item.extension?.some(\n    (e) =>\n      e.url === 'http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl' &&\n      e.valueCodeableConcept?.coding?.[0]?.code === 'drop-down'\n  );\n}\n\ninterface MultiSelect {\n  readonly value: any;\n  readonly label: any;\n}\n\ninterface FormattedData {\n  readonly propertyName: string;\n  readonly data: MultiSelect[];\n}\n\nfunction formatSelectData(item: QuestionnaireItem): FormattedData {\n  if (item.answerOption?.length === 0) {\n    return { propertyName: '', data: [] };\n  }\n  const option = (item.answerOption as QuestionnaireItemAnswerOption[])[0];\n  const optionValue = getTypedPropertyValue(\n    { type: 'QuestionnaireItemAnswerOption', value: option },\n    'value'\n  ) as TypedValue;\n  const propertyName = 'value' + capitalize(optionValue.type);\n\n  const data = (item.answerOption ?? []).map((a) => ({\n    value: getValueAndLabel(a, propertyName),\n    label: getValueAndLabel(a, propertyName),\n  }));\n  return { propertyName, data };\n}\n\nfunction getValueAndLabel(option: QuestionnaireItemAnswerOption, propertyName: string): string | undefined {\n  return formatCoding(option.valueCoding) || option[propertyName as keyof QuestionnaireItemAnswerOption]?.toString();\n}\n", "import {\n  TypedValue,\n  deepClone,\n  evalFhirPathTyped,\n  formatCoding,\n  getExtension,\n  getReferenceString,\n  getTypedPropertyValue,\n  splitN,\n  stringify,\n} from '@medplum/core';\nimport {\n  Encounter,\n  Questionnaire,\n  QuestionnaireItem,\n  QuestionnaireItemAnswerOption,\n  QuestionnaireItemEnableWhen,\n  QuestionnaireItemInitial,\n  QuestionnaireResponse,\n  QuestionnaireResponseItem,\n  QuestionnaireResponseItemAnswer,\n  Reference,\n  ResourceType,\n} from '@medplum/fhirtypes';\n\nexport enum QuestionnaireItemType {\n  group = 'group',\n  display = 'display',\n  question = 'question',\n  boolean = 'boolean',\n  decimal = 'decimal',\n  integer = 'integer',\n  date = 'date',\n  dateTime = 'dateTime',\n  time = 'time',\n  string = 'string',\n  text = 'text',\n  url = 'url',\n  choice = 'choice',\n  openChoice = 'open-choice',\n  attachment = 'attachment',\n  reference = 'reference',\n  quantity = 'quantity',\n}\n\nexport function isChoiceQuestion(item: QuestionnaireItem): boolean {\n  return item.type === 'choice' || item.type === 'open-choice';\n}\n\nexport function isQuestionEnabled(item: QuestionnaireItem, responseItems: QuestionnaireResponseItem[]): boolean {\n  if (!item.enableWhen) {\n    return true;\n  }\n\n  const enableBehavior = item.enableBehavior ?? 'any';\n\n  for (const enableWhen of item.enableWhen) {\n    const actualAnswers = getByLinkId(responseItems, enableWhen.question as string);\n\n    if (enableWhen.operator === 'exists' && !enableWhen.answerBoolean && !actualAnswers?.length) {\n      if (enableBehavior === 'any') {\n        return true;\n      } else {\n        continue;\n      }\n    }\n    const { anyMatch, allMatch } = checkAnswers(enableWhen, actualAnswers, enableBehavior);\n\n    if (enableBehavior === 'any' && anyMatch) {\n      return true;\n    }\n    if (enableBehavior === 'all' && !allMatch) {\n      return false;\n    }\n  }\n\n  return enableBehavior !== 'any';\n}\n\nexport function getNewMultiSelectValues(\n  selected: string[],\n  propertyName: string,\n  item: QuestionnaireItem\n): QuestionnaireResponseItemAnswer[] {\n  return selected.map((o) => {\n    const option = item.answerOption?.find(\n      (option) =>\n        formatCoding(option.valueCoding) === o || option[propertyName as keyof QuestionnaireItemAnswerOption] === o\n    );\n    const optionValue = getTypedPropertyValue(\n      { type: 'QuestionnaireItemAnswerOption', value: option },\n      'value'\n    ) as TypedValue;\n    return { [propertyName]: optionValue?.value };\n  });\n}\n\nfunction getByLinkId(\n  responseItems: QuestionnaireResponseItem[] | undefined,\n  linkId: string\n): QuestionnaireResponseItemAnswer[] | undefined {\n  if (!responseItems) {\n    return undefined;\n  }\n\n  for (const response of responseItems) {\n    if (response.linkId === linkId) {\n      return response.answer;\n    }\n    if (response.item) {\n      const nestedAnswer = getByLinkId(response.item, linkId);\n      if (nestedAnswer) {\n        return nestedAnswer;\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction evaluateMatch(actualAnswer: TypedValue | undefined, expectedAnswer: TypedValue, operator?: string): boolean {\n  // We handle exists separately since its so different in terms of comparisons than the other mathematical operators\n  if (operator === 'exists') {\n    // if actualAnswer is not undefined, then exists: true passes\n    // if actualAnswer is undefined, then exists: false passes\n    return !!actualAnswer === expectedAnswer.value;\n  } else if (!actualAnswer) {\n    return false;\n  } else {\n    // `=` and `!=` should be treated as the FHIRPath `~` and `!~`\n    // All other operators should be unmodified\n    const fhirPathOperator = operator === '=' || operator === '!=' ? operator?.replace('=', '~') : operator;\n    const [{ value }] = evalFhirPathTyped(`%actualAnswer ${fhirPathOperator} %expectedAnswer`, [actualAnswer], {\n      '%actualAnswer': actualAnswer,\n      '%expectedAnswer': expectedAnswer,\n    });\n    return value;\n  }\n}\n\nfunction checkAnswers(\n  enableWhen: QuestionnaireItemEnableWhen,\n  answers: QuestionnaireResponseItemAnswer[] | undefined,\n  enableBehavior: 'any' | 'all'\n): { anyMatch: boolean; allMatch: boolean } {\n  const actualAnswers = answers || [];\n  const expectedAnswer = getTypedPropertyValue(\n    {\n      type: 'QuestionnaireItemEnableWhen',\n      value: enableWhen,\n    },\n    'answer[x]'\n  ) as TypedValue;\n\n  let anyMatch = false;\n  let allMatch = true;\n\n  for (const actualAnswerValue of actualAnswers) {\n    const actualAnswer = getTypedPropertyValue(\n      {\n        type: 'QuestionnaireResponseItemAnswer',\n        value: actualAnswerValue,\n      },\n      'value[x]'\n    ) as TypedValue | undefined; // possibly undefined when question unanswered\n    const { operator } = enableWhen;\n    const match = evaluateMatch(actualAnswer, expectedAnswer, operator);\n    if (match) {\n      anyMatch = true;\n    } else {\n      allMatch = false;\n    }\n\n    if (enableBehavior === 'any' && anyMatch) {\n      break;\n    }\n  }\n\n  return { anyMatch, allMatch };\n}\n\nexport function getQuestionnaireItemReferenceTargetTypes(item: QuestionnaireItem): ResourceType[] | undefined {\n  const extension = getExtension(item, 'http://hl7.org/fhir/StructureDefinition/questionnaire-referenceResource');\n  if (!extension) {\n    return undefined;\n  }\n  if (extension.valueCode !== undefined) {\n    return [extension.valueCode] as ResourceType[];\n  }\n  if (extension.valueCodeableConcept) {\n    return extension.valueCodeableConcept?.coding?.map((c) => c.code) as ResourceType[];\n  }\n  return undefined;\n}\n\nexport function setQuestionnaireItemReferenceTargetTypes(\n  item: QuestionnaireItem,\n  targetTypes: ResourceType[] | undefined\n): QuestionnaireItem {\n  const result = deepClone(item);\n  let extension = getExtension(result, 'http://hl7.org/fhir/StructureDefinition/questionnaire-referenceResource');\n\n  if (!targetTypes || targetTypes.length === 0) {\n    if (extension) {\n      result.extension = result.extension?.filter((e) => e !== extension);\n    }\n    return result;\n  }\n\n  if (!extension) {\n    if (!result.extension) {\n      result.extension = [];\n    }\n    extension = { url: 'http://hl7.org/fhir/StructureDefinition/questionnaire-referenceResource' };\n    result.extension.push(extension);\n  }\n\n  if (targetTypes.length === 1) {\n    extension.valueCode = targetTypes[0];\n    delete extension.valueCodeableConcept;\n  } else {\n    extension.valueCodeableConcept = { coding: targetTypes.map((t) => ({ code: t })) };\n    delete extension.valueCode;\n  }\n\n  return result;\n}\n\n/**\n * Returns the reference filter for the given questionnaire item.\n * @see https://build.fhir.org/ig/HL7/fhir-extensions//StructureDefinition-questionnaire-referenceFilter-definitions.html\n * @param item - The questionnaire item to get the reference filter for.\n * @param subject - Optional subject reference.\n * @param encounter - Optional encounter reference.\n * @returns The reference filter as a map of key/value pairs.\n */\nexport function getQuestionnaireItemReferenceFilter(\n  item: QuestionnaireItem,\n  subject: Reference | undefined,\n  encounter: Reference<Encounter> | undefined\n): Record<string, string> | undefined {\n  const extension = getExtension(item, 'http://hl7.org/fhir/StructureDefinition/questionnaire-referenceFilter');\n  if (!extension?.valueString) {\n    return undefined;\n  }\n\n  // Replace variables\n  let filter = extension.valueString;\n  if (subject?.reference) {\n    filter = filter.replaceAll('$subj', subject.reference);\n  }\n  if (encounter?.reference) {\n    filter = filter.replaceAll('$encounter', encounter.reference);\n  }\n\n  // Parse the valueString into a map\n  const result: Record<string, string> = {};\n  const parts = filter.split('&');\n  for (const part of parts) {\n    const [key, value] = splitN(part, '=', 2);\n    result[key] = value;\n  }\n  return result;\n}\n\nexport function buildInitialResponse(questionnaire: Questionnaire): QuestionnaireResponse {\n  const response: QuestionnaireResponse = {\n    resourceType: 'QuestionnaireResponse',\n    questionnaire: getReferenceString(questionnaire),\n    item: buildInitialResponseItems(questionnaire.item),\n    status: 'in-progress',\n  };\n\n  return response;\n}\n\nfunction buildInitialResponseItems(items: QuestionnaireItem[] | undefined): QuestionnaireResponseItem[] {\n  return items?.map(buildInitialResponseItem) ?? [];\n}\n\nexport function buildInitialResponseItem(item: QuestionnaireItem): QuestionnaireResponseItem {\n  return {\n    id: generateId(),\n    linkId: item.linkId,\n    text: item.text,\n    item: buildInitialResponseItems(item.item),\n    answer: item.initial?.map(buildInitialResponseAnswer) ?? [],\n  };\n}\n\nlet nextId = 1;\nfunction generateId(): string {\n  return 'id-' + nextId++;\n}\n\nfunction buildInitialResponseAnswer(answer: QuestionnaireItemInitial): QuestionnaireResponseItemAnswer {\n  // This works because QuestionnaireItemInitial and QuestionnaireResponseItemAnswer\n  // have the same properties.\n  return { ...answer };\n}\n\nexport function formatReferenceString(typedValue: TypedValue): string {\n  return typedValue.value.display || typedValue.value.reference || stringify(typedValue.value);\n}\n\n/**\n * Returns the number of pages in the questionnaire.\n *\n * By default, a questionnaire is represented as a simple single page questionnaire,\n * so the default return value is 1.\n *\n * If the questionnaire has a page extension on the first item, then the number of pages\n * is the number of top level items in the questionnaire.\n *\n * @param questionnaire - The questionnaire to get the number of pages for.\n * @returns The number of pages in the questionnaire. Default is 1.\n */\nexport function getNumberOfPages(questionnaire: Questionnaire): number {\n  const firstItem = questionnaire?.item?.[0];\n  if (firstItem) {\n    const extension = getExtension(firstItem, 'http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl');\n    if (extension?.valueCodeableConcept?.coding?.[0]?.code === 'page') {\n      return (questionnaire.item as QuestionnaireItem[]).length;\n    }\n  }\n  return 1;\n}\n", "import { Encounter, Reference } from '@medplum/fhirtypes';\nimport { createContext } from 'react';\n\nexport const QuestionnaireFormContext = createContext<{ subject?: Reference; encounter?: Reference<Encounter> }>({});\n", ".section {\n  position: relative;\n  margin: 4px 4px 8px;\n  padding: 6px 12px 16px 6px;\n  border: 1.5px solid var(--mantine-color-gray-1);\n  border-radius: var(--mantine-radius-sm);\n  transition: all 0.1;\n}\n\n.hovering {\n  border: 1.5px solid var(--mantine-color-blue-5);\n}\n\n.editing {\n  border: 1.5px solid var(--mantine-color-gray-1);\n  border-left: 4px solid var(--mantine-color-blue-5);\n}\n\n.questionBody {\n  max-width: 600px;\n}\n\n.topActions {\n  position: absolute;\n  right: 32px;\n  top: 1px;\n  padding: 4px;\n  color: var(--mantine-color-gray-5);\n  font-size: var(--mantine-font-size-xs);\n}\n\n.bottomActions {\n  position: absolute;\n  right: 4px;\n  bottom: 0;\n  font-size: var(--mantine-font-size-xs);\n\n  & a {\n    margin-left: 8px;\n  }\n}\n\n.movementActions {\n  position: absolute;\n  right: 8px;\n  top: 0;\n  padding-top: 8px;\n  font-size: var(--mantine-font-size-xs);\n\n  & a {\n    margin-left: 8px;\n  }\n}\n\n.movementIcons {\n  color: var(--mantine-color-gray-5);\n}\n\n.columnAlignment {\n  display: flex;\n  flex-direction: column;\n}\n\n.linkIdInput {\n  width: 100px;\n  margin-bottom: 4px;\n}\n\n.typeSelect {\n  width: 100px;\n}\n", "import { Title } from '@mantine/core';\nimport { ProfileResource, createReference, getReferenceString } from '@medplum/core';\nimport {\n  Encounter,\n  Questionnaire,\n  QuestionnaireItem,\n  QuestionnaireResponse,\n  QuestionnaireResponseItem,\n  Reference,\n} from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport { useEffect, useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { buildInitialResponse, getNumberOfPages, isQuestionEnabled } from '../utils/questionnaire';\nimport { QuestionnaireFormContext } from './QuestionnaireForm.context';\nimport { QuestionnairePageSequence } from './QuestionnaireFormComponents/QuestionnaireFormPageSequence';\n\nexport interface QuestionnaireFormProps {\n  readonly questionnaire: Questionnaire | Reference<Questionnaire>;\n  readonly subject?: Reference;\n  readonly encounter?: Reference<Encounter>;\n  readonly submitButtonText?: string;\n  readonly onSubmit: (response: QuestionnaireResponse) => void;\n}\n\nexport function QuestionnaireForm(props: QuestionnaireFormProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const source = medplum.getProfile();\n  const [schemaLoaded, setSchemaLoaded] = useState(false);\n  const questionnaire = useResource(props.questionnaire);\n  const [response, setResponse] = useState<QuestionnaireResponse | undefined>();\n  const [activePage, setActivePage] = useState(0);\n\n  useEffect(() => {\n    medplum\n      .requestSchema('Questionnaire')\n      .then(() => medplum.requestSchema('QuestionnaireResponse'))\n      .then(() => setSchemaLoaded(true))\n      .catch(console.log);\n  }, [medplum]);\n\n  useEffect(() => {\n    setResponse(questionnaire ? buildInitialResponse(questionnaire) : undefined);\n  }, [questionnaire]);\n\n  function setItems(newResponseItems: QuestionnaireResponseItem | QuestionnaireResponseItem[]): void {\n    const currentItems = response?.item ?? [];\n    const mergedItems = mergeItems(\n      currentItems,\n      Array.isArray(newResponseItems) ? newResponseItems : [newResponseItems]\n    );\n\n    const newResponse: QuestionnaireResponse = {\n      resourceType: 'QuestionnaireResponse',\n      status: 'in-progress',\n      item: mergedItems,\n    };\n\n    setResponse(newResponse);\n  }\n\n  function checkForQuestionEnabled(item: QuestionnaireItem): boolean {\n    return isQuestionEnabled(item, response?.item ?? []);\n  }\n\n  if (!schemaLoaded || !questionnaire || !response) {\n    return null;\n  }\n\n  const numberOfPages = getNumberOfPages(questionnaire);\n  const nextStep = (): void => setActivePage((current) => current + 1);\n  const prevStep = (): void => setActivePage((current) => current - 1);\n\n  return (\n    <QuestionnaireFormContext.Provider value={{ subject: props.subject, encounter: props.encounter }}>\n      <Form\n        testid=\"questionnaire-form\"\n        onSubmit={() => {\n          if (props.onSubmit && response) {\n            props.onSubmit({\n              ...response,\n              questionnaire: getReferenceString(questionnaire),\n              subject: props.subject,\n              source: createReference(source as ProfileResource),\n              authored: new Date().toISOString(),\n              status: 'completed',\n            });\n          }\n        }}\n      >\n        {questionnaire.title && <Title>{questionnaire.title}</Title>}\n        <QuestionnairePageSequence\n          items={questionnaire.item ?? []}\n          response={response}\n          onChange={setItems}\n          renderPages={numberOfPages > 1}\n          activePage={activePage}\n          numberOfPages={numberOfPages}\n          submitButtonText={props.submitButtonText}\n          checkForQuestionEnabled={checkForQuestionEnabled}\n          nextStep={nextStep}\n          prevStep={prevStep}\n        />\n      </Form>\n    </QuestionnaireFormContext.Provider>\n  );\n}\n\nfunction mergeIndividualItems(\n  prevItem: QuestionnaireResponseItem,\n  newItem: QuestionnaireResponseItem\n): QuestionnaireResponseItem {\n  // Recursively merge the nested items based on their ids.\n  const mergedNestedItems = mergeItems(prevItem.item ?? [], newItem.item ?? []);\n\n  return {\n    ...newItem,\n    item: mergedNestedItems.length > 0 ? mergedNestedItems : undefined,\n    answer: newItem.answer && newItem.answer.length > 0 ? newItem.answer : prevItem.answer,\n  };\n}\n\nfunction mergeItems(\n  prevItems: QuestionnaireResponseItem[],\n  newItems: QuestionnaireResponseItem[]\n): QuestionnaireResponseItem[] {\n  const result: QuestionnaireResponseItem[] = [];\n  const usedIds = new Set<string>();\n\n  for (const prevItem of prevItems) {\n    const itemId = prevItem.id;\n    const newItem = newItems.find((item) => item.id === itemId);\n\n    if (newItem) {\n      result.push(mergeIndividualItems(prevItem, newItem));\n      usedIds.add(newItem.id as string);\n    } else {\n      result.push(prevItem);\n    }\n  }\n\n  // Add items from newItems that were not in prevItems.\n  for (const newItem of newItems) {\n    if (!usedIds.has(newItem.id as string)) {\n      result.push(newItem);\n    }\n  }\n\n  return result;\n}\n", "import { Button, Group, Stack, Stepper } from '@mantine/core';\nimport { QuestionnaireItem, QuestionnaireResponse, QuestionnaireResponseItem } from '@medplum/fhirtypes';\nimport { QuestionnaireItemType } from '../../utils/questionnaire';\nimport { QuestionnaireRepeatableItem } from '../QuestionnaireFormItem/QuestionnaireRepeatableItem';\nimport { QuestionnaireRepeatedGroup } from './QuestionnaireFormGroup';\n\ninterface QuestionnairePageSequenceProps {\n  readonly items: QuestionnaireItem[];\n  readonly response?: QuestionnaireResponse;\n  readonly renderPages: boolean;\n  readonly activePage?: number;\n  readonly numberOfPages: number;\n  readonly submitButtonText?: string;\n  readonly checkForQuestionEnabled: (item: QuestionnaireItem) => boolean;\n  readonly onChange: (items: QuestionnaireResponseItem | QuestionnaireResponseItem[]) => void;\n  readonly nextStep: () => void;\n  readonly prevStep: () => void;\n}\n\nexport function QuestionnairePageSequence(props: QuestionnairePageSequenceProps): JSX.Element {\n  const {\n    items,\n    response,\n    activePage,\n    onChange,\n    nextStep,\n    prevStep,\n    numberOfPages,\n    renderPages,\n    submitButtonText,\n    checkForQuestionEnabled,\n  } = props;\n\n  const form = items.map((item) => {\n    const itemResponse = response?.item?.filter((i) => i.linkId === item.linkId) ?? [];\n\n    const repeatedItem =\n      item.type === QuestionnaireItemType.group ? (\n        <QuestionnaireRepeatedGroup\n          key={item.linkId}\n          item={item}\n          response={itemResponse}\n          onChange={onChange}\n          checkForQuestionEnabled={checkForQuestionEnabled}\n        />\n      ) : (\n        <QuestionnaireRepeatableItem\n          key={item.linkId}\n          item={item}\n          response={itemResponse?.[0]}\n          onChange={onChange}\n          checkForQuestionEnabled={checkForQuestionEnabled}\n        />\n      );\n\n    if (renderPages) {\n      return (\n        <Stepper.Step key={item.linkId} label={item.text}>\n          {repeatedItem}\n        </Stepper.Step>\n      );\n    }\n    return repeatedItem;\n  });\n\n  return (\n    <>\n      {renderPages && (\n        <Stepper active={activePage ?? 0} allowNextStepsSelect={false} p={6}>\n          {form}\n        </Stepper>\n      )}\n      {!renderPages && <Stack>{form}</Stack>}\n      <ButtonGroup\n        activePage={activePage ?? 0}\n        numberOfPages={numberOfPages}\n        nextStep={nextStep}\n        prevStep={prevStep}\n        submitButtonText={submitButtonText}\n      />\n    </>\n  );\n}\n\ninterface ButtonGroupProps {\n  readonly activePage: number;\n  readonly numberOfPages: number;\n  readonly submitButtonText?: string;\n  readonly nextStep: () => void;\n  readonly prevStep: () => void;\n}\n\nfunction ButtonGroup(props: ButtonGroupProps): JSX.Element {\n  const showBackButton = props.activePage > 0;\n  const showNextButton = props.activePage < props.numberOfPages - 1;\n  const showSubmitButton = props.activePage === props.numberOfPages - 1;\n\n  return (\n    <Group justify=\"flex-end\" mt=\"xl\" gap=\"xs\">\n      {showBackButton && <Button onClick={props.prevStep}>Back</Button>}\n      {showNextButton && (\n        <Button\n          onClick={(e) => {\n            const form = e.currentTarget.closest('form') as HTMLFormElement;\n            if (form.reportValidity()) {\n              props.nextStep();\n            }\n          }}\n        >\n          Next\n        </Button>\n      )}\n      {showSubmitButton && <Button type=\"submit\">{props.submitButtonText ?? 'Submit'}</Button>}\n    </Group>\n  );\n}\n", "import { Anchor } from '@mantine/core';\nimport { QuestionnaireItem, QuestionnaireResponseItem } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { FormSection } from '../../FormSection/FormSection';\nimport { QuestionnaireItemType } from '../../utils/questionnaire';\nimport { QuestionnaireFormItem } from './QuestionnaireFormItem';\n\ninterface QuestionnaireRepeatableItemProps {\n  readonly item: QuestionnaireItem;\n  readonly response?: QuestionnaireResponseItem;\n  readonly checkForQuestionEnabled: (item: QuestionnaireItem) => boolean;\n  readonly onChange: (items: QuestionnaireResponseItem[]) => void;\n}\n\nexport function QuestionnaireRepeatableItem(props: QuestionnaireRepeatableItemProps): JSX.Element | null {\n  const { item, response, onChange } = props;\n  const [number, setNumber] = useState(getNumberOfRepeats(item, response ?? { linkId: item.linkId }));\n  if (!props.checkForQuestionEnabled(item)) {\n    return null;\n  }\n\n  if (!response) {\n    return null;\n  }\n\n  if (item.type === QuestionnaireItemType.display) {\n    return <p key={item.linkId}>{item.text}</p>;\n  }\n\n  const showAddButton =\n    item?.repeats && item.type !== QuestionnaireItemType.choice && item.type !== QuestionnaireItemType.openChoice;\n\n  // Styling reason to avoid duplicate text\n  if (item.type === QuestionnaireItemType.boolean) {\n    return (\n      <QuestionnaireFormItem\n        key={item.linkId}\n        item={item}\n        response={response}\n        onChange={(r) => onChange([r])}\n        index={0}\n      />\n    );\n  }\n\n  return (\n    <FormSection\n      key={props.item.linkId}\n      htmlFor={props.item.linkId}\n      title={props.item.text}\n      withAsterisk={props.item.required}\n    >\n      {[...Array(number)].map((_, index) => (\n        <QuestionnaireFormItem\n          key={`${item.linkId}-${index}`}\n          item={item}\n          response={response}\n          onChange={(r) => onChange([r])}\n          index={index}\n        />\n      ))}\n      {showAddButton && <Anchor onClick={() => setNumber((n) => n + 1)}>Add Item</Anchor>}\n    </FormSection>\n  );\n}\n\nfunction getNumberOfRepeats(item: QuestionnaireItem, response: QuestionnaireResponseItem): number {\n  if (item.type === QuestionnaireItemType.choice || item.type === QuestionnaireItemType.openChoice) {\n    return 1;\n  }\n  const answers = response.answer;\n  return answers?.length ? answers.length : 1;\n}\n", "import { Anchor, Stack, Title } from '@mantine/core';\nimport { QuestionnaireItem, QuestionnaireResponseItem } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { QuestionnaireItemType, buildInitialResponseItem } from '../../utils/questionnaire';\nimport { QuestionnaireRepeatableItem } from '../QuestionnaireFormItem/QuestionnaireRepeatableItem';\n\ninterface QuestionnaireRepeatableGroupProps {\n  readonly item: QuestionnaireItem;\n  readonly response: QuestionnaireResponseItem[];\n  readonly checkForQuestionEnabled: (item: QuestionnaireItem) => boolean;\n  readonly onChange: (responses: QuestionnaireResponseItem[]) => void;\n}\n\nexport function QuestionnaireRepeatedGroup(props: QuestionnaireRepeatableGroupProps): JSX.Element | null {\n  const [responses, setResponses] = useState(props.response);\n\n  if (responses.length === 0) {\n    return null;\n  }\n\n  function handleRepeatableGroup(newResponseItems: QuestionnaireResponseItem[], index: number): void {\n    const newResponses = responses.map((responses, idx) => (idx === index ? newResponseItems[0] : responses));\n    setResponses(newResponses);\n    props.onChange(newResponses);\n  }\n\n  function insertNewGroup(): void {\n    const newResponse = buildInitialResponseItem(props.item);\n    setResponses([...responses, newResponse]);\n  }\n\n  return (\n    <>\n      {responses.map((response, idx) => (\n        <QuestionnaireGroup\n          key={response.id}\n          item={props.item}\n          response={response}\n          checkForQuestionEnabled={props.checkForQuestionEnabled}\n          onChange={(r) => handleRepeatableGroup(r, idx)}\n        />\n      ))}\n      {props.item.repeats && <Anchor onClick={insertNewGroup}>{`Add Group: ${props.item.text}`}</Anchor>}\n    </>\n  );\n}\n\ninterface QuestionnaireGroupProps {\n  readonly item: QuestionnaireItem;\n  readonly response: QuestionnaireResponseItem;\n  readonly checkForQuestionEnabled: (item: QuestionnaireItem) => boolean;\n  readonly onChange: (response: QuestionnaireResponseItem[]) => void;\n}\n\nexport function QuestionnaireGroup(props: QuestionnaireGroupProps): JSX.Element | null {\n  const { response, checkForQuestionEnabled, onChange } = props;\n  function onSetGroup(newResponseItem: QuestionnaireResponseItem[]): void {\n    const newResponse = response.item?.map((current) => {\n      const matchingItem = newResponseItem.find((newResponse) => newResponse.id === current.id);\n      return matchingItem ?? current;\n    });\n    // This checks to see if there were any nested repeated groups that we need to add\n    const mergedResponse = newResponse?.concat(newResponseItem.slice(1));\n    const groupResponse = { ...response, item: mergedResponse };\n    onChange([groupResponse]);\n  }\n\n  if (!props.checkForQuestionEnabled(props.item)) {\n    return null;\n  }\n\n  return (\n    <div key={props.item.linkId}>\n      {props.item.text && (\n        <Title order={3} mb=\"md\">\n          {props.item.text}\n        </Title>\n      )}\n      <Stack>\n        {props.item.item?.map((item) => {\n          if (item.type === QuestionnaireItemType.group) {\n            return item.repeats ? (\n              <QuestionnaireRepeatedGroup\n                key={item.linkId}\n                item={item}\n                response={response.item?.filter((i) => i.linkId === item.linkId) ?? []}\n                checkForQuestionEnabled={checkForQuestionEnabled}\n                onChange={onSetGroup}\n              />\n            ) : (\n              <QuestionnaireGroup\n                key={item.linkId}\n                item={item}\n                checkForQuestionEnabled={checkForQuestionEnabled}\n                response={response.item?.find((i) => i.linkId === item.linkId) ?? { linkId: item.linkId }}\n                onChange={onSetGroup}\n              />\n            );\n          }\n          return (\n            <QuestionnaireRepeatableItem\n              key={item.linkId}\n              item={item}\n              response={response.item?.find((i) => i.linkId === item.linkId)}\n              onChange={onSetGroup}\n              checkForQuestionEnabled={checkForQuestionEnabled}\n            />\n          );\n        })}\n      </Stack>\n    </div>\n  );\n}\n", "import { ActionIcon, Button, Divider, Group, NativeSelect, Stack, Text, TextInput } from '@mantine/core';\nimport { formatRange, getCodeBySystem } from '@medplum/core';\nimport { CodeableConcept, ObservationDefinition, ObservationDefinitionQualifiedInterval } from '@medplum/fhirtypes';\nimport { IconCircleMinus, IconCirclePlus } from '@tabler/icons-react';\nimport { MouseEvent, useEffect, useState } from 'react';\nimport { Container } from '../Container/Container';\nimport { Form } from '../Form/Form';\nimport { RangeInput } from '../RangeInput/RangeInput';\nimport { killEvent } from '../utils/dom';\nimport classes from './ReferenceRangeEditor.module.css';\n\n// Properties of qualified intervals used for grouping\nconst intervalFilters = ['gender', 'age', 'gestationalAge', 'context', 'appliesTo', 'category'] as const;\n\nexport interface ReferenceRangeEditorProps {\n  readonly definition: ObservationDefinition;\n  readonly onSubmit: (result: ObservationDefinition) => void;\n}\n\n// Helper type that groups of qualified intervals by equal filter criteria\nexport type IntervalGroup = {\n  id: string;\n  filters: Record<string, any>;\n  intervals: ObservationDefinitionQualifiedInterval[];\n};\n\nconst defaultProps: ReferenceRangeEditorProps = {\n  definition: {\n    resourceType: 'ObservationDefinition',\n    code: { text: '' },\n  },\n  onSubmit: () => {\n    return undefined;\n  },\n};\n\nexport function ReferenceRangeEditor(props: ReferenceRangeEditorProps): JSX.Element {\n  props = Object.assign(defaultProps, props);\n  const defaultDefinition = props.definition;\n\n  const [intervalGroups, setIntervalGroups] = useState<IntervalGroup[]>([]);\n  const [groupId, setGroupId] = useState(1);\n  const [intervalId, setIntervalId] = useState(1);\n\n  useEffect(() => {\n    const definition = ensureQualifiedIntervalKeys(defaultDefinition, setIntervalId);\n    setIntervalGroups(groupQualifiedIntervals(definition.qualifiedInterval || [], setGroupId));\n  }, [defaultDefinition]);\n\n  return (\n    <Form testid=\"reference-range-editor\" onSubmit={submitDefinition}>\n      <Stack>\n        {intervalGroups.map((intervalGroup) => (\n          <ReferenceRangeGroupEditor\n            unit={getUnitString(defaultDefinition.quantitativeDetails?.unit)}\n            onChange={changeInterval}\n            onAdd={addInterval}\n            onRemove={removeInterval}\n            onRemoveGroup={removeGroup}\n            key={`group-${intervalGroup.id}`}\n            intervalGroup={intervalGroup}\n          />\n        ))}\n      </Stack>\n      <ActionIcon\n        title=\"Add Group\"\n        variant=\"subtle\"\n        size=\"sm\"\n        onClick={(e: MouseEvent) => {\n          killEvent(e);\n          addGroup({ id: `group-id-${groupId}`, filters: {} as IntervalGroup['filters'], intervals: [] });\n          setGroupId((id) => id + 1);\n        }}\n      >\n        <IconCirclePlus />\n      </ActionIcon>\n\n      <Group justify=\"flex-end\">\n        <Button type=\"submit\">Save</Button>\n      </Group>\n    </Form>\n  );\n\n  /**\n   * Submit qualified intervals\n   */\n\n  function submitDefinition(): void {\n    const qualifiedInterval = intervalGroups\n      .flatMap((group) => group.intervals)\n      .filter((interval) => !isEmptyInterval(interval));\n    props.onSubmit({ ...defaultDefinition, qualifiedInterval });\n  }\n\n  /**\n   * Add Remove Interval Groups\n   */\n\n  function addGroup(addedGroup: IntervalGroup): void {\n    setIntervalGroups((currentGroups) => [...currentGroups, addedGroup]);\n  }\n\n  function removeGroup(removedGroup: IntervalGroup): void {\n    setIntervalGroups((currentGroups) => currentGroups.filter((group) => group.id !== removedGroup.id));\n  }\n\n  /**\n   * Add/Remove/Update specific Qualified Intervals\n   * @param groupId - The reference range group ID.\n   * @param changedInterval - The updated reference range interval.\n   */\n  function changeInterval(groupId: string, changedInterval: ObservationDefinitionQualifiedInterval): void {\n    setIntervalGroups((groups) => {\n      groups = [...groups];\n      const currentGroup = groups.find((g) => g.id === groupId);\n\n      const index = currentGroup?.intervals.findIndex((interval) => interval.id === changedInterval.id);\n      if (index !== undefined && currentGroup?.intervals[index]) {\n        currentGroup.intervals[index] = changedInterval;\n      }\n      return groups;\n    });\n  }\n\n  function addInterval(groupId: string, addedInterval: ObservationDefinitionQualifiedInterval): void {\n    if (addedInterval.id === undefined) {\n      addedInterval.id = `id-${intervalId}`;\n      setIntervalId((id) => id + 1);\n    }\n    setIntervalGroups((groups) => {\n      groups = [...groups];\n      const currentGroupIndex = groups.findIndex((g) => g.id === groupId);\n\n      if (currentGroupIndex !== -1) {\n        const currentGroup = { ...groups[currentGroupIndex] };\n        addedInterval = { ...addedInterval, ...currentGroup.filters };\n        currentGroup.intervals = [...currentGroup.intervals, addedInterval];\n        groups[currentGroupIndex] = currentGroup;\n      }\n\n      return groups;\n    });\n  }\n\n  function removeInterval(groupId: string, removedInterval: ObservationDefinitionQualifiedInterval): void {\n    setIntervalGroups((groups) => {\n      groups = [...groups];\n      const currentGroup = groups.find((g) => g.id === groupId);\n      if (currentGroup) {\n        currentGroup.intervals = currentGroup.intervals.filter((interval) => interval.id !== removedInterval.id);\n      }\n      return groups;\n    });\n  }\n}\n\n/**\n * Helper component that renders an \"interval group\", which is a set of ObservationDefinitionQualifiedIntervals\n * that have the same filter values\n */\nexport interface ReferenceRangeGroupEditorProps {\n  readonly intervalGroup: IntervalGroup;\n  readonly unit: string | undefined;\n  readonly onChange: (groupId: string, changed: ObservationDefinitionQualifiedInterval) => void;\n  readonly onAdd: (groupId: string, added: ObservationDefinitionQualifiedInterval) => void;\n  readonly onRemove: (groupId: string, removed: ObservationDefinitionQualifiedInterval) => void;\n  readonly onRemoveGroup: (removedGroup: IntervalGroup) => void;\n}\n\nexport function ReferenceRangeGroupEditor(props: ReferenceRangeGroupEditorProps): JSX.Element {\n  const { intervalGroup, unit } = props;\n  return (\n    <Container data-testid={intervalGroup.id} className={classes.section}>\n      <Stack gap=\"lg\">\n        <Group justify=\"flex-end\">\n          <ActionIcon\n            title=\"Remove Group\"\n            variant=\"subtle\"\n            data-testid={`remove-group-button-${intervalGroup.id}`}\n            key={`remove-group-button-${intervalGroup.id}`}\n            size=\"sm\"\n            onClick={(e: React.MouseEvent) => {\n              killEvent(e);\n              props.onRemoveGroup(intervalGroup);\n            }}\n          >\n            <IconCircleMinus />\n          </ActionIcon>\n        </Group>\n        <ReferenceRangeGroupFilters intervalGroup={intervalGroup} onChange={props.onChange} />\n        <Divider />\n        {intervalGroup.intervals.map((interval) => (\n          <Stack key={`interval-${interval.id}`} gap=\"xs\">\n            <Group>\n              <TextInput\n                key={`condition-${interval.id}`}\n                data-testid={`condition-${interval.id}`}\n                defaultValue={interval.condition}\n                label=\"Condition: \"\n                size=\"sm\"\n                onChange={(e) => {\n                  killEvent(e);\n                  props.onChange(intervalGroup.id, { ...interval, condition: e.currentTarget.value.trim() });\n                }}\n              />\n              <ActionIcon\n                title=\"Remove Interval\"\n                variant=\"subtle\"\n                size=\"sm\"\n                key={`remove-interval-${interval.id}`}\n                data-testid={`remove-interval-${interval.id}`}\n                onClick={(e: React.MouseEvent) => {\n                  killEvent(e);\n                  props.onRemove(intervalGroup.id, interval);\n                }}\n              >\n                <IconCircleMinus />\n              </ActionIcon>\n            </Group>\n\n            <RangeInput\n              onChange={(range) => {\n                props.onChange(intervalGroup.id, { ...interval, range });\n              }}\n              key={`range-${interval.id}`}\n              name={`range-${interval.id}`}\n              defaultValue={interval.range}\n            />\n          </Stack>\n        ))}\n        <ActionIcon\n          title=\"Add Interval\"\n          variant=\"subtle\"\n          size=\"sm\"\n          onClick={(e: React.MouseEvent) => {\n            killEvent(e);\n            props.onAdd(intervalGroup.id, {\n              range: {\n                low: { unit },\n                high: { unit },\n              },\n            });\n          }}\n        >\n          <IconCirclePlus />\n        </ActionIcon>\n      </Stack>\n    </Container>\n  );\n}\n\ninterface ReferenceRangeGroupFiltersProps {\n  readonly intervalGroup: IntervalGroup;\n  readonly onChange: ReferenceRangeGroupEditorProps['onChange'];\n}\n\n/**\n * Render the \"filters\" section of the IntervalGroup.\n * @param props - The ReferenceRangeGroupFilter React props.\n * @returns The ReferenceRangeGroupFilter React node.\n */\nfunction ReferenceRangeGroupFilters(props: ReferenceRangeGroupFiltersProps): JSX.Element {\n  const { intervalGroup, onChange } = props;\n\n  // Pre-populate the units of the age filter\n  if (!intervalGroup.filters.age) {\n    intervalGroup.filters.age = {};\n  }\n  for (const key of ['low', 'high']) {\n    if (!intervalGroup.filters.age[key]?.unit) {\n      intervalGroup.filters.age[key] = {\n        ...intervalGroup.filters.age[key],\n        unit: 'years',\n        system: 'http://unitsofmeasure.org',\n      };\n    }\n  }\n\n  return (\n    <Stack style={{ maxWidth: '50%' }}>\n      <Group>\n        <NativeSelect\n          data={['', 'male', 'female']}\n          label=\"Gender:\"\n          defaultValue={intervalGroup.filters.gender || ''}\n          onChange={(e) => {\n            for (const interval of intervalGroup.intervals) {\n              let newGender: string | undefined = e.currentTarget.value;\n              if (newGender === '') {\n                newGender = undefined;\n              }\n              onChange(intervalGroup.id, {\n                ...interval,\n                gender: newGender as ObservationDefinitionQualifiedInterval['gender'],\n              });\n            }\n          }}\n        />\n      </Group>\n      <Group gap=\"xs\">\n        <Text component=\"label\" htmlFor={`div-age-${intervalGroup.id}`}>\n          Age:\n        </Text>\n        <div id={`div-age-${intervalGroup.id}`}>\n          <RangeInput\n            key={`age-${intervalGroup.id}`}\n            name={`age-${intervalGroup.id}`}\n            defaultValue={intervalGroup.filters['age']}\n            onChange={(ageRange) => {\n              for (const interval of intervalGroup.intervals) {\n                onChange(intervalGroup.id, { ...interval, age: ageRange });\n              }\n            }}\n          />\n        </div>\n      </Group>\n      <NativeSelect\n        data={['', 'pre-puberty', 'follicular', 'midcycle', 'luteal', 'postmenopausal']}\n        label=\"Endocrine:\"\n        defaultValue={intervalGroup.filters.context?.text || ''}\n        onChange={(e) => {\n          for (const interval of intervalGroup.intervals) {\n            let newEndocrine: string | undefined = e.currentTarget.value;\n            if (newEndocrine === '') {\n              newEndocrine = undefined;\n              onChange(intervalGroup.id, { ...interval, context: undefined });\n            } else {\n              onChange(intervalGroup.id, {\n                ...interval,\n                context: {\n                  text: newEndocrine,\n                  coding: [\n                    { code: newEndocrine, system: 'http://terminology.hl7.org/CodeSystem/referencerange-meaning' },\n                  ],\n                },\n              });\n            }\n          }\n        }}\n      />\n      <NativeSelect\n        data={['', 'reference', 'critical', 'absolute']}\n        label=\"Category: \"\n        defaultValue={intervalGroup.filters.category}\n        onChange={(e) => {\n          for (const interval of intervalGroup.intervals) {\n            const newCategory: string | undefined = e.currentTarget.value;\n            if (newCategory === '') {\n              onChange(intervalGroup.id, { ...interval, category: undefined });\n            } else {\n              onChange(intervalGroup.id, {\n                ...interval,\n                category: newCategory as 'reference' | 'critical' | 'absolute',\n              });\n            }\n          }\n        }}\n      />\n    </Stack>\n  );\n}\n\n/**\n * Helper function that assigns ids to each qualifiedInterval of an ObservationDefinition\n * @param definition - An ObservationDefinition\n * @param setIntervalId - React setState function for the intervalId\n * @returns The updated observation definition.\n */\nfunction ensureQualifiedIntervalKeys(\n  definition: ObservationDefinition,\n  setIntervalId: (id: number) => void\n): ObservationDefinition {\n  const intervals = definition.qualifiedInterval || [];\n  // Set the nextId to the max of any existing numeric id\n  let nextId =\n    Math.max(\n      ...intervals.map((interval) => {\n        const existingNum = parseInt(interval.id?.substring(3) || '', 10);\n        return !isNaN(existingNum) ? existingNum : Number.NEGATIVE_INFINITY;\n      })\n    ) + 1;\n\n  if (!Number.isFinite(nextId)) {\n    nextId = 1;\n  }\n\n  // If an interval doesn't have an id, set it to the nextId\n  definition = {\n    ...definition,\n    qualifiedInterval: intervals.map((interval) => ({\n      ...interval,\n      id: interval.id || `id-${nextId++}`,\n    })),\n  };\n  setIntervalId(nextId);\n  return definition;\n}\n\n/**\n * Group all ObservationDefinitionQualifiedIntervals based on the values of their \"filter\" properties,\n * so that similar ranges can be grouped together.\n * @param intervals - Array of reference range intervals.\n * @param setGroupId - Callback to set the group ID.\n * @returns The grouped intervals.\n */\nfunction groupQualifiedIntervals(\n  intervals: ObservationDefinitionQualifiedInterval[],\n  setGroupId: (id: number) => void\n): IntervalGroup[] {\n  let groupId = 1;\n  const groups: Record<string, IntervalGroup> = {};\n  for (const interval of intervals) {\n    const groupKey = generateGroupKey(interval);\n    if (!(groupKey in groups)) {\n      groups[groupKey] = {\n        id: `group-id-${groupId++}`,\n        filters: Object.fromEntries(intervalFilters.map((f) => [f, interval[f]])) as Record<string, any>,\n        intervals: [],\n      };\n    }\n    groups[groupKey].intervals.push(interval);\n  }\n  setGroupId(groupId);\n  return Object.values(groups);\n}\n\n/**\n * Generates a unique string for each set of filter values, so that similarly filtered intervals can be grouped together.\n * @param interval - The reference range interval.\n * @returns A \"group key\" that corresponds to the value of the interval filter properties.\n */\nfunction generateGroupKey(interval: ObservationDefinitionQualifiedInterval): string {\n  const results = [\n    `gender=${interval.gender}`,\n    `age=${formatRange(interval.age)}`,\n    `gestationalAge=${formatRange(interval.gestationalAge)}`,\n    `context=${interval.context?.text}`,\n    `appliesTo=${interval.appliesTo?.map((c) => c.text).join('+')}`,\n    `category=${interval.category}`,\n  ];\n\n  return results.join(':');\n}\n\nfunction getUnitString(unit: CodeableConcept | undefined): string | undefined {\n  return unit && (getCodeBySystem(unit, 'http://unitsofmeasure.org') || unit.text);\n}\n\nfunction isEmptyInterval(interval: ObservationDefinitionQualifiedInterval): boolean {\n  return interval.range?.low?.value === undefined && interval.range?.high?.value === undefined;\n}\n", ".section {\n  position: relative;\n  margin: 4px 4px 8px;\n  padding: 6px 12px 16px 6px;\n  border: 1.5px solid var(--mantine-color-gray-3);\n  border-radius: var(--mantine-radius-sm);\n  transition: all 0.1;\n}\n", "import { Button, Grid, Text } from '@mantine/core';\nimport { formatDateTime, getReferenceString } from '@medplum/core';\nimport { Bundle, BundleEntry, Reference, RequestGroup, Resource, Task } from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport { IconCheckbox, IconSquare } from '@tabler/icons-react';\nimport { Fragment, useEffect, useState } from 'react';\nimport { ResourceName } from '../ResourceName/ResourceName';\nimport { StatusBadge } from '../StatusBadge/StatusBadge';\n\nexport interface RequestGroupDisplayProps {\n  readonly value?: RequestGroup | Reference<RequestGroup>;\n  readonly onStart: (task: Task, input: Reference) => void;\n  readonly onEdit: (task: Task, input: Reference, output: Reference) => void;\n}\n\nexport function RequestGroupDisplay(props: RequestGroupDisplayProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const requestGroup = useResource(props.value);\n  const [startedLoading, setStartedLoading] = useState(false);\n  const [responseBundle, setResponseBundle] = useState<Bundle>();\n\n  useEffect(() => {\n    if (requestGroup && !startedLoading) {\n      medplum.executeBatch(buildBatchRequest(requestGroup)).then(setResponseBundle).catch(console.log);\n      setStartedLoading(true);\n    }\n  }, [medplum, requestGroup, startedLoading]);\n\n  if (!requestGroup || !responseBundle) {\n    return null;\n  }\n\n  return (\n    <Grid>\n      {requestGroup.action?.map((action, index) => {\n        const task = action.resource && findBundleEntry(action.resource as Reference<Task>);\n        const taskInput = task?.input?.[0]?.valueReference;\n        const taskOutput = task?.output?.[0]?.valueReference;\n        return (\n          <Fragment key={`action-${index}`}>\n            <Grid.Col span={1} p=\"md\">\n              {task?.status === 'completed' ? <IconCheckbox /> : <IconSquare color=\"gray\" />}\n            </Grid.Col>\n            <Grid.Col span={9} p=\"xs\">\n              <Text fw={500}>{action.title}</Text>\n              {action.description && <div>{action.description}</div>}\n              <div>\n                Last edited by&nbsp;\n                <ResourceName value={task?.meta?.author as Reference} />\n                &nbsp;on&nbsp;\n                {formatDateTime(task?.meta?.lastUpdated)}\n              </div>\n              <div>\n                Status: <StatusBadge status={task?.status || 'unknown'} />\n              </div>\n            </Grid.Col>\n            <Grid.Col span={2} p=\"md\">\n              {taskInput && !taskOutput && <Button onClick={() => props.onStart(task, taskInput)}>Start</Button>}\n              {taskInput && taskOutput && (\n                <Button onClick={() => props.onEdit(task, taskInput, taskOutput)}>Edit</Button>\n              )}\n            </Grid.Col>\n          </Fragment>\n        );\n      })}\n    </Grid>\n  );\n\n  function buildBatchRequest(request: RequestGroup): Bundle {\n    const batchEntries = [] as BundleEntry[];\n    if (request.action) {\n      for (const action of request.action) {\n        if (action.resource?.reference) {\n          batchEntries.push({ request: { method: 'GET', url: action.resource.reference } });\n        }\n      }\n    }\n\n    return {\n      resourceType: 'Bundle',\n      type: 'batch',\n      entry: batchEntries,\n    };\n  }\n\n  function findBundleEntry<T extends Resource>(reference: Reference<T>): T | undefined {\n    for (const entry of responseBundle?.entry as BundleEntry[]) {\n      if (entry.resource && reference.reference === getReferenceString(entry.resource)) {\n        return entry.resource as T;\n      }\n    }\n    return undefined;\n  }\n}\n", "import { Bundle, Resource, ResourceType } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useEffect, useState } from 'react';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\nimport { ResourceBadge } from '../ResourceBadge/ResourceBadge';\nimport { blame } from '../utils/blame';\nimport classes from './ResourceBlame.module.css';\nimport { getTimeString, getVersionUrl } from './ResourceBlame.utils';\n\nexport interface ResourceBlameProps {\n  readonly history?: Bundle;\n  readonly resourceType?: ResourceType;\n  readonly id?: string;\n}\n\nexport function ResourceBlame(props: ResourceBlameProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const [value, setValue] = useState<Bundle | undefined>(props.history);\n\n  useEffect(() => {\n    if (!props.history && props.resourceType && props.id) {\n      medplum.readHistory(props.resourceType, props.id).then(setValue).catch(console.log);\n    }\n  }, [medplum, props.history, props.resourceType, props.id]);\n\n  if (!value) {\n    return <div>Loading...</div>;\n  }\n\n  const resource = value.entry?.[0]?.resource as Resource;\n\n  if (!resource) {\n    return null;\n  }\n\n  const table = blame(value);\n\n  return (\n    <div className={classes.container}>\n      <table className={classes.root}>\n        <tbody>\n          {table.map((row, index) => (\n            <tr key={'row-' + index} className={row.span > 0 ? classes.startRow : classes.normalRow}>\n              {row.span > 0 && (\n                <>\n                  <td className={classes.author} rowSpan={row.span}>\n                    <ResourceBadge value={row.meta.author} link={true} />\n                  </td>\n                  <td className={classes.dateTime} rowSpan={row.span}>\n                    <MedplumLink to={getVersionUrl(resource, row.meta.versionId as string)}>\n                      {getTimeString(row.meta.lastUpdated as string)}\n                    </MedplumLink>\n                  </td>\n                </>\n              )}\n              <td className={classes.lineNumber}>{index + 1}</td>\n              <td className={classes.line}>\n                <pre className={classes.pre}>{row.value}</pre>\n              </td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n", "import { stringify } from '@medplum/core';\nimport { Bundle, BundleEntry, Meta } from '@medplum/fhirtypes';\nimport { diff } from './diff';\n\nexport interface BlameRow {\n  id: string;\n  meta: Meta;\n  value: string;\n  span: number;\n}\n\nexport function blame(history: Bundle): BlameRow[] {\n  // Convert to array of array of lines\n  const versions = (history.entry as BundleEntry[])\n    .filter((entry) => !!entry.resource)\n    .map((entry) => ({\n      meta: entry.resource?.meta as Meta,\n      lines: stringify(entry.resource, true).match(/[^\\r\\n]+/g) as string[],\n    }))\n    .sort((a, b) => (a.meta.lastUpdated as string).localeCompare(b.meta.lastUpdated as string));\n\n  // Start with array of lines from the first version\n  const table: BlameRow[] = versions[0].lines.map((line) => ({\n    id: versions[0].meta.versionId as string,\n    meta: versions[0].meta,\n    value: line,\n    span: 1,\n  }));\n\n  compareVersions(table, versions);\n  combineSpans(table);\n  return table;\n}\n\n/**\n * For each version, update the blame table with revisions.\n * @param table - The output blame table.\n * @param versions - The array of versions.\n */\nfunction compareVersions(table: BlameRow[], versions: { meta: Meta; lines: string[] }[]): void {\n  for (let i = 1; i < versions.length; i++) {\n    const revisions = diff(versions[i - 1].lines, versions[i].lines);\n\n    for (const revision of revisions) {\n      const position = revision.original.position;\n      const oldLines = revision.original.lines;\n      const newLines = revision.revised.lines;\n\n      if (revision.type === 'delete' || revision.type === 'change') {\n        // Remove the old rows\n        table.splice(position, oldLines.length);\n      }\n\n      if (revision.type === 'insert' || revision.type === 'change') {\n        // Add the new lines\n        for (let k = 0; k < revision.revised.lines.length; k++) {\n          table.splice(position + k, 0, {\n            id: versions[i].meta.versionId as string,\n            meta: versions[i].meta,\n            value: newLines[k],\n            span: 1,\n          });\n        }\n      }\n    }\n  }\n}\n\n/**\n * Combine adjacent rows into spans.\n * @param table - The output blame table.\n */\nfunction combineSpans(table: BlameRow[]): void {\n  let start = 0;\n  while (start < table.length) {\n    let curr = start;\n    while (curr < table.length && table[curr].id === table[start].id) {\n      table[curr].span = -1;\n      curr++;\n    }\n    table[start].span = curr - start;\n    start = curr;\n  }\n}\n", "/*\n * Myers Diff algorithm\n * Based on: https://github.com/KengoTODA/java-diff-utils/blob/master/src/main/java/difflib/myers/MyersDiff.java\n * Apache Software License, Version 1.1\n */\n\nexport function diff(original: string[], revised: string[]): Delta[] {\n  const path = buildPath(original, revised) as PathNode;\n  return buildRevisions(path, original, revised);\n}\n\nexport interface PathNode {\n  readonly i: number;\n  readonly j: number;\n  readonly prev: PathNode | undefined;\n  readonly snake: boolean;\n}\n\nexport interface Delta {\n  readonly original: Chunk;\n  readonly revised: Chunk;\n  readonly type: 'change' | 'delete' | 'insert';\n}\n\nexport interface Chunk {\n  readonly position: number;\n  readonly lines: string[];\n}\n\nfunction buildPath(orig: string[], rev: string[]): PathNode | undefined {\n  const N = orig.length;\n  const M = rev.length;\n  const MAX = N + M + 1;\n  const size = 1 + 2 * MAX;\n  const middle = (size / 2) | 0;\n  const diagonal: (PathNode | undefined)[] = new Array(size);\n\n  diagonal[middle + 1] = {\n    i: 0,\n    j: -1,\n    prev: undefined,\n    snake: true,\n  };\n\n  for (let d = 0; d < MAX; d++) {\n    for (let k = -d; k <= d; k += 2) {\n      const kmiddle = middle + k;\n      const kplus = kmiddle + 1;\n      const kminus = kmiddle - 1;\n      const kplusNode = diagonal[kplus] as PathNode;\n      const kminusNode = diagonal[kminus] as PathNode;\n      let prev: PathNode | undefined = undefined;\n      let i = 0;\n\n      if (k === -d || (k !== d && kminusNode.i < kplusNode.i)) {\n        i = kplusNode.i;\n        prev = kplusNode;\n      } else {\n        i = kminusNode.i + 1;\n        prev = kminusNode;\n      }\n\n      diagonal[kminus] = undefined; // no longer used\n\n      let j = i - k;\n      let node = {\n        i,\n        j,\n        prev: previousSnake(prev),\n        snake: false,\n      };\n\n      // orig and rev are zero-based\n      // but the algorithm is one-based\n      // that's why there's no +1 when indexing the sequences\n      while (i < N && j < M && orig[i] === rev[j]) {\n        i++;\n        j++;\n      }\n\n      if (i > node.i) {\n        node = {\n          i,\n          j,\n          prev: node,\n          snake: true,\n        };\n      }\n\n      diagonal[kmiddle] = node;\n\n      if (i >= N && j >= M) {\n        return diagonal[kmiddle] as PathNode;\n      }\n    }\n    diagonal[middle + d - 1] = undefined;\n  }\n\n  // According to Myers, this cannot happen\n  return undefined;\n}\n\nfunction buildRevisions(startNode: PathNode, orig: string[], rev: string[]): Delta[] {\n  const deltas: Delta[] = [];\n  let path: PathNode | undefined = startNode;\n\n  if (path.snake) {\n    path = path.prev;\n  }\n\n  while (path?.prev && path.prev.j >= 0) {\n    const i = path.i;\n    const j = path.j;\n\n    path = path.prev;\n    const ianchor = path.i;\n    const janchor = path.j;\n\n    const original = {\n      position: ianchor,\n      lines: orig.slice(ianchor, i),\n    };\n\n    const revised = {\n      position: janchor,\n      lines: rev.slice(janchor, j),\n    };\n\n    let type: 'insert' | 'delete' | 'change';\n\n    if (original.lines.length === 0 && revised.lines.length > 0) {\n      type = 'insert';\n    } else if (original.lines.length > 0 && revised.lines.length === 0) {\n      type = 'delete';\n    } else {\n      type = 'change';\n    }\n\n    deltas.push({ original, revised, type });\n\n    if (path.snake) {\n      path = path.prev;\n    }\n  }\n\n  return deltas;\n}\n\nfunction previousSnake(node: PathNode): PathNode {\n  if (node && !node.snake && node.prev) {\n    return node.prev;\n  }\n  return node;\n}\n", ".container {\n  overflow-x: auto;\n}\n\n.root {\n  border: 0.1px solid var(--mantine-color-gray-3);\n  border-collapse: collapse;\n  border-radius: var(--mantine-radius-sm);\n  border-spacing: 0;\n  font-size: var(--mantine-font-size-xs);\n  width: 100px;\n\n  & td {\n    padding: 2px 4px 0 4px;\n    vertical-align: top;\n    white-space: nowra;\n  }\n}\n\n.startRow {\n  border-top: 0.1px solid var(--mantine-color-gray-3);\n}\n\n.normalRow {\n  border-top: 0;\n}\n\n.author {\n  line-height: 10px;\n}\n\n.dateTime {\n  border-right: 0.1px solid var(--mantine-color-gray-3);\n  line-height: 20px;\n}\n\n.lineNumber {\n  background-color: var(--mantine-color-gray-1);\n  border: 0;\n  color: var(--mantine-color-gray-5);\n  font-family: var(--mantine-font-family-monospace);\n  padding: var(--mantine-spacing-xs) var(--mantine-spacing-sm);\n  text-align: right;\n}\n\n.line {\n  font-family: var(--mantine-font-family-monospace);\n  font-size: var(--mantine-font-size-sm);\n  padding: var(--mantine-spacing-xs) var(--mantine-spacing-sm);\n}\n\n.pre {\n  margin: 0;\n}\n", "import { Resource } from '@medplum/fhirtypes';\n\nexport function getVersionUrl(resource: Resource, versionId: string): string {\n  return `/${resource.resourceType}/${resource.id}/_history/${versionId}`;\n}\n\nexport function getTimeString(lastUpdated: string): string {\n  const seconds = Math.floor((Date.now() - Date.parse(lastUpdated)) / 1000);\n\n  const years = Math.floor(seconds / 31536000);\n  if (years > 0) {\n    return pluralizeTime(years, 'year');\n  }\n\n  const months = Math.floor(seconds / 2592000);\n  if (months > 0) {\n    return pluralizeTime(months, 'month');\n  }\n\n  const days = Math.floor(seconds / 86400);\n  if (days > 0) {\n    return pluralizeTime(days, 'day');\n  }\n\n  const hours = Math.floor(seconds / 3600);\n  if (hours > 0) {\n    return pluralizeTime(hours, 'hour');\n  }\n\n  const minutes = Math.floor(seconds / 60);\n  if (minutes > 0) {\n    return pluralizeTime(minutes, 'minute');\n  }\n\n  return pluralizeTime(seconds, 'second');\n}\n\nfunction pluralizeTime(count: number, noun: string): string {\n  return `${count} ${count === 1 ? noun : noun + 's'} ago`;\n}\n", "import { stringify } from '@medplum/core';\nimport { Resource } from '@medplum/fhirtypes';\nimport { Delta, diff } from '../utils/diff';\nimport classes from './ResourceDiff.module.css';\n\nexport interface ResourceDiffProps {\n  readonly original: Resource;\n  readonly revised: Resource;\n  readonly ignoreMeta?: boolean;\n}\n\nexport function ResourceDiff(props: ResourceDiffProps): JSX.Element {\n  let originalResource = props.original;\n  let revisedResource = props.revised;\n\n  if (props.ignoreMeta) {\n    originalResource = { ...originalResource, meta: undefined };\n    revisedResource = { ...revisedResource, meta: undefined };\n  }\n\n  const original = stringify(originalResource, true).match(/[^\\r\\n]+/g) as string[];\n  const revised = stringify(revisedResource, true).match(/[^\\r\\n]+/g) as string[];\n  const deltas = diff(original, revised);\n  return (\n    <pre style={{ color: 'gray' }}>\n      {deltas.map((delta, index) => (\n        <ChangeDiff key={'delta' + index} delta={delta} />\n      ))}\n    </pre>\n  );\n}\n\nfunction ChangeDiff(props: { delta: Delta }): JSX.Element {\n  return (\n    <>\n      ...\n      <br />\n      {props.delta.original.lines.length > 0 && (\n        <div className={classes.removed}>{props.delta.original.lines.join('\\n')}</div>\n      )}\n      {props.delta.revised.lines.length > 0 && (\n        <div className={classes.added}>{props.delta.revised.lines.join('\\n')}</div>\n      )}\n      ...\n      <br />\n    </>\n  );\n}\n", "\n.removed {\n  color: var(--mantine-color-red-7);\n  text-decoration: line-through;\n}\n\n.added {\n  color: var(--mantine-color-green-7);\n}", "import { Button, Group, Stack, TextInput } from '@mantine/core';\nimport { applyDefaultValuesToResource, tryGetProfile } from '@medplum/core';\nimport { OperationOutcome, Reference, Resource } from '@medplum/fhirtypes';\nimport { useMedplum, useResource } from '@medplum/react-hooks';\nimport { FormEvent, useEffect, useState } from 'react';\nimport { BackboneElementInput } from '../BackboneElementInput/BackboneElementInput';\nimport { FormSection } from '../FormSection/FormSection';\n\nexport interface ResourceFormProps {\n  readonly defaultValue: Partial<Resource> | Reference;\n  readonly outcome?: OperationOutcome;\n  readonly onSubmit: (resource: Resource) => void;\n  readonly onDelete?: (resource: Resource) => void;\n  readonly schemaName?: string;\n  /** (optional) URL of the resource profile used to display the form. Takes priority over schemaName. */\n  readonly profileUrl?: string;\n}\n\nexport function ResourceForm(props: ResourceFormProps): JSX.Element {\n  const { outcome } = props;\n  const medplum = useMedplum();\n  const defaultValue = useResource(props.defaultValue);\n  const [schemaLoaded, setSchemaLoaded] = useState<string>();\n  const [value, setValue] = useState<Resource>();\n\n  useEffect(() => {\n    if (defaultValue) {\n      if (props.profileUrl) {\n        const profileUrl: string = props.profileUrl;\n        medplum\n          .requestProfileSchema(props.profileUrl, { expandProfile: true })\n          .then(() => {\n            const profile = tryGetProfile(profileUrl);\n            if (profile) {\n              setSchemaLoaded(profile.name);\n              const modifiedDefaultValue = applyDefaultValuesToResource(defaultValue, profile);\n              setValue(modifiedDefaultValue);\n            } else {\n              console.error(`Schema not found for ${profileUrl}`);\n            }\n          })\n          .catch((reason) => {\n            console.error('Error in requestProfileSchema', reason);\n          });\n      } else {\n        const schemaName = props.schemaName ?? defaultValue?.resourceType;\n        medplum\n          .requestSchema(schemaName)\n          .then(() => {\n            setValue(defaultValue);\n            setSchemaLoaded(schemaName);\n          })\n          .catch(console.log);\n      }\n    }\n  }, [medplum, defaultValue, props.schemaName, props.profileUrl]);\n\n  if (!schemaLoaded || !value) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <form\n      noValidate\n      autoComplete=\"off\"\n      onSubmit={(e: FormEvent) => {\n        e.preventDefault();\n        if (props.onSubmit) {\n          props.onSubmit(value);\n        }\n      }}\n    >\n      <Stack mb=\"xl\">\n        <FormSection title=\"Resource Type\" htmlFor=\"resourceType\" outcome={outcome}>\n          <TextInput name=\"resourceType\" defaultValue={value.resourceType} disabled={true} />\n        </FormSection>\n        <FormSection title=\"ID\" htmlFor=\"id\" outcome={outcome}>\n          <TextInput name=\"id\" defaultValue={value.id} disabled={true} />\n        </FormSection>\n      </Stack>\n      <BackboneElementInput\n        path={value.resourceType}\n        typeName={schemaLoaded}\n        defaultValue={value}\n        outcome={outcome}\n        onChange={setValue}\n        profileUrl={props.profileUrl}\n      />\n      <Group justify=\"flex-end\" mt=\"xl\">\n        <Button type=\"submit\">OK</Button>\n        {props.onDelete && (\n          <Button\n            variant=\"outline\"\n            color=\"red\"\n            type=\"button\"\n            onClick={() => {\n              (props.onDelete as (resource: Resource) => void)(value);\n            }}\n          >\n            Delete\n          </Button>\n        )}\n      </Group>\n    </form>\n  );\n}\n", "import { Table } from '@mantine/core';\nimport { formatDateTime, normalizeErrorString } from '@medplum/core';\nimport { Bundle, BundleEntry, Resource, ResourceType } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useEffect, useState } from 'react';\nimport { MedplumLink } from '../MedplumLink/MedplumLink';\nimport { ResourceBadge } from '../ResourceBadge/ResourceBadge';\n\nexport interface ResourceHistoryTableProps {\n  readonly history?: Bundle;\n  readonly resourceType?: string;\n  readonly id?: string;\n}\n\nexport function ResourceHistoryTable(props: ResourceHistoryTableProps): JSX.Element {\n  const medplum = useMedplum();\n  const [value, setValue] = useState<Bundle | undefined>(props.history);\n\n  useEffect(() => {\n    if (!props.history && props.resourceType && props.id) {\n      medplum\n        .readHistory(props.resourceType as ResourceType, props.id)\n        .then(setValue)\n        .catch(console.log);\n    }\n  }, [medplum, props.history, props.resourceType, props.id]);\n\n  if (!value) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <Table withTableBorder withRowBorders withColumnBorders>\n      <Table.Thead>\n        <Table.Tr>\n          <Table.Th>Author</Table.Th>\n          <Table.Th>Date</Table.Th>\n          <Table.Th>Version</Table.Th>\n        </Table.Tr>\n      </Table.Thead>\n      <Table.Tbody>\n        {value.entry?.map((entry, index) => <HistoryRow key={'entry-' + index} entry={entry} />)}\n      </Table.Tbody>\n    </Table>\n  );\n}\n\ninterface HistoryRowProps {\n  readonly entry: BundleEntry;\n}\n\nfunction HistoryRow(props: HistoryRowProps): JSX.Element {\n  const { response, resource } = props.entry;\n  if (resource) {\n    return (\n      <Table.Tr>\n        <Table.Td>\n          <ResourceBadge value={resource.meta?.author} link={true} />\n        </Table.Td>\n        <Table.Td>{formatDateTime(resource.meta?.lastUpdated)}</Table.Td>\n        <Table.Td>\n          <MedplumLink to={getVersionUrl(resource)}>{resource.meta?.versionId}</MedplumLink>\n        </Table.Td>\n      </Table.Tr>\n    );\n  } else {\n    return (\n      <Table.Tr>\n        <Table.Td colSpan={3}>{normalizeErrorString(response?.outcome)}</Table.Td>\n      </Table.Tr>\n    );\n  }\n}\n\nfunction getVersionUrl(resource: Resource): string {\n  return `/${resource.resourceType}/${resource.id}/_history/${resource.meta?.versionId}`;\n}\n", "import { Button, Stack, Text } from '@mantine/core';\nimport { getReferenceString, isReference } from '@medplum/core';\nimport { Questionnaire, QuestionnaireResponse, Reference, Schedule, Slot } from '@medplum/fhirtypes';\nimport { useResource, useSearchResources } from '@medplum/react-hooks';\nimport { useState } from 'react';\nimport { CalendarInput } from '../CalendarInput/CalendarInput';\nimport { getStartMonth } from '../CalendarInput/CalendarInput.utils';\nimport { QuestionnaireForm } from '../QuestionnaireForm/QuestionnaireForm';\nimport { ResourceAvatar } from '../ResourceAvatar/ResourceAvatar';\nimport { ResourceName } from '../ResourceName/ResourceName';\nimport classes from './Scheduler.module.css';\n\nexport interface SchedulerProps {\n  readonly schedule: Schedule | Reference<Schedule>;\n  readonly questionnaire: Questionnaire | Reference<Questionnaire>;\n}\n\nexport function Scheduler(props: SchedulerProps): JSX.Element | null {\n  const schedule = useResource(props.schedule);\n  const questionnaire = useResource(props.questionnaire);\n\n  const [month, setMonth] = useState<Date>(getStartMonth());\n  const [date, setDate] = useState<Date>();\n  const [slot, setSlot] = useState<Slot>();\n  const [response, setResponse] = useState<QuestionnaireResponse>();\n\n  const [slots] = useSearchResources(\n    'Slot',\n    new URLSearchParams([\n      ['_count', (30 * 24).toString()],\n      [\n        'schedule',\n        isReference(props.schedule)\n          ? (props.schedule.reference as string)\n          : getReferenceString(props.schedule as Schedule),\n      ],\n      ['start', 'gt' + getStart(month)],\n      ['start', 'lt' + getEnd(month)],\n    ])\n  );\n\n  if (!schedule || !slots || !questionnaire) {\n    return null;\n  }\n\n  const actor = schedule.actor?.[0];\n\n  return (\n    <div className={classes.container} data-testid=\"scheduler\">\n      <div className={classes.info}>\n        {actor && <ResourceAvatar value={actor} size=\"xl\" />}\n        {actor && (\n          <Text size=\"xl\" fw={500}>\n            <ResourceName value={actor} />\n          </Text>\n        )}\n        <p>1 hour</p>\n        {date && <p>{date.toLocaleDateString()}</p>}\n        {slot && <p>{formatTime(new Date(slot.start as string))}</p>}\n      </div>\n      <div className={classes.selection}>\n        {!date && (\n          <div>\n            <h3>Select date</h3>\n            <CalendarInput slots={slots} onChangeMonth={setMonth} onClick={setDate} />\n          </div>\n        )}\n        {date && !slot && (\n          <div>\n            <h3>Select time</h3>\n            <Stack>\n              {slots.map((s) => {\n                const slotStart = new Date(s.start as string);\n                return (\n                  slotStart.getTime() > date.getTime() &&\n                  slotStart.getTime() < date.getTime() + 24 * 3600 * 1000 && (\n                    <div key={s.id}>\n                      <Button variant=\"outline\" style={{ width: 150 }} onClick={() => setSlot(s)}>\n                        {formatTime(slotStart)}\n                      </Button>\n                    </div>\n                  )\n                );\n              })}\n            </Stack>\n          </div>\n        )}\n        {date && slot && !response && (\n          <QuestionnaireForm questionnaire={questionnaire} submitButtonText=\"Next\" onSubmit={setResponse} />\n        )}\n        {date && slot && response && (\n          <div>\n            <h3>You're all set!</h3>\n            <p>Check your email for a calendar invite.</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction getStart(month: Date): string {\n  return formatSlotInstant(month.getTime());\n}\n\nfunction getEnd(month: Date): string {\n  return formatSlotInstant(month.getTime() + 31 * 24 * 60 * 60 * 1000);\n}\n\nfunction formatSlotInstant(time: number): string {\n  const date = new Date(Math.max(Date.now(), time));\n  date.setHours(0, 0, 0, 0);\n  return date.toISOString();\n}\n\nfunction formatTime(date: Date): string {\n  return date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });\n}\n", "\n.container {\n  display: flex;\n  min-height: 400px;\n}\n\n.info {\n  min-width: 300px;\n  padding: 20px;\n  border-right: 1px solid var(--mantine-color-gray-3);\n}\n\n.selection {\n  min-width: 300px;\n  padding: 20px;\n}", "import { createReference, MedplumClient, ProfileResource } from '@medplum/core';\nimport { Attachment, Group, Patient, Reference, ResourceType, ServiceRequest } from '@medplum/fhirtypes';\nimport { ResourceTimeline } from '../ResourceTimeline/ResourceTimeline';\n\nexport interface ServiceRequestTimelineProps {\n  readonly serviceRequest: ServiceRequest | Reference<ServiceRequest>;\n}\n\nexport function ServiceRequestTimeline(props: ServiceRequestTimelineProps): JSX.Element {\n  return (\n    <ResourceTimeline\n      value={props.serviceRequest}\n      loadTimelineResources={async (medplum: MedplumClient, resourceType: ResourceType, id: string) => {\n        const ref = `${resourceType}/${id}`;\n        const _count = 100;\n        return Promise.allSettled([\n          medplum.readHistory('ServiceRequest', id),\n          medplum.search('Communication', { 'based-on': ref, _count }),\n          medplum.search('DiagnosticReport', { 'based-on': ref, _count }),\n          medplum.search('Media', { 'based-on': ref, _count }),\n          medplum.search('DocumentReference', { related: ref, _count }),\n          medplum.search('Task', { _filter: `based-on eq ${ref} or focus eq ${ref} or subject eq ${ref}`, _count }),\n        ]);\n      }}\n      createCommunication={(resource: ServiceRequest, sender: ProfileResource, text: string) => ({\n        resourceType: 'Communication',\n        status: 'completed',\n        basedOn: [createReference(resource)],\n        subject: resource.subject as Reference<Group | Patient>,\n        sender: createReference(sender),\n        sent: new Date().toISOString(),\n        payload: [{ contentString: text }],\n      })}\n      createMedia={(resource: ServiceRequest, operator: ProfileResource, content: Attachment) => ({\n        resourceType: 'Media',\n        status: 'completed',\n        basedOn: [createReference(resource)],\n        subject: resource.subject,\n        operator: createReference(operator),\n        issued: new Date().toISOString(),\n        content,\n      })}\n    />\n  );\n}\n", "import { Anchor, AnchorProps } from '@mantine/core';\nimport { showNotification } from '@mantine/notifications';\nimport { normalizeErrorString } from '@medplum/core';\nimport { ClientApplication, Encounter, Patient, Reference, SmartAppLaunch } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { ReactNode } from 'react';\n\nexport interface SmartAppLaunchLinkProps extends AnchorProps {\n  readonly client: ClientApplication;\n  readonly patient?: Reference<Patient>;\n  readonly encounter?: Reference<Encounter>;\n  readonly children?: ReactNode;\n}\n\nexport function SmartAppLaunchLink(props: SmartAppLaunchLinkProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const { client, patient, encounter, children, ...rest } = props;\n\n  function launchApp(): void {\n    medplum\n      .createResource<SmartAppLaunch>({\n        resourceType: 'SmartAppLaunch',\n        patient,\n        encounter,\n      })\n      .then((result) => {\n        const url = new URL(client.launchUri as string);\n        url.searchParams.set('iss', medplum.getBaseUrl() + 'fhir/R4');\n        url.searchParams.set('launch', result.id as string);\n        window.location.assign(url.toString());\n      })\n      .catch((err) => showNotification({ color: 'red', message: normalizeErrorString(err), autoClose: false }));\n  }\n\n  return (\n    <Anchor onClick={() => launchApp()} {...rest}>\n      {children}\n    </Anchor>\n  );\n}\n", "import { LoginAuthenticationResponse, normalizeOperationOutcome } from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { ReactNode, useEffect, useState } from 'react';\nimport { Document } from '../Document/Document';\nimport { NewProjectForm } from './NewProjectForm';\nimport { NewUserForm } from './NewUserForm';\n\nexport interface RegisterFormProps {\n  readonly type: 'patient' | 'project';\n  readonly projectId?: string;\n  readonly clientId?: string;\n  readonly googleClientId?: string;\n  readonly recaptchaSiteKey?: string;\n  readonly children?: ReactNode;\n  readonly onSuccess: () => void;\n}\n\nexport function RegisterForm(props: RegisterFormProps): JSX.Element {\n  const { type, projectId, clientId, googleClientId, recaptchaSiteKey, onSuccess } = props;\n  const medplum = useMedplum();\n  const [login, setLogin] = useState<string>();\n  const [outcome, setOutcome] = useState<OperationOutcome>();\n\n  useEffect(() => {\n    if (type === 'patient' && login) {\n      medplum\n        .startNewPatient({ login, projectId: projectId as string })\n        .then((response) => medplum.processCode(response.code as string))\n        .then(() => onSuccess())\n        .catch((err) => setOutcome(normalizeOperationOutcome(err)));\n    }\n  }, [medplum, type, projectId, login, onSuccess]);\n\n  function handleAuthResponse(response: LoginAuthenticationResponse): void {\n    if (response.code) {\n      medplum\n        .processCode(response.code)\n        .then(() => onSuccess())\n        .catch(console.log);\n    } else if (response.login) {\n      setLogin(response.login);\n    }\n  }\n\n  return (\n    <Document width={450}>\n      {outcome && <pre>{JSON.stringify(outcome, null, 2)}</pre>}\n      {!login && (\n        <NewUserForm\n          projectId={projectId as string}\n          clientId={clientId}\n          googleClientId={googleClientId}\n          recaptchaSiteKey={recaptchaSiteKey}\n          handleAuthResponse={handleAuthResponse}\n        >\n          {props.children}\n        </NewUserForm>\n      )}\n      {login && type === 'project' && <NewProjectForm login={login} handleAuthResponse={handleAuthResponse} />}\n    </Document>\n  );\n}\n", "import { Anchor, Button, Center, Group, Stack, Text, TextInput, Title } from '@mantine/core';\nimport { LoginAuthenticationResponse, normalizeOperationOutcome } from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { Logo } from '../Logo/Logo';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { getErrorsForInput } from '../utils/outcomes';\n\nexport interface NewProjectFormProps {\n  readonly login: string;\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n}\n\nexport function NewProjectForm(props: NewProjectFormProps): JSX.Element {\n  const medplum = useMedplum();\n  const [outcome, setOutcome] = useState<OperationOutcome | undefined>();\n  return (\n    <Form\n      style={{ maxWidth: 400 }}\n      onSubmit={async (formData: Record<string, string>) => {\n        try {\n          props.handleAuthResponse(\n            await medplum.startNewProject({\n              login: props.login,\n              projectName: formData.projectName,\n            })\n          );\n        } catch (err) {\n          setOutcome(normalizeOperationOutcome(err));\n        }\n      }}\n    >\n      <Center style={{ flexDirection: 'column' }}>\n        <Logo size={32} />\n        <Title>Create project</Title>\n      </Center>\n      <Stack gap=\"xl\">\n        <TextInput\n          name=\"projectName\"\n          label=\"Project Name\"\n          placeholder=\"My Project\"\n          required={true}\n          autoFocus={true}\n          error={getErrorsForInput(outcome, 'firstName')}\n        />\n        <Text c=\"dimmed\" size=\"xs\">\n          By clicking submit you agree to the Medplum{' '}\n          <Anchor href=\"https://www.medplum.com/privacy\">Privacy&nbsp;Policy</Anchor>\n          {' and '}\n          <Anchor href=\"https://www.medplum.com/terms\">Terms&nbsp;of&nbsp;Service</Anchor>.\n        </Text>\n      </Stack>\n      <Group justify=\"flex-end\" mt=\"xl\" wrap=\"nowrap\">\n        <Button type=\"submit\">Create project</Button>\n      </Group>\n    </Form>\n  );\n}\n", "import { Anchor, Button, Center, Checkbox, Divider, Group, PasswordInput, Stack, Text, TextInput } from '@mantine/core';\nimport { GoogleCredentialResponse, LoginAuthenticationResponse, normalizeOperationOutcome } from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { ReactNode, useEffect, useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { GoogleButton } from '../GoogleButton/GoogleButton';\nimport { getGoogleClientId } from '../GoogleButton/GoogleButton.utils';\nimport { OperationOutcomeAlert } from '../OperationOutcomeAlert/OperationOutcomeAlert';\nimport { getErrorsForInput, getIssuesForExpression } from '../utils/outcomes';\nimport { getRecaptcha, initRecaptcha } from '../utils/recaptcha';\n\nexport interface NewUserFormProps {\n  readonly projectId: string;\n  readonly clientId?: string;\n  readonly googleClientId?: string;\n  readonly recaptchaSiteKey?: string;\n  readonly children?: ReactNode;\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n}\n\nexport function NewUserForm(props: NewUserFormProps): JSX.Element {\n  const googleClientId = getGoogleClientId(props.googleClientId);\n  const recaptchaSiteKey = props.recaptchaSiteKey;\n  const medplum = useMedplum();\n  const [outcome, setOutcome] = useState<OperationOutcome>();\n  const issues = getIssuesForExpression(outcome, undefined);\n\n  useEffect(() => {\n    if (recaptchaSiteKey) {\n      initRecaptcha(recaptchaSiteKey);\n    }\n  }, [recaptchaSiteKey]);\n\n  return (\n    <Form\n      style={{ maxWidth: 400 }}\n      onSubmit={async (formData: Record<string, string>) => {\n        try {\n          let recaptchaToken = '';\n          if (recaptchaSiteKey) {\n            recaptchaToken = await getRecaptcha(recaptchaSiteKey);\n          }\n          props.handleAuthResponse(\n            await medplum.startNewUser({\n              projectId: props.projectId,\n              clientId: props.clientId,\n              firstName: formData.firstName,\n              lastName: formData.lastName,\n              email: formData.email,\n              password: formData.password,\n              remember: formData.remember === 'true',\n              recaptchaSiteKey,\n              recaptchaToken,\n            })\n          );\n        } catch (err) {\n          setOutcome(normalizeOperationOutcome(err));\n        }\n      }}\n    >\n      <Center style={{ flexDirection: 'column' }}>{props.children}</Center>\n      <OperationOutcomeAlert issues={issues} />\n      {googleClientId && (\n        <>\n          <Group justify=\"center\" p=\"xl\" style={{ height: 70 }}>\n            <GoogleButton\n              googleClientId={googleClientId}\n              handleGoogleCredential={async (response: GoogleCredentialResponse) => {\n                try {\n                  props.handleAuthResponse(\n                    await medplum.startGoogleLogin({\n                      googleClientId: response.clientId,\n                      googleCredential: response.credential,\n                      createUser: true,\n                    })\n                  );\n                } catch (err) {\n                  setOutcome(normalizeOperationOutcome(err));\n                }\n              }}\n            />\n          </Group>\n          <Divider label=\"or\" labelPosition=\"center\" my=\"lg\" />\n        </>\n      )}\n      <Stack gap=\"xl\">\n        <TextInput\n          name=\"firstName\"\n          type=\"text\"\n          label=\"First name\"\n          placeholder=\"First name\"\n          required={true}\n          autoFocus={true}\n          error={getErrorsForInput(outcome, 'firstName')}\n        />\n        <TextInput\n          name=\"lastName\"\n          type=\"text\"\n          label=\"Last name\"\n          placeholder=\"Last name\"\n          required={true}\n          error={getErrorsForInput(outcome, 'lastName')}\n        />\n        <TextInput\n          name=\"email\"\n          type=\"email\"\n          label=\"Email\"\n          placeholder=\"name@domain.com\"\n          required={true}\n          error={getErrorsForInput(outcome, 'email')}\n        />\n        <PasswordInput\n          name=\"password\"\n          label=\"Password\"\n          autoComplete=\"off\"\n          required={true}\n          error={getErrorsForInput(outcome, 'password')}\n        />\n        <Text c=\"dimmed\" size=\"xs\">\n          By clicking submit you agree to the Medplum{' '}\n          <Anchor href=\"https://www.medplum.com/privacy\">Privacy&nbsp;Policy</Anchor>\n          {' and '}\n          <Anchor href=\"https://www.medplum.com/terms\">Terms&nbsp;of&nbsp;Service</Anchor>.\n        </Text>\n        <Text c=\"dimmed\" size=\"xs\">\n          This site is protected by reCAPTCHA and the Google{' '}\n          <Anchor href=\"https://policies.google.com/privacy\">Privacy&nbsp;Policy</Anchor>\n          {' and '}\n          <Anchor href=\"https://policies.google.com/terms\">Terms&nbsp;of&nbsp;Service</Anchor> apply.\n        </Text>\n      </Stack>\n      <Group justify=\"space-between\" mt=\"xl\" wrap=\"nowrap\">\n        <Checkbox name=\"remember\" label=\"Remember me\" size=\"xs\" />\n        <Button type=\"submit\">Create account</Button>\n      </Group>\n    </Form>\n  );\n}\n", "import { GoogleCredentialResponse } from '@medplum/core';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useEffect, useRef, useState } from 'react';\nimport { createScriptTag } from '../utils/script';\n\ninterface GoogleApi {\n  readonly accounts: {\n    id: {\n      initialize: (args: any) => void;\n      renderButton: (parent: HTMLElement, args: any) => void;\n    };\n  };\n}\n\ndeclare const google: GoogleApi;\n\nexport interface GoogleButtonProps {\n  readonly googleClientId?: string;\n  readonly handleGoogleCredential: (response: GoogleCredentialResponse) => void;\n}\n\nexport function GoogleButton(props: GoogleButtonProps): JSX.Element | null {\n  const medplum = useMedplum();\n  const { googleClientId, handleGoogleCredential } = props;\n  const parentRef = useRef<HTMLDivElement>(null);\n  const [scriptLoaded, setScriptLoaded] = useState<boolean>(typeof google !== 'undefined');\n  const [initialized, setInitialized] = useState(false);\n  const [buttonRendered, setButtonRendered] = useState(false);\n\n  useEffect(() => {\n    if (typeof google === 'undefined') {\n      createScriptTag('https://accounts.google.com/gsi/client', () => setScriptLoaded(true));\n      return;\n    }\n\n    if (!initialized) {\n      google.accounts.id.initialize({\n        client_id: googleClientId,\n        callback: handleGoogleCredential,\n      });\n      setInitialized(true);\n    }\n\n    if (parentRef.current && !buttonRendered) {\n      google.accounts.id.renderButton(parentRef.current, {});\n      setButtonRendered(true);\n    }\n  }, [medplum, googleClientId, initialized, scriptLoaded, parentRef, buttonRendered, handleGoogleCredential]);\n\n  if (!googleClientId) {\n    return null;\n  }\n\n  return <div ref={parentRef} />;\n}\n", "/**\n * Dynamically creates a script tag for the specified JavaScript file.\n * @param src - The JavaScript file URL.\n * @param onload - Optional callback for the onload event.\n */\nexport function createScriptTag(src: string, onload?: () => void): void {\n  const head = document.getElementsByTagName('head')[0];\n  const script = document.createElement('script');\n  script.async = true;\n  script.src = src;\n  script.onload = onload ?? null;\n  head.appendChild(script);\n}\n", "export function getGoogleClientId(clientId: string | undefined): string | undefined {\n  if (clientId) {\n    return clientId;\n  }\n\n  if (typeof window !== 'undefined') {\n    const origin = window.location.protocol + '//' + window.location.host;\n    const authorizedOrigins = import.meta.env.GOOGLE_AUTH_ORIGINS?.split(',') ?? [];\n    if (authorizedOrigins.includes(origin)) {\n      return import.meta.env.GOOGLE_CLIENT_ID;\n    }\n  }\n\n  return undefined;\n}\n", "import { createScriptTag } from './script';\n\n// reCAPTCHA type definitions do not work with Vite project aliasing.\n// Project aliasing is more valuable than type definitions,\n// so cheating and using `any` here.\ndeclare let grecaptcha: any;\n\n/**\n * Dynamically loads the recaptcha script.\n * We do not want to load the script on page load unless the user needs it.\n * @param siteKey - The reCAPTCHA site key, available from the reCAPTCHA admin page.\n */\nexport function initRecaptcha(siteKey: string): void {\n  if (typeof grecaptcha === 'undefined') {\n    createScriptTag('https://www.google.com/recaptcha/api.js?render=' + siteKey);\n  }\n}\n\n/**\n * Starts a request to generate a recapcha token.\n * @param siteKey - The reCAPTCHA site key, available from the reCAPTCHA admin page.\n * @returns Promise to a recaptcha token for the current user.\n */\nexport function getRecaptcha(siteKey: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    grecaptcha.ready(async () => {\n      try {\n        resolve(await grecaptcha.execute(siteKey, { action: 'submit' }));\n      } catch (err) {\n        reject(err);\n      }\n    });\n  });\n}\n", "import { showNotification } from '@mantine/notifications';\nimport { BaseLoginRequest, LoginAuthenticationResponse, normalizeErrorString } from '@medplum/core';\nimport { ProjectMembership } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { ReactNode, useCallback, useEffect, useState } from 'react';\nimport { Document } from '../Document/Document';\nimport { AuthenticationForm } from './AuthenticationForm';\nimport { ChooseProfileForm } from './ChooseProfileForm';\nimport { ChooseScopeForm } from './ChooseScopeForm';\nimport { MfaForm } from './MfaForm';\nimport { NewProjectForm } from './NewProjectForm';\n\nexport interface SignInFormProps extends BaseLoginRequest {\n  readonly login?: string;\n  readonly chooseScopes?: boolean;\n  readonly disableEmailAuth?: boolean;\n  readonly disableGoogleAuth?: boolean;\n  readonly onSuccess?: () => void;\n  readonly onForgotPassword?: () => void;\n  readonly onRegister?: () => void;\n  readonly onCode?: (code: string) => void;\n  readonly children?: ReactNode;\n}\n\n/**\n * The SignInForm component allows users to sign in to Medplum.\n *\n * \"Signing in\" is a multi-step process:\n * 1) Authentication - identify the user\n * 2) MFA - If MFA is enabled, prompt for MFA code\n * 3) Choose profile - If the user has multiple profiles, prompt to choose one\n * 4) Choose scope - If the user has multiple scopes, prompt to choose one\n * 5) Success - Return to the caller with either a code or a redirect\n * @param props - The SignInForm React props.\n * @returns The SignInForm React node.\n */\nexport function SignInForm(props: SignInFormProps): JSX.Element {\n  const {\n    login: loginCode,\n    chooseScopes,\n    onSuccess,\n    onForgotPassword,\n    onRegister,\n    onCode,\n    ...baseLoginRequest\n  } = props;\n  const medplum = useMedplum();\n  const [login, setLogin] = useState<string>();\n  const [mfaRequired, setAuthenticatorRequired] = useState(false);\n  const [memberships, setMemberships] = useState<ProjectMembership[]>();\n\n  const handleCode = useCallback(\n    (code: string): void => {\n      if (onCode) {\n        onCode(code);\n      } else {\n        medplum\n          .processCode(code)\n          .then(() => {\n            if (onSuccess) {\n              onSuccess();\n            }\n          })\n          .catch((err) => showNotification({ color: 'red', message: normalizeErrorString(err) }));\n      }\n    },\n    [medplum, onCode, onSuccess]\n  );\n\n  const handleAuthResponse = useCallback(\n    (response: LoginAuthenticationResponse): void => {\n      setAuthenticatorRequired(!!response.mfaRequired);\n\n      if (response.login) {\n        setLogin(response.login);\n      }\n\n      if (response.memberships) {\n        setMemberships(response.memberships);\n      }\n\n      if (response.code) {\n        if (chooseScopes) {\n          setMemberships(undefined);\n        } else {\n          handleCode(response.code as string);\n        }\n      }\n    },\n    [chooseScopes, handleCode]\n  );\n\n  const handleScopeResponse = useCallback(\n    (response: LoginAuthenticationResponse): void => {\n      handleCode(response.code as string);\n    },\n    [handleCode]\n  );\n\n  useEffect(() => {\n    // Beware the race condition here\n    // The `useMedplum` hook will return a new instance of the MedplumClient on login\n    // We do not want to request the login status again in that case\n    // Only request login status once\n    if (loginCode && !login) {\n      medplum\n        .get('auth/login/' + loginCode)\n        .then(handleAuthResponse)\n        .catch((err) => showNotification({ color: 'red', message: normalizeErrorString(err) }));\n    }\n  }, [medplum, loginCode, login, handleAuthResponse]);\n\n  return (\n    <Document width={450} px=\"sm\" py=\"md\">\n      {(() => {\n        if (!login) {\n          return (\n            <AuthenticationForm\n              onForgotPassword={onForgotPassword}\n              onRegister={onRegister}\n              handleAuthResponse={handleAuthResponse}\n              disableGoogleAuth={props.disableGoogleAuth}\n              disableEmailAuth={props.disableEmailAuth}\n              {...baseLoginRequest}\n            >\n              {props.children}\n            </AuthenticationForm>\n          );\n        } else if (mfaRequired) {\n          return <MfaForm login={login} handleAuthResponse={handleAuthResponse} />;\n        } else if (memberships) {\n          return <ChooseProfileForm login={login} memberships={memberships} handleAuthResponse={handleAuthResponse} />;\n        } else if (props.projectId === 'new') {\n          return <NewProjectForm login={login} handleAuthResponse={handleAuthResponse} />;\n        } else if (props.chooseScopes) {\n          return <ChooseScopeForm login={login} scope={props.scope} handleAuthResponse={handleScopeResponse} />;\n        } else {\n          return <div>Success</div>;\n        }\n      })()}\n    </Document>\n  );\n}\n", "import { Anchor, Button, Center, Checkbox, Divider, Group, PasswordInput, Stack, TextInput } from '@mantine/core';\nimport {\n  BaseLoginRequest,\n  GoogleCredentialResponse,\n  GoogleLoginRequest,\n  LoginAuthenticationResponse,\n  normalizeOperationOutcome,\n} from '@medplum/core';\nimport { OperationOutcome } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { ReactNode, useCallback, useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { GoogleButton } from '../GoogleButton/GoogleButton';\nimport { getGoogleClientId } from '../GoogleButton/GoogleButton.utils';\nimport { OperationOutcomeAlert } from '../OperationOutcomeAlert/OperationOutcomeAlert';\nimport { getErrorsForInput, getIssuesForExpression } from '../utils/outcomes';\n\nexport interface AuthenticationFormProps extends BaseLoginRequest {\n  readonly disableEmailAuth?: boolean;\n  readonly disableGoogleAuth?: boolean;\n  readonly onForgotPassword?: () => void;\n  readonly onRegister?: () => void;\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n  readonly children?: ReactNode;\n}\n\nexport function AuthenticationForm(props: AuthenticationFormProps): JSX.Element {\n  const [email, setEmail] = useState<string>();\n\n  if (!email) {\n    return <EmailForm setEmail={setEmail} {...props} />;\n  } else {\n    return <PasswordForm email={email} {...props} />;\n  }\n}\n\nexport interface EmailFormProps extends BaseLoginRequest {\n  readonly disableEmailAuth?: boolean;\n  readonly disableGoogleAuth?: boolean;\n  readonly onRegister?: () => void;\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n  readonly setEmail: (email: string) => void;\n  readonly children?: ReactNode;\n}\n\nexport function EmailForm(props: EmailFormProps): JSX.Element {\n  const { setEmail, onRegister, handleAuthResponse, children, disableEmailAuth, ...baseLoginRequest } = props;\n  const medplum = useMedplum();\n  const googleClientId = !props.disableGoogleAuth && getGoogleClientId(props.googleClientId);\n  const [outcome, setOutcome] = useState<OperationOutcome>();\n  const issues = getIssuesForExpression(outcome, undefined);\n\n  const isExternalAuth = useCallback(\n    async (authMethod: any): Promise<boolean> => {\n      if (!authMethod.authorizeUrl) {\n        return false;\n      }\n\n      const state = JSON.stringify({\n        ...(await medplum.ensureCodeChallenge(baseLoginRequest)),\n        domain: authMethod.domain,\n      });\n      const url = new URL(authMethod.authorizeUrl);\n      url.searchParams.set('state', state);\n      window.location.assign(url.toString());\n      return true;\n    },\n    [medplum, baseLoginRequest]\n  );\n\n  const handleSubmit = useCallback(\n    async (formData: Record<string, string>) => {\n      const authMethod = await medplum.post('auth/method', { email: formData.email });\n      if (!(await isExternalAuth(authMethod))) {\n        setEmail(formData.email);\n      }\n    },\n    [medplum, isExternalAuth, setEmail]\n  );\n\n  const handleGoogleCredential = useCallback(\n    async (response: GoogleCredentialResponse) => {\n      try {\n        const authResponse = await medplum.startGoogleLogin({\n          ...baseLoginRequest,\n          googleCredential: response.credential,\n        } as GoogleLoginRequest);\n        if (!(await isExternalAuth(authResponse))) {\n          handleAuthResponse(authResponse);\n        }\n      } catch (err) {\n        setOutcome(normalizeOperationOutcome(err));\n      }\n    },\n    [medplum, baseLoginRequest, isExternalAuth, handleAuthResponse]\n  );\n\n  return (\n    <Form onSubmit={handleSubmit}>\n      <Center style={{ flexDirection: 'column' }}>{children}</Center>\n      <OperationOutcomeAlert issues={issues} />\n      {googleClientId && (\n        <>\n          <Group justify=\"center\" p=\"xl\" style={{ height: 70 }}>\n            <GoogleButton googleClientId={googleClientId} handleGoogleCredential={handleGoogleCredential} />\n          </Group>\n          {!disableEmailAuth && <Divider label=\"or\" labelPosition=\"center\" my=\"lg\" />}\n        </>\n      )}\n      {!disableEmailAuth && (\n        <TextInput\n          name=\"email\"\n          type=\"email\"\n          label=\"Email\"\n          placeholder=\"name@domain.com\"\n          required={true}\n          autoFocus={true}\n          error={getErrorsForInput(outcome, 'email')}\n        />\n      )}\n      <Group justify=\"space-between\" mt=\"xl\" gap={0} wrap=\"nowrap\">\n        <div>\n          {onRegister && (\n            <Anchor component=\"button\" type=\"button\" color=\"dimmed\" onClick={onRegister} size=\"xs\">\n              Register\n            </Anchor>\n          )}\n        </div>\n        {!disableEmailAuth && <Button type=\"submit\">Next</Button>}\n      </Group>\n    </Form>\n  );\n}\n\nexport interface PasswordFormProps extends BaseLoginRequest {\n  readonly email: string;\n  readonly onForgotPassword?: () => void;\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n  readonly children?: ReactNode;\n}\n\nexport function PasswordForm(props: PasswordFormProps): JSX.Element {\n  const { onForgotPassword, handleAuthResponse, children, ...baseLoginRequest } = props;\n  const medplum = useMedplum();\n  const [outcome, setOutcome] = useState<OperationOutcome>();\n  const issues = getIssuesForExpression(outcome, undefined);\n\n  const handleSubmit = useCallback(\n    (formData: Record<string, string>) => {\n      medplum\n        .startLogin({\n          ...baseLoginRequest,\n          password: formData.password,\n          remember: formData.remember === 'on',\n        })\n        .then(handleAuthResponse)\n        .catch((err) => setOutcome(normalizeOperationOutcome(err)));\n    },\n    [medplum, baseLoginRequest, handleAuthResponse]\n  );\n\n  return (\n    <Form style={{ maxWidth: 400 }} onSubmit={handleSubmit}>\n      <Center style={{ flexDirection: 'column' }}>{children}</Center>\n      <OperationOutcomeAlert issues={issues} />\n      <Stack gap=\"xl\">\n        <PasswordInput\n          name=\"password\"\n          label=\"Password\"\n          autoComplete=\"off\"\n          required={true}\n          autoFocus={true}\n          error={getErrorsForInput(outcome, 'password')}\n        />\n      </Stack>\n      <Group justify=\"space-between\" mt=\"xl\" gap={0} wrap=\"nowrap\">\n        {onForgotPassword && (\n          <Anchor component=\"button\" type=\"button\" c=\"dimmed\" onClick={onForgotPassword} size=\"xs\">\n            Forgot password\n          </Anchor>\n        )}\n        <Checkbox id=\"remember\" name=\"remember\" label=\"Remember me\" size=\"xs\" style={{ lineHeight: 1 }} />\n        <Button type=\"submit\">Sign in</Button>\n      </Group>\n    </Form>\n  );\n}\n", "import { Avatar, Combobox, Flex, Group, Stack, Text, TextInput, Title, useCombobox } from '@mantine/core';\nimport { LoginAuthenticationResponse, normalizeOperationOutcome } from '@medplum/core';\nimport { OperationOutcome, ProjectMembership } from '@medplum/fhirtypes';\nimport { useMedplum } from '@medplum/react-hooks';\nimport { useState } from 'react';\nimport { Logo } from '../Logo/Logo';\nimport { OperationOutcomeAlert } from '../OperationOutcomeAlert/OperationOutcomeAlert';\n\nexport interface ChooseProfileFormProps {\n  readonly login: string;\n  readonly memberships: ProjectMembership[];\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n}\n\nexport function ChooseProfileForm(props: ChooseProfileFormProps): JSX.Element {\n  const medplum = useMedplum();\n  const combobox = useCombobox();\n  const [search, setSearch] = useState('');\n  const [outcome, setOutcome] = useState<OperationOutcome>();\n\n  function filterDisplay(display: string | undefined): boolean {\n    return !!display?.toLowerCase()?.includes(search.toLowerCase());\n  }\n\n  function filterMembership(membership: ProjectMembership): boolean {\n    return filterDisplay(membership.profile?.display) || filterDisplay(membership.project?.display);\n  }\n\n  function handleValueSelect(membershipId: string): void {\n    medplum\n      .post('auth/profile', {\n        login: props.login,\n        profile: membershipId,\n      })\n      .then(props.handleAuthResponse)\n      .catch((err) => setOutcome(normalizeOperationOutcome(err)));\n  }\n\n  const options = props.memberships\n    .filter(filterMembership)\n    .slice(0, 10)\n    .map((item) => (\n      <Combobox.Option value={item.id as string} key={item.id}>\n        <SelectOption {...item} />\n      </Combobox.Option>\n    ));\n\n  return (\n    <Stack>\n      <Flex gap=\"md\" mb=\"md\" justify=\"center\" align=\"center\" direction=\"column\" wrap=\"nowrap\">\n        <Logo size={32} />\n        <Title order={3}>Choose profile</Title>\n      </Flex>\n      <OperationOutcomeAlert outcome={outcome} />\n      <Combobox store={combobox} onOptionSubmit={handleValueSelect}>\n        <Combobox.EventsTarget>\n          <TextInput\n            placeholder=\"Search\"\n            value={search}\n            onChange={(event) => {\n              setSearch(event.currentTarget.value);\n              combobox.updateSelectedOptionIndex();\n            }}\n          />\n        </Combobox.EventsTarget>\n\n        <div>\n          <Combobox.Options>\n            {options.length > 0 ? options : <Combobox.Empty>Nothing found...</Combobox.Empty>}\n          </Combobox.Options>\n        </div>\n      </Combobox>\n    </Stack>\n  );\n}\n\nfunction SelectOption(membership: ProjectMembership): JSX.Element {\n  return (\n    <Group>\n      <Avatar radius=\"xl\" />\n      <div>\n        <Text fz=\"sm\" fw={500}>\n          {membership.profile?.display}\n        </Text>\n        <Text fz=\"xs\" opacity={0.6}>\n          {membership.project?.display}\n        </Text>\n      </div>\n    </Group>\n  );\n}\n", "import { Button, Center, Checkbox, Group, Stack, Title } from '@mantine/core';\nimport { LoginAuthenticationResponse } from '@medplum/core';\nimport { Form } from '../Form/Form';\nimport { Logo } from '../Logo/Logo';\nimport { useMedplum } from '@medplum/react-hooks';\n\nexport interface ChooseScopeFormProps {\n  readonly login: string;\n  readonly scope: string | undefined;\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n}\n\nexport function ChooseScopeForm(props: ChooseScopeFormProps): JSX.Element {\n  const medplum = useMedplum();\n  return (\n    <Form\n      style={{ maxWidth: 400 }}\n      onSubmit={(formData: Record<string, string>) => {\n        medplum\n          .post('auth/scope', {\n            login: props.login,\n            scope: Object.keys(formData).join(' '),\n          })\n          .then(props.handleAuthResponse)\n          .catch(console.log);\n      }}\n    >\n      <Stack>\n        <Center style={{ flexDirection: 'column' }}>\n          <Logo size={32} />\n          <Title>Choose scope</Title>\n        </Center>\n        <Stack>\n          {(props.scope ?? 'openid').split(' ').map((scopeName: string) => (\n            <Checkbox key={scopeName} id={scopeName} name={scopeName} label={scopeName} defaultChecked />\n          ))}\n        </Stack>\n        <Group justify=\"flex-end\" mt=\"xl\">\n          <Button type=\"submit\">Set scope</Button>\n        </Group>\n      </Stack>\n    </Form>\n  );\n}\n", "import { Alert, Button, Center, Group, Stack, TextInput, Title } from '@mantine/core';\nimport { LoginAuthenticationResponse, normalizeErrorString } from '@medplum/core';\nimport { IconAlertCircle } from '@tabler/icons-react';\nimport { useState } from 'react';\nimport { Form } from '../Form/Form';\nimport { Logo } from '../Logo/Logo';\nimport { useMedplum } from '@medplum/react-hooks';\n\nexport interface MfaFormProps {\n  readonly login: string;\n  readonly handleAuthResponse: (response: LoginAuthenticationResponse) => void;\n}\n\nexport function MfaForm(props: MfaFormProps): JSX.Element {\n  const medplum = useMedplum();\n  const [errorMessage, setErrorMessage] = useState<string>();\n  return (\n    <Form\n      style={{ maxWidth: 400 }}\n      onSubmit={(formData: Record<string, string>) => {\n        setErrorMessage(undefined);\n        medplum\n          .post('auth/mfa/verify', {\n            login: props.login,\n            token: formData.token,\n          })\n          .then(props.handleAuthResponse)\n          .catch((err) => setErrorMessage(normalizeErrorString(err)));\n      }}\n    >\n      <Stack>\n        <Center style={{ flexDirection: 'column' }}>\n          <Logo size={32} />\n          <Title>Enter MFA code</Title>\n        </Center>\n        {errorMessage && (\n          <Alert icon={<IconAlertCircle size={16} />} title=\"Error\" color=\"red\">\n            {errorMessage}\n          </Alert>\n        )}\n        <Stack>\n          <TextInput name=\"token\" label=\"MFA code\" required />\n        </Stack>\n        <Group justify=\"flex-end\" mt=\"xl\">\n          <Button type=\"submit\">Submit code</Button>\n        </Group>\n      </Stack>\n    </Form>\n  );\n}\n"],
  "mappings": "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",
  "names": ["Pointer", "diff", "memo", "j", "a", "b", "b", "d", "MissingError", "TestError", "InvalidOperationError", "diff", "createPatch", "import_react", "import_core", "reactContext", "createContext", "useMedplumContext", "useContext", "useMedplum", "useMedplumNavigate", "useMedplumProfile", "MedplumProvider", "props", "medplum", "navigate", "defaultNavigate", "state", "setState", "useState", "useEffect", "s", "eventListener", "medplumContext", "useMemo", "jsx", "path", "urls", "useCachedBinaryUrl", "binaryUrl", "binaryResourceUrl", "binaryUrlSearchParams", "binaryUrlExpires", "cachedUrl", "expires", "useResource", "value", "setOutcome", "resource", "setResource", "getInitialResource", "setResourceIfChanged", "useCallback", "r", "deepEquals", "subscribed", "isReference", "err", "normalizeOperationOutcome", "isResource", "useSearch", "resourceType", "query", "useSearchImpl", "useSearchOne", "useSearchResources", "searchFn", "searchKey", "setSearchKey", "loading", "setLoading", "result", "setResult", "outcome", "key", "res", "allOk", "SUBSCRIPTION_DEBOUNCE_MS", "useSubscription", "criteria", "callback", "emitter", "setEmitter", "listeningRef", "useRef", "unsubTimerRef", "prevCriteriaRef", "callbackRef", "emitterCallback", "event", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_notifications", "import_react", "import_core", "Component", "PropTypes", "import_react", "import_jsx_runtime", "import_core", "import_jsx_runtime", "main", "import_core", "f", "import_react", "import_core", "import_core", "import_jsx_runtime", "import_jsx_runtime", "logoButton", "user", "userName", "userActive", "import_core", "import_core", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_react", "import_core", "import_react", "import_jsx_runtime", "defaultValue", "toOption", "ItemComponent", "option", "v", "searchInput", "import_core", "import_jsx_runtime", "a", "b", "import_jsx_runtime", "MantineAppShell", "import_core", "import_react", "import_core", "import_notifications", "import_jsx_runtime", "import_jsx_runtime", "import_react", "import_react", "import_core", "import_react", "import_jsx_runtime", "toOption", "ItemComponent", "import_jsx_runtime", "defaultValue", "import_jsx_runtime", "menuTitle", "link", "linkActive", "import_jsx_runtime", "MantineAppShell", "import_jsx_runtime", "MantineAppShell", "import_core", "import_jsx_runtime", "root", "compact", "import_jsx_runtime", "import_core", "import_jsx_runtime", "v", "import_core", "import_react", "import_core", "import_react", "import_jsx_runtime", "import_jsx_runtime", "v", "props", "import_core", "import_react", "import_jsx_runtime", "props", "import_core", "import_core", "import_core", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_react", "React", "import_core", "import_core", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "slices", "slicedValues", "import_core", "import_react", "import_core", "import_jsx_runtime", "import_jsx_runtime", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_core", "import_react", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_core", "import_react", "import_react", "import_jsx_runtime", "defaultValue", "import_react", "import_jsx_runtime", "defaultValue", "import_core", "import_react", "import_core", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "v", "import_core", "import_react", "import_jsx_runtime", "v", "import_core", "import_react", "import_core", "import_react", "import_jsx_runtime", "toOption", "defaultValue", "ItemComponent", "import_jsx_runtime", "defaultValue", "import_core", "import_react", "import_core", "import_react", "import_core", "import_jsx_runtime", "import_core", "import_jsx_runtime", "indented", "import_jsx_runtime", "import_jsx_runtime", "defaultValue", "slices", "slicedValues", "import_core", "import_notifications", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_jsx_runtime", "defaultValue", "import_jsx_runtime", "EXTENSION_KEYS", "IGNORED_PROPERTIES", "import_jsx_runtime", "defaultValue", "import_core", "import_react", "table", "import_jsx_runtime", "import_core", "root", "import_jsx_runtime", "MantineContainer", "import_core", "import_notifications", "import_react", "import_core", "import_react", "import_core", "noteBody", "noteCite", "noteRoot", "import_jsx_runtime", "import_core", "import_core", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_jsx_runtime", "table", "criticalRow", "noteBody", "noteCite", "noteRoot", "import_jsx_runtime", "import_core", "paper", "fill", "import_jsx_runtime", "import_core", "import_react", "root", "removed", "added", "import_jsx_runtime", "v", "import_react", "import_core", "import_jsx_runtime", "import_core", "import_jsx_runtime", "a", "b", "pinnedComment", "import_jsx_runtime", "resource", "props", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_core", "import_jsx_runtime", "f", "v", "import_jsx_runtime", "a", "b", "import_core", "import_react", "import_core", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_jsx_runtime", "root", "table", "tr", "th", "control", "icon", "import_core", "import_jsx_runtime", "state", "f", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_core", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_core", "import_hooks", "import_react", "import_jsx_runtime", "import_core", "import_hooks", "import_react", "import_jsx_runtime", "import_core", "import_hooks", "import_react", "import_jsx_runtime", "import_core", "import_hooks", "import_react", "import_jsx_runtime", "import_core", "import_hooks", "import_react", "import_core", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "section", "hovering", "editing", "bottomActions", "import_jsx_runtime", "defaultValue", "x", "import_core", "import_react", "import_core", "import_react", "import_core", "QuestionnaireItemType", "option", "generateId", "nextId", "import_react", "import_jsx_runtime", "a", "defaultValue", "data", "option", "section", "hovering", "editing", "questionBody", "topActions", "bottomActions", "movementActions", "movementIcons", "columnAlignment", "linkIdInput", "typeSelect", "import_jsx_runtime", "defaultValue", "isResource", "isResourceType", "item", "generateId", "nextId", "import_core", "import_react", "import_core", "import_core", "import_react", "import_jsx_runtime", "r", "_", "import_core", "import_react", "import_jsx_runtime", "responses", "r", "newResponse", "import_jsx_runtime", "import_jsx_runtime", "import_core", "import_react", "section", "import_jsx_runtime", "groupId", "g", "nextId", "f", "import_core", "import_react", "import_jsx_runtime", "import_react", "import_core", "N", "k", "j", "a", "b", "k", "container", "root", "startRow", "normalRow", "author", "dateTime", "lineNumber", "line", "pre", "import_jsx_runtime", "import_core", "removed", "added", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "defaultValue", "import_core", "import_react", "import_jsx_runtime", "getVersionUrl", "import_core", "import_react", "container", "info", "selection", "import_jsx_runtime", "getStart", "getEnd", "import_core", "import_jsx_runtime", "import_core", "import_notifications", "import_jsx_runtime", "import_core", "import_react", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_react", "import_jsx_runtime", "import_jsx_runtime", "import_jsx_runtime", "import_notifications", "import_core", "import_react", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_core", "import_jsx_runtime", "import_core", "import_react", "import_jsx_runtime", "import_jsx_runtime"]
}
